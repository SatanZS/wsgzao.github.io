<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>HelloDog</title>
  <subtitle>Keep Calm and Carry On</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://wsgzao.github.io/"/>
  <updated>2018-04-19T02:55:09.836Z</updated>
  <id>https://wsgzao.github.io/</id>
  
  <author>
    <name>wsgzao</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>RHEL7/CentOS7在线和离线安装GitLab配置使用实践</title>
    <link href="https://wsgzao.github.io/post/gitlab/"/>
    <id>https://wsgzao.github.io/post/gitlab/</id>
    <published>2018-04-19T08:40:53.000Z</published>
    <updated>2018-04-19T02:55:09.836Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>GitLab Community Edition 新版本已经集成了CI/CD的支持，从某种程度上来说可以告别对于Jenkins的依赖，我本来计划是写基于Docker部署GitLab但感觉还是有点重，对于内网离线环境来说基于容器部署也未必是合理的方案，这里沿用传统的部署方式介绍简单且长期有效的GitLab部署方案供大家参考，或许未来会增加基于容器的部署方案和CI/CD的分享，因需而变。</p>
<blockquote>
<p>RHEL7/CentOS7在线和离线安装GitLab配置实践，GitLab汉化配置使用小结</p>
</blockquote>
<h2 id="更新记录"><a href="#更新记录" class="headerlink" title="更新记录"></a>更新记录</h2><p>2018年04月19日 - 完善内容<br>2018年04月10日 - 初稿</p>
<p>阅读原文 - <a href="https://wsgzao.github.io/post/gitlab/">https://wsgzao.github.io/post/gitlab/</a></p>
<p><strong>扩展阅读</strong></p>
<p>GitLab Installation - <a href="https://about.gitlab.com/installation" target="_blank" rel="external">https://about.gitlab.com/installation</a></p>
<h2 id="GitLab简介"><a href="#GitLab简介" class="headerlink" title="GitLab简介"></a>GitLab简介</h2><p>GitLab是利用Ruby On Rails开发的一个开源版本管理系统，实现了一个自托管的Git项目仓库，是集代码托管，测试，部署于一体的开源git仓库管理软件，可通过web界面来进行访问公开的或私人项目。与Github类似，GitLab能够浏览代码，管理缺陷和注释。可以管理团队对仓库的访问，它非常易于浏览提交过的版本，并提供一个文件历史库。它还提供一个代码片段收集功能可以轻松实现代码复用，便于日后需要的时候查找。</p>
<blockquote>
<p>Git的家族成员</p>
</blockquote>
<ul>
<li>Git：是一种版本控制系统，是一个命令，是一种工具。</li>
<li>Gitlib：是用于实现Git功能的开发库。</li>
<li>Github：是一个基于Git实现的在线代码托管仓库，公开项目是免费的，也可以付费创建私人项目。</li>
<li>GitLab：是一个基于Git实现的在线代码仓库托管软件，可以用GitLab搭建一套类似Github的系统。</li>
</ul>
<p>GitLab对硬件还是有一定要求的，1核心的CPU基本上可以满足需求，大概支撑100个左右的用户，不过在运行GitLab网站的同时还需要运行多个后台job，就会显得有点捉襟见肘了。需要至少4GB的可寻址内存（RAM交换）来安装和使用GitLab，操作系统和任何其他正在运行的应用程序也将使用内存，因此请记住，在运行GitLab之前，您至少需要4GB的可用空间。如果使用更少的内存，GitLab将在重新配置运行期间给出奇怪的错误，我用虚拟机来分别新建1G,2G内存的CentOS系统来装GitLab，确实非常捉襟见肘啊，伤不起。</p>
<h3 id="Gitlab的服务构成"><a href="#Gitlab的服务构成" class="headerlink" title="Gitlab的服务构成"></a>Gitlab的服务构成</h3><ul>
<li>Nginx：静态web服务器</li>
<li>gitlab-shell：用于处理Git命令和修改authorized keys列表</li>
<li>gitlab-workhorse: 轻量级的反向代理服务器</li>
<li>logrotate：日志文件管理工具</li>
<li>postgresql：数据库</li>
<li>redis：缓存数据库</li>
<li>sidekiq：用于在后台执行队列任务（异步执行）</li>
<li>unicorn：An HTTP server for Rack applications，GitLab Rails应用是托管在这个服务器上面的</li>
</ul>
<h3 id="GitLab工作流程"><a href="#GitLab工作流程" class="headerlink" title="GitLab工作流程"></a>GitLab工作流程</h3><p><img src="http://docs-aliyun.cn-hangzhou.oss.aliyun-inc.com/assets/pic/52857/cn_zh/1492756915645/%E5%9B%BE%E7%89%878.png" alt=""></p>
<h2 id="GitLab安装"><a href="#GitLab安装" class="headerlink" title="GitLab安装"></a>GitLab安装</h2><h3 id="基础依赖"><a href="#基础依赖" class="headerlink" title="基础依赖"></a>基础依赖</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">yum install curl policycoreutils openssh-server openssh-clients -y</div><div class="line">systemctl <span class="built_in">enable</span> sshd</div><div class="line">systemctl start sshd</div><div class="line">yum install postfix</div><div class="line">systemctl <span class="built_in">enable</span> postfix</div><div class="line"></div><div class="line"><span class="comment"># 检查修改邮件下面2项配置，不配置可以跳过</span></div><div class="line">vim /etc/postfix/main.cf </div><div class="line"></div><div class="line">inet_interfaces = all</div><div class="line">inet_protocols = ipv4</div><div class="line"></div><div class="line">systemctl start postfix</div></pre></td></tr></table></figure>
<h3 id="在线安装gitlab-ce"><a href="#在线安装gitlab-ce" class="headerlink" title="在线安装gitlab-ce"></a>在线安装gitlab-ce</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 安装必要的依赖包，如果不需要可以考虑跳过</span></div><div class="line">yum install pygpgme yum-utils</div><div class="line"><span class="comment"># On CentOS 7 (and RedHat/Oracle/Scientific Linux 7), the commands below will also open HTTP and SSH access in the system firewall.</span></div><div class="line">sudo yum install -y curl policycoreutils-python openssh-server</div><div class="line">sudo systemctl <span class="built_in">enable</span> sshd</div><div class="line">sudo systemctl start sshd</div><div class="line">sudo firewall-cmd --permanent --add-service=http</div><div class="line">sudo systemctl reload firewalld</div><div class="line"><span class="comment"># Next, install Postfix to send notification emails. If you want to use another solution to send emails please skip this step and configure an external SMTP server after GitLab has been installed.</span></div><div class="line">sudo yum install postfix</div><div class="line">sudo systemctl <span class="built_in">enable</span> postfix</div><div class="line">sudo systemctl start postfix</div><div class="line"></div><div class="line"><span class="comment"># 使用阿里云作加速</span></div><div class="line"><span class="built_in">cd</span> /etc/yum.repos.d/ &amp;&amp; rm -f *.repo</div><div class="line">wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</div><div class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</div><div class="line"></div><div class="line"><span class="comment"># 添加GitLab镜像源并安装，建议切换国内资源加速访问</span></div><div class="line">curl https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh | sudo bash</div><div class="line"></div><div class="line"><span class="comment"># 创建gitlab-ce的repo，使用清华大学加速</span></div><div class="line">vim /etc/yum.repos.d/gitlab_gitlab-ce.repo</div><div class="line"></div><div class="line">[gitlab-ce]</div><div class="line">name=gitlab-ce</div><div class="line">baseurl=http://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7</div><div class="line">repo_gpgcheck=0</div><div class="line">gpgcheck=0</div><div class="line">enabled=1</div><div class="line">gpgkey=https://packages.gitlab.com/gpg.key</div><div class="line"></div><div class="line"><span class="comment">#配置并启动 GitLab</span></div><div class="line">gitlab-ctl reconfigure</div><div class="line"></div><div class="line"><span class="comment"># 第一次访问GitLab，系统会重定向页面到重定向到重置密码页面，你需要输入初始化管理员账号的密码，管理员的用户名为root，重置密码后新密码即为刚输入的密码。</span></div><div class="line">0.0.0.0:80</div></pre></td></tr></table></figure>
<h3 id="离线安装gitlab-ce"><a href="#离线安装gitlab-ce" class="headerlink" title="离线安装gitlab-ce"></a>离线安装gitlab-ce</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 使用阿里云作加速</span></div><div class="line"><span class="built_in">cd</span> /etc/yum.repos.d/ &amp;&amp; rm -f *.repo</div><div class="line">wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</div><div class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</div><div class="line"></div><div class="line"><span class="comment"># 添加GitLab镜像源并安装，建议切换国内资源加速访问</span></div><div class="line">curl https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh | sudo bash</div><div class="line"></div><div class="line"><span class="comment"># 创建gitlab-ce的repo，使用清华大学加速</span></div><div class="line">vim /etc/yum.repos.d/gitlab_gitlab-ce.repo</div><div class="line"></div><div class="line">[gitlab-ce]</div><div class="line">name=gitlab-ce</div><div class="line">baseurl=http://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7</div><div class="line">repo_gpgcheck=0</div><div class="line">gpgcheck=0</div><div class="line">enabled=1</div><div class="line">gpgkey=https://packages.gitlab.com/gpg.key</div><div class="line"></div><div class="line"><span class="comment">#安装yum-plugin-downloadonly插件</span></div><div class="line">yum install -y yum-plugin-downloadonly</div><div class="line"></div><div class="line"><span class="comment"># 下载gitlab-ce相关rpm到指定目录</span></div><div class="line">mkdir -p /tmp/repo/gitlab-ce/</div><div class="line">yum install --downloadonly --downloaddir=/tmp/repo/gitlab-ce/ gitlab-ce</div><div class="line"></div><div class="line"><span class="comment"># 拷贝文件至内网离线安装</span></div><div class="line">rpm -ivh /tmp/repo/gitlab-ce/*</div><div class="line"></div><div class="line"><span class="comment">#配置并启动 GitLab</span></div><div class="line">gitlab-ctl reconfigure</div><div class="line"></div><div class="line"><span class="comment"># 第一次访问GitLab，系统会重定向页面到重定向到重置密码页面，你需要输入初始化管理员账号的密码，管理员的用户名为root，重置密码后新密码即为刚输入的密码。</span></div><div class="line">0.0.0.0:80</div></pre></td></tr></table></figure>
<h2 id="GitLab汉化"><a href="#GitLab汉化" class="headerlink" title="GitLab汉化"></a>GitLab汉化</h2><blockquote>
<p>如果团队里英文水平都不错的话，是没必要汉化的，我个人的建议是坚持使用原版不做汉化</p>
</blockquote>
<p>GitLab中文社区的项目，v7-v8.8是由Larry Li发起的“GitLab中文社区版项目”<br><a href="https://gitlab.com/larryli/gitlab" target="_blank" rel="external">https://gitlab.com/larryli/gitlab</a></p>
<p>从v8.9之后由@xhang开始继续汉化项目<br><a href="https://gitlab.com/xhang/gitlab" target="_blank" rel="external">https://gitlab.com/xhang/gitlab</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 如没安装git，需提前安装</span></div><div class="line">yum install -y git</div><div class="line"></div><div class="line"><span class="comment"># 创建gitlba汉化包下载目录</span></div><div class="line">mkdir -p /tmp/gitlab</div><div class="line"><span class="built_in">cd</span> /tmp/gitlab</div><div class="line"></div><div class="line"><span class="comment"># 下载最新的汉化包</span></div><div class="line">git <span class="built_in">clone</span> https://gitlab.com/xhang/gitlab.git</div><div class="line"></div><div class="line"><span class="comment"># 如果是要下载老版本的汉化包，需要加上老版本的分支，如果想下载10.0.2，可以运行如下语句</span></div><div class="line">git <span class="built_in">clone</span> https://gitlab.com/xhang/gitlab.git -b v10.0.2-zh</div><div class="line"></div><div class="line"><span class="comment"># 停止GitLab并执行如下语句</span></div><div class="line">gitlab-ctl stop</div><div class="line">cp /tmp/gitlab/gitlab/* /opt/gitlab/embedded/service/gitlab-rails/ -rf</div><div class="line"></div><div class="line"><span class="comment"># 复制时可能不断提示是否要覆盖，这时可能是系统每次执行cp命令时，其实是执行了cp -i命令的别名。出现这种情况可以修改~/.bashrc，在“alias cp=’cp-i’”前加#注释即可。使用命令或者注销登录即可</span></div><div class="line"><span class="built_in">source</span> ~/.bashrc</div><div class="line"></div><div class="line"><span class="comment"># 接下来可以重新配置和启动</span></div><div class="line">gitlab-ctl reconfigure</div><div class="line">gitlab-ctl restart</div></pre></td></tr></table></figure>
<h2 id="GitLab-常用命令"><a href="#GitLab-常用命令" class="headerlink" title="GitLab 常用命令"></a>GitLab 常用命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 语法</span></div><div class="line">gitlab-ctl <span class="built_in">command</span> (subcommand)</div><div class="line"></div><div class="line">Service Management Commands</div><div class="line"></div><div class="line">start <span class="comment"># 启动所有服务</span></div><div class="line">stop <span class="comment"># 关闭所有服务</span></div><div class="line">restart <span class="comment"># 重启所有服务</span></div><div class="line">status <span class="comment"># 查看所有服务状态</span></div><div class="line">tail <span class="comment"># 查看日志信息</span></div><div class="line">service-list <span class="comment"># 列举所有启动服务</span></div><div class="line">graceful-kill <span class="comment"># 平稳停止一个服务</span></div><div class="line"></div><div class="line"><span class="comment"># 启动所有服务</span></div><div class="line">gitlab-ctl start </div><div class="line"><span class="comment"># 启动单独一个服务</span></div><div class="line">gitlab-ctl start nginx</div><div class="line"><span class="comment">#查看日志，查看所有日志</span></div><div class="line">gitlab-ctl tail</div><div class="line"><span class="comment">#查看具体一个日志,类似tail -f</span></div><div class="line">gitlab-ctl tail nginx</div><div class="line"></div><div class="line">General Commands</div><div class="line"></div><div class="line"><span class="built_in">help</span> <span class="comment"># 帮助</span></div><div class="line">reconfigure <span class="comment"># 修改配置文件之后，需要重新加载下</span></div><div class="line">show-config <span class="comment"># 查看所有服务配置文件信息</span></div><div class="line">uninstall <span class="comment"># 卸载这个软件</span></div><div class="line">cleanse <span class="comment"># 删除gitlab数据，重新白手起家</span></div><div class="line"></div><div class="line"><span class="comment"># 显示所有服务配置文件</span></div><div class="line">gitlab-ctl show-config</div><div class="line"></div><div class="line"><span class="comment"># 卸载gitlab</span></div><div class="line">gitlab-ctl uninstall</div></pre></td></tr></table></figure>
<h2 id="公网邮箱配置"><a href="#公网邮箱配置" class="headerlink" title="公网邮箱配置"></a>公网邮箱配置</h2><p>默认情况下，GitLab用qq邮箱注册是发不出确认邮件的。查看了网上很多邮箱配置的教程，大部分都是误导的。像这类软件，归根到底总结为一句话：一切以官网文档为准。QQ邮箱最好用企业邮箱，本人用个人邮箱进行测试是有些小问题的，正确配置如下：</p>
<p>其他邮箱可以参考官方给出的 SMTP 配置 SMTP Setting<br><a href="https://docs.gitlab.com/omnibus/settings/smtp.html" target="_blank" rel="external">https://docs.gitlab.com/omnibus/settings/smtp.html</a></p>
<h3 id="QQ企业邮箱"><a href="#QQ企业邮箱" class="headerlink" title="QQ企业邮箱"></a>QQ企业邮箱</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 编辑gitlab.rb</span></div><div class="line">vim /etc/gitlab/gitlab.rb</div><div class="line"></div><div class="line">gitlab_rails[<span class="string">'smtp_enable'</span>] = <span class="literal">true</span></div><div class="line">gitlab_rails[<span class="string">'smtp_address'</span>] = <span class="string">"smtp.exmail.qq.com"</span></div><div class="line">gitlab_rails[<span class="string">'smtp_port'</span>] = 465</div><div class="line">gitlab_rails[<span class="string">'smtp_user_name'</span>] = <span class="string">"xxxx@xx.com"</span></div><div class="line">gitlab_rails[<span class="string">'smtp_password'</span>] = <span class="string">"password"</span></div><div class="line">gitlab_rails[<span class="string">'smtp_authentication'</span>] = <span class="string">"login"</span></div><div class="line">gitlab_rails[<span class="string">'smtp_enable_starttls_auto'</span>] = <span class="literal">true</span></div><div class="line">gitlab_rails[<span class="string">'smtp_tls'</span>] = <span class="literal">true</span></div><div class="line">gitlab_rails[<span class="string">'gitlab_email_from'</span>] = <span class="string">'xxxx@xx.com'</span></div></pre></td></tr></table></figure>
<h3 id="163邮箱"><a href="#163邮箱" class="headerlink" title="163邮箱"></a>163邮箱</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 编辑gitlab.rb</span></div><div class="line">vim /etc/gitlab/gitlab.rb</div><div class="line"></div><div class="line">gitlab_rails[<span class="string">'smtp_enable'</span>] = <span class="literal">true</span></div><div class="line">gitlab_rails[<span class="string">'smtp_address'</span>] = <span class="string">"smtp.163.com"</span></div><div class="line">gitlab_rails[<span class="string">'smtp_port'</span>] = 25</div><div class="line">gitlab_rails[<span class="string">'smtp_user_name'</span>] = <span class="string">"gitlab@163.com"</span></div><div class="line">gitlab_rails[<span class="string">'smtp_password'</span>] = <span class="string">"123456"</span></div><div class="line">gitlab_rails[<span class="string">'smtp_domain'</span>] = <span class="string">"163.com"</span></div><div class="line">gitlab_rails[<span class="string">'smtp_authentication'</span>] = <span class="string">"login"</span></div><div class="line">gitlab_rails[<span class="string">'smtp_enable_starttls_auto'</span>] = <span class="literal">true</span></div><div class="line">gitlab_rails[<span class="string">'gitlab_email_from'</span>] = <span class="string">'gitlab@163.com'</span></div><div class="line">gitlab_rails[<span class="string">'smtp_tls'</span>] = <span class="literal">false</span></div><div class="line">gitlab_rails[<span class="string">'smtp_openssl_verify_mode'</span>] = <span class="literal">false</span></div></pre></td></tr></table></figure>
<h3 id="阿里云企业邮箱"><a href="#阿里云企业邮箱" class="headerlink" title="阿里云企业邮箱"></a>阿里云企业邮箱</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 编辑gitlab.rb</span></div><div class="line">vim /etc/gitlab/gitlab.rb</div><div class="line"></div><div class="line">gitlab_rails[<span class="string">'smtp_enable'</span>] = <span class="literal">true</span></div><div class="line">gitlab_rails[<span class="string">'smtp_address'</span>] = <span class="string">"smtp.mxhichina.com"</span></div><div class="line">gitlab_rails[<span class="string">'smtp_port'</span>] = 465</div><div class="line">gitlab_rails[<span class="string">'smtp_user_name'</span>] = <span class="string">"gitlab@aliyun.com"</span></div><div class="line">gitlab_rails[<span class="string">'smtp_password'</span>] = <span class="string">"************"</span></div><div class="line">gitlab_rails[<span class="string">'smtp_domain'</span>] = <span class="string">"aliyun.com"</span></div><div class="line">gitlab_rails[<span class="string">'smtp_authentication'</span>] = <span class="string">"login"</span></div><div class="line">gitlab_rails[<span class="string">'smtp_enable_starttls_auto'</span>] = <span class="literal">true</span></div><div class="line">gitlab_rails[<span class="string">'gitlab_email_from'</span>] = <span class="string">'gitlab@aliyun.com'</span></div></pre></td></tr></table></figure>
<h2 id="GitLab使用"><a href="#GitLab使用" class="headerlink" title="GitLab使用"></a>GitLab使用</h2><h3 id="登录GitLab"><a href="#登录GitLab" class="headerlink" title="登录GitLab"></a>登录GitLab</h3><ol>
<li>在浏览器的地址栏中输入IP即可登录GitLab的界面，老版本第一次登录使用的用户名和密码为 <code>root</code> 和 <code>5iveL!fe</code></li>
<li>首次登录会强制用户修改密码。密码修改成功后，输入新密码进行登录</li>
</ol>
<h3 id="创建Project"><a href="#创建Project" class="headerlink" title="创建Project"></a>创建Project</h3><p>1.安装Git工具linux：安装Git，使用自带的源安装</p>
<pre><code>yum install git
</code></pre><p>2.生成密钥文件：使用ssh-keygen生成密钥文件.ssh/id_rsa.pub。</p>
<pre><code>ssh-keygen -t rsa
</code></pre><p>3.在GitLab的主页中新建一个Project</p>
<p>4.添加ssh key导入步骤2中生成的密钥文件内容：</p>
<pre><code>Profile Settings =&gt; SSH Keys =&gt; Add SSH key
</code></pre><h3 id="简单配置"><a href="#简单配置" class="headerlink" title="简单配置"></a>简单配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 配置使用Git仓库的人员姓名</span></div><div class="line">git config --global user.name <span class="string">"wangao"</span> </div><div class="line"><span class="comment"># 配置使用Git仓库的人员email，填写自己的公司邮箱</span></div><div class="line">git config --global user.email <span class="string">"wangao@test.com"</span> </div><div class="line"><span class="comment"># 克隆项目，在本地生成同名目录，并且目录中会有所有的项目文件</span></div><div class="line">git <span class="built_in">clone</span> git@172.28.70.126:root/test.git</div><div class="line"><span class="comment"># 进入到项目目录</span></div><div class="line"><span class="built_in">cd</span> <span class="built_in">test</span>/ </div><div class="line"><span class="comment"># 创建需要上传到GitLab中的目标文件</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"test"</span> &gt; test.sh</div><div class="line"><span class="comment"># 将test.sh文件加入到索引中</span></div><div class="line">git add test.sh</div><div class="line"><span class="comment"># 将test.sh提交到本地仓库</span></div><div class="line">git commit -m <span class="string">"test.sh"</span></div><div class="line"><span class="comment"># 将文件同步到GitLab服务器上</span></div><div class="line">git push -u origin master</div><div class="line"><span class="comment"># 在网页中查看上传的test.sh文件已经同步到GitLab中</span></div></pre></td></tr></table></figure>
<h2 id="配置-GitLab"><a href="#配置-GitLab" class="headerlink" title="配置 GitLab"></a>配置 GitLab</h2><h3 id="设置外部访问链接"><a href="#设置外部访问链接" class="headerlink" title="设置外部访问链接"></a>设置外部访问链接</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 编辑 /etc/gitlab/gitlab.rb</span></div><div class="line">vim /etc/gitlab/gitlab.rb</div><div class="line"></div><div class="line"><span class="comment"># 修改第 13 行，改成 http(s)://ip(: 端口) 或者 http(s):// 域名 (: 端口)，（如果云主机上存在 Web 服务占用了 80,443 端口，则 GitLab 不能适用 80,443），比如：</span></div><div class="line">external_url <span class="string">"https://repo.gitlab.com"</span></div></pre></td></tr></table></figure>
<h3 id="HTTPS-配置"><a href="#HTTPS-配置" class="headerlink" title="HTTPS 配置"></a>HTTPS 配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 第513行开始，将SSL证书以及密钥放入/etc/gitlab/ssl/</span></div><div class="line">nginx[<span class="string">'enable'</span>] = <span class="literal">true</span></div><div class="line">nginx[<span class="string">'redirect_http_to_https'</span>] = <span class="literal">true</span></div><div class="line">nginx[<span class="string">'ssl_certificate'</span>] = <span class="string">"/etc/gitlab/ssl/server.crt"</span></div><div class="line">nginx[<span class="string">'ssl_certificate_key'</span>] = <span class="string">"/etc/gitlab/ssl/server.key"</span></div></pre></td></tr></table></figure>
<h3 id="应用配置"><a href="#应用配置" class="headerlink" title="应用配置"></a>应用配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 使配置生效</span></div><div class="line">sudo gitlab-ctl reconfigure</div><div class="line"></div><div class="line"><span class="comment"># 开启gitlab</span></div><div class="line">sudo gitlab-ctl start</div><div class="line"></div><div class="line"><span class="comment"># 查看状态</span></div><div class="line">sudo gitlab-ctl status</div></pre></td></tr></table></figure>
<h2 id="GitLab-备份升级迁移"><a href="#GitLab-备份升级迁移" class="headerlink" title="GitLab 备份升级迁移"></a>GitLab 备份升级迁移</h2><h3 id="GitLab-备份"><a href="#GitLab-备份" class="headerlink" title="GitLab 备份"></a>GitLab 备份</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">ansible-rhel7.4@JQ/opt/gitlab/etc<span class="comment">#gitlab-rake gitlab:backup:create</span></div><div class="line">Dumping database ... </div><div class="line">Dumping PostgreSQL database gitlabhq_production ... [DONE]</div><div class="line"><span class="keyword">done</span></div><div class="line">Dumping repositories ...</div><div class="line"> * root/ansible ... [DONE]</div><div class="line"> * root/ansible.wiki ...  [SKIPPED]</div><div class="line"><span class="keyword">done</span></div><div class="line">Dumping uploads ... </div><div class="line"><span class="keyword">done</span></div><div class="line">Dumping builds ... </div><div class="line"><span class="keyword">done</span></div><div class="line">Dumping artifacts ... </div><div class="line"><span class="keyword">done</span></div><div class="line">Dumping pages ... </div><div class="line"><span class="keyword">done</span></div><div class="line">Dumping lfs objects ... </div><div class="line"><span class="keyword">done</span></div><div class="line">Dumping container registry images ... </div><div class="line">[DISABLED]</div><div class="line">Creating backup archive: 1524016954_2018_04_18_10.6.3_gitlab_backup.tar ... <span class="keyword">done</span></div><div class="line">Uploading backup archive to remote storage  ... skipped</div><div class="line">Deleting tmp directories ... <span class="keyword">done</span></div><div class="line"><span class="keyword">done</span></div><div class="line"><span class="keyword">done</span></div><div class="line"><span class="keyword">done</span></div><div class="line"><span class="keyword">done</span></div><div class="line"><span class="keyword">done</span></div><div class="line"><span class="keyword">done</span></div><div class="line"><span class="keyword">done</span></div><div class="line">Deleting old backups ... skipping</div><div class="line"></div><div class="line">ansible-rhel7.4@JQ/opt/gitlab<span class="comment">#cd /var/opt/gitlab/backups</span></div><div class="line">ansible-rhel7.4@JQ/var/opt/gitlab/backups<span class="comment">#ll</span></div><div class="line">total 22372</div><div class="line">-rw------- 1 git git 22906880 Apr 18 10:02 1524016954_2018_04_18_10.6.3_gitlab_backup.tar</div></pre></td></tr></table></figure>
<h3 id="GitLab-升级"><a href="#GitLab-升级" class="headerlink" title="GitLab 升级"></a>GitLab 升级</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 停止gitlab相关服务</span></div><div class="line">gitlab-ctl stop</div><div class="line"></div><div class="line"><span class="comment"># 下载离线包升级gitlab，建议不要跨3个以上大版本升级，具体升级方案请参考官方文档</span></div><div class="line">rpm -Uvh gitlab-ce-10.6.3-ce.0.el7.x86_64.rpm</div><div class="line"></div><div class="line"><span class="comment"># 重新配置gitlab</span></div><div class="line">gitlab-ctl reconfigure</div><div class="line"></div><div class="line"><span class="comment"># 启动gitlab</span></div><div class="line">gitlab-ctl start</div></pre></td></tr></table></figure>
<h3 id="GitLab-迁移"><a href="#GitLab-迁移" class="headerlink" title="GitLab 迁移"></a>GitLab 迁移</h3><ol>
<li>GitLab 迁移的前提是新旧机器GitLab版本必须一致</li>
<li>在旧机器备份,默认会在/var/opt/gitlab/backups/ 创建备份文件#gitlab-rake gitlab:backup:create</li>
<li>复制备份文件到新机器 /var/opt/gitlab/backups/</li>
<li>在新机器运行下面命令,停止相关数据连接服务,然后从备份文件恢复</li>
<li>启动gitlab</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 停止gitlab</span></div><div class="line">gitlab-ctl stop</div><div class="line"><span class="comment"># 从1524016954编号备份中恢复</span></div><div class="line">gitlab-rake gitlab:backup:restore BACKUP=1524016954 </div><div class="line"><span class="comment"># 启动gitlab</span></div><div class="line">gitlab-ctl start</div></pre></td></tr></table></figure>
<h2 id="GitLab-常见问题"><a href="#GitLab-常见问题" class="headerlink" title="GitLab 常见问题"></a>GitLab 常见问题</h2><h3 id="更改管理员密码"><a href="#更改管理员密码" class="headerlink" title="更改管理员密码"></a>更改管理员密码</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">gitlab-rails console production</div><div class="line"></div><div class="line">Loading production environment (Rails 4.8.5.2)</div><div class="line">irb(main):001:0&gt; user = User.where(id: 1).first</div><div class="line">=&gt; <span class="comment">#&lt;User id: 1, email: "admin@example.com", ...</span></div><div class="line">irb(main):002:0&gt; user.password=123456</div><div class="line">=&gt; 123456</div><div class="line">irb(main):003:0&gt; user.password_confirmation=123456</div><div class="line">=&gt; 123456</div><div class="line">irb(main):004:0&gt; user.save!</div><div class="line">=&gt; <span class="literal">true</span></div><div class="line">irb(main):005:0&gt; quit</div></pre></td></tr></table></figure>
<h3 id="webhooks不生效"><a href="#webhooks不生效" class="headerlink" title="webhooks不生效"></a>webhooks不生效</h3><p><a href="https://gitlab.com/gitlab-org/gitlab-ce/issues/45334" target="_blank" rel="external">https://gitlab.com/gitlab-org/gitlab-ce/issues/45334</a><br><a href="https://gitlab.com/gitlab-org/omnibus-gitlab/issues/3307#note_64245578" target="_blank" rel="external">https://gitlab.com/gitlab-org/omnibus-gitlab/issues/3307#note_64245578</a></p>
<p>Admin Area —- Settings —- Outbound request —- 勾选以下内容<br>Allow request to the local network from hooks and services</p>
<p><img src="https://www.ilanni.com/wp-content/uploads/2018/04/clip_image011_thumb-1.png" alt=""></p>
]]></content>
    
    <summary type="html">
    
      RHEL7/CentOS7在线和离线安装GitLab配置实践，GitLab汉化配置使用小结
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>3proxy 使用指北</title>
    <link href="https://wsgzao.github.io/post/3proxy/"/>
    <id>https://wsgzao.github.io/post/3proxy/</id>
    <published>2018-04-17T06:59:49.000Z</published>
    <updated>2018-04-17T02:04:49.034Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本文推荐的是3proxy但是也不能不提一下SSH端口转发，因为很多使用场景可能只需要借助SSH即可实现。SSH有三种端口转发模式，本地端口转发(Local Port Forwarding)，远程端口转发(Remote Port Forwarding)以及动态端口转发(Dynamic Port Forwarding)。对于本地/远程端口转发，两者的方向恰好相反。动态端口转发则可以用于科学上网。3roxy的角色类似于CCProxy，如果你熟悉CCProxy那配置3proxy应该也不会存在太大问题。</p>
<blockquote>
<p>3proxy tiny free proxy server</p>
</blockquote>
<h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2017年04月17日 - 初稿</p>
<p>阅读原文 - <a href="https://wsgzao.github.io/post/3proxy/">https://wsgzao.github.io/post/3proxy/</a></p>
<p><strong>扩展阅读</strong></p>
<p>3proxy - <a href="https://3proxy.ru/" target="_blank" rel="external">https://3proxy.ru/</a></p>
<hr>
<h2 id="3proxy简介"><a href="#3proxy简介" class="headerlink" title="3proxy简介"></a>3proxy简介</h2><p>3proxy是一款代理软件支持http/socks，支持windows和linux平台，安装和配置都很简单<br><a href="http://3proxy.ru/" target="_blank" rel="external">http://3proxy.ru/</a></p>
<p>详细的配置文档可以参考3proxy documentation How To (English, very incomplete)<br><a href="https://3proxy.ru/doc/howtoe.html" target="_blank" rel="external">https://3proxy.ru/doc/howtoe.html</a></p>
<p>关于3proxy的比较好的资料是<br><a href="http://linux.die.net/man/3/3proxy.cfg" target="_blank" rel="external">http://linux.die.net/man/3/3proxy.cfg</a><br><a href="https://github.com/z3APA3A/3proxy/wiki" target="_blank" rel="external">https://github.com/z3APA3A/3proxy/wiki</a></p>
<h2 id="3proxy安装配置"><a href="#3proxy安装配置" class="headerlink" title="3proxy安装配置"></a>3proxy安装配置</h2><h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><p>3proxy的代码代管在github上面，地址是：<a href="https://github.com/z3APA3A/3proxy" target="_blank" rel="external">https://github.com/z3APA3A/3proxy</a><br>安装步骤如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 通过git下载最新版3proxy源码</span></div><div class="line">git <span class="built_in">clone</span> https://github.com/z3APA3A/3proxy.git</div><div class="line"><span class="comment"># 切换到3proxy目录</span></div><div class="line"><span class="built_in">cd</span> 3proxy</div><div class="line"><span class="comment"># 编译3proxy,如果你的系统没有gcc，你需求先安装gcc</span></div><div class="line">make -f Makefile.Linux</div><div class="line"><span class="comment"># 安装3proxy</span></div><div class="line">make -f Makefile.Linux install</div></pre></td></tr></table></figure>
<p>编辑生成3proxy.cfg配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/local/bin/3proxy</span></div><div class="line"></div><div class="line">timeouts 1 5 30 60 180 1800 15 60</div><div class="line">service</div><div class="line"><span class="comment">#users ox:CL:ox</span></div><div class="line"><span class="built_in">log</span> /etc/3proxy/3proxy.log D</div><div class="line">logformat <span class="string">"- +_L%t.%.  %N.%p %E %U %C:%c %R:%r %O %I %h %T"</span></div><div class="line">rotate 30</div><div class="line">external 0.0.0.0</div><div class="line">internal 0.0.0.0</div><div class="line">auth iponly strong</div><div class="line">allow *</div><div class="line">proxy -a -p6666</div><div class="line">socks -p6667</div></pre></td></tr></table></figure>
<p>执行配置文件，如果有报错比如日志目录不存在和语法错误都会有具体提示</p>
<pre><code>3proxy 3proxy.cfg 
</code></pre><p>后台执行</p>
<pre><code>3proxy 3proxy.cfg &amp;
</code></pre><h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># string into 3proxy.cfg. Now, start command prompt (cmd.exe). Change directory to 3proxy installation and run 3proxy.exe --install:</span></div><div class="line">D:\&gt;C:</div><div class="line">C:\&gt;cd C:\Program Files\<span class="number">3</span>proxy</div><div class="line">C:\Program Files\<span class="number">3</span>proxy&gt;<span class="number">3</span>proxy.exe --install</div><div class="line"></div><div class="line"><span class="comment"># Now, you should have 3proxy service installed and running. If service is not started, remove "service" string from 3proxy.cfg, run 3proxy.exe manually and correct all errors.</span></div><div class="line"><span class="comment"># To remove 3proxy run 3proxy --remove:</span></div><div class="line"></div><div class="line">D:\&gt;C:</div><div class="line">C:\&gt;cd C:\Program Files\<span class="number">3</span>proxy</div><div class="line">C:\Program Files\<span class="number">3</span>proxy&gt;net stop <span class="number">3</span>proxy</div><div class="line">C:\Program Files\<span class="number">3</span>proxy&gt;<span class="number">3</span>proxy.exe --remove</div></pre></td></tr></table></figure>
<h2 id="客户端代理使用"><a href="#客户端代理使用" class="headerlink" title="客户端代理使用"></a>客户端代理使用</h2><h3 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h3><blockquote>
<p>有钱任性，服务端可以购买使用CCProxy</p>
</blockquote>
<ul>
<li>浏览器代理</li>
<li>Proxifier</li>
</ul>
<h3 id="Linux-1"><a href="#Linux-1" class="headerlink" title="Linux"></a>Linux</h3><ul>
<li>export http_proxy=””</li>
<li>proxychains(proxychains-ng)</li>
<li>redsocks + iptables</li>
</ul>
]]></content>
    
    <summary type="html">
    
      3proxy tiny free proxy server
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>proxychains 使用指北</title>
    <link href="https://wsgzao.github.io/post/proxychains/"/>
    <id>https://wsgzao.github.io/post/proxychains/</id>
    <published>2018-04-16T06:59:49.000Z</published>
    <updated>2018-04-17T09:34:23.492Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>proxychains新的版本已经称为proxychains-ng由rofl0r托管在GitHub中维护，一般使用proxychains用于加速更新和下载国外的一些开源组件，比如yum和pip。proxychains使用十分简单，甚至都不必编译安装。</p>
<blockquote>
<p>proxychains ng (new generation)</p>
</blockquote>
<h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2017年04月16日 - 初稿</p>
<p>阅读原文 - <a href="https://wsgzao.github.io/post/proxychains/">https://wsgzao.github.io/post/proxychains/</a></p>
<p><strong>扩展阅读</strong></p>
<p>proxychains-ng - <a href="https://github.com/rofl0r/proxychains-ng" target="_blank" rel="external">https://github.com/rofl0r/proxychains-ng</a></p>
<hr>
<h2 id="proxychains-简介"><a href="#proxychains-简介" class="headerlink" title="proxychains 简介"></a>proxychains 简介</h2><p>ProxyChains is a UNIX program, that hooks network-related libc functions in DYNAMICALLY LINKED programs via a preloaded DLL (dlsym(), LD_PRELOAD) and redirects the connections through SOCKS4a/5 or HTTP proxies. It supports TCP only (no UDP/ICMP etc).</p>
<p>The way it works is basically a HACK; so it is possible that it doesn’t work with your program, especially when it’s a script, or starts numerous processes like background daemons or uses dlopen() to load “modules” (bug in glibc dynlinker).</p>
<p>It should work with simple compiled (C/C++) dynamically linked programs though.</p>
<p>If your program doesn’t work with proxychains, consider using an iptables based solution instead; this is much more robust.</p>
<p>Supported Platforms: Linux, BSD, Mac.</p>
<h2 id="proxychains-安装配置"><a href="#proxychains-安装配置" class="headerlink" title="proxychains 安装配置"></a>proxychains 安装配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># needs a working C compiler, preferably gcc</span></div><div class="line">yum install gcc -y</div><div class="line">./configure --prefix=/usr --sysconfdir=/etc</div><div class="line">make</div><div class="line">[optional] sudo make install</div><div class="line">[optional] sudo make install-config (installs proxychains.conf)</div><div class="line"></div><div class="line"><span class="comment"># if you dont install, you can use proxychains from the build directory like this: </span></div><div class="line">./proxychains4 -f src/proxychains.conf telnet google.com 80</div><div class="line"></div><div class="line"><span class="comment"># 一般编辑proxychains.conf添加socks5地址即可立即使用</span></div><div class="line">vim /etc/proxychains.conf</div><div class="line"></div><div class="line">[ProxyList]</div><div class="line"><span class="comment"># add proxy here ...</span></div><div class="line"><span class="comment"># meanwile</span></div><div class="line"><span class="comment"># defaults set to "tor"</span></div><div class="line"><span class="comment">#socks4 	127.0.0.1 9050</span></div><div class="line">socks5 172.28.70.26 1080</div><div class="line"></div><div class="line"><span class="comment"># 测试</span></div><div class="line">[root@centos7 ~]<span class="comment"># curl myip.ipip.net</span></div><div class="line">当前 IP：116.228.53.149  来自于：中国 上海 上海  电信</div><div class="line">[root@centos7 ~]<span class="comment"># proxychains4 curl myip.ipip.net</span></div><div class="line">[proxychains] config file found: /etc/proxychains.conf</div><div class="line">[proxychains] preloading /usr/<span class="built_in">local</span>/lib/libproxychains4.so</div><div class="line">[proxychains] DLL init: proxychains-ng 4.12</div><div class="line">[proxychains] Strict chain  ...  172.28.70.26:1080  ...  myip.ipip.net:80  ...  OK</div><div class="line">当前 IP：45.79.192.22  来自于：美国 乔治亚州 亚特兰大  linode.com</div></pre></td></tr></table></figure>
<h2 id="proxychains-conf-配置文件"><a href="#proxychains-conf-配置文件" class="headerlink" title="proxychains.conf 配置文件"></a>proxychains.conf 配置文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div></pre></td><td class="code"><pre><div class="line">[root@centos7 ~]<span class="comment"># cat /etc/proxychains.conf </span></div><div class="line"><span class="comment"># proxychains.conf  VER 4.x</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#        HTTP, SOCKS4a, SOCKS5 tunneling proxifier with DNS.</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># The option below identifies how the ProxyList is treated.</span></div><div class="line"><span class="comment"># only one option should be uncommented at time,</span></div><div class="line"><span class="comment"># otherwise the last appearing option will be accepted</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#dynamic_chain</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Dynamic - Each connection will be done via chained proxies</span></div><div class="line"><span class="comment"># all proxies chained in the order as they appear in the list</span></div><div class="line"><span class="comment"># at least one proxy must be online to play in chain</span></div><div class="line"><span class="comment"># (dead proxies are skipped)</span></div><div class="line"><span class="comment"># otherwise EINTR is returned to the app</span></div><div class="line"><span class="comment">#</span></div><div class="line">strict_chain</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Strict - Each connection will be done via chained proxies</span></div><div class="line"><span class="comment"># all proxies chained in the order as they appear in the list</span></div><div class="line"><span class="comment"># all proxies must be online to play in chain</span></div><div class="line"><span class="comment"># otherwise EINTR is returned to the app</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#round_robin_chain</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Round Robin - Each connection will be done via chained proxies</span></div><div class="line"><span class="comment"># of chain_len length</span></div><div class="line"><span class="comment"># all proxies chained in the order as they appear in the list</span></div><div class="line"><span class="comment"># at least one proxy must be online to play in chain</span></div><div class="line"><span class="comment"># (dead proxies are skipped).</span></div><div class="line"><span class="comment"># the start of the current proxy chain is the proxy after the last</span></div><div class="line"><span class="comment"># proxy in the previously invoked proxy chain.</span></div><div class="line"><span class="comment"># if the end of the proxy chain is reached while looking for proxies</span></div><div class="line"><span class="comment"># start at the beginning again.</span></div><div class="line"><span class="comment"># otherwise EINTR is returned to the app</span></div><div class="line"><span class="comment"># These semantics are not guaranteed in a multithreaded environment.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#random_chain</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Random - Each connection will be done via random proxy</span></div><div class="line"><span class="comment"># (or proxy chain, see  chain_len) from the list.</span></div><div class="line"><span class="comment"># this option is good to test your IDS :)</span></div><div class="line"></div><div class="line"><span class="comment"># Make sense only if random_chain or round_robin_chain</span></div><div class="line"><span class="comment">#chain_len = 2</span></div><div class="line"></div><div class="line"><span class="comment"># Quiet mode (no output from library)</span></div><div class="line"><span class="comment">#quiet_mode</span></div><div class="line"></div><div class="line"><span class="comment"># Proxy DNS requests - no leak for DNS data</span></div><div class="line">proxy_dns </div><div class="line"></div><div class="line"><span class="comment"># set the class A subnet number to use for the internal remote DNS mapping</span></div><div class="line"><span class="comment"># we use the reserved 224.x.x.x range by default,</span></div><div class="line"><span class="comment"># if the proxified app does a DNS request, we will return an IP from that range.</span></div><div class="line"><span class="comment"># on further accesses to this ip we will send the saved DNS name to the proxy.</span></div><div class="line"><span class="comment"># in case some control-freak app checks the returned ip, and denies to </span></div><div class="line"><span class="comment"># connect, you can use another subnet, e.g. 10.x.x.x or 127.x.x.x.</span></div><div class="line"><span class="comment"># of course you should make sure that the proxified app does not need</span></div><div class="line"><span class="comment"># *real* access to this subnet. </span></div><div class="line"><span class="comment"># i.e. dont use the same subnet then in the localnet section</span></div><div class="line"><span class="comment">#remote_dns_subnet 127 </span></div><div class="line"><span class="comment">#remote_dns_subnet 10</span></div><div class="line">remote_dns_subnet 224</div><div class="line"></div><div class="line"><span class="comment"># Some timeouts in milliseconds</span></div><div class="line">tcp_read_time_out 15000</div><div class="line">tcp_connect_time_out 8000</div><div class="line"></div><div class="line"><span class="comment">### Examples for localnet exclusion</span></div><div class="line"><span class="comment">## localnet ranges will *not* use a proxy to connect.</span></div><div class="line"><span class="comment">## Exclude connections to 192.168.1.0/24 with port 80</span></div><div class="line"><span class="comment"># localnet 192.168.1.0:80/255.255.255.0</span></div><div class="line"></div><div class="line"><span class="comment">## Exclude connections to 192.168.100.0/24</span></div><div class="line"><span class="comment"># localnet 192.168.100.0/255.255.255.0</span></div><div class="line"></div><div class="line"><span class="comment">## Exclude connections to ANYwhere with port 80</span></div><div class="line"><span class="comment"># localnet 0.0.0.0:80/0.0.0.0</span></div><div class="line"></div><div class="line"><span class="comment">## RFC5735 Loopback address range</span></div><div class="line"><span class="comment">## if you enable this, you have to make sure remote_dns_subnet is not 127</span></div><div class="line"><span class="comment">## you'll need to enable it if you want to use an application that </span></div><div class="line"><span class="comment">## connects to localhost.</span></div><div class="line"><span class="comment"># localnet 127.0.0.0/255.0.0.0</span></div><div class="line"></div><div class="line"><span class="comment">## RFC1918 Private Address Ranges</span></div><div class="line"><span class="comment"># localnet 10.0.0.0/255.0.0.0</span></div><div class="line"><span class="comment"># localnet 172.16.0.0/255.240.0.0</span></div><div class="line"><span class="comment"># localnet 192.168.0.0/255.255.0.0</span></div><div class="line"></div><div class="line"><span class="comment"># ProxyList format</span></div><div class="line"><span class="comment">#       type  ip  port [user pass]</span></div><div class="line"><span class="comment">#       (values separated by 'tab' or 'blank')</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#       only numeric ipv4 addresses are valid</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#        Examples:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#            	socks5	192.168.67.78	1080	lamer	secret</span></div><div class="line"><span class="comment">#		http	192.168.89.3	8080	justu	hidden</span></div><div class="line"><span class="comment">#	 	socks4	192.168.1.49	1080</span></div><div class="line"><span class="comment">#	        http	192.168.39.93	8080	</span></div><div class="line"><span class="comment">#		</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#       proxy types: http, socks4, socks5</span></div><div class="line"><span class="comment">#        ( auth types supported: "basic"-http  "user/pass"-socks )</span></div><div class="line"><span class="comment">#</span></div><div class="line">[ProxyList]</div><div class="line"><span class="comment"># add proxy here ...</span></div><div class="line"><span class="comment"># meanwile</span></div><div class="line"><span class="comment"># defaults set to "tor"</span></div><div class="line"><span class="comment">#socks4 	127.0.0.1 9050</span></div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      proxychains ng (new generation)
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>使用pypiserver快速搭建内网离线pypi仓库实践</title>
    <link href="https://wsgzao.github.io/post/pypiserver/"/>
    <id>https://wsgzao.github.io/post/pypiserver/</id>
    <published>2018-04-12T08:40:53.000Z</published>
    <updated>2018-04-13T08:25:01.135Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本文介绍了如何快速搭建一个pypiserver，通过自建pypiserver，我们可以解决网络环境不好，或者离线无法安装python包的问题。如果结合最新的GitLab CI/CD和pipenv我相信各位还可以玩出更多的花样。</p>
<blockquote>
<p>pypiserver - minimal PyPI server for use with pip/easy_install</p>
</blockquote>
<h2 id="更新记录"><a href="#更新记录" class="headerlink" title="更新记录"></a>更新记录</h2><p>2018年04月12日 - 初稿</p>
<p>阅读原文 - <a href="https://wsgzao.github.io/post/pypiserver/">https://wsgzao.github.io/post/pypiserver/</a></p>
<p><strong>扩展阅读</strong></p>
<p>pypiserver - <a href="https://github.com/pypiserver/pypiserver" target="_blank" rel="external">https://github.com/pypiserver/pypiserver</a></p>
<h2 id="pypiserver-简介"><a href="#pypiserver-简介" class="headerlink" title="pypiserver 简介"></a>pypiserver 简介</h2><p>pypiserver is a minimal PyPI compatible server for pip or easy_install. It is based on bottle and serves packages from regular directories. Wheels, bdists, eggs and accompanying PGP-signatures can be uploaded either with pip, setuptools, twine, pypi-uploader, or simply copied with scp.</p>
<h2 id="pypiserver-服务端配置"><a href="#pypiserver-服务端配置" class="headerlink" title="pypiserver 服务端配置"></a>pypiserver 服务端配置</h2><blockquote>
<p>如果你的Linux环境缺少Python 2.7可以参考我的文章直接离线升级至最新版本</p>
</blockquote>
<p>Python 2.6 升级至 Python 2.7 的实践心得<br><a href="https://wsgzao.github.io/post/python-2-6-update-to-2-7/">https://wsgzao.github.io/post/python-2-6-update-to-2-7/</a></p>
<p>pypiserver &gt; 1.2.x works with python 2.7 and 3.3+ or pypy. Older python-versions may still work, but they are not tested. For legacy python versions, use pypiserver-1.1.x series.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 替换pip为阿里云，感概豆瓣的时代已经过去</span></div><div class="line">tee ~/.pip/pip.conf &lt;&lt;-<span class="string">'EOF'</span></div><div class="line">[global]</div><div class="line">index-url = https://mirrors.aliyun.com/pypi/simple/</div><div class="line">[install]</div><div class="line">trusted-host= mirrors.aliyun.com</div><div class="line">EOF</div><div class="line"></div><div class="line"><span class="comment"># 直接在线安装pypiserver</span></div><div class="line">pip install pypiserver</div><div class="line"><span class="comment"># 离线下载pypiserver</span></div><div class="line">mkdir /tmp/pypiserver</div><div class="line">pip install -d /tmp/pypiserver/ pypiserver</div><div class="line"></div><div class="line"><span class="comment"># Copy packages into this directory.</span></div><div class="line">mkdir ~/packages</div><div class="line"><span class="comment"># Copy some packages into your ~/packages folder and then get your pypiserver up and running:</span></div><div class="line">pypi-server -p 8080 ~/packages &amp;</div></pre></td></tr></table></figure>
<h2 id="pypiserver-客户端配置"><a href="#pypiserver-客户端配置" class="headerlink" title="pypiserver 客户端配置"></a>pypiserver 客户端配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">## Download and Install hosted packages.</span></div><div class="line">pip install  --extra-index-url http://localhost:8080/simple/ ...</div><div class="line"></div><div class="line"><span class="comment"># or</span></div><div class="line">pip install --extra-index-url http://localhost:8080</div><div class="line"></div><div class="line"><span class="comment">## Search hosted packages</span></div><div class="line">pip search --index http://localhost:8080 ...</div><div class="line"></div><div class="line"><span class="comment"># 个人推荐的配置</span></div><div class="line">tee ~/.pip/pip.conf &lt;&lt;-<span class="string">'EOF'</span></div><div class="line">[global]</div><div class="line">index-url = http://172.28.70.126/simple</div><div class="line">extra-index-url = https://mirrors.aliyun.com/pypi/simple/</div><div class="line">[install]</div><div class="line">trusted-host = 172.28.70.126</div><div class="line">EOF</div></pre></td></tr></table></figure>
<h2 id="pypiserver-进阶配置"><a href="#pypiserver-进阶配置" class="headerlink" title="pypiserver 进阶配置"></a>pypiserver 进阶配置</h2><blockquote>
<p>pypiserver Running as a systemd service</p>
</blockquote>
<p><a href="https://github.com/pypiserver/pypiserver#running-as-a-systemd-service" target="_blank" rel="external">https://github.com/pypiserver/pypiserver#running-as-a-systemd-service</a></p>
<p>Adjusting the paths and adding this file as pypiserver.service into your systemd/system directory will allow management of the pypiserver process with systemctl, e.g. systemctl start pypiserver.</p>
<p>More useful information about systemd can be found at <a href="https://www.digitalocean.com/community/tutorials/how-to-use-systemctl-to-manage-systemd-services-and-units" target="_blank" rel="external">https://www.digitalocean.com/community/tutorials/how-to-use-systemctl-to-manage-systemd-services-and-units</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 安装需要的包</span></div><div class="line">yum install nginx -y</div><div class="line">pip install passlib pypiserver gunicorn</div><div class="line"></div><div class="line"><span class="comment"># 创建pypiserver服务方便服务启停管理</span></div><div class="line">tee /usr/lib/systemd/system/pypiserver.service &lt;&lt;-<span class="string">'EOF'</span></div><div class="line">[Unit]</div><div class="line">Description=gunicorn daemon</div><div class="line">After=network.target</div><div class="line"></div><div class="line">[Service]</div><div class="line">PIDFile=/run/pypiserver.pid</div><div class="line">ExecStart=/usr/<span class="built_in">local</span>/bin/gunicorn -w16 \</div><div class="line">    --pid /run/pypiserver.pid \</div><div class="line">    -b :10012 \</div><div class="line">    <span class="string">'pypiserver:app(root="/var/www/pypi")'</span></div><div class="line">ExecReload=/bin/<span class="built_in">kill</span> -s HUP <span class="variable">$MAINPID</span></div><div class="line">ExecStop=/bin/<span class="built_in">kill</span> -s TERM <span class="variable">$MAINPID</span></div><div class="line"></div><div class="line">[Install]</div><div class="line">WantedBy=multi-user.target </div><div class="line">EOF</div><div class="line"></div><div class="line"><span class="comment"># Warning: pypiserver.service changed on disk. Run 'systemctl daemon-reload' to reload units.</span></div><div class="line">systemctl daemon-reload</div><div class="line"></div><div class="line"><span class="comment"># 启动pypiserver服务</span></div><div class="line">systemctl <span class="built_in">enable</span> pypiserver.service</div><div class="line">systemctl start pypiserver.service</div><div class="line">systemctl status pypiserver.service</div><div class="line"></div><div class="line"><span class="comment"># 停止pypiserver服务</span></div><div class="line">systemctl <span class="built_in">disable</span> pypiserver.service</div><div class="line">systemctl stop pypiserver.service</div><div class="line">systemctl status pypiserver.service</div><div class="line"></div><div class="line">[root@centos7 run]<span class="comment"># systemctl status pypiserver.service</span></div><div class="line">● pypiserver.service - gunicorn daemon</div><div class="line">   Loaded: loaded (/usr/lib/systemd/system/pypiserver.service; disabled; vendor preset: disabled)</div><div class="line">   Active: active (running) since Fri 2018-04-13 15:14:08 CST; 859ms ago</div><div class="line"> Main PID: 22524 (gunicorn)</div><div class="line">   CGroup: /system.slice/pypiserver.service</div><div class="line">           ├─22524 /usr/<span class="built_in">local</span>/bin/python /usr/<span class="built_in">local</span>/bin/gunicorn -w16 --pid /run/pypiserver.pid -b :10012 pypiserver:app(root=<span class="string">"/var/www/pypi"</span>)</div><div class="line">           ├─22530 /usr/<span class="built_in">local</span>/bin/python /usr/<span class="built_in">local</span>/bin/gunicorn -w16 --pid /run/pypiserver.pid -b :10012 pypiserver:app(root=<span class="string">"/var/www/pypi"</span>)</div><div class="line">           ├─22531 /usr/<span class="built_in">local</span>/bin/python /usr/<span class="built_in">local</span>/bin/gunicorn -w16 --pid /run/pypiserver.pid -b :10012 pypiserver:app(root=<span class="string">"/var/www/pypi"</span>)</div><div class="line">           ├─22532 /usr/<span class="built_in">local</span>/bin/python /usr/<span class="built_in">local</span>/bin/gunicorn -w16 --pid /run/pypiserver.pid -b :10012 pypiserver:app(root=<span class="string">"/var/www/pypi"</span>)</div><div class="line">           ├─22533 /usr/<span class="built_in">local</span>/bin/python /usr/<span class="built_in">local</span>/bin/gunicorn -w16 --pid /run/pypiserver.pid -b :10012 pypiserver:app(root=<span class="string">"/var/www/pypi"</span>)</div><div class="line">           ├─22534 /usr/<span class="built_in">local</span>/bin/python /usr/<span class="built_in">local</span>/bin/gunicorn -w16 --pid /run/pypiserver.pid -b :10012 pypiserver:app(root=<span class="string">"/var/www/pypi"</span>)</div><div class="line">           ├─22535 /usr/<span class="built_in">local</span>/bin/python /usr/<span class="built_in">local</span>/bin/gunicorn -w16 --pid /run/pypiserver.pid -b :10012 pypiserver:app(root=<span class="string">"/var/www/pypi"</span>)</div><div class="line">           ├─22536 /usr/<span class="built_in">local</span>/bin/python /usr/<span class="built_in">local</span>/bin/gunicorn -w16 --pid /run/pypiserver.pid -b :10012 pypiserver:app(root=<span class="string">"/var/www/pypi"</span>)</div><div class="line">           ├─22537 /usr/<span class="built_in">local</span>/bin/python /usr/<span class="built_in">local</span>/bin/gunicorn -w16 --pid /run/pypiserver.pid -b :10012 pypiserver:app(root=<span class="string">"/var/www/pypi"</span>)</div><div class="line">           ├─22538 /usr/<span class="built_in">local</span>/bin/python /usr/<span class="built_in">local</span>/bin/gunicorn -w16 --pid /run/pypiserver.pid -b :10012 pypiserver:app(root=<span class="string">"/var/www/pypi"</span>)</div><div class="line">           ├─22539 /usr/<span class="built_in">local</span>/bin/python /usr/<span class="built_in">local</span>/bin/gunicorn -w16 --pid /run/pypiserver.pid -b :10012 pypiserver:app(root=<span class="string">"/var/www/pypi"</span>)</div><div class="line">           └─22540 /usr/<span class="built_in">local</span>/bin/python /usr/<span class="built_in">local</span>/bin/gunicorn -w16 --pid /run/pypiserver.pid -b :10012 pypiserver:app(root=<span class="string">"/var/www/pypi"</span>)</div><div class="line"></div><div class="line">Apr 13 15:14:08 centos7 gunicorn[22524]: [2018-04-13 15:14:08 +0000] [22531] [INFO] Booting worker with pid: 22531</div><div class="line">Apr 13 15:14:08 centos7 gunicorn[22524]: [2018-04-13 15:14:08 +0000] [22532] [INFO] Booting worker with pid: 22532</div><div class="line">Apr 13 15:14:08 centos7 gunicorn[22524]: [2018-04-13 15:14:08 +0000] [22533] [INFO] Booting worker with pid: 22533</div><div class="line">Apr 13 15:14:08 centos7 gunicorn[22524]: [2018-04-13 15:14:08 +0000] [22534] [INFO] Booting worker with pid: 22534</div><div class="line">Apr 13 15:14:08 centos7 gunicorn[22524]: [2018-04-13 15:14:08 +0000] [22535] [INFO] Booting worker with pid: 22535</div><div class="line">Apr 13 15:14:08 centos7 gunicorn[22524]: [2018-04-13 15:14:08 +0000] [22536] [INFO] Booting worker with pid: 22536</div><div class="line">Apr 13 15:14:08 centos7 gunicorn[22524]: [2018-04-13 15:14:08 +0000] [22537] [INFO] Booting worker with pid: 22537</div><div class="line">Apr 13 15:14:08 centos7 gunicorn[22524]: [2018-04-13 15:14:08 +0000] [22538] [INFO] Booting worker with pid: 22538</div><div class="line">Apr 13 15:14:08 centos7 gunicorn[22524]: [2018-04-13 15:14:08 +0000] [22539] [INFO] Booting worker with pid: 22539</div><div class="line">Apr 13 15:14:08 centos7 gunicorn[22524]: [2018-04-13 15:14:08 +0000] [22540] [INFO] Booting worker with pid: 22540</div><div class="line">[root@centos7 run]<span class="comment"># netstat -tnlp</span></div><div class="line">Active Internet connections (only servers)</div><div class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </div><div class="line">tcp        0      0 0.0.0.0:111             0.0.0.0:*               LISTEN      1/systemd           </div><div class="line">tcp        0      0 192.168.122.1:53        0.0.0.0:*               LISTEN      1517/dnsmasq        </div><div class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      977/sshd            </div><div class="line">tcp        0      0 127.0.0.1:631           0.0.0.0:*               LISTEN      978/cupsd           </div><div class="line">tcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN      1383/master         </div><div class="line">tcp        0      0 127.0.0.1:6011          0.0.0.0:*               LISTEN      19378/sshd: root@pt </div><div class="line">tcp        0      0 0.0.0.0:10012           0.0.0.0:*               LISTEN      22524/python        </div><div class="line">tcp6       0      0 :::111                  :::*                    LISTEN      1/systemd           </div><div class="line">tcp6       0      0 :::22                   :::*                    LISTEN      977/sshd            </div><div class="line">tcp6       0      0 ::1:631                 :::*                    LISTEN      978/cupsd           </div><div class="line">tcp6       0      0 ::1:25                  :::*                    LISTEN      1383/master         </div><div class="line">tcp6       0      0 ::1:6011                :::*                    LISTEN      19378/sshd: root@pt </div><div class="line"></div><div class="line"><span class="comment"># 检查pypiserver服务</span></div><div class="line"><span class="built_in">cd</span> /var/www/pypi</div><div class="line"><span class="comment"># 向仓库中添加python package</span></div><div class="line">[root@centos7 pypi]<span class="comment"># pip download pypiserver</span></div><div class="line">Collecting pypiserver</div><div class="line">  Downloading https://mirrors.aliyun.com/pypi/packages/d7/78/5772432dad2b9e754ab92f4d301fa507069b9decc8c943c1b18c2043ff4f/pypiserver-1.2.1-py2.py3-none-any.whl (83kB)</div><div class="line">    100% |████████████████████████████████| 92kB 643kB/s </div><div class="line">  Saved ./pypiserver-1.2.1-py2.py3-none-any.whl</div><div class="line">Successfully downloaded pypiserver</div><div class="line"></div><div class="line">[root@centos7 pypi]<span class="comment"># ll</span></div><div class="line">total 84</div><div class="line">-rw-r--r-- 1 root root 83529 Apr 13 14:55 pypiserver-1.2.1-py2.py3-none-any.whl</div><div class="line"></div><div class="line"><span class="comment"># 搜索刚才下载的package</span></div><div class="line">[root@centos7 pypi]<span class="comment"># pip search -i http://127.0.0.1:10012 pypiserver</span></div><div class="line">pypiserver (1.2.1)  - 1.2.1</div><div class="line">  INSTALLED: 1.2.1 (latest)</div><div class="line"></div><div class="line"><span class="comment"># 配置nginx做反向代理</span></div><div class="line">tee /etc/nginx/conf.d/pypi.conf &lt;&lt;-<span class="string">'EOF'</span></div><div class="line">upstream pypiserver &#123;</div><div class="line">  server 127.0.0.1:10012;</div><div class="line">&#125;</div><div class="line"></div><div class="line">server &#123;</div><div class="line">  listen 10087;</div><div class="line"></div><div class="line">  <span class="comment"># disable any limits to avoid HTTP 413 for large package uploads</span></div><div class="line">  client_max_body_size 0;</div><div class="line"></div><div class="line">  location / &#123;</div><div class="line">    proxy_pass http://pypiserver/;</div><div class="line">    proxy_set_header Host <span class="variable">$host</span>;</div><div class="line">    proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</div><div class="line">    proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</div><div class="line"></div><div class="line">    <span class="comment"># When setting up pypiserver behind other proxy, such as an Nginx instance, remove the below line if the proxy already has similar settings.</span></div><div class="line">    proxy_set_header X-Forwarded-Proto <span class="variable">$scheme</span>;</div><div class="line"></div><div class="line">    proxy_buffering off;</div><div class="line">    proxy_request_buffering off;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  location /packages/ &#123;</div><div class="line">    <span class="built_in">alias</span> /var/www/pypi; <span class="comment"># static file</span></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">EOF</div><div class="line"></div><div class="line"><span class="comment"># 启动nginx</span></div><div class="line">systemctl <span class="built_in">enable</span> nginx</div><div class="line">systemctl start nginx</div><div class="line">systemctl status nginx</div><div class="line"></div><div class="line"><span class="comment"># 检查nginx服务</span></div><div class="line">pip search -i http://172.28.79.126:10087 pypiserver</div><div class="line">pypiserver (1.2.1)  - 1.2.1</div><div class="line">  INSTALLED: 1.2.1 (latest)</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      pypiserver - minimal PyPI server for use with pip/easy_install
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>Dokan+SSHFS 文件系统共享心得，代替Samba的理想之选</title>
    <link href="https://wsgzao.github.io/post/winsshfs/"/>
    <id>https://wsgzao.github.io/post/winsshfs/</id>
    <published>2018-04-12T06:59:49.000Z</published>
    <updated>2018-04-13T07:38:16.986Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>2017年5月12日国内校园网络遭受勒索病毒蠕虫入侵损失惨重，国内的安全厂商也在第一时间发布安全告警和预防方案，可是通过防火墙直接禁用445端口来解决安全隐患的方式似乎也带来了其他问题，而Samba文件系统共享正是使用了该端口，由于安全的权重大于一切，在研究过CIFS/NFS共享协议以及GoodSync等数据同步软件后发现Dokan+SSHFS可以作为目前比较理想的解决方案。</p>
<blockquote>
<p>使用Dokan+SSHFS实现Linux与Windows文件系统共享，解决Samba 445端口被禁的矛盾</p>
</blockquote>
<h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018年04月12日 - 增加方案NetDrive<br>2017年07月11日 - 补充ExpanDrive和SFTP Net Drive<br>2017年05月16日 - 初稿</p>
<p>阅读原文 - <a href="https://wsgzao.github.io/post/winsshfs/">https://wsgzao.github.io/post/winsshfs/</a></p>
<p><strong>扩展阅读</strong></p>
<p>Dokan -  <a href="http://dokan-dev.github.io" target="_blank" rel="external">http://dokan-dev.github.io</a><br>WinSSHFS - <a href="https://github.com/Foreveryone-cz/win-sshfs" target="_blank" rel="external">https://github.com/Foreveryone-cz/win-sshfs</a></p>
<hr>
<h2 id="Dokan和SSHFS"><a href="#Dokan和SSHFS" class="headerlink" title="Dokan和SSHFS"></a>Dokan和SSHFS</h2><blockquote>
<p>User mode file system library for windows with FUSE Wrapper</p>
</blockquote>
<p>Dokan是用户态的文件系统驱动，可以称之为fuse for windows。可以用来开发虚拟磁盘，即在“我的电脑”中虚拟出一个硬盘来，可以是硬盘，也可以是可移动磁盘或者网络硬盘。</p>
<p><a href="http://dokan-dev.github.io" target="_blank" rel="external">http://dokan-dev.github.io</a></p>
<blockquote>
<p>SSH(SFTP) filesystem for Windows</p>
</blockquote>
<p>SSH(SFTP) filesystem made using Dokan and SSH.NET library. It allows you to mount remote computers via SFTP protocol like windows network drives .</p>
<p>sshfs 是基于 FUSE 构建的 SSH 文件系统客户端程序，通过它远程主机的配置无需作任何改变，就可以透过 SSH 协议来挂载远程文件系统了，非常方便及安全。</p>
<p><a href="https://github.com/Foreveryone-cz/win-sshfs" target="_blank" rel="external">https://github.com/Foreveryone-cz/win-sshfs</a></p>
<h2 id="WinSSHFS"><a href="#WinSSHFS" class="headerlink" title="WinSSHFS"></a>WinSSHFS</h2><p>使用方法很简单，这里有一篇国外的文章写得非常清晰，大家遇到问题可以参考下<br><a href="https://igikorn.com/sshfs-windows-10/" target="_blank" rel="external">https://igikorn.com/sshfs-windows-10/</a></p>
<p><img src="https://ooo.0o0.ooo/2017/05/16/591ab60fd5298.png" alt=""></p>
<ol>
<li>安装Dokan</li>
<li>安装WinSSHFS</li>
<li>配置WinSSHFS然后Mount远端文件夹</li>
</ol>
<p>Get Dokan here: <a href="https://github.com/dokan-dev/dokany/releases" target="_blank" rel="external">https://github.com/dokan-dev/dokany/releases</a><br>Get WinSSHFS here: <a href="https://github.com/Foreveryone-cz/win-sshfs/releases" target="_blank" rel="external">https://github.com/Foreveryone-cz/win-sshfs/releases</a><br>百度网盘：<a href="http://pan.baidu.com/s/1dEPrPfF" target="_blank" rel="external">http://pan.baidu.com/s/1dEPrPfF</a></p>
<h2 id="其他代替方案"><a href="#其他代替方案" class="headerlink" title="其他代替方案"></a>其他代替方案</h2><ol>
<li>ExpanDrive - <a href="http://www.expandrive.com/" target="_blank" rel="external">http://www.expandrive.com/</a></li>
<li>NetDrive - NetDrive </li>
<li>SFTP Net Drive - <a href="http://www.sftpnetdrive.com/" target="_blank" rel="external">http://www.sftpnetdrive.com/</a></li>
</ol>
<blockquote>
<p>这里推荐方案3，主要是因为免费但在离线环境下安装不友好，需要设置key</p>
</blockquote>
<p>Sorry for the trouble here. The reason this happens is because the free version does technically have a product key, it is just a “special” product key that we use for all free users. Usually, you never notice, because an online machine will activate this special product key without you doing anything. But since your machine is offline, you have to activate it manually. Here are the steps to do that:</p>
<ol>
<li>Download this file and run it on the offline machine you will use SFTP NetDrive on to get something called your “Node ID”, you’ll need it in a moment:<a href="http://www.nsoftware.com/lic/nodeid.exe" target="_blank" rel="external">http://www.nsoftware.com/lic/nodeid.exe</a></li>
<li>If you have the 2016 installer, go to this page on a machine that has internet, then go to step 4: <a href="http://www.nsoftware.com/lic/?prod=NDXB-A&amp;sno=NSXBAS-PERSONAL&amp;key=PXE-K3A" target="_blank" rel="external">http://www.nsoftware.com/lic/?prod=NDXB-A&amp;sno=NSXBAS-PERSONAL&amp;key=PXE-K3A</a> (if not, go to step 3)</li>
<li>If you have the 2017 installer, go to this page instead: <a href="http://www.nsoftware.com/lic/?w64=1&amp;prod=ndxca&amp;sno=NDXCAS-PERSONAL&amp;key=DRG-K4V" target="_blank" rel="external">http://www.nsoftware.com/lic/?w64=1&amp;prod=ndxca&amp;sno=NDXCAS-PERSONAL&amp;key=DRG-K4V</a></li>
<li>Enter your information on the form on that page, using the Node ID you got from step 1. Then, click “Download Keys” to download a keys.reg file.</li>
<li>Copy the .reg file back to your offline machine and run it to add the information to your registry.</li>
<li>Re-run your installer. It should recognize that you already have the free version’s special product key now, and you’ll be able to install it.</li>
</ol>
<p>If you have any trouble, let me know and I’ll be happy to assist you.</p>
<p>Regards,<br>Brenden Kromhout<br>/n software, inc.</p>
<p>如果需要学习Samba可以参考之前的一篇文章<br><a href="https://wsgzao.github.io/post/samba/">https://wsgzao.github.io/post/samba/</a></p>
]]></content>
    
    <summary type="html">
    
      使用Dokan+SSHFS实现Linux与Windows文件系统共享，解决Samba 445端口被禁的矛盾
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>Python 2.6 升级至 Python 2.7 的实践心得</title>
    <link href="https://wsgzao.github.io/post/python-2-6-update-to-2-7/"/>
    <id>https://wsgzao.github.io/post/python-2-6-update-to-2-7/</id>
    <published>2018-04-12T06:59:49.000Z</published>
    <updated>2018-04-13T07:30:25.552Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>CentOS 6.8 安装 Python 2.7.13，因为软件版本上的需求所以考虑将 Python 升级至 2.7.14，加上生产环境还是以 RHEL 6 为主，互联网自动化运维平台大多数也推荐以Python 2.7.x + CentOS 6.x 来操作，选择 Python 2 还是 Python 3 也没有定论，找到适合的搭配即可。</p>
<blockquote>
<p>Python 2.6 升级至 Python 2.7 的实践心得</p>
</blockquote>
<h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018年04月12日 - 升级Python 2.7.14<br>2017年07月11日 - 完善Windows下Python的部署细节<br>2017年04月26日 - 初稿</p>
<p>阅读原文 - <a href="https://wsgzao.github.io/post/python-2-6-update-to-2-7/">https://wsgzao.github.io/post/python-2-6-update-to-2-7/</a></p>
<p><strong>扩展阅读</strong></p>
<p>Python - <a href="https://www.python.org/" target="_blank" rel="external">https://www.python.org/</a><br>PyPI - <a href="https://pypi.python.org/pypi" target="_blank" rel="external">https://pypi.python.org/pypi</a><br>pip - <a href="https://pip.pypa.io/en/stable/user_guide/#configuration" target="_blank" rel="external">https://pip.pypa.io/en/stable/user_guide/#configuration</a></p>
<hr>
<h2 id="简单安装"><a href="#简单安装" class="headerlink" title="简单安装"></a>简单安装</h2><blockquote>
<p>因为Python 2.7.13以后版本会自动完善yum配置，所以不必参考以前的网上文章去修改其他地方</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 查看当前系统中的 Python 版本，返回 Python 2.6.6 为正常，rhel7以上版本为2.7.5</span></div><div class="line">python --version</div><div class="line"></div><div class="line">Python 2.6.6</div><div class="line"></div><div class="line"><span class="comment"># 检查 CentOS 版本，返回 CentOS release 6.8 (Final) 为正常</span></div><div class="line">cat /etc/redhat-release</div><div class="line"></div><div class="line">CentOS release 6.8 (Final)</div><div class="line"></div><div class="line"><span class="comment"># 安装所有的开发工具包</span></div><div class="line">yum groupinstall -y <span class="string">"Development tools"</span></div><div class="line"><span class="comment"># 安装其它的必需包</span></div><div class="line">yum install -y zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel</div><div class="line"></div><div class="line"><span class="comment"># 下载、编译和安装 Python 2.7.13</span></div><div class="line"><span class="comment">#wget https://www.python.org/ftp/python/2.7.13/Python-2.7.13.tgz</span></div><div class="line">tar zxf Python-2.7.13.tgz</div><div class="line"><span class="built_in">cd</span> Python-2.7.13</div><div class="line">./configure</div><div class="line">make &amp;&amp; make install</div><div class="line"></div><div class="line"><span class="comment"># 查看新的 Python 版本，返回 Python 2.7.13 为正常</span></div><div class="line">python --version</div><div class="line"></div><div class="line">Python 2.7.13</div></pre></td></tr></table></figure>
<h2 id="ansible离线安装实践"><a href="#ansible离线安装实践" class="headerlink" title="ansible离线安装实践"></a>ansible离线安装实践</h2><blockquote>
<p>这里利用了一些内网离线安装ansible的小技巧，相关文件我会上传至网盘</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Install Python</span></div><div class="line">tar xf Python-2.7.13.tgz</div><div class="line"><span class="built_in">cd</span> Python-2.7.13</div><div class="line">./configure</div><div class="line">make</div><div class="line">make install</div><div class="line"></div><div class="line"><span class="comment"># ImportError: No module named six.moves</span></div><div class="line">tar xf six-1.10.0.tar.gz</div><div class="line"><span class="built_in">cd</span> six-1.10.0</div><div class="line">python setup.py install</div><div class="line"><span class="built_in">cd</span> ..</div><div class="line"></div><div class="line"><span class="comment"># ImportError: No module named packaging.version</span></div><div class="line">tar xf packaging-16.8.tar.gz</div><div class="line"><span class="built_in">cd</span> packaging-16.8</div><div class="line">python setup.py install</div><div class="line"><span class="built_in">cd</span> ..</div><div class="line"><span class="comment"># ImportError: No module named pyparsing</span></div><div class="line">tar xf pyparsing-2.2.0.tar.gz</div><div class="line"><span class="built_in">cd</span> pyparsing-2.2.0</div><div class="line">python setup.py install</div><div class="line"><span class="built_in">cd</span> ..</div><div class="line"></div><div class="line"><span class="comment"># ImportError: No module named appdirs</span></div><div class="line">tar xf appdirs-1.4.3.tar.gz</div><div class="line"><span class="built_in">cd</span> appdirs-1.4.3</div><div class="line">python setup.py install</div><div class="line"><span class="built_in">cd</span> ..</div><div class="line"></div><div class="line"><span class="comment"># Install Setuptools</span></div><div class="line">unzip setuptools-34.2.0.zip</div><div class="line"><span class="built_in">cd</span> setuptools-34.2.0</div><div class="line">python setup.py install</div><div class="line"><span class="built_in">cd</span> ..</div><div class="line"></div><div class="line"><span class="comment"># Install pip</span></div><div class="line">tar xf pip-9.0.1.tar.gz</div><div class="line"><span class="built_in">cd</span> pip-9.0.1</div><div class="line">python setup.py install</div><div class="line"><span class="built_in">cd</span> ..</div><div class="line"></div><div class="line"><span class="comment"># pip 离线下载依赖包</span></div><div class="line">pip install -d ~/tmp/ ansible</div><div class="line">pip install -d ~/tmp/ ansible-cmdb</div><div class="line"></div><div class="line"><span class="comment"># pip 离线安装</span></div><div class="line">pip install ansible --index-url=http://172.31.197.1:7000/simple/ --trusted-host=172.31.197.1</div><div class="line">pip install ansible-cmdb --index-url=http://172.31.197.1:7000/simple/ --trusted-host=172.31.197.1</div><div class="line"></div><div class="line"><span class="comment"># 查看安装好的版本</span></div><div class="line">[root@ansible-wangao ansible]<span class="comment"># pip -V</span></div><div class="line">pip 9.0.1 from /usr/<span class="built_in">local</span>/lib/python2.7/site-packages/pip-9.0.1-py2.7.egg (python 2.7)</div><div class="line"></div><div class="line">[root@ansible-wangao ansible]<span class="comment"># ansible --version</span></div><div class="line">ansible 2.3.0.0</div><div class="line">  config file = /etc/ansible/ansible.cfg</div><div class="line">  configured module search path = Default w/o overrides</div><div class="line">  python version = 2.7.13 (default, Apr 25 2017, 17:19:23) [GCC 4.4.7 20120313 (Red Hat 4.4.7-17)]</div><div class="line"></div><div class="line">[root@ansible-wangao ansible]<span class="comment"># ansible-cmdb --version</span></div><div class="line">ansible-cmdb v1.20</div><div class="line"></div><div class="line"><span class="comment"># 更换豆瓣pip源</span></div><div class="line">vim  <span class="variable">$HOME</span>/.pip/pip.conf</div><div class="line"></div><div class="line">[global]</div><div class="line">index-url = https://pypi.doubanio.com/simple/</div><div class="line">[install]</div><div class="line"></div><div class="line">trusted-host=pypi.doubanio.com</div></pre></td></tr></table></figure>
<h2 id="Windows-安装-Python-2-7-x"><a href="#Windows-安装-Python-2-7-x" class="headerlink" title="Windows 安装 Python 2.7.x"></a>Windows 安装 Python 2.7.x</h2><blockquote>
<p>Windows下安装扩展包可能没有想象中那么顺利，遇到安装不上的包推荐去下面这个网址看看</p>
</blockquote>
<p><a href="http://www.lfd.uci.edu/~gohlke/pythonlibs/" target="_blank" rel="external">http://www.lfd.uci.edu/~gohlke/pythonlibs/</a></p>
<p>一般情况先安装编译库Microsoft Visual C++ Compiler for Python 2.7<br><a href="https://www.microsoft.com/en-us/download/details.aspx?id=44266" target="_blank" rel="external">https://www.microsoft.com/en-us/download/details.aspx?id=44266</a></p>
<p>下载Python，如 2.7.13<br><a href="https://www.python.org/downloads/" target="_blank" rel="external">https://www.python.org/downloads/</a><br><a href="https://www.python.org/ftp/python/2.7.13/python-2.7.13.msi" target="_blank" rel="external">https://www.python.org/ftp/python/2.7.13/python-2.7.13.msi</a></p>
<p>安装时注意勾选环境变量<br>Add python.exe to Path</p>
<p>如果忘记勾选也没关系，可以自行在PATH添加环境变量<br>右键计算机【属性】-&gt;【高级系统设置】-&gt;【环境变量】-&gt;【系统变量】-&gt;【PATH】<br>D:\Python27\;D:\Python27\Scripts;</p>
<p>安装python2.7.13默认自带pip版本为9.0.1<br>PS C:\Users\Administrator&gt; pip -V<br>pip 9.0.1 from c:\python27\lib\site-packages (python 2.7)</p>
<p>安装Python后升级pip<br>python -m pip install –upgrade pip</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 更换pypi国内源，运行以下python代码会自动建立pip.ini</span></div><div class="line"><span class="keyword">import</span> os</div><div class="line"></div><div class="line">ini=<span class="string">"""[global]</span></div><div class="line"><span class="string">index-url = https://pypi.doubanio.com/simple/</span></div><div class="line"><span class="string">[install]</span></div><div class="line"><span class="string">trusted-host=pypi.doubanio.com</span></div><div class="line"><span class="string">"""</span></div><div class="line">pippath=os.environ[<span class="string">"USERPROFILE"</span>]+<span class="string">"\\pip\\"</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(pippath):</div><div class="line">    os.mkdir(pippath)</div><div class="line"></div><div class="line"><span class="keyword">with</span> open(pippath+<span class="string">"pip.ini"</span>,<span class="string">"w+"</span>) <span class="keyword">as</span> f:</div><div class="line">    f.write(ini)</div></pre></td></tr></table></figure>
<h2 id="离线安装包"><a href="#离线安装包" class="headerlink" title="离线安装包"></a>离线安装包</h2><p><a href="http://pan.baidu.com/s/1o7J8QBw" target="_blank" rel="external">http://pan.baidu.com/s/1o7J8QBw</a></p>
<h2 id="Python-2-7-14"><a href="#Python-2-7-14" class="headerlink" title="Python 2.7.14"></a>Python 2.7.14</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Install Packages</span></div><div class="line">yum install gcc zlib zlib-devel openssl-devel -y</div><div class="line"></div><div class="line"><span class="comment"># Install Python</span></div><div class="line">tar xf Python-2.7.14.tgz</div><div class="line"><span class="built_in">cd</span> Python-2.7.14</div><div class="line">./configure</div><div class="line">make</div><div class="line">make install</div><div class="line"><span class="built_in">cd</span> ..</div><div class="line"></div><div class="line"><span class="comment"># ImportError: No module named six.moves</span></div><div class="line">tar xf six-1.11.0.tar.gz </div><div class="line"><span class="built_in">cd</span> six-1.11.0</div><div class="line">python setup.py install</div><div class="line"><span class="built_in">cd</span> ..</div><div class="line"></div><div class="line"><span class="comment"># ImportError: No module named packaging.version</span></div><div class="line">tar xf packaging-17.1.tar.gz </div><div class="line"><span class="built_in">cd</span> packaging-17.1</div><div class="line">python setup.py install</div><div class="line"><span class="built_in">cd</span> ..</div><div class="line"></div><div class="line"><span class="comment"># ImportError: No module named pyparsing</span></div><div class="line">tar xf pyparsing-2.2.0.tar.gz </div><div class="line"><span class="built_in">cd</span> pyparsing-2.2.0</div><div class="line">python setup.py install</div><div class="line"><span class="built_in">cd</span> ..</div><div class="line"></div><div class="line"><span class="comment"># ImportError: No module named appdirs</span></div><div class="line">tar xf appdirs-1.4.3.tar.gz </div><div class="line"><span class="built_in">cd</span> appdirs-1.4.3</div><div class="line">python setup.py install</div><div class="line"><span class="built_in">cd</span> ..</div><div class="line"></div><div class="line"><span class="comment"># Install Setuptools</span></div><div class="line">unzip setuptools-38.5.2.zip</div><div class="line"><span class="built_in">cd</span> setuptools-38.5.2</div><div class="line">python setup.py install</div><div class="line"><span class="built_in">cd</span> ..</div><div class="line"></div><div class="line"><span class="comment"># Install pip</span></div><div class="line">tar xf pip-9.0.1.tar.gz</div><div class="line"><span class="built_in">cd</span> pip-9.0.1</div><div class="line">python setup.py install</div><div class="line"><span class="built_in">cd</span> ..</div><div class="line"></div><div class="line"><span class="comment"># pip 离线下载</span></div><div class="line"><span class="comment"># pip install --download DIR -r requirements.txt</span></div><div class="line">pip install -d ~/ansible/ ansible</div><div class="line"></div><div class="line"><span class="comment"># pip 离线安装</span></div><div class="line"><span class="comment"># pip install --no-index --find-links=DIR -r requirements.txt</span></div><div class="line">pip install --no-index --find-links=pip-ansible-2.3.3.0/ -r requirements.txt</div><div class="line"></div><div class="line"><span class="comment"># pip 离线安装pipenv</span></div><div class="line">pip install --no-index --find-links=pip-pipenv/ pipenv</div><div class="line"></div><div class="line"><span class="comment"># 使用pipenv创建虚拟环境</span></div><div class="line">mkdir win_ansible</div><div class="line"><span class="built_in">cd</span> win_ansible</div><div class="line">pipenv shell</div><div class="line">pip install --no-index --find-links=pip-ansible-2.4.3.0/ -r requirements.txt</div><div class="line"></div><div class="line"><span class="comment"># 退出虚拟环境</span></div><div class="line"><span class="built_in">exit</span></div><div class="line"></div><div class="line"><span class="comment"># RuntimeError: Compression requires the (missing) zlib module</span></div><div class="line">yum install zlib zlib-devel -y</div><div class="line"><span class="built_in">cd</span> Python-2.7.14</div><div class="line">make</div><div class="line">make install</div><div class="line"></div><div class="line"><span class="comment"># pip is configured with locations that require TLS/SSL, however the ssl module in Python is not available.</span></div><div class="line">yum install openssl-devel -y</div><div class="line"><span class="built_in">cd</span> Python-2.7.14</div><div class="line">make</div><div class="line">make install</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      Python 2.6 升级至 Python 2.7 的实践心得
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>使用virtualenv和virtualenvwrapper管理多版本Python开发环境</title>
    <link href="https://wsgzao.github.io/post/virtualenv/"/>
    <id>https://wsgzao.github.io/post/virtualenv/</id>
    <published>2018-04-11T06:59:49.000Z</published>
    <updated>2018-04-11T07:00:23.058Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>之前一篇文章分享了从Python 2.6 升级至 Python 2.7，在开发环境中我们也和很多朋友一样使用virtualenv和virtualenvwrapper来管理和解决不同用户和应用之间的冲突，比如一个DevOps团队在Linux环境中协作开发，每个用户都需要搭建一套Django+Ansible</p>
<blockquote>
<p>virtualenv为应用提供了隔离的Python运行环境，解决了不同应用间多版本的冲突问题</p>
</blockquote>
<h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018年04月11日 - 初稿</p>
<p>阅读原文 - <a href="https://wsgzao.github.io/post/virtualenv/">https://wsgzao.github.io/post/virtualenv/</a></p>
<p><strong>扩展阅读</strong></p>
<p>PyPI - <a href="https://pypi.python.org/pypi/virtualenv" target="_blank" rel="external">https://pypi.python.org/pypi/virtualenv</a><br>virtualenv - <a href="http://pythonguidecn.readthedocs.io/zh/latest/dev/virtualenvs.html" target="_blank" rel="external">http://pythonguidecn.readthedocs.io/zh/latest/dev/virtualenvs.html</a><br>virtualenvwrapper - <a href="http://virtualenvwrapper.readthedocs.io/en/latest/index.html" target="_blank" rel="external">http://virtualenvwrapper.readthedocs.io/en/latest/index.html</a></p>
<hr>
<h2 id="virtualenv"><a href="#virtualenv" class="headerlink" title="virtualenv"></a>virtualenv</h2><blockquote>
<p>virtualenv 是一个创建隔绝的Python环境的工具。virtualenv创建一个包含所有必要的可执行文件的文件夹，用来使用Python工程所需的包。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 检查python版本是否升级至2.7以上</span></div><div class="line">python -V</div><div class="line">Python 2.7.13</div><div class="line"></div><div class="line"><span class="comment"># 安装virtualenv</span></div><div class="line">pip install virtualenv</div><div class="line"><span class="comment"># 切换用户创建一个虚拟环境</span></div><div class="line">su - wangao</div><div class="line"><span class="comment"># virtualenv -p /usr/bin/python2.7 venv</span></div><div class="line"><span class="comment"># virtualenv --no-site-packages venv</span></div><div class="line">[wangao@localhost ~]$ virtualenv venv</div><div class="line">New python executable <span class="keyword">in</span> /home/wangao/venv/bin/python</div><div class="line">Installing setuptools, pip, wheel...done.</div><div class="line"><span class="comment"># 激活虚拟环境</span></div><div class="line">[wangao@localhost ~]$ <span class="built_in">source</span> venv/bin/activate</div><div class="line">(venv) [wangao@localhost ~]$ pip install requests</div><div class="line"><span class="comment"># 如果你在虚拟环境中暂时完成了工作，则可以停用它：</span></div><div class="line">(venv) [wangao@localhost ~]$ deactivate</div><div class="line"><span class="comment"># 要删除一个虚拟环境，只需删除它的文件夹</span></div><div class="line">rm -rf venv</div></pre></td></tr></table></figure>
<h2 id="virtualenvwrapper"><a href="#virtualenvwrapper" class="headerlink" title="virtualenvwrapper"></a>virtualenvwrapper</h2><blockquote>
<p>virtualenvwrapper 提供了一系列命令使得和虚拟环境工作变得愉快许多。它把你所有的虚拟环境都放在一个地方。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 推荐直接使用virtualenvwrapper来管理python虚拟环境</span></div><div class="line">pip install virtualenvwrapper</div><div class="line"></div><div class="line"><span class="comment"># 安装好之后需要简单配置下，主要是设置独立环境的保存路径，推荐在.bash_profile下追加</span></div><div class="line">[wangao@localhost ~]$ vim .bash_profile</div><div class="line"></div><div class="line"><span class="comment"># 建议放入.bash_profile</span></div><div class="line"><span class="built_in">export</span> WORKON_HOME=~/.virtualenvs</div><div class="line"><span class="comment"># 不同系统virtualenvwrapper.sh存放的位置可能不同</span></div><div class="line"><span class="built_in">source</span> /usr/<span class="built_in">local</span>/bin/virtualenvwrapper.sh</div><div class="line"><span class="comment"># 强制只允许在虚拟环境下安装软件</span></div><div class="line"><span class="built_in">export</span> PIP_REQUIRE_VIRTUALENV=<span class="literal">true</span></div><div class="line"></div><div class="line">[wangao@localhost ~]$ <span class="built_in">source</span> .bash_profile</div><div class="line">virtualenvwrapper.user_scripts creating /home/wangao/.virtualenvs/premkproject</div><div class="line">virtualenvwrapper.user_scripts creating /home/wangao/.virtualenvs/postmkproject</div><div class="line">virtualenvwrapper.user_scripts creating /home/wangao/.virtualenvs/initialize</div><div class="line">virtualenvwrapper.user_scripts creating /home/wangao/.virtualenvs/premkvirtualenv</div><div class="line">virtualenvwrapper.user_scripts creating /home/wangao/.virtualenvs/postmkvirtualenv</div><div class="line">virtualenvwrapper.user_scripts creating /home/wangao/.virtualenvs/prermvirtualenv</div><div class="line">virtualenvwrapper.user_scripts creating /home/wangao/.virtualenvs/postrmvirtualenv</div><div class="line">virtualenvwrapper.user_scripts creating /home/wangao/.virtualenvs/predeactivate</div><div class="line">virtualenvwrapper.user_scripts creating /home/wangao/.virtualenvs/postdeactivate</div><div class="line">virtualenvwrapper.user_scripts creating /home/wangao/.virtualenvs/preactivate</div><div class="line">virtualenvwrapper.user_scripts creating /home/wangao/.virtualenvs/postactivate</div><div class="line">virtualenvwrapper.user_scripts creating /home/wangao/.virtualenvs/get_env_details</div><div class="line"></div><div class="line"><span class="comment"># 基础使用</span></div><div class="line">su - wangao</div><div class="line"><span class="comment"># 创建一个虚拟环境</span></div><div class="line">[wangao@localhost ~]$ mkvirtualenv venv</div><div class="line">New python executable <span class="keyword">in</span> /home/wangao/.virtualenvs/venv/bin/python</div><div class="line">Installing setuptools, pip, wheel...done.</div><div class="line">virtualenvwrapper.user_scripts creating /home/wangao/.virtualenvs/venv/bin/predeactivate</div><div class="line">virtualenvwrapper.user_scripts creating /home/wangao/.virtualenvs/venv/bin/postdeactivate</div><div class="line">virtualenvwrapper.user_scripts creating /home/wangao/.virtualenvs/venv/bin/preactivate</div><div class="line">virtualenvwrapper.user_scripts creating /home/wangao/.virtualenvs/venv/bin/postactivate</div><div class="line">virtualenvwrapper.user_scripts creating /home/wangao/.virtualenvs/venv/bin/get_env_details</div><div class="line"><span class="comment"># 在虚拟环境上工作</span></div><div class="line">(venv) [wangao@localhost ~]$ workon venv</div><div class="line"><span class="comment"># 停止是一样的</span></div><div class="line">(venv) [wangao@localhost ~]$ deactivate</div><div class="line">[wangao@localhost ~]$</div><div class="line"><span class="comment"># 删除</span></div><div class="line">[wangao@localhost ~]$  rmvirtualenv venv</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      virtualenv为应用提供了隔离的Python运行环境，解决了不同应用间多版本的冲突问题
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>HPQLOCFG 批量管理 HP iLO 实践</title>
    <link href="https://wsgzao.github.io/post/hpqlocfg/"/>
    <id>https://wsgzao.github.io/post/hpqlocfg/</id>
    <published>2018-04-02T08:40:53.000Z</published>
    <updated>2018-04-02T10:13:30.801Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>HP iLO, Dell iDRAC, IBM/Lenovo IMM 等这些名字对于服务器硬件工程师来说应该不会陌生，当然在服务器采购回来大规模上架的时刻很多小伙伴估计就要崩溃了，OOB带外管理的IP需要手动配置，NTP和License也需要记得配置，万一忘记了，咳咳，那可就惨喽。这次我们就碰上了NTP时间同步没有配置，导致时区和时间的显示直接影响硬件故障时收集日志判断，为了避免人力资源浪费，网上搜索了一圈发现HP iLO有自己的批量化管理客户端程序，希望大家举一反三提升运维的效率。</p>
<blockquote>
<p>HP Lights-Out Configuration Utility 批量管理 HP iLO 2/3/4</p>
</blockquote>
<h2 id="更新记录"><a href="#更新记录" class="headerlink" title="更新记录"></a>更新记录</h2><p>2018年04月01日 - 初稿</p>
<p>阅读原文 - <a href="https://wsgzao.github.io/post/hpqlocfg/">https://wsgzao.github.io/post/hpqlocfg/</a></p>
<p><strong>扩展阅读</strong></p>
<p>HP ilo4 批量管理 - <a href="http://blog.51cto.com/gregdefanhua/2089408" target="_blank" rel="external">http://blog.51cto.com/gregdefanhua/2089408</a></p>
<h2 id="下载-HP-iLO-管理软件和模板"><a href="#下载-HP-iLO-管理软件和模板" class="headerlink" title="下载 HP iLO 管理软件和模板"></a>下载 HP iLO 管理软件和模板</h2><blockquote>
<p>扩展阅读中的信息已过期，cpqlocfg现在更名为hpqlocfg，沿用了作者的思路在此表示感谢</p>
</blockquote>
<p>RECOMMENDED * HP Lights-Out Configuration Utility<br><a href="https://support.hpe.com/hpsc/swd/public/detail?swItemId=MTX_d7e7146b56324eb0879f0a98e2#tab1" target="_blank" rel="external">https://support.hpe.com/hpsc/swd/public/detail?swItemId=MTX_d7e7146b56324eb0879f0a98e2#tab1</a></p>
<p>用于 Windows 的 HP Lights-Out XML Scripting Sample<br><a href="https://support.hpe.com/hpsc/swd/public/detail?swItemId=MTX_f045db3f567040f291bf645684#tab1" target="_blank" rel="external">https://support.hpe.com/hpsc/swd/public/detail?swItemId=MTX_f045db3f567040f291bf645684#tab1</a></p>
<h2 id="实践方法"><a href="#实践方法" class="headerlink" title="实践方法"></a>实践方法</h2><blockquote>
<p>拷贝HPQLOCFG.exe和相关dll文件至脚本当前路径</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">file://C:\Users\wsgzao\Desktop\ilo_ntp	(1 folders, 12 files, 211.96 KB, 3.70 MB <span class="keyword">in</span> total.)</div><div class="line">│  172.25.240.45	266 bytes</div><div class="line">│  HPQLOCFG.exe	59.00 KB</div><div class="line">│  HPQLOCFG.exe.config	712 bytes</div><div class="line">│  HPSSLConnection.dll	13.50 KB</div><div class="line">│  ilo_ntp.log	0 bytes</div><div class="line">│  ip.txt	150 bytes</div><div class="line">│  log.txt	2.24 KB</div><div class="line">│  Parser.dll	133.00 KB</div><div class="line">│  README.txt	2.03 KB</div><div class="line">│  SetNTP.bat	181 bytes</div><div class="line">│  SetNTP.xml	555 bytes</div><div class="line">│  操作步骤.txt	381 bytes</div><div class="line">└─HP官方文件	(0 folders, 3 files, 3.50 MB, 3.50 MB <span class="keyword">in</span> total.)</div><div class="line">        HPE iLO 4 脚本和命令行指南.pdf	2.95 MB</div><div class="line">        SP58155.exe	392.67 KB</div><div class="line">        windows-LOsamplescripts4.80.0.zip	168.34 KB</div></pre></td></tr></table></figure>
<p>编写XML文件 SetNTP.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">RIBCL</span> <span class="attr">VERSION</span>=<span class="string">"2.0"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">LOGIN</span> <span class="attr">USER_LOGIN</span>=<span class="string">"iloadmin"</span> <span class="attr">PASSWORD</span>=<span class="string">"iloadmin"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">RIB_INFO</span> <span class="attr">MODE</span>=<span class="string">"write"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">MOD_NETWORK_SETTINGS</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">DHCP_SNTP_SETTINGS</span> <span class="attr">value</span>=<span class="string">"No"</span>/&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">DHCPV6_SNTP_SETTINGS</span> <span class="attr">value</span>=<span class="string">"No"</span>/&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">SNTP_SERVER1</span> <span class="attr">value</span>=<span class="string">"%ntp1%"</span>/&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">TIMEZONE</span> <span class="attr">value</span>=<span class="string">"Asia/Shanghai"</span>/&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">MOD_NETWORK_SETTINGS</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">MOD_GLOBAL_SETTINGS</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">PROPAGATE_TIME_TO_HOST</span> <span class="attr">VALUE</span>=<span class="string">"No"</span> /&gt;</span> </div><div class="line">            <span class="tag">&lt;/<span class="name">MOD_GLOBAL_SETTINGS</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">RIB_INFO</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">LOGIN</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">RIBCL</span>&gt;</span></div></pre></td></tr></table></figure>
<p>编写批处理  SetNTP.bat</p>
<figure class="highlight bat"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">@<span class="built_in">echo</span> off</div><div class="line"><span class="keyword">for</span> /f <span class="variable">%%a</span> <span class="keyword">in</span> (ip.txt) <span class="keyword">do</span> (</div><div class="line">    <span class="built_in">set</span> ip=<span class="variable">%%a</span></div><div class="line">    <span class="built_in">set</span> ntp="<span class="number">172</span>.<span class="number">25</span>.<span class="number">240</span>.<span class="number">254</span>"</div><div class="line">    <span class="keyword">call</span> hpqlocfg -s <span class="variable">%%i</span>p%% -l log.txt -f SetNTP.xml -u iloadmin -p iloadmin -t ntp1=<span class="variable">%%n</span>tp%%</div><div class="line">)</div></pre></td></tr></table></figure>
<blockquote>
<p>修改2处内容</p>
</blockquote>
<ol>
<li>修改ip.txt，添加信息</li>
<li>修改SetNTP.bat中set ntp=”172.28.70.254”</li>
</ol>
<blockquote>
<p>执行方法</p>
</blockquote>
<pre><code>SetNTP.bat
</code></pre>]]></content>
    
    <summary type="html">
    
      HP Lights-Out Configuration Utility 批量管理 HP iLO 2/3/4
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>腾达AC18刷梅林固件(KoolShare)和恢复原厂固件实践心得</title>
    <link href="https://wsgzao.github.io/post/ac18/"/>
    <id>https://wsgzao.github.io/post/ac18/</id>
    <published>2018-04-01T08:40:53.000Z</published>
    <updated>2018-04-02T09:37:31.243Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://a.zdmimg.com/201706/17/5944e5991f09d7003.png_f710.jpg" alt=""></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>2016年9月份买腾达AC18的时候是因为觉得AC9性能不够用，毕竟家里带宽已经上200MB，当时考虑过小米路由但觉得和NAS搭配还不够成熟，也许现在或者下一个路由器会回归小米，本文主要和大家一起分享下AC18如何刷入梅林固件和恢复，推荐自己用的配置和插件，本来应该很早分享的但一直在验证稳定的刷机固件，希望这一切来的不会太迟。</p>
<blockquote>
<p>路由器刷固件后对我来说最直接的作用是科学上网和屏蔽广告，比如小米盒子广告就彻底屏蔽了</p>
</blockquote>
<h2 id="更新记录"><a href="#更新记录" class="headerlink" title="更新记录"></a>更新记录</h2><p>2018年04月01日 - 增加无线信号设置的几点建议<br>2017年08月07日 - 完善细节描述<br>2017年07月14日 - 增加优化设置<br>2017年06月21日 - 初稿</p>
<p>阅读原文 - <a href="https://wsgzao.github.io/post/ac18/">https://wsgzao.github.io/post/ac18/</a></p>
<p><strong>扩展阅读</strong></p>
<p>AC18 1900M 11ac千兆口别墅型双频无线路由器 - <a href="http://www.tenda.com.cn/product/AC18.html" target="_blank" rel="external">http://www.tenda.com.cn/product/AC18.html</a><br>Asuswrt-merlin基本操作 - <a href="http://koolshare.cn/thread-3578-1-1.html" target="_blank" rel="external">http://koolshare.cn/thread-3578-1-1.html</a></p>
<h2 id="购买记录"><a href="#购买记录" class="headerlink" title="购买记录"></a>购买记录</h2><blockquote>
<p>我买的时候差不多也是499，如果你在618拿到优惠券400多拿下也是可能的</p>
</blockquote>
<p><a href="https://item.jd.com/3137178.html" target="_blank" rel="external">https://item.jd.com/3137178.html</a></p>
<h2 id="什么是merlin"><a href="#什么是merlin" class="headerlink" title="什么是merlin"></a>什么是merlin</h2><p>首先Asuswrt是华硕公司为他的路由器所开发的固件。Asuswrt-merlin是一个对Asuswrt固件二次开发进行各种改进和修正的项目。现在支持以下的路由型号：<br>RT-AC56U<br>RT-N66U<br>RT-AC66U<br>RT-AC68U<br>RT-AC68P<br>RT-AC87U<br>RT-AC3200<br>源码来源于<a href="https://github.com/RMerl/asuswrt-merlin" target="_blank" rel="external">https://github.com/RMerl/asuswrt-merlin</a></p>
<blockquote>
<p>Asuswrt-merlin的优势</p>
</blockquote>
<p>Merlin固件拥有更多的功能，由于第三方不断维护代码，各种新功能也在不断增加。Merlin固件的升级并不需要反复的操作过程，方法与官方固件的升级相同，有很好的硬件软件兼容性。继承了Asuswrt官方固件优秀的交互界面。Koolshare论坛所分享的固件大多是基于Merlin代码再次改进，增加适合国内使用的功能。</p>
<h2 id="刷固件"><a href="#刷固件" class="headerlink" title="刷固件"></a>刷固件</h2><blockquote>
<p>如果你觉得官方固件足够稳定，功能都满足你的需要建议就不用折腾自己刷机啦</p>
</blockquote>
<p>这里分享两种刷机方法</p>
<h3 id="方法一（推荐）"><a href="#方法一（推荐）" class="headerlink" title="方法一（推荐）"></a>方法一（推荐）</h3><p><img src="http://am.zdmimg.com/201706/17/5944e93c8989a7325.gif_e600.jpg" alt=""></p>
<p>在原厂固件下AC18_kf_V15.03.3.7(4031)AC18特殊版中间固件，重启会自动更新18的cfe，修正早期版本的ac18的cfe，破除固件限制，然后在就可以在ac18原厂固件的系统升级页面来选择梅林升级了</p>
<h3 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h3><p>按住路由后面的reset按钮，然后开机，持续大概15秒左右，看到路由器的大部分过之后，可以松开按钮，去电脑通过有线来刷机，打开192.168.0.1，如下图，选择梅林固件，upload，等等长传完毕</p>
<p><img src="http://am.zdmimg.com/201706/17/5944e9ad9825c1058.png_e600.jpg" alt=""><br><img src="http://am.zdmimg.com/201706/17/5944e9ae5ce209143.png_e600.jpg" alt=""></p>
<p>刷完梅林之后路由会重启，需要进入梅林恢复出厂设置或捅菊花清空一次nvram</p>
<p><img src="http://am.zdmimg.com/201706/17/5944e9af391118578.png_e600.jpg" alt=""></p>
<h2 id="固件和插件选择"><a href="#固件和插件选择" class="headerlink" title="固件和插件选择"></a>固件和插件选择</h2><blockquote>
<p>如果刷梅林目前推荐最新的 KoolShare 7.8版本</p>
</blockquote>
<p><a href="http://koolshare.cn/forum-96-1.html" target="_blank" rel="external">http://koolshare.cn/forum-96-1.html</a></p>
<p>1.第一次登陆梅林要清空nvram或出厂设置。然后进入/系统管理/选项里边的/系统设置/</p>
<p>将format jffs 和enable jssf custom script两个选项选上 是，然后将下面的enableSSH选择 lan only ，保存提交配置，这样在重启之后就可以可以使用webshell 和软件中心了</p>
<p><img src="http://am.zdmimg.com/201706/17/5944f28dc32c27837.png_e600.jpg" alt=""></p>
<p>2.进入内置网络 /内网址设置</p>
<p>将路由器的ip地址设置成为192.168.50.1，这个只是建议值，为了避免和光猫或上一级路由IP冲突，当然你也可以改成192.168.xx.1或你喜欢的非.1.1的地址就行，完成这项配置之后，选择重启路由</p>
<p><img src="http://am.zdmimg.com/201706/17/5944f28f390121205.png_e600.jpg" alt=""></p>
<p>3.重启之后进入路由点software center，更新到最新版本，并且安装webshell</p>
<p><img src="http://am.zdmimg.com/201706/17/5944f28ff304f7451.png_e600.jpg" alt=""></p>
<p>4.推荐插件</p>
<ul>
<li><p>koolproxy，路由器去广告插件的首选，占用资源低稳定</p>
</li>
<li><p>ss，科学上网利器你懂得，新版软件中心已经下架，建议手动离线安装</p>
</li>
</ul>
<p>5.优化设置</p>
<p>A： 5G设置，在一般设置里边将频道带宽设置为80Mhz，信道固定到149或157（自动信道会出现有些信道无信号，从而不能搜到5g的id）等等<br>然后进入专业设置，把地区改成 all area，可以让5G达到最佳效果</p>
<p>B：2.4G设置</p>
<p>进入一般设置将频段带宽设置为40mhz，然后进入专业设置，将降低USB3.0干扰 停用</p>
<p>因为ac18的屏蔽做的比华硕68u要好，这里可以停用，可以让2.4g的信号正常，如果USB3.0效果不行可以打开这个选项看看效果，这个功能看你看重哪个了，试一下找到最好的平衡点</p>
<h2 id="部分设备搜索不到Wifi信号"><a href="#部分设备搜索不到Wifi信号" class="headerlink" title="部分设备搜索不到Wifi信号"></a>部分设备搜索不到Wifi信号</h2><p>*关于2.4G:有设备搜不到2.4G信号，此时请检查无线设置中的2.4G信号，信道设置在13可能会造成部分设备无法搜索到信号，通常建议使用1或6信道。此外，频道带宽也有可能影响信号的搜索，在不确定设备支持情况时请使用20Mhz，保证最大兼容。注意，此时2.4G的连接速率会比40Mhz低一半。</p>
<p>*关于5G:有支持5G的设备设备搜不到5G信号。部分用户购买的国际版手机可能工作在国内不支持的信道。遇到此类问题，请不要把信道设置为36-64；一般情况下正常终端应该都会支持149-165，您可以尝试将信道设置在此范围内然后再试。</p>
<h2 id="关于无线信号设置的几点建议"><a href="#关于无线信号设置的几点建议" class="headerlink" title="关于无线信号设置的几点建议"></a>关于无线信号设置的几点建议</h2><p>2.4G通常作为无线覆盖主力，因此建议用wifi 分析仪 或者 Wifi Analytics之类的软件分析一下周围信道使用状况，尽量避免使用周围占用严重的信道。且建议用20Mhz频道带宽，尽量保证兼容性。</p>
<p>而5G作为高速连接使用的信号，建议使用80Mhz的频道带宽，增加速率，且5G信号中信道对传输速率相对影响较大，低频段信号穿墙能力好，但是速率仅略高于2.4G（36信道）因此，无法发挥5G信号本来的优势，153-157信号一般速率都能达到867Mbps以上，有需要高速接入的，就必须把信道设定为153或157这样的高频信号。</p>
<h2 id="恢复原厂固件"><a href="#恢复原厂固件" class="headerlink" title="恢复原厂固件"></a>恢复原厂固件</h2><p>参照刷机方法二执行即可，如果现有的固件足够稳定，就不要用强迫症来折腾自己啦，够用就好</p>
]]></content>
    
    <summary type="html">
    
      路由器刷固件后对我来说最直接的作用是科学上网 和屏蔽广告，比如小米盒子广告就彻底屏蔽了
    
    </summary>
    
      <category term="生活 | Life" scheme="https://wsgzao.github.io/categories/%E7%94%9F%E6%B4%BB-Life/"/>
    
    
  </entry>
  
  <entry>
    <title>中文文案排版指北</title>
    <link href="https://wsgzao.github.io/post/chinese-copywriting-guidelines/"/>
    <id>https://wsgzao.github.io/post/chinese-copywriting-guidelines/</id>
    <published>2018-04-01T07:31:24.000Z</published>
    <updated>2018-04-02T09:15:02.939Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://i.v2ex.co/ekrNgJeK.jpeg" alt=""></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote>
<p>统一中文文案、排版的相关用法，降低团队成员之间的沟通成本，增强网站气质。</p>
</blockquote>
<hr>
<h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018年04月01日 - 更新至最新版本<br>2016年05月09日 - 更新至release v0.0.9<br>2015年10月24日 - 更新官方翻译的简体中文<br>2015年07月11日 - 转载初稿，转化为简体中文</p>
<p>本文链接 - <a href="https://wsgzao.github.io/post/chinese-copywriting-guidelines/">https://wsgzao.github.io/post/chinese-copywriting-guidelines/</a></p>
<p><strong>原文出处</strong></p>
<p>Chinese Copywriting Guidelines：中文文案排版指北 - <a href="https://github.com/sparanoid/chinese-copywriting-guidelines" target="_blank" rel="external">https://github.com/sparanoid/chinese-copywriting-guidelines</a><br>Chinese Copywriting Guidelines：中文文案排版指北（简体中文版） - <a href="https://github.com/mzlogin/chinese-copywriting-guidelines" target="_blank" rel="external">https://github.com/mzlogin/chinese-copywriting-guidelines</a></p>
<hr>
<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><!-- vim-markdown-toc GFM -->
<ul>
<li><a href="#空格">空格</a><ul>
<li><a href="#中英文之间需要增加空格">中英文之间需要增加空格</a></li>
<li><a href="#中文与数字之间需要增加空格">中文与数字之间需要增加空格</a></li>
<li><a href="#数字与单位之间无需增加空格">数字与单位之间无需增加空格</a></li>
<li><a href="#全角标点与其他字符之间不加空格">全角标点与其他字符之间不加空格</a></li>
<li><a href="#-ms-text-autospace-to-the-rescue"><code>-ms-text-autospace</code> to the rescue?</a></li>
</ul>
</li>
<li><a href="#标点符号">标点符号</a><ul>
<li><a href="#不重复使用标点符号">不重复使用标点符号</a></li>
</ul>
</li>
<li><a href="#全角和半角">全角和半角</a><ul>
<li><a href="#使用全角中文标点">使用全角中文标点</a></li>
<li><a href="#数字使用半角字符">数字使用半角字符</a></li>
<li><a href="#遇到完整的英文整句特殊名词其內容使用半角标点">遇到完整的英文整句、特殊名词，其內容使用半角标点</a></li>
</ul>
</li>
<li><a href="#名词">名词</a><ul>
<li><a href="#专有名词使用正确的大小写">专有名词使用正确的大小写</a></li>
<li><a href="#不要使用不地道的缩写">不要使用不地道的缩写</a></li>
</ul>
</li>
<li><a href="#争议">争议</a><ul>
<li><a href="#链接之间增加空格">链接之间增加空格</a></li>
<li><a href="#简体中文使用直角引号">简体中文使用直角引号</a></li>
</ul>
</li>
<li><a href="#工具">工具</a></li>
<li><a href="#谁在这样做">谁在这样做？</a></li>
<li><a href="#参考文献">参考文献</a></li>
</ul>
<!-- vim-markdown-toc -->
<h2 id="空格"><a href="#空格" class="headerlink" title="空格"></a>空格</h2><p>「有研究显示，打字的时候不喜欢在中文和英文之间加空格的人，感情路都走得很辛苦，有七成的比例会在 34 岁的时候跟自己不爱的人结婚，而其余三成的人最后只能把遗产留给自己的猫。毕竟爱情跟书写都需要适时地留白。</p>
<p>与大家共勉之。」——<a href="https://github.com/vinta/pangu.js" target="_blank" rel="external">vinta/paranoid-auto-spacing</a></p>
<h3 id="中英文之间需要增加空格"><a href="#中英文之间需要增加空格" class="headerlink" title="中英文之间需要增加空格"></a>中英文之间需要增加空格</h3><p>正确：</p>
<blockquote>
<p>在 LeanCloud 上，数据存储是围绕 <code>AVObject</code> 进行的。</p>
</blockquote>
<p>错误：</p>
<blockquote>
<p>在LeanCloud上，数据存储是围绕<code>AVObject</code>进行的。</p>
<p>在 LeanCloud上，数据存储是围绕<code>AVObject</code> 进行的。</p>
</blockquote>
<p>完整的正确用法：</p>
<blockquote>
<p>在 LeanCloud 上，数据存储是围绕 <code>AVObject</code> 进行的。每个 <code>AVObject</code> 都包含了与 JSON 兼容的 key-value 对应的数据。数据是 schema-free 的，你不需要在每个 <code>AVObject</code> 上提前指定存在哪些键，只要直接设定对应的 key-value 即可。</p>
</blockquote>
<p>例外：「豆瓣FM」等产品名词，按照官方所定义的格式书写。</p>
<h3 id="中文与数字之间需要增加空格"><a href="#中文与数字之间需要增加空格" class="headerlink" title="中文与数字之间需要增加空格"></a>中文与数字之间需要增加空格</h3><p>正确：</p>
<blockquote>
<p>今天出去买菜花了 5000 元。</p>
</blockquote>
<p>错误：</p>
<blockquote>
<p>今天出去买菜花了 5000元。</p>
<p>今天出去买菜花了5000元。</p>
</blockquote>
<h3 id="数字与单位之间无需增加空格"><a href="#数字与单位之间无需增加空格" class="headerlink" title="数字与单位之间无需增加空格"></a>数字与单位之间无需增加空格</h3><p>正确：</p>
<blockquote>
<p>我家的光纤入户宽带有 10Gbps，SSD 一共有 10TB。</p>
</blockquote>
<p>错误：</p>
<blockquote>
<p>我家的光纤入户宽带有 10 Gbps，SSD 一共有 20 TB。</p>
</blockquote>
<p>另外，度／百分比与数字之间不需要增加空格：</p>
<p>正确：</p>
<blockquote>
<p>今天是 233° 的高温。</p>
<p>新 MacBook Pro 有 15% 的 CPU 性能提升。</p>
</blockquote>
<p>错误：</p>
<blockquote>
<p>今天是 233 ° 的高温。</p>
<p>新 MacBook Pro 有 15 % 的 CPU 性能提升。</p>
</blockquote>
<h3 id="全角标点与其他字符之间不加空格"><a href="#全角标点与其他字符之间不加空格" class="headerlink" title="全角标点与其他字符之间不加空格"></a>全角标点与其他字符之间不加空格</h3><p>正确：</p>
<blockquote>
<p>刚刚买了一部 iPhone，好开心！</p>
</blockquote>
<p>错误：</p>
<blockquote>
<p>刚刚买了一部 iPhone ，好开心！</p>
</blockquote>
<h3 id="ms-text-autospace-to-the-rescue"><a href="#ms-text-autospace-to-the-rescue" class="headerlink" title="-ms-text-autospace to the rescue?"></a><code>-ms-text-autospace</code> to the rescue?</h3><p>Microsoft 有个 <a href="http://msdn.microsoft.com/en-us/library/ie/ms531164(v=vs.85" target="_blank" rel="external"><code>-ms-text-autospace</code></a>.aspx) 的 CSS 属性可以实现自动为中英文之间增加空白。不过目前并未普及，另外在其他应用场景，例如 OS X、iOS 的用户界面目前并不存在这个特性，所以请继续保持随手加空格的习惯。</p>
<h2 id="标点符号"><a href="#标点符号" class="headerlink" title="标点符号"></a>标点符号</h2><h3 id="不重复使用标点符号"><a href="#不重复使用标点符号" class="headerlink" title="不重复使用标点符号"></a>不重复使用标点符号</h3><p>正确：</p>
<blockquote>
<p>德国队竟然战胜了巴西队！</p>
<p>她竟然对你说「喵」？！</p>
</blockquote>
<p>错误：</p>
<blockquote>
<p>德国队竟然战胜了巴西队！！</p>
<p>德国队竟然战胜了巴西队！！！！！！！！</p>
<p>她竟然对你说「喵」？？！！</p>
<p>她竟然对你说「喵」？！？！？？！！</p>
</blockquote>
<h2 id="全角和半角"><a href="#全角和半角" class="headerlink" title="全角和半角"></a>全角和半角</h2><p>不明白什么是全角（全形）与半角（半形）符号？请查看维基百科词条『<a href="http://zh.wikipedia.org/wiki/%E5%85%A8%E5%BD%A2%E5%92%8C%E5%8D%8A%E5%BD%A2" target="_blank" rel="external">全角和半角</a>』。</p>
<h3 id="使用全角中文标点"><a href="#使用全角中文标点" class="headerlink" title="使用全角中文标点"></a>使用全角中文标点</h3><p>正确：</p>
<blockquote>
<p>嗨！你知道嘛？今天前台的小妹跟我说「喵」了哎！</p>
<p>核磁共振成像（NMRI）是什么原理都不知道？JFGI！</p>
</blockquote>
<p>错误：</p>
<blockquote>
<p>嗨! 你知道嘛? 今天前台的小妹跟我说 “喵” 了哎!</p>
<p>嗨!你知道嘛?今天前台的小妹跟我说”喵”了哎!</p>
<p>核磁共振成像 (NMRI) 是什么原理都不知道? JFGI!</p>
<p>核磁共振成像(NMRI)是什么原理都不知道?JFGI!</p>
</blockquote>
<h3 id="数字使用半角字符"><a href="#数字使用半角字符" class="headerlink" title="数字使用半角字符"></a>数字使用半角字符</h3><p>正确：</p>
<blockquote>
<p>这件蛋糕只卖 1000 元。</p>
</blockquote>
<p>错误：</p>
<blockquote>
<p>这件蛋糕只卖 １０００ 元。</p>
</blockquote>
<p>例外：在设计稿、宣传海报中如出现极少量数字的情形时，为方便文字对齐，是可以使用全角数字的。</p>
<h3 id="遇到完整的英文整句、特殊名词，其內容使用半角标点"><a href="#遇到完整的英文整句、特殊名词，其內容使用半角标点" class="headerlink" title="遇到完整的英文整句、特殊名词，其內容使用半角标点"></a>遇到完整的英文整句、特殊名词，其內容使用半角标点</h3><p>正确：</p>
<blockquote>
<p>乔布斯那句话是怎么说的？「Stay hungry, stay foolish.」</p>
<p>推荐你阅读《Hackers &amp; Painters: Big Ideas from the Computer Age》，非常的有趣。</p>
</blockquote>
<p>错误：</p>
<blockquote>
<p>乔布斯那句话是怎么说的？「Stay hungry，stay foolish。」</p>
<p>推荐你阅读《Hackers＆Painters：Big Ideas from the Computer Age》，非常的有趣。</p>
</blockquote>
<h2 id="名词"><a href="#名词" class="headerlink" title="名词"></a>名词</h2><h3 id="专有名词使用正确的大小写"><a href="#专有名词使用正确的大小写" class="headerlink" title="专有名词使用正确的大小写"></a>专有名词使用正确的大小写</h3><p>大小写相关用法原属于英文书写范畴，不属于本 wiki 讨论內容，在这里只对部分易错用法进行简述。</p>
<p>正确：</p>
<blockquote>
<p>使用 GitHub 登录</p>
<p>我们的客户有 GitHub、Foursquare、Microsoft Corporation、Google、Facebook, Inc.。</p>
</blockquote>
<p>错误：</p>
<blockquote>
<p>使用 github 登录</p>
<p>使用 GITHUB 登录</p>
<p>使用 Github 登录</p>
<p>使用 gitHub 登录</p>
<p>使用 gｲんĤЦ8 登录</p>
<p>我们的客户有 github、foursquare、microsoft corporation、google、facebook, inc.。</p>
<p>我们的客户有 GITHUB、FOURSQUARE、MICROSOFT CORPORATION、GOOGLE、FACEBOOK, INC.。</p>
<p>我们的客户有 Github、FourSquare、MicroSoft Corporation、Google、FaceBook, Inc.。</p>
<p>我们的客户有 gitHub、fourSquare、microSoft Corporation、google、faceBook, Inc.。</p>
<p>我们的客户有 gｲんĤЦ8、ｷouЯƧquﾑгє、๓เςг๏ร๏Ŧt ς๏гק๏гคtเ๏ภn、900913、ƒ4ᄃëв๏๏к, IПᄃ.。</p>
</blockquote>
<p>注意：当网页中需要配合整体视觉风格而出现全部大写／小写的情形，HTML 中请使用标准的大小写规范进行书写；并通过 <code>text-transform: uppercase;</code>／<code>text-transform: lowercase;</code> 对表现形式进行定义。</p>
<h3 id="不要使用不地道的缩写"><a href="#不要使用不地道的缩写" class="headerlink" title="不要使用不地道的缩写"></a>不要使用不地道的缩写</h3><p>正确：</p>
<blockquote>
<p>我们需要一位熟悉 JavaScript、HTML5，至少理解一种框架（如 Backbone.js、AngularJS、React 等）的前端开发者。</p>
</blockquote>
<p>错误：</p>
<blockquote>
<p>我们需要一位熟悉 Js、h5，至少理解一种框架（如 backbone、angular、RJS 等）的 FED。</p>
</blockquote>
<h2 id="争议"><a href="#争议" class="headerlink" title="争议"></a>争议</h2><p>以下用法略带有个人色彩，即：无论是否遵循下述规则，从语法的角度来讲都是<strong>正确</strong>的。</p>
<h3 id="链接之间增加空格"><a href="#链接之间增加空格" class="headerlink" title="链接之间增加空格"></a>链接之间增加空格</h3><p>用法：</p>
<blockquote>
<p>请 <a href="#">提交一个 issue</a> 并分配给相关同事。</p>
<p>访问我们网站的最新动态，请 <a href="#">点击这里</a> 进行订阅！</p>
</blockquote>
<p>对比用法：</p>
<blockquote>
<p>请<a href="#">提交一个 issue</a> 并分配给相关同事。</p>
<p>访问我们网站的最新动态，请<a href="#">点击这里</a>进行订阅！</p>
</blockquote>
<h3 id="简体中文使用直角引号"><a href="#简体中文使用直角引号" class="headerlink" title="简体中文使用直角引号"></a>简体中文使用直角引号</h3><p>用法：</p>
<blockquote>
<p>「老师，『有条不紊』的『紊』是什么意思？」</p>
</blockquote>
<p>对比用法：</p>
<blockquote>
<p>“老师，‘有条不紊’的‘紊’是什么意思？”</p>
</blockquote>
<h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><table>
<thead>
<tr>
<th>仓库</th>
<th>语言</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/vinta/paranoid-auto-spacing" target="_blank" rel="external">vinta/paranoid-auto-spacing</a></td>
<td>JavaScript</td>
</tr>
<tr>
<td><a href="https://github.com/huei90/pangu.node" target="_blank" rel="external">huei90/pangu.node</a></td>
<td>Node.js</td>
</tr>
<tr>
<td><a href="https://github.com/huacnlee/auto-correct" target="_blank" rel="external">huacnlee/auto-correct</a></td>
<td>Ruby</td>
</tr>
<tr>
<td><a href="https://github.com/sparanoid/space-lover" target="_blank" rel="external">sparanoid/space-lover</a></td>
<td>PHP (WordPress)</td>
</tr>
<tr>
<td><a href="https://github.com/NauxLiu/auto-correct" target="_blank" rel="external">nauxliu/auto-correct</a></td>
<td>PHP</td>
</tr>
<tr>
<td><a href="https://github.com/ricoa/copywriting-correct" target="_blank" rel="external">ricoa/copywriting-correct</a></td>
<td>PHP</td>
</tr>
<tr>
<td><a href="https://github.com/hotoo/pangu.vim" target="_blank" rel="external">hotoo/pangu.vim</a></td>
<td>Vim</td>
</tr>
<tr>
<td><a href="https://github.com/sparanoid/grunt-auto-spacing" target="_blank" rel="external">sparanoid/grunt-auto-spacing</a></td>
<td>Node.js (Grunt)</td>
</tr>
<tr>
<td><a href="https://github.com/hjiang/scripts/blob/master/add-space-between-latin-and-cjk" target="_blank" rel="external">hjiang/scripts/add-space-between-latin-and-cjk</a></td>
<td>Python</td>
</tr>
</tbody>
</table>
<h2 id="谁在这样做？"><a href="#谁在这样做？" class="headerlink" title="谁在这样做？"></a>谁在这样做？</h2><table>
<thead>
<tr>
<th>网站</th>
<th>文案</th>
<th>UGC</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="http://www.apple.com/cn/" target="_blank" rel="external">Apple 中国</a></td>
<td>Yes</td>
<td>N/A</td>
</tr>
<tr>
<td><a href="http://www.apple.com/hk/" target="_blank" rel="external">Apple 香港</a></td>
<td>Yes</td>
<td>N/A</td>
</tr>
<tr>
<td><a href="http://www.apple.com/tw/" target="_blank" rel="external">Apple 台湾</a></td>
<td>Yes</td>
<td>N/A</td>
</tr>
<tr>
<td><a href="http://www.microsoft.com/zh-cn/" target="_blank" rel="external">Microsoft 中国</a></td>
<td>Yes</td>
<td>N/A</td>
</tr>
<tr>
<td><a href="http://www.microsoft.com/zh-hk/" target="_blank" rel="external">Microsoft 香港</a></td>
<td>Yes</td>
<td>N/A</td>
</tr>
<tr>
<td><a href="http://www.microsoft.com/zh-tw/" target="_blank" rel="external">Microsoft 台湾</a></td>
<td>Yes</td>
<td>N/A</td>
</tr>
<tr>
<td><a href="https://leancloud.cn/" target="_blank" rel="external">LeanCloud</a></td>
<td>Yes</td>
<td>N/A</td>
</tr>
<tr>
<td><a href="https://www.zhihu.com/" target="_blank" rel="external">知乎</a></td>
<td>Yes</td>
<td>部分用户达成</td>
</tr>
<tr>
<td><a href="https://www.v2ex.com/" target="_blank" rel="external">V2EX</a></td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td><a href="https://segmentfault.com/" target="_blank" rel="external">SegmentFault</a></td>
<td>Yes</td>
<td>部分用户达成</td>
</tr>
<tr>
<td><a href="http://apple4us.com/" target="_blank" rel="external">Apple4us</a></td>
<td>Yes</td>
<td>N/A</td>
</tr>
<tr>
<td><a href="https://www.wandoujia.com/" target="_blank" rel="external">豌豆荚</a></td>
<td>Yes</td>
<td>N/A</td>
</tr>
<tr>
<td><a href="https://ruby-china.org/" target="_blank" rel="external">Ruby China</a></td>
<td>Yes</td>
<td>标题达成</td>
</tr>
<tr>
<td><a href="https://phphub.org/" target="_blank" rel="external">PHPHub</a></td>
<td>Yes</td>
<td>标题达成</td>
</tr>
<tr>
<td><a href="http://sspai.com/" target="_blank" rel="external">少数派</a></td>
<td>Yes</td>
<td>N/A</td>
</tr>
</tbody>
</table>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><ul>
<li><a href="http://grammar.about.com/od/punctuationandmechanics/a/Guidelines-For-Using-Capital-Letters.htm" target="_blank" rel="external">Guidelines for Using Capital Letters</a></li>
<li><a href="http://en.wikipedia.org/wiki/Letter_case" target="_blank" rel="external">Letter case - Wikipedia</a></li>
<li><a href="http://www.oxforddictionaries.com/words/punctuation" target="_blank" rel="external">Punctuation - Oxford Dictionaries</a></li>
<li><a href="https://owl.english.purdue.edu/owl/section/1/6/" target="_blank" rel="external">Punctuation - The Purdue OWL</a></li>
<li><a href="http://www.wikihow.com/Use-English-Punctuation-Correctly" target="_blank" rel="external">How to Use English Punctuation Corrently - wikiHow</a></li>
<li><a href="https://zh.opensuse.org/index.php?title=Help:%E6%A0%BC%E5%BC%8F" target="_blank" rel="external">格式 - openSUSE</a></li>
<li><a href="http://zh.wikipedia.org/wiki/%E5%85%A8%E5%BD%A2%E5%92%8C%E5%8D%8A%E5%BD%A2" target="_blank" rel="external">全角和半角 - 维基百科</a></li>
<li><a href="http://zh.wikipedia.org/wiki/%E5%BC%95%E8%99%9F" target="_blank" rel="external">引号 - 维基百科</a></li>
<li><a href="http://zh.wikipedia.org/wiki/%E7%96%91%E5%95%8F%E9%A9%9A%E5%98%86%E8%99%9F" target="_blank" rel="external">疑问惊叹号 - 维基百科</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      统一中文文案、排版的相关用法，降低团队成员之间的沟通成本，增强网站气质。
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>NLS_LANG数据库字符集中文乱码问题分析和解决</title>
    <link href="https://wsgzao.github.io/post/lang/"/>
    <id>https://wsgzao.github.io/post/lang/</id>
    <published>2017-09-06T08:40:53.000Z</published>
    <updated>2017-09-06T08:08:18.241Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>已经有3年多没再关心或者遇到编码格式的问题了，一是离Oracle数据库操作远了，二是现在的Terminal，IDE和操作系统语言环境配置都很标准，比如清一色的UTF-8编码和UNIX(LF)，我自己的组合是以下形式，Xmanager + Visual Studio Code/Notepad2 + 增加中文语言包显示的操作系统，Oracle zhs16gbk，MySQL utf8，Python 2/3 utf-8。本来应该是非常统一而和谐的开发环境因为sqlplus spool导出中文内容而又变更混沌，索性再彻底分析以下中文乱码的源头和解决方案。</p>
<blockquote>
<p>保持操作系统，终端登录，数据库3者编码格式一致性很重要</p>
</blockquote>
<h2 id="更新记录"><a href="#更新记录" class="headerlink" title="更新记录"></a>更新记录</h2><p>2017年09月06日 - 初稿</p>
<p>阅读原文 - <a href="https://wsgzao.github.io/post/lang/">https://wsgzao.github.io/post/lang/</a></p>
<h2 id="Locale"><a href="#Locale" class="headerlink" title="Locale"></a>Locale</h2><blockquote>
<p>下面2个地址对Locale语言字符集的介绍已经很清晰了，我只强调2点</p>
</blockquote>
<ol>
<li>大多数UNIX操作系统建议默认显示语言为英语，但是一定要添加中文语言支持包</li>
<li>显示中文乱码多数原因是操作系统LANG环境变量或者类似Xshell编码不统一造成的</li>
</ol>
<p>Locale - <a href="http://wiki.ubuntu.org.cn/Locale" target="_blank" rel="external">http://wiki.ubuntu.org.cn/Locale</a><br>Localization - <a href="https://wiki.gentoo.org/wiki/Localization/Guide" target="_blank" rel="external">https://wiki.gentoo.org/wiki/Localization/Guide</a></p>
<h2 id="NLS-LANG"><a href="#NLS-LANG" class="headerlink" title="NLS_LANG"></a>NLS_LANG</h2><p>本次遇到的问题主要是由于使用sqlplus spool从Oracle数据库导出中文数据引发连锁问题，虽然和数据库相关但是解决中文乱码的思路基本上是一致的，方便各位以后可以借鉴和参考。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment"># 源主机：CentOS 6.8 已安装中文语言包，保持LANG和NLS_LANG默认环境变量，Oracle Instant Client 12.2.0.1.0，已安装sqlplus</span></div><div class="line"><span class="built_in">echo</span> <span class="variable">$LANG</span></div><div class="line">en_US.UTF-8</div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="variable">$NLS_LANG</span></div><div class="line">空</div><div class="line"></div><div class="line"><span class="comment"># 数据库服务器：Oracle Database 11.2.0.3.0，NLS_CHARACTERSET ZHS16GBK</span></div><div class="line">sqlplus system/oracle@orabiz</div><div class="line"></div><div class="line">SQL&gt; select * from v<span class="variable">$nls_parameters</span>;</div><div class="line"></div><div class="line">PARAMETER</div><div class="line">----------------------------------------------------------------</div><div class="line">VALUE</div><div class="line">----------------------------------------------------------------</div><div class="line">NLS_LANGUAGE</div><div class="line">AMERICAN</div><div class="line"></div><div class="line">NLS_TERRITORY</div><div class="line">AMERICA</div><div class="line"></div><div class="line">NLS_CURRENCY</div><div class="line">$</div><div class="line"></div><div class="line"></div><div class="line">PARAMETER</div><div class="line">----------------------------------------------------------------</div><div class="line">VALUE</div><div class="line">----------------------------------------------------------------</div><div class="line">NLS_ISO_CURRENCY</div><div class="line">AMERICA</div><div class="line"></div><div class="line">NLS_NUMERIC_CHARACTERS</div><div class="line">.,</div><div class="line"></div><div class="line">NLS_CALENDAR</div><div class="line">GREGORIAN</div><div class="line"></div><div class="line"></div><div class="line">PARAMETER</div><div class="line">----------------------------------------------------------------</div><div class="line">VALUE</div><div class="line">----------------------------------------------------------------</div><div class="line">NLS_DATE_FORMAT</div><div class="line">DD-MON-RR</div><div class="line"></div><div class="line">NLS_DATE_LANGUAGE</div><div class="line">AMERICAN</div><div class="line"></div><div class="line">NLS_CHARACTERSET</div><div class="line">ZHS16GBK</div><div class="line"></div><div class="line"></div><div class="line">PARAMETER</div><div class="line">----------------------------------------------------------------</div><div class="line">VALUE</div><div class="line">----------------------------------------------------------------</div><div class="line">NLS_SORT</div><div class="line">BINARY</div><div class="line"></div><div class="line">NLS_TIME_FORMAT</div><div class="line">HH.MI.SSXFF AM</div><div class="line"></div><div class="line">NLS_TIMESTAMP_FORMAT</div><div class="line">DD-MON-RR HH.MI.SSXFF AM</div><div class="line"></div><div class="line"></div><div class="line">PARAMETER</div><div class="line">----------------------------------------------------------------</div><div class="line">VALUE</div><div class="line">----------------------------------------------------------------</div><div class="line">NLS_TIME_TZ_FORMAT</div><div class="line">HH.MI.SSXFF AM TZR</div><div class="line"></div><div class="line">NLS_TIMESTAMP_TZ_FORMAT</div><div class="line">DD-MON-RR HH.MI.SSXFF AM TZR</div><div class="line"></div><div class="line">NLS_DUAL_CURRENCY</div><div class="line">$</div><div class="line"></div><div class="line"></div><div class="line">PARAMETER</div><div class="line">----------------------------------------------------------------</div><div class="line">VALUE</div><div class="line">----------------------------------------------------------------</div><div class="line">NLS_NCHAR_CHARACTERSET</div><div class="line">AL16UTF16</div><div class="line"></div><div class="line">NLS_COMP</div><div class="line">BINARY</div><div class="line"></div><div class="line">NLS_LENGTH_SEMANTICS</div><div class="line">BYTE</div><div class="line"></div><div class="line"></div><div class="line">PARAMETER</div><div class="line">----------------------------------------------------------------</div><div class="line">VALUE</div><div class="line">----------------------------------------------------------------</div><div class="line">NLS_NCHAR_CONV_EXCP</div><div class="line">FALSE</div><div class="line"></div><div class="line"></div><div class="line">19 rows selected.</div></pre></td></tr></table></figure>
<h3 id="问题1：ORA-12705"><a href="#问题1：ORA-12705" class="headerlink" title="问题1：ORA-12705"></a>问题1：ORA-12705</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">ERROR:</div><div class="line">ORA-12705: Cannot access NLS data files or invalid environment specified</div><div class="line"></div><div class="line">12705, 00000, <span class="string">"Cannot access NLS data files or invalid environment specified"</span></div><div class="line">// *Cause: Either an attempt was made to issue an ALTER SESSION <span class="built_in">command</span></div><div class="line">//         with an invalid NLS parameter or value; or the environment</div><div class="line">//         variable(s) NLS_LANG, ORA_NLSxx, or ORACLE_HOME was incorrectly</div><div class="line">//         specified, therefore the NLS data files cannot be located.</div><div class="line">// *Action: Check the syntax of the ALTER SESSION <span class="built_in">command</span> and the NLS</div><div class="line">//          parameter, correct the syntax and retry the statement, or</div><div class="line">//          specify the correct directory path/values <span class="keyword">in</span> the environment</div><div class="line">//          variables.</div></pre></td></tr></table></figure>
<p>根据以上Oracle官方提示，合理的解决思路大致是这样</p>
<ol>
<li>检查数据库服务器的NLS parameter</li>
<li>在客户端中配置与服务端匹配的NLS_LANG</li>
</ol>
<p>比如我的环境就需要配置</p>
<pre><code>export NLS_LANG=&quot;american_america.zhs16gbk&quot;
</code></pre><p>它的格式如下:NLS_LANG=language_territory.charset<br>它有三个组成部分(语言、地域和字符集)，每个成分控制了NLS子集的特性。<br>Language：指定服务器消息的语言， 影响提示信息是中文还是英文<br>Territory：指定服务器的日期和数字格式，<br>Charset：指定字符集。<br>如:AMERICAN_AMERICA.ZHS16GBK, SIMPLIFIED CHINESE_CHINA.ZHS16GBK</p>
<pre><code>export NLS_LANG=&quot;SIMPLIFIED CHINESE_CHINA.ZHS16GBK&quot;
</code></pre><p>从NLS_LANG的组成我们可以看出，真正影响数据库字符集的其实是第三部分。<br>所以两个数据库之间的字符集只要第三部分一样就可以相互导入导出数据，前面影响的只是提示信息是中文还是英文。</p>
<h3 id="问题2：VI打开文件中文乱码"><a href="#问题2：VI打开文件中文乱码" class="headerlink" title="问题2：VI打开文件中文乱码"></a>问题2：VI打开文件中文乱码</h3><blockquote>
<p>其实这个问题就是由第一个问题引申出来的，主要和LANG环境变量有关</p>
</blockquote>
<p>Locale 是软件在运行时的语言环境, 它包括语言(Language), 地域 (Territory) 和字符集(Codeset)。<br>一个locale的书写格式为: 语言[_地域[.字符集]].</p>
<p>zh<em>CN.GB2312＝中文</em>中华人民共和国＋国标2312字符集。<br>我说中文，身处中国大陆，使用国标2312字符集来表达字符。</p>
<p>zh<em>TW.BIG5=中文</em>台湾.大五码字符集<br>我说中文，身处台湾地区，使用Big5字符集来表达字符。</p>
<p>根据以上信息合理的解决思路大致是这样</p>
<ol>
<li>检查操作系统是否已添加中文语言包</li>
<li>检查SecureCRT/Xshell等终端编码是否为默认编码或UTF-8</li>
<li>检查LANG环境变量是否合适</li>
</ol>
<p>比如我的环境就需要配置，为什么不加zh_CN.UTF-8，你猜呢</p>
<pre><code>export LANG=zh_CN
</code></pre>]]></content>
    
    <summary type="html">
    
      保持操作系统，终端登录，数据库3者编码格式一致性很重要
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>PyCharm使用心得</title>
    <link href="https://wsgzao.github.io/post/pycharm/"/>
    <id>https://wsgzao.github.io/post/pycharm/</id>
    <published>2017-08-25T08:40:53.000Z</published>
    <updated>2017-08-25T08:27:05.881Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>PyCharm是大JB旗下的产品之一，对于广大Python开发者来说应该不会陌生，对于个人开发者来说用什么IDE(VIM/Sublime Text/Visual Studio Code)可能并不重要，但是面对一个开发素质参差不齐的团队时，我相信老老实实统一使用PyCharm会是一个虽然大但是全的不错选择，因为一开始就开启pep8和pylint检测能显著提升代码质量，各种错误和警告提示会逼着你写出高质量的代码。当然统一编码和注释风格，小团队做一些适度的code review和单元测试会帮助团队一起更快的成长，良好的代码有时候靠的是自律、规范和review，而不仅仅是技术。</p>
<p>“我不是个伟大的程序员，我只是个有着一些优秀习惯的好程序员” | By Kent Beck</p>
<blockquote>
<p>PyCharm - Python IDE for Professional Developers by JetBrains.</p>
</blockquote>
<h2 id="更新记录"><a href="#更新记录" class="headerlink" title="更新记录"></a>更新记录</h2><p>2017年08月25日 - 初稿</p>
<p>阅读原文 - <a href="https://wsgzao.github.io/post/pycharm/">https://wsgzao.github.io/post/pycharm/</a></p>
<p><strong>扩展阅读</strong></p>
<p>PyCharm - <a href="https://www.jetbrains.com/pycharm/" target="_blank" rel="external">https://www.jetbrains.com/pycharm/</a></p>
<h2 id="购买和使用"><a href="#购买和使用" class="headerlink" title="购买和使用"></a>购买和使用</h2><p>JetBrains 的产品大多数是付费形式，但是对于教育行业却实行免费授权计划，几乎涵盖所有产品，十分良心。</p>
<p>学生授权申请方式<br><a href="https://sales.jetbrains.com/hc/zh-cn/articles/207154369-%E5%AD%A6%E7%94%9F%E6%8E%88%E6%9D%83%E7%94%B3%E8%AF%B7%E6%96%B9%E5%BC%8F" target="_blank" rel="external">https://sales.jetbrains.com/hc/zh-cn/articles/207154369-%E5%AD%A6%E7%94%9F%E6%8E%88%E6%9D%83%E7%94%B3%E8%AF%B7%E6%96%B9%E5%BC%8F</a></p>
<p>如果已经有一定经济能力请支持正版</p>
<h2 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h2><blockquote>
<p>以下设置选项随着版本调整可能发生位置变化，但可以在Settings(Ctrl+Alt+S)左上角的搜索栏里快速进行查询</p>
</blockquote>
<h3 id="字体调整"><a href="#字体调整" class="headerlink" title="字体调整"></a>字体调整</h3><p>默认的字体个人觉得偏小，<code>File--&gt;Settings--&gt;Editor--&gt;Font</code>，新版本不必像老版本一样调整前必须要保持一个新的Scheme，直接修改你喜欢的字体和大小应用就可以看到效果了</p>
<h3 id="显示行号"><a href="#显示行号" class="headerlink" title="显示行号"></a>显示行号</h3><p>在<code>File--&gt;Settings--&gt;Editor--&gt;General--&gt;Appearance</code>里勾选Show line numbers</p>
<h3 id="皮肤主题与编辑器主题"><a href="#皮肤主题与编辑器主题" class="headerlink" title="皮肤主题与编辑器主题"></a>皮肤主题与编辑器主题</h3><p>皮肤主题和编辑器主题是分开设置的</p>
<p>皮肤主题在<code>File--&gt;Settings--&gt;Appearance &amp; Behavior--&gt;Appearance</code>的Theme选项下选择</p>
<p>编辑器主题在<code>File--&gt;Settings--&gt;Editor--&gt;Colors Scheme</code>的Scheme选项下选择</p>
<h3 id="自动生成文件头"><a href="#自动生成文件头" class="headerlink" title="自动生成文件头"></a>自动生成文件头</h3><p>默认情况下，新建完一个文件后，PyCharm会生成一个<strong>author</strong> = ‘$USER’的文件头，但通常每个Python文件都会添加<code># -*- coding: utf-8 -*-</code>来控制编码。可以在<code>File--&gt;Settings--&gt;File and Code Templates</code>中的Templates选中Python Script在右侧把你要自动添加的内容加进去</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"><span class="comment"># __author__ = 'wangao'</span></div></pre></td></tr></table></figure>
<h3 id="常用快捷键"><a href="#常用快捷键" class="headerlink" title="常用快捷键"></a>常用快捷键</h3><blockquote>
<p>温馨提示：PyCharm会实时自动保存代码并写入本地文件</p>
</blockquote>
<p>Ctrl + / 行注释，可以批量选择和取消<br>快速按2次Shift 全局文件名称查找，可以快速定位所要编辑的文件</p>
<p>Ctrl + F 当前文件查找<br>Ctrl + R 当前文件替换<br>Ctrl + Shift + F 全局查找，可能会和输入法的简繁快捷键冲突，记得关闭<br>Ctrl + Shift + R 全局替换</p>
<p>Ctrl + Z 撤销<br>Ctrl + Shift + Z 回撤</p>
<h2 id="使用技巧"><a href="#使用技巧" class="headerlink" title="使用技巧"></a>使用技巧</h2><p>未完待续</p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><blockquote>
<p>@陈俊岭 把Pycharm官方帮助文档翻译了一遍，如果英文不好可以适度参考</p>
</blockquote>
<p>我的Pycharm，我做主 - <a href="http://blog.csdn.net/u013088062/article/details/50388329" target="_blank" rel="external">http://blog.csdn.net/u013088062/article/details/50388329</a></p>
]]></content>
    
    <summary type="html">
    
      PyCharm - Python IDE for Professional Developers by JetBrains.
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>Install Oracle Instant Client on Linux and Windows</title>
    <link href="https://wsgzao.github.io/post/oracle-instant-client/"/>
    <id>https://wsgzao.github.io/post/oracle-instant-client/</id>
    <published>2017-08-22T08:40:53.000Z</published>
    <updated>2017-08-22T08:03:48.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本篇文章用最简单和快速的方法介绍如何在Red Hat Enterprise Linux安装Oracle Instant Client，该方法同样适用于Windows，RHEL5/6/7，OEL，CentOS。Oracle Instant Client是官方免费授权的一种比Oracle Client还要简单的数据库管理工具，通过SQL*Plus或者其它工具比如Navicat等用于快速连接和管理Oracle数据库服务器。</p>
<blockquote>
<p>Install Oracle instantclient basic and instantclient sqlplus on Linux and Windows.</p>
</blockquote>
<h2 id="更新记录"><a href="#更新记录" class="headerlink" title="更新记录"></a>更新记录</h2><p>2017年08月22日 - 增加oracle instant client tnsping<br>2017年08月14日 - 补充ORA-24454: client host name is not set的解决方案<br>2017年08月10日 - 初稿</p>
<p>阅读原文 - <a href="https://wsgzao.github.io/post/oracle-instant-client/">https://wsgzao.github.io/post/oracle-instant-client/</a></p>
<p><strong>扩展阅读</strong></p>
<p>Oracle Instant Client Downloads - <a href="http://www.oracle.com/technetwork/database/features/instant-client/index-097480.html" target="_blank" rel="external">http://www.oracle.com/technetwork/database/features/instant-client/index-097480.html</a></p>
<h2 id="Oracle-Instant-Client-Downloads"><a href="#Oracle-Instant-Client-Downloads" class="headerlink" title="Oracle Instant Client Downloads"></a>Oracle Instant Client Downloads</h2><blockquote>
<p>文章内容均已64位版本为例，如果客户端有特殊需求请使用32位版本兼容</p>
</blockquote>
<ol>
<li>Linux Oracle Instant Client推荐使用RPM方式安装，如果需要定制具体路径可以使用zip包手动配置</li>
<li>Windows和Linux类似但需要主要PATH环境变量的配置</li>
<li>实测12版本客户端可以向下兼容11版本的数据库服务器，Oracle Instant Client 12.2.0.1.0，Oracle Database 11.2.0.3.0</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">file://C:\Dropbox\Oracle Instant Client    (2 folders, 1 files, 5.51 KB, 479.15 MB <span class="keyword">in</span> total.)</div><div class="line">│ README.md    5.51 KB</div><div class="line">├─Linux    (2 folders, 0 files, 0 bytes, 234.26 MB <span class="keyword">in</span> total.)</div><div class="line">│ ├─11.2.0.4.0    (0 folders, 4 files, 116.57 MB, 116.57 MB <span class="keyword">in</span> total.)</div><div class="line">│ │   instantclient-basic-linux.x64-11.2.0.4.0.zip    57.89 MB</div><div class="line">│ │   instantclient-sqlplus-linux.x64-11.2.0.4.0.zip    814.93 KB</div><div class="line">│ │   oracle-instantclient11.2-basic-11.2.0.4.0-1.x86_64.rpm    57.09 MB</div><div class="line">│ │   oracle-instantclient11.2-sqlplus-11.2.0.4.0-1.x86_64.rpm    808.92 KB</div><div class="line">│ └─12.2.0.1.0    (0 folders, 4 files, 117.69 MB, 117.69 MB <span class="keyword">in</span> total.)</div><div class="line">│     instantclient-basic-linux.x64-12.2.0.1.0.zip    65.77 MB</div><div class="line">│     instantclient-sqlplus-linux.x64-12.2.0.1.0.zip    883.11 KB</div><div class="line">│     oracle-instantclient12.2-basic-12.2.0.1.0-1.x86_64.rpm    50.38 MB</div><div class="line">│     oracle-instantclient12.2-sqlplus-12.2.0.1.0-1.x86_64.rpm    691.51 KB</div><div class="line">└─Windows    (2 folders, 0 files, 0 bytes, 244.89 MB <span class="keyword">in</span> total.)</div><div class="line">  ├─11.2.0.4.0    (0 folders, 4 files, 103.01 MB, 103.01 MB <span class="keyword">in</span> total.)</div><div class="line">  │   instantclient-basic-nt-11.2.0.4.0.zip    49.09 MB</div><div class="line">  │   instantclient-basic-windows.x64-11.2.0.4.0.zip    52.41 MB</div><div class="line">  │   instantclient-sqlplus-nt-11.2.0.4.0.zip    739.29 KB</div><div class="line">  │   instantclient-sqlplus-windows.x64-11.2.0.4.0.zip    801.93 KB</div><div class="line">  └─12.2.0.1.0    (0 folders, 4 files, 141.88 MB, 141.88 MB <span class="keyword">in</span> total.)</div><div class="line">      instantclient-basic-nt-12.2.0.1.0.zip    68.55 MB</div><div class="line">      instantclient-basic-windows.x64-12.2.0.1.0.zip    71.59 MB</div><div class="line">      instantclient-sqlplus-nt-12.2.0.1.0.zip    849.21 KB</div><div class="line">      instantclient-sqlplus-windows.x64-12.2.0.1.0.zip    937.40 KB</div></pre></td></tr></table></figure>
<p>下载地址<br><a href="http://www.oracle.com/technetwork/database/features/instant-client/index-097480.html" target="_blank" rel="external">http://www.oracle.com/technetwork/database/features/instant-client/index-097480.html</a></p>
<p>百度网盘分流<br><a href="http://pan.baidu.com/s/1slhoZEH" target="_blank" rel="external">http://pan.baidu.com/s/1slhoZEH</a></p>
<h2 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h2><blockquote>
<p>以RPM最简方式为例</p>
</blockquote>
<h3 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h3><p>Download all the required RPM from the official site and put them on the target system.<br>Current RPMs for 64bit are:<br>oracle-instantclient12.2-basic-12.2.0.1.0-1.x86_64.rpm<br>oracle-instantclient12.2-sqlplus-12.2.0.1.0-1.x86_64.rpm</p>
<h3 id="Install-RPMs"><a href="#Install-RPMs" class="headerlink" title="Install RPMs"></a>Install RPMs</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># install as root</span></div><div class="line">rpm -ivh oracle-instantclient12.2-basic-12.2.0.1.0-1.x86_64.rpm oracle-instantclient12.2-sqlplus-12.2.0.1.0-1.x86_64.rpm</div><div class="line"></div><div class="line"><span class="comment"># create oracle group and user</span></div><div class="line">groupadd dba</div><div class="line">useradd -g dba oracle</div><div class="line"><span class="built_in">echo</span> oracle:oracle | chpasswd</div><div class="line"></div><div class="line"><span class="comment"># configure profile</span></div><div class="line">su - oracle</div><div class="line">vi ~/.bash_profile</div><div class="line"></div><div class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=/usr/lib/oracle/12.2/client64/lib</div><div class="line"><span class="built_in">export</span> TNS_ADMIN=/usr/lib/oracle/12.2/client64/</div><div class="line"><span class="built_in">export</span> PATH=/usr/lib/oracle/12.2/client64/bin:<span class="variable">$PATH</span></div><div class="line"></div><div class="line"><span class="comment"># Connect to Your database with:</span></div><div class="line">sqlplus system/oracle@oracapdb</div><div class="line"></div><div class="line"><span class="comment"># create new tnsnames.ora</span></div><div class="line"><span class="comment"># ORA-12154: TNS:could not resolve the connect identifier specified</span></div><div class="line">vim /usr/lib/oracle/12.2/client64/tnsnames.ora</div><div class="line"></div><div class="line">oracapdb =</div><div class="line">   (DESCRIPTION =</div><div class="line">      (ADDRESS = (PROTOCOL = TCP)(HOST = 172.28.70.244)(PORT = 1521))</div><div class="line">          (CONNECT_DATA =</div><div class="line">        (SERVER = DEDICATED)</div><div class="line">      (SERVICE_NAME = oracapdb)</div><div class="line">   )</div><div class="line">)</div><div class="line"></div><div class="line"><span class="comment"># You can also use the Easy Connect connection string format (does not use TNSNAMES):</span></div><div class="line">sqlplus system/oracle@//172.28.70.244:1521/oracapdb</div><div class="line"></div><div class="line"><span class="comment"># ORA-24454: client host name is not set</span></div><div class="line"><span class="comment"># Cause: The network host name in files like /etc/hosts was not set.</span></div><div class="line"><span class="comment"># Action: Set the host name and try again.</span></div><div class="line">/bin/bash -c <span class="string">"echo '127.0.1.1 <span class="variable">$&#123;HOSTNAME&#125;</span>' &gt;&gt; /etc/hosts"</span></div></pre></td></tr></table></figure>
<h2 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h2><blockquote>
<p>Windows的配置相比Linux差不多简单，注意环境变量尤其是TNS_ADMIN</p>
</blockquote>
<h3 id="Preparation-1"><a href="#Preparation-1" class="headerlink" title="Preparation"></a>Preparation</h3><p>国外一篇图文并茂的文章写的也很详细，有需要可以参考下<br>Installing Oracle instantclient basic and instantclient sqlplus on win32<br><a href="http://www.dbatoolz.com/t/installing-oracle-instantclient-basic-and-instantclient-sqlplus-on-win32.html" target="_blank" rel="external">http://www.dbatoolz.com/t/installing-oracle-instantclient-basic-and-instantclient-sqlplus-on-win32.html</a></p>
<p>Go to Instant Client Downloads for Microsoft Windows download page:<br><a href="http://www.oracle.com/technology/software/tech/oci/instantclient/htdocs/winsoft.html" target="_blank" rel="external">http://www.oracle.com/technology/software/tech/oci/instantclient/htdocs/winsoft.html</a></p>
<h3 id="unzip-files"><a href="#unzip-files" class="headerlink" title="unzip files"></a>unzip files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 下载解压以下两个包至目录，比如C:\instantclient_12_2</span></div><div class="line">instantclient-basic-windows.x64-12.2.0.1.0.zip</div><div class="line">instantclient-sqlplus-windows.x64-12.2.0.1.0.zip</div><div class="line"></div><div class="line"><span class="comment"># 设置环境变量</span></div><div class="line">计算机右键【属性】----【高级系统设置】----【环境变量】----【系统变量】----【Path】</div><div class="line"></div><div class="line"><span class="comment"># Setup your system %PATH% and %TNS_ADMIN% variables</span></div><div class="line">C:\instantclient_12_2</div><div class="line"></div><div class="line"><span class="comment"># Connect to Your database with:</span></div><div class="line">sqlplus system/oracle@oracapdb</div><div class="line"></div><div class="line"><span class="comment"># TNS_ADMIN</span></div><div class="line"><span class="comment"># ORA-12154: TNS:could not resolve the connect identifier specified</span></div><div class="line">Variable Name: TNS_ADMIN</div><div class="line">Variable Value: C:\instantclient_12_2</div><div class="line"></div><div class="line"><span class="comment"># create new tnsnames.ora</span></div><div class="line">C:\instantclient_12_2\tnsnames.ora</div><div class="line"></div><div class="line">oracapdb =</div><div class="line">   (DESCRIPTION =</div><div class="line">      (ADDRESS = (PROTOCOL = TCP)(HOST = 172.28.70.244)(PORT = 1521))</div><div class="line">          (CONNECT_DATA =</div><div class="line">        (SERVER = DEDICATED)</div><div class="line">      (SERVICE_NAME = oracapdb)</div><div class="line">   )</div><div class="line">)</div><div class="line"></div><div class="line"><span class="comment"># You can also use the Easy Connect connection string format (does not use TNSNAMES):</span></div><div class="line">sqlplus system/oracle@//172.28.70.244:1521/oracapdb</div></pre></td></tr></table></figure>
<h2 id="tnsping"><a href="#tnsping" class="headerlink" title="tnsping"></a>tnsping</h2><p>因为某种原因Oracle官方迟迟未在Oracle Instant Client里集成tnsping，尽管不是什么大问题但相信也会给习惯使用tnsping命令测试数据库连接的小伙伴带来困扰，我这里推荐采用的方法不是像网上一样复制拷贝Standard Oracle Client，也不是完全拎起炉灶自己编写一套tnsping，而是选择使用Bash Shell模拟tnsping</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">vim /etc/profile</div><div class="line">vim ~/bash_profile</div><div class="line"></div><div class="line"><span class="built_in">whence</span> tnsping &gt;/dev/null 2&gt;&amp;1 || </div><div class="line">  <span class="function"><span class="title">tnsping</span></span>() &#123; </div><div class="line">    sqlplus -L -s x/x@<span class="variable">$1</span> &lt;/dev/null | </div><div class="line">      grep ORA- | </div><div class="line">        (grep -v ORA-01017 || <span class="built_in">echo</span> OK)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">$ tnsping db999</div><div class="line">ORA-12154: TNS:could not resolve the connect identifier specified</div><div class="line">$ tnsping db01</div><div class="line">OK</div><div class="line">$ tnsping db02</div><div class="line">ORA-12541: TNS:no listener</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      Install Oracle instantclient basic and instantclient sqlplus on Linux and Windows.
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>VMware vSphere Client(4.1/5.0/5.1/5.5/6.0) 客户端下载地址</title>
    <link href="https://wsgzao.github.io/post/vmware-vsphere-client/"/>
    <id>https://wsgzao.github.io/post/vmware-vsphere-client/</id>
    <published>2017-07-11T07:59:49.000Z</published>
    <updated>2017-07-11T06:15:54.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>VMware作为商业虚拟化方案的佼佼者不知不觉中已经成长为一颗苍天大树，面对OpenStack和Docker的夹击希望VMware可以继续勇往直前，从vSphere 6.5开始终于彻底告别Client的束缚，Web响应速度和功能也不再为人所诟病，因为多版本VMware vSphere Client共存比较困难，这里记录分享下vSphere Client从4.1至6.0的下载地址备用。</p>
<blockquote>
<p>The vSphere Client is no longer available starting with vSphere 6.5.</p>
</blockquote>
<h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2017年07月11日 - 初稿</p>
<p>阅读原文 - <a href="https://wsgzao.github.io/post/vmware-vsphere-client/">https://wsgzao.github.io/post/vmware-vsphere-client/</a></p>
<p><strong>扩展阅读</strong></p>
<p>Download URLs for VMware vSphere Client (2089791) - <a href="https://kb.vmware.com/selfservice/microsites/search.do" target="_blank" rel="external">https://kb.vmware.com/selfservice/microsites/search.do</a> language=en_US&amp;cmd=displayKC&amp;externalId=2089791</p>
<hr>
<h2 id="下载地址"><a href="#下载地址" class="headerlink" title="下载地址"></a>下载地址</h2><table>
<thead>
<tr>
<th>Version</th>
<th>File Name</th>
<th>Download URLs</th>
</tr>
</thead>
<tbody>
<tr>
<td>VMware vSphere Client 6.0</td>
<td>VMware-viclient-all-6.0.0-2502222.exe</td>
<td><a href="http://vsphereclient.vmware.com/vsphereclient/2/5/0/2/2/2/2/VMware-viclient-all-6.0.0-2502222.exe" target="_blank" rel="external">http://vsphereclient.vmware.com/vsphereclient/2/5/0/2/2/2/2/VMware-viclient-all-6.0.0-2502222.exe</a></td>
</tr>
<tr>
<td>VMware vSphere Client 6.0 Update 1</td>
<td>VMware-viclient-all-6.0.0-3016447.exe</td>
<td><a href="http://vsphereclient.vmware.com/vsphereclient/3/0/1/6/4/4/7/VMware-viclient-all-6.0.0-3016447.exe" target="_blank" rel="external">http://vsphereclient.vmware.com/vsphereclient/3/0/1/6/4/4/7/VMware-viclient-all-6.0.0-3016447.exe</a></td>
</tr>
<tr>
<td>VMware vSphere Client 6.0 Update 2</td>
<td>VMware-viclient-all-6.0.0-3562874.exe</td>
<td><a href="http://vsphereclient.vmware.com/vsphereclient/3/5/6/2/8/7/4/VMware-viclient-all-6.0.0-3562874.exe" target="_blank" rel="external">http://vsphereclient.vmware.com/vsphereclient/3/5/6/2/8/7/4/VMware-viclient-all-6.0.0-3562874.exe</a></td>
</tr>
<tr>
<td>VMware vSphere Client 6.0 Update 2a</td>
<td>VMware-viclient-all-6.0.0-4437566.exe</td>
<td><a href="http://vsphereclient.vmware.com/vsphereclient/4/4/3/7/5/6/6/VMware-viclient-all-6.0.0-4437566.exe" target="_blank" rel="external">http://vsphereclient.vmware.com/vsphereclient/4/4/3/7/5/6/6/VMware-viclient-all-6.0.0-4437566.exe</a></td>
</tr>
<tr>
<td>VMware vSphere Client 6.0 Update 3</td>
<td>VMware-viclient-all-6.0.0-5112508.exe</td>
<td><a href="http://vsphereclient.vmware.com/vsphereclient/5/1/1/2/5/0/8/VMware-viclient-all-6.0.0-5112508.exe" target="_blank" rel="external">http://vsphereclient.vmware.com/vsphereclient/5/1/1/2/5/0/8/VMware-viclient-all-6.0.0-5112508.exe</a></td>
</tr>
<tr>
<td>VMware vSphere Client 5.5</td>
<td>VMware-viclient-all-5.5.0-1281650.exe</td>
<td><a href="http://vsphereclient.vmware.com/vsphereclient/1/2/8/1/6/5/0/VMware-viclient-all-5.5.0-1281650.exe" target="_blank" rel="external">http://vsphereclient.vmware.com/vsphereclient/1/2/8/1/6/5/0/VMware-viclient-all-5.5.0-1281650.exe</a></td>
</tr>
<tr>
<td>VMware vSphere Client 5.5 Update 1</td>
<td>VMware-viclient-all-5.5.0-1618071.exe</td>
<td><a href="http://vsphereclient.vmware.com/vsphereclient/1/6/1/8/0/7/1/VMware-viclient-all-5.5.0-1618071.exe" target="_blank" rel="external">http://vsphereclient.vmware.com/vsphereclient/1/6/1/8/0/7/1/VMware-viclient-all-5.5.0-1618071.exe</a></td>
</tr>
<tr>
<td>VMware vSphere Client 5.5 Update 1a</td>
<td>VMware-viclient-all-5.5.0-1746248.exe</td>
<td><a href="http://vsphereclient.vmware.com/vsphereclient/1/7/4/6/2/4/8/VMware-viclient-all-5.5.0-1746248.exe" target="_blank" rel="external">http://vsphereclient.vmware.com/vsphereclient/1/7/4/6/2/4/8/VMware-viclient-all-5.5.0-1746248.exe</a></td>
</tr>
<tr>
<td>VMware vSphere Client 5.5 Update C</td>
<td>VMware-viclient-all-5.5.0-1745234.exe</td>
<td><a href="http://vsphereclient.vmware.com/vsphereclient/1/7/4/5/2/3/4/VMware-viclient-all-5.5.0-1745234.exe" target="_blank" rel="external">http://vsphereclient.vmware.com/vsphereclient/1/7/4/5/2/3/4/VMware-viclient-all-5.5.0-1745234.exe</a></td>
</tr>
<tr>
<td>VMware vSphere Client 5.5 Update 1b</td>
<td>VMware-viclient-all-5.5.0-1880841.exe</td>
<td><a href="http://vsphereclient.vmware.com/vsphereclient/1/8/8/0/8/4/1/VMware-viclient-all-5.5.0-1880841.exe" target="_blank" rel="external">http://vsphereclient.vmware.com/vsphereclient/1/8/8/0/8/4/1/VMware-viclient-all-5.5.0-1880841.exe</a></td>
</tr>
<tr>
<td>VMware vSphere Client 5.5 Update 2</td>
<td>VMware-viclient-all-5.5.0-1993072.exe</td>
<td><a href="http://vsphereclient.vmware.com/vsphereclient/1/9/9/3/0/7/2/VMware-viclient-all-5.5.0-1993072.exe" target="_blank" rel="external">http://vsphereclient.vmware.com/vsphereclient/1/9/9/3/0/7/2/VMware-viclient-all-5.5.0-1993072.exe</a></td>
</tr>
<tr>
<td>VMware vSphere Client 5.5 Update 3</td>
<td>VMware-viclient-all-5.5.0-3024345.exe</td>
<td><a href="http://vsphereclient.vmware.com/vsphereclient/3/0/2/4/3/4/5/VMware-viclient-all-5.5.0-3024345.exe" target="_blank" rel="external">http://vsphereclient.vmware.com/vsphereclient/3/0/2/4/3/4/5/VMware-viclient-all-5.5.0-3024345.exe</a></td>
</tr>
<tr>
<td>VMware vSphere Client 5.5 Update 3e</td>
<td>VMware-viclient-all-5.5.0-4032365.exe</td>
<td><a href="http://vsphereclient.vmware.com/vsphereclient/4/0/3/2/3/6/5/VMware-viclient-all-5.5.0-4032365.exe" target="_blank" rel="external">http://vsphereclient.vmware.com/vsphereclient/4/0/3/2/3/6/5/VMware-viclient-all-5.5.0-4032365.exe</a></td>
</tr>
<tr>
<td>VMware vSphere Client 5.1</td>
<td>VMware-viclient-all-5.1.0-786111.exe</td>
<td><a href="http://vsphereclient.vmware.com/vsphereclient/7/8/6/1/1/1/VMware-viclient-all-5.1.0-786111.exe" target="_blank" rel="external">http://vsphereclient.vmware.com/vsphereclient/7/8/6/1/1/1/VMware-viclient-all-5.1.0-786111.exe</a></td>
</tr>
<tr>
<td>VMware vSphere Client 5.1.0a</td>
<td>VMware-viclient-all-5.1.0-860230.exe</td>
<td><a href="http://vsphereclient.vmware.com/vsphereclient/8/6/0/2/3/0/VMware-viclient-all-5.1.0-860230.exe" target="_blank" rel="external">http://vsphereclient.vmware.com/vsphereclient/8/6/0/2/3/0/VMware-viclient-all-5.1.0-860230.exe</a></td>
</tr>
<tr>
<td>VMware vSphere Client 5.1.0b</td>
<td>VMware-viclient-all-5.1.0-941893.exe</td>
<td><a href="http://vsphereclient.vmware.com/vsphereclient/9/4/1/8/9/3/VMware-viclient-all-5.1.0-941893.exe" target="_blank" rel="external">http://vsphereclient.vmware.com/vsphereclient/9/4/1/8/9/3/VMware-viclient-all-5.1.0-941893.exe</a></td>
</tr>
<tr>
<td>VMware vSphere Client 5.1 Update 1</td>
<td>VMware-viclient-all-5.1.0-1064113.exe</td>
<td><a href="http://vsphereclient.vmware.com/vsphereclient/1/0/6/4/1/1/3/VMware-viclient-all-5.1.0-1064113.exe" target="_blank" rel="external">http://vsphereclient.vmware.com/vsphereclient/1/0/6/4/1/1/3/VMware-viclient-all-5.1.0-1064113.exe</a></td>
</tr>
<tr>
<td>VMware vSphere Client 5.1 Update 1b</td>
<td>VMware-viclient-all-5.1.0-1235233.exe</td>
<td><a href="http://vsphereclient.vmware.com/vsphereclient/1/2/3/5/2/3/3/VMware-viclient-all-5.1.0-1235233.exe" target="_blank" rel="external">http://vsphereclient.vmware.com/vsphereclient/1/2/3/5/2/3/3/VMware-viclient-all-5.1.0-1235233.exe</a></td>
</tr>
<tr>
<td>VMware vSphere Client 5.1 Update 1c</td>
<td>VMware-viclient-all-5.1.0-1364039.exe</td>
<td><a href="http://vsphereclient.vmware.com/vsphereclient/1/3/6/4/0/3/9/VMware-viclient-all-5.1.0-1364039.exe" target="_blank" rel="external">http://vsphereclient.vmware.com/vsphereclient/1/3/6/4/0/3/9/VMware-viclient-all-5.1.0-1364039.exe</a></td>
</tr>
<tr>
<td>VMware vSphere Client 5.1 Update 2</td>
<td>VMware-viclient-all-5.1.0-11471691.exe</td>
<td><a href="http://vsphereclient.vmware.com/vsphereclient/1/4/7/1/6/9/1/VMware-viclient-all-5.1.0-1471691.exe" target="_blank" rel="external">http://vsphereclient.vmware.com/vsphereclient/1/4/7/1/6/9/1/VMware-viclient-all-5.1.0-1471691.exe</a></td>
</tr>
<tr>
<td>VMware vSphere Client 5.1 Update 2a</td>
<td>VMware-viclient-all-5.1.0-1880906.exe</td>
<td><a href="http://vsphereclient.vmware.com/vsphereclient/1/8/8/0/9/0/6/VMware-viclient-all-5.1.0-1880906.exe" target="_blank" rel="external">http://vsphereclient.vmware.com/vsphereclient/1/8/8/0/9/0/6/VMware-viclient-all-5.1.0-1880906.exe</a></td>
</tr>
<tr>
<td>VMware vSphere Client 5.0</td>
<td>VMware-viclient-all-5.0.0-455964.exe</td>
<td><a href="http://vsphereclient.vmware.com/vsphereclient/4/5/5/9/6/4/VMware-viclient-all-5.0.0-455964.exe" target="_blank" rel="external">http://vsphereclient.vmware.com/vsphereclient/4/5/5/9/6/4/VMware-viclient-all-5.0.0-455964.exe</a></td>
</tr>
<tr>
<td>VMware vSphere Client 5.0 Update 1</td>
<td>VMware-viclient-all-5.0.0-623373.exe</td>
<td><a href="http://vsphereclient.vmware.com/vsphereclient/6/2/3/3/7/3/VMware-viclient-all-5.0.0-623373.exe" target="_blank" rel="external">http://vsphereclient.vmware.com/vsphereclient/6/2/3/3/7/3/VMware-viclient-all-5.0.0-623373.exe</a></td>
</tr>
<tr>
<td>VMware vSphere Client 5.0 Update 1a</td>
<td>VMware-viclient-all-5.0.0-755629.exe</td>
<td><a href="http://vsphereclient.vmware.com/vsphereclient/7/5/5/6/2/9/VMware-viclient-all-5.0.0-755629.exe" target="_blank" rel="external">http://vsphereclient.vmware.com/vsphereclient/7/5/5/6/2/9/VMware-viclient-all-5.0.0-755629.exe</a></td>
</tr>
<tr>
<td>VMware vSphere Client 5.0 Update 1b</td>
<td>VMware-viclient-all-5.0.0-804277.exe</td>
<td><a href="http://vsphereclient.vmware.com/vsphereclient/8/0/4/2/7/7/VMware-viclient-all-5.0.0-804277.exe" target="_blank" rel="external">http://vsphereclient.vmware.com/vsphereclient/8/0/4/2/7/7/VMware-viclient-all-5.0.0-804277.exe</a></td>
</tr>
<tr>
<td>VMware vSphere Client v5.0 Update 2</td>
<td>VMware-viclient-all-5.0.0-913577.exe</td>
<td><a href="http://vsphereclient.vmware.com/vsphereclient/9/1/3/5/7/7/VMware-viclient-all-5.0.0-913577.exe" target="_blank" rel="external">http://vsphereclient.vmware.com/vsphereclient/9/1/3/5/7/7/VMware-viclient-all-5.0.0-913577.exe</a></td>
</tr>
<tr>
<td>VMware vSphere Client v5.0 Update 3</td>
<td>VMware-viclient-all-5.0.0-1300600.exe</td>
<td><a href="http://vsphereclient.vmware.com/vsphereclient/1/3/0/0/6/0/0/VMware-viclient-all-5.0.0-1300600.exe" target="_blank" rel="external">http://vsphereclient.vmware.com/vsphereclient/1/3/0/0/6/0/0/VMware-viclient-all-5.0.0-1300600.exe</a></td>
</tr>
<tr>
<td>VMware vSphere Client v4.1</td>
<td>VMware-viclient-all-4.1.0-258902.exe</td>
<td><a href="http://vsphereclient.vmware.com/vsphereclient/2/5/8/9/0/2/VMware-viclient-all-4.1.0-258902.exe" target="_blank" rel="external">http://vsphereclient.vmware.com/vsphereclient/2/5/8/9/0/2/VMware-viclient-all-4.1.0-258902.exe</a></td>
</tr>
<tr>
<td>VMware vSphere Client v4.1 Update 1</td>
<td>VMware-viclient-all-4.1.0-345043.exe</td>
<td><a href="http://vsphereclient.vmware.com/vsphereclient/3/4/5/0/4/3/VMware-viclient-all-4.1.0-345043.exe" target="_blank" rel="external">http://vsphereclient.vmware.com/vsphereclient/3/4/5/0/4/3/VMware-viclient-all-4.1.0-345043.exe</a></td>
</tr>
<tr>
<td>VMware vSphere Client v4.1 Update 2</td>
<td>VMware-viclient-all-4.1.0-491557.exe</td>
<td><a href="http://vsphereclient.vmware.com/vsphereclient/4/9/1/5/5/7/VMware-viclient-all-4.1.0-491557.exe" target="_blank" rel="external">http://vsphereclient.vmware.com/vsphereclient/4/9/1/5/5/7/VMware-viclient-all-4.1.0-491557.exe</a></td>
</tr>
<tr>
<td>VMware vSphere Client v4.1 Update 3</td>
<td>VMware-viclient-all-4.1.0-799345.exe</td>
<td><a href="http://vsphereclient.vmware.com/vsphereclient/7/9/9/3/4/5/VMware-viclient-all-4.1.0-799345.exe" target="_blank" rel="external">http://vsphereclient.vmware.com/vsphereclient/7/9/9/3/4/5/VMware-viclient-all-4.1.0-799345.exe</a></td>
</tr>
</tbody>
</table>
<h2 id="百度网盘分流"><a href="#百度网盘分流" class="headerlink" title="百度网盘分流"></a>百度网盘分流</h2><p><a href="http://pan.baidu.com/s/1c1Fnxra" target="_blank" rel="external">http://pan.baidu.com/s/1c1Fnxra</a></p>
]]></content>
    
    <summary type="html">
    
      The vSphere Client is no longer available starting with vSphere 6.5.
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>使用Samba实现Linux与Windows文件共享实践</title>
    <link href="https://wsgzao.github.io/post/samba/"/>
    <id>https://wsgzao.github.io/post/samba/</id>
    <published>2017-05-16T06:31:57.000Z</published>
    <updated>2017-05-16T08:30:22.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://i.v2ex.co/Pbu91VnP.png" alt=""></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>一直以来都以为FTP和NFS是局域网文件共享的常用方式，但是在最近接触Samba之后，了解到一些用户需要简化访问学习成本，满足基础的权限控制管理，并支持实时编辑和保存文件，我才明白这些需求使用之前的方法都是很难满足的，而Samba却可以完美的支持上述需求，虽然在开始接触时花了一些时间学习，但把配置和语法梳理清楚之后就很简单了。</p>
<blockquote>
<p>Unix与Windows文件共享的最佳方式之一</p>
</blockquote>
<hr>
<h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2017年05月16日 - 完善内容<br>2015年07月28日 - 增加Samba日志审计部分<br>2015年07月11日 - 初稿</p>
<p>阅读原文 - <a href="https://wsgzao.github.io/post/samba/">https://wsgzao.github.io/post/samba/</a></p>
<p><strong>扩展阅读</strong></p>
<p>Samba - <a href="https://www.samba.org/samba/docs/man/Samba-HOWTO-Collection/" target="_blank" rel="external">https://www.samba.org/samba/docs/man/Samba-HOWTO-Collection/</a><br>使用Samba或NFS实现文件共享 - <a href="http://www.linuxprobe.com/chapter-12.html" target="_blank" rel="external">http://www.linuxprobe.com/chapter-12.html</a><br>SAMBA服务器 - <a href="http://vbird.dic.ksu.edu.tw/linux_server/0370samba.php" target="_blank" rel="external">http://vbird.dic.ksu.edu.tw/linux_server/0370samba.php</a><br>RHEL6.5下部署samba企业级文件服务器实战 - <a href="http://yuan2.blog.51cto.com/446689/1588085" target="_blank" rel="external">http://yuan2.blog.51cto.com/446689/1588085</a><br>Samba日志分析 - <a href="http://chenguang.blog.51cto.com/350944/1606746" target="_blank" rel="external">http://chenguang.blog.51cto.com/350944/1606746</a></p>
<hr>
<h2 id="安装samba"><a href="#安装samba" class="headerlink" title="安装samba"></a>安装samba</h2><blockquote>
<p>各个平台的安装都蛮简单的，略过</p>
</blockquote>
<h2 id="配置samba"><a href="#配置samba" class="headerlink" title="配置samba"></a>配置samba</h2><blockquote>
<p>建议合理规划目录和用户权限，可以利用用户组来简化授权管理，参见扩展阅读</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">#创建目录（举例）</span></div><div class="line">mkdir -p /data2/sm</div><div class="line">chmod -R 777 /data2/sm</div><div class="line"></div><div class="line"><span class="comment">#添加用户（举例）</span></div><div class="line">groupadd dengling</div><div class="line">useradd -g dengling -s /sbin/nologin dengling</div><div class="line"><span class="comment">#推荐使用pdbedit</span></div><div class="line">smbpasswd -a dengling</div><div class="line"></div><div class="line"><span class="comment">#备份smb配置文件并编辑</span></div><div class="line"><span class="built_in">cd</span> /etc/samba</div><div class="line">cp smb.conf smb.conf.bak</div><div class="line">vi smb.conf</div><div class="line"></div><div class="line"><span class="comment">#全局参数</span></div><div class="line">[global]</div><div class="line">security = share</div><div class="line"><span class="built_in">log</span> file = /var/<span class="built_in">log</span>/samba/<span class="built_in">log</span>.%m</div><div class="line">idmap config * : backend = tdb</div><div class="line">guest ok = Yes</div><div class="line">lanman auth = Yes</div><div class="line">client lanman auth = yes</div><div class="line">client plaintext auth = yes</div><div class="line">hosts allow = 127., 172., 192.168.1., 192.168.3.</div><div class="line">cups options = raw</div><div class="line">        vfs objects = full_audit</div><div class="line">        full_audit:failure = none</div><div class="line">        full_audit:success = rename unlink rmdir open opendir pwrite write</div><div class="line">        full_audit:prefix = %u|%I|%m|%</div><div class="line">admin <span class="built_in">log</span> = yes</div><div class="line"><span class="built_in">log</span> level = 2</div><div class="line">        syslog = 2</div><div class="line"></div><div class="line"><span class="comment">#共享参数</span></div><div class="line">[homes]</div><div class="line">    comment = Home Directories</div><div class="line">    <span class="built_in">read</span> only = No</div><div class="line">    browseable = No</div><div class="line"></div><div class="line">[sheji]</div><div class="line">    comment = sheji</div><div class="line">    path = /data2/sm/sheji</div><div class="line">    valid users = share, shenwei, xuwei, shenjiamei, humengchu, rensiqiang, yeting, tongying, jinbo, zengfanan, fengpeisi</div><div class="line">    <span class="built_in">read</span> only = No</div><div class="line">    create mask = 0775</div><div class="line">    directory mask = 0775</div><div class="line"></div><div class="line">[<span class="built_in">test</span>]</div><div class="line">    comment = sheji</div><div class="line">    path = /data2/sm/<span class="built_in">test</span></div><div class="line">    valid users = <span class="built_in">test</span>, test2, shenwei</div><div class="line">    <span class="built_in">read</span> only = No</div><div class="line">    create mask = 0775</div><div class="line">    directory mask = 0775</div><div class="line"></div><div class="line">[q2]</div><div class="line">    comment = sheji</div><div class="line">    path = /data2/sm/q2</div><div class="line">    valid users = xuejia, sungaoshuai, lujingjing, huangsonghe, yefei, lvwenhan, fangyuan, zhanghuichen, liuguofa, xupeiyu, yangpengfei, lisuitao, sunzhen, shenwei, xuwei, shenjiamei, humengchu, rensiqiang, yeting, tongying, jinbo, zengfanan, fengpeisi, chenye, wuailing, pengnan, liangzhixue, chenhong, daimengyou, wangxiaoshuo, zhoujian, fenglu, linlijun, chenshuxian, linzhimin, yanyoushan, xiaguoying, zhanghuanrong, mayushu, xuyangjing, guogaoyan, huangyouyang, jinzhibin, huyuqing, shenxuemei, liukui</div><div class="line">    <span class="built_in">read</span> only = No</div><div class="line">    create mask = 0775</div><div class="line">    directory mask = 0775</div><div class="line"></div><div class="line">[market]</div><div class="line">    comment = sheji</div><div class="line">    path = /data2/sm/market</div><div class="line">    valid users = zhanghuichen, shenwei, chenye, wuailing, pengnan, liangzhixue, chenhong, daimengyou, wangxiaoshuo, xuyangjing, chenshuxian, linzhimin, caoling, guogaoyan, xiehaibo, huangyouyang, jinzhibin, huyuqing</div><div class="line">    <span class="built_in">read</span> only = No</div><div class="line">    create mask = 0777</div><div class="line">    directory mask = 0775</div><div class="line"></div><div class="line">[market_finance]</div><div class="line">    comment = sheji</div><div class="line">    path = /data2/sm/market_finance</div><div class="line">    valid users = yangqiong, shenwei, chenye, wuailing, pengnan, liangzhixue, chenhong, daimengyou, wangxiaoshuo, xiehaibo, gaofangjie, xuyangjing, chenshuxian, linzhimin, huangyouyang, jinzhibin, huyuqing</div><div class="line">    <span class="built_in">read</span> only = No</div><div class="line">    create mask = 0777</div><div class="line">    directory mask = 0775</div><div class="line"></div><div class="line">[shenwei]</div><div class="line">    comment = sheji</div><div class="line">    path = /data2/sm/develop/shenwei</div><div class="line">    valid users = shenwei</div><div class="line">    <span class="built_in">read</span> only = No</div><div class="line">    create mask = 0777</div><div class="line">    directory mask = 0775</div><div class="line"></div><div class="line">[qijun]</div><div class="line">    comment = qj</div><div class="line">    path = /data2/sm/homedir/qijun</div><div class="line">    valid users = qijun</div><div class="line">    <span class="built_in">read</span> only = No</div><div class="line">    create mask = 0777</div><div class="line">    directory mask = 0775</div><div class="line">    guest ok = No</div><div class="line"></div><div class="line">[wenyong]</div><div class="line">    comment = sheji</div><div class="line">    path = /data2/sm/develop/wenyong</div><div class="line">    valid users = wenyong</div><div class="line">    <span class="built_in">read</span> only = No</div><div class="line">    create mask = 0777</div><div class="line">    directory mask = 0775</div><div class="line"></div><div class="line">[wudi]</div><div class="line">    comment = sheji</div><div class="line">    path = /data2/sm/develop/wudi</div><div class="line">    valid users = wudi</div><div class="line">    <span class="built_in">read</span> only = No</div><div class="line">    create mask = 0777</div><div class="line">    directory mask = 0775</div><div class="line"></div><div class="line">[caijiannan]</div><div class="line">    comment = sheji</div><div class="line">    path = /data2/sm/develop/caijiannan</div><div class="line">    valid users = caijiannan</div><div class="line">    <span class="built_in">read</span> only = No</div><div class="line">    create mask = 0777</div><div class="line">    directory mask = 0775</div><div class="line"></div><div class="line">[weiduani2]</div><div class="line">    comment = weiduan</div><div class="line">    path = /data2/sm/develop/raochao/微端</div><div class="line">    valid users = wangfeng</div><div class="line">    <span class="built_in">read</span> only = No</div><div class="line">    create mask = 0777</div><div class="line">    directory mask = 0775</div><div class="line"></div><div class="line">[raochao]</div><div class="line">    comment = raochao</div><div class="line">    path = /data2/sm/develop/raochao</div><div class="line">    <span class="built_in">read</span> list = wangfeng, xuwei, shenjiamei, chenxianzhe, chenye, wuailing, liuyuting, dainan</div><div class="line">    write list = raochao</div><div class="line"></div><div class="line">[product]</div><div class="line">    comment = product</div><div class="line">    path = /data2/sm/product</div><div class="line">    <span class="built_in">read</span> only = No</div><div class="line">    create mask = 0777</div><div class="line">    directory mask = 0777</div><div class="line"></div><div class="line">[jinbo]</div><div class="line">    comment = JinBo</div><div class="line">    path = /data2/sm/homedir/jinbo</div><div class="line">    valid users = jinbo</div><div class="line">    <span class="built_in">read</span> only = No</div><div class="line">    guest ok = No</div><div class="line"></div><div class="line">[xiaoqiang]</div><div class="line">    comment = xiaoqiang</div><div class="line">    path = /data2/sm/homedir/xiaoqiang</div><div class="line">    valid users = xiaoqiang</div><div class="line">    <span class="built_in">read</span> only = No</div><div class="line">    guest ok = No</div><div class="line"></div><div class="line">[share]</div><div class="line">    comment = share</div><div class="line">    path = /data2/sm/homedir/share</div><div class="line">    valid users = share, market, wal, qijun, zhanghua</div><div class="line">    <span class="built_in">read</span> only = No</div></pre></td></tr></table></figure>
<h2 id="启动samba"><a href="#启动samba" class="headerlink" title="启动samba"></a>启动samba</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">#常用选项</span></div><div class="line">[shared_name]</div><div class="line">    path =                              <span class="comment"># 文件系统路径</span></div><div class="line">    browseable = &#123;yes|no&#125;               <span class="comment"># 是否可以被查看到</span></div><div class="line">    public = &#123;yes|no&#125;                   <span class="comment"># 是否可被所有人读</span></div><div class="line">    guest ok = &#123;yes|no&#125;                 <span class="comment"># 与 public 相同</span></div><div class="line">    <span class="built_in">read</span> only = yes                     <span class="comment"># 是否只读</span></div><div class="line">    writeable = yes                     <span class="comment"># 是否可写</span></div><div class="line">    write list = user1, user2           <span class="comment"># 可写用户列表</span></div><div class="line">                @group, +group          <span class="comment"># 可写组列表</span></div><div class="line">    valid users =                       <span class="comment"># 白名单</span></div><div class="line">    invalid users =                     <span class="comment"># 黑名单</span></div><div class="line"></div><div class="line"><span class="comment">#检查语法</span></div><div class="line">testparm</div><div class="line"></div><div class="line"><span class="comment">#重启smb服务查看状态</span></div><div class="line">service smb restart</div><div class="line">smbstatus</div></pre></td></tr></table></figure>
<h2 id="Windows客户端访问"><a href="#Windows客户端访问" class="headerlink" title="Windows客户端访问"></a>Windows客户端访问</h2><p>1.Windows上访问samba</p>
<p>在“计算机”中输入：<code>\\xxx.xxx.xxx.xxx\</code></p>
<p>2.Windows断开samba共享连接，实在不行可以选择注销或者重启</p>
<p>在【开始】→【运行】→【CMD】回车中输入：<code>net use * /del /y</code></p>
<p>3.将samba共享的Linux目录映射成Windows的一个驱动器盘符</p>
<p>在【右键计算机】→【映射网络驱动器】→【文件夹\XX.XX.XX.XX\】</p>
]]></content>
    
    <summary type="html">
    
      Unix与Windows文件共享的最佳方式之一
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>Multipath 多路径配置实践心得</title>
    <link href="https://wsgzao.github.io/post/multipath/"/>
    <id>https://wsgzao.github.io/post/multipath/</id>
    <published>2017-05-04T06:59:49.000Z</published>
    <updated>2017-05-04T06:43:02.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>配置存储时一定会遇到 multipath 多路径的问题，不同的厂商比如 EMC PowerPath，Veritas VxDMP 等都有独立的多路径软件，而多路径软件的功能也很清晰主要用于IO流量负载均衡和故障切换恢复等。在 Linux 环境中 device-mapper-multipath 是一个免费的通用型多路径管理软件，其配置文件也非常简单，主要通过修改 /etc/multipath.conf 来调整。文章提供了《HPE 3PAR Red Hat Enterprise Linux和 Oracle Linux 实施指南》，也分享了自己配置 multipath 的实践过程，希望对大家有参考价值。</p>
<blockquote>
<p>记录 3PAR8400 存储 Multipath 多路径配置</p>
</blockquote>
<h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2017年05月04日 - 初稿</p>
<p>阅读原文 - <a href="https://wsgzao.github.io/post/multipath/">https://wsgzao.github.io/post/multipath/</a></p>
<p><strong>扩展阅读</strong></p>
<p>multipath - <a href="https://access.redhat.com/labsinfo/multipathhelper" target="_blank" rel="external">https://access.redhat.com/labsinfo/multipathhelper</a><br>[原]红旗上使用multipath复合多条路径 - <a href="http://www.linuxfly.org/post/513/" target="_blank" rel="external">http://www.linuxfly.org/post/513/</a></p>
<hr>
<h2 id="官方最佳实践手册"><a href="#官方最佳实践手册" class="headerlink" title="官方最佳实践手册"></a>官方最佳实践手册</h2><blockquote>
<p>HPE 3PAR Red Hat Enterprise Linux和 Oracle Linux 实施指南</p>
</blockquote>
<p><iframe src="https://www.slideshare.net/slideshow/embed_code/key/MKQJhstxnv4JFy" width="479" height="511" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> <div style="margin-bottom:5px"> </div></p>
<h2 id="什么是multipath"><a href="#什么是multipath" class="headerlink" title="什么是multipath"></a>什么是multipath</h2><p>普通的电脑主机都是一个硬盘挂接到一个总线上，这里是一对一的关系。而到了有光纤组成的SAN环境，由于主机和存储通过了光纤交换机连接，这样的话，就构成了多对多的关系。也就是说，主机到存储可以有多条路径可以选择。主机到存储之间的IO由多条路径可以选择。</p>
<p>既然，每个主机到所对应的存储可以经过几条不同的路径，如果是同时使用的话，I/O流量如何分配？其中一条路径坏掉了，如何处理？还有在操作系统的角度来看，每条路径，操作系统会认为是一个实际存在的物理盘，但实际上只是通向同一个物理盘的不同路径而已，这样是在使用的时候，就给用户带来了困惑。多路径软件就是为了解决上面的问题应运而生的，多路径的主要功能就是和存储设备一起配合实现如下功能：</p>
<ol>
<li>故障的切换和恢复</li>
<li>IO流量的负载均衡</li>
<li>磁盘的虚拟化</li>
</ol>
<h2 id="为什么使用multipath"><a href="#为什么使用multipath" class="headerlink" title="为什么使用multipath"></a>为什么使用multipath</h2><p>由于多路径软件是需要和存储在一起配合使用的，不同的厂商基于不同的操作系统，都提供了不同的版本。并且有的厂商，软件和硬件也不是一起卖的，如果要使用多路径软件的话，可能还需要向厂商购买license才行。比如EMC公司基于Linux下的多路径软件，就需要单独的购买license。其中，EMC提供的就是PowerPath，HDS提供的就是HDLM，Veritas提供的就是VxDMP。当然，使用系统自带的免费多路径软件包，同时也是一个比较通用的包，可以支持大多数存储厂商的设备，即使是一些不是出名的厂商，通过对配置文件进行稍作修改，也是可以支持并运行的很好。</p>
<p>比较重要的一点还是听从原厂工程师的建议根据实际的业务和存储策略使用合适的多路径软件。</p>
<h2 id="配置multipath"><a href="#配置multipath" class="headerlink" title="配置multipath"></a>配置multipath</h2><blockquote>
<p>原理看了一堆，实际配置还是比较简单的，配置文件只有一个：/etc/multipath.conf</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#查看主机或者存储交换机上的WWN号，在存储上将LUN映射给需要的主机</span></div><div class="line">cat /sys/class/fc_host/host*/port_name</div><div class="line">0x2002d0431efb7f5d</div><div class="line">0x2001d0431efb7f5d</div><div class="line"></div><div class="line"><span class="comment">#在系统内执行扫盘命令，没有命令先安装sg3_utils</span></div><div class="line">yum install sg3_utils</div><div class="line">rescan-scsi-bus.sh</div><div class="line"></div><div class="line"><span class="comment">#查看是否映射到对应的</span></div><div class="line">fdisk -l</div><div class="line">lsblk</div><div class="line"></div><div class="line"><span class="comment">#查看是否安装了multipath</span></div><div class="line">yum install device-mapper-multipath</div><div class="line"></div><div class="line">rpm -qa | grep device-mapper</div><div class="line">device-mapper-libs-1.02.107-5.el7_2.2.x86_64</div><div class="line">device-mapper-persistent-data-0.5.5-1.el7.x86_64</div><div class="line">device-mapper-multipath-0.4.9-85.el7_2.4.x86_64</div><div class="line">device-mapper-1.02.107-5.el7_2.2.x86_64</div><div class="line">device-mapper-event-libs-1.02.107-5.el7_2.2.x86_64</div><div class="line">device-mapper-event-1.02.107-5.el7_2.2.x86_64</div><div class="line">device-mapper-multipath-libs-0.4.9-85.el7_2.4.x86_64</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#拷贝默认的multipath.conf到/etc目录下，也可以使用mpathconf命令创建默认模板</span></div><div class="line">cp /usr/share/doc/device-mapper-multipath-0.4.9/multipath.conf /etc/multipath.conf</div><div class="line">mpathconf --<span class="built_in">enable</span> --with_multipathd y</div><div class="line"></div><div class="line"><span class="comment">#查看本地存储wwid</span></div><div class="line">/lib/udev/scsi_id --whitelisted --device=/dev/sda</div><div class="line">36141877030bcca001d9c4d52106b9d90</div><div class="line"></div><div class="line"><span class="comment">#查看存储参数</span></div><div class="line">cat /sys/block/sdb/device/vendor </div><div class="line">3PARdata</div><div class="line">cat /sys/block/sdb/device/model</div><div class="line">VV</div><div class="line"></div><div class="line"><span class="comment">#添加本地盘到blacklist内,不同的存储和系统参考官方的最佳实践</span></div><div class="line">vim /etc/multipath.conf</div><div class="line"></div><div class="line">defaults &#123;</div><div class="line">polling_interval 10</div><div class="line">user_friendly_names no</div><div class="line">find_multipaths yes</div><div class="line">&#125;</div><div class="line">blacklist &#123;</div><div class="line">wwid <span class="string">"&lt;wwid_of_the_local_disk&gt;"</span></div><div class="line">&#125;</div><div class="line">devices &#123;</div><div class="line">device &#123;</div><div class="line">vendor <span class="string">"3PARdata"</span></div><div class="line">product <span class="string">"VV"</span></div><div class="line">path_grouping_policy group_by_prio</div><div class="line">path_selector <span class="string">"round-robin 0"</span></div><div class="line">path_checker tur</div><div class="line">features <span class="string">"0"</span></div><div class="line">hardware_handler <span class="string">"1 alua"</span></div><div class="line">prio alua</div><div class="line">failback immediate</div><div class="line">rr_weight uniform</div><div class="line">no_path_retry 18</div><div class="line">rr_min_io_rq 1</div><div class="line">detect_prio yes</div><div class="line"><span class="comment"># fast_io_fail_tmo 10</span></div><div class="line"><span class="comment"># dev_loss_tmo 14</span></div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">#固定设备的别名</span></div><div class="line">cat /etc/multipath/bindings </div><div class="line"><span class="comment"># Multipath bindings, Version : 1.0</span></div><div class="line"><span class="comment"># <span class="doctag">NOTE:</span> this file is automatically maintained by the multipath program.</span></div><div class="line"><span class="comment"># You should not need to edit this file in normal circumstances.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Format:</span></div><div class="line"><span class="comment"># alias wwid</span></div><div class="line"><span class="comment">#</span></div><div class="line">mpatha 360002ac000000000000000260001a945</div><div class="line">mpathb 360002ac000000000000000270001a945</div><div class="line">mpathc 360002ac000000000000000280001a945</div><div class="line">mpathd 360002ac000000000000000290001a945</div><div class="line">mpathe 360002ac0000000000000002a0001a945</div><div class="line"></div><div class="line"><span class="comment">#编辑multipath.conf，增加以下字段</span></div><div class="line">vim /etc/multipath.conf</div><div class="line"></div><div class="line">multipaths &#123;</div><div class="line">  multipath &#123;</div><div class="line">  wwid 360002ac000000000000000260001a945</div><div class="line">  <span class="built_in">alias</span> 3PAR8400_DEV_LUN26</div><div class="line">  &#125;</div><div class="line">  multipath &#123;</div><div class="line">  wwid 360002ac000000000000000270001a945</div><div class="line">  <span class="built_in">alias</span> 3PAR8400_DEV_LUN27</div><div class="line">  &#125;</div><div class="line">  multipath &#123;</div><div class="line">  wwid 360002ac000000000000000280001a945</div><div class="line">  <span class="built_in">alias</span> 3PAR8400_DEV_LUN28</div><div class="line">  &#125;</div><div class="line">  multipath &#123;</div><div class="line">  wwid 360002ac000000000000000290001a945</div><div class="line">  <span class="built_in">alias</span> 3PAR8400_DEV_LUN29</div><div class="line">  &#125;</div><div class="line">  multipath &#123;</div><div class="line">  wwid 360002ac0000000000000002a0001a945</div><div class="line">  <span class="built_in">alias</span> 3PAR8400_DEV_LUN30</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">#清空已有的multipath记录</span></div><div class="line">multipath -F</div><div class="line"><span class="comment">#打印诊断信息</span></div><div class="line">multipath -v3</div><div class="line"><span class="comment">#启用多路径守护程序以在引导时启动</span></div><div class="line">mpathconf --<span class="built_in">enable</span></div><div class="line"><span class="comment">#启动多路径服务</span></div><div class="line">service multipathd start</div><div class="line"><span class="comment">#如果在启动 multipath 守护程序后更改多路径配置文件，请运行以下命令以使更改生效。</span></div><div class="line">service multipathd reload </div><div class="line"><span class="comment">#重启系统测试</span></div><div class="line">init 6</div><div class="line"><span class="comment">#查看多路径当前状态</span></div><div class="line">multipath -ll</div><div class="line"></div><div class="line"><span class="comment">#Enable extended logging on the qla2xxx driver</span></div><div class="line">chmod u+x /sys/module/qla2xxx/parameters/ql2xextended_error_logging</div><div class="line"><span class="built_in">echo</span> <span class="string">"1"</span> &gt; /sys/module/qla2xxx/parameters/ql2xextended_error_logging</div><div class="line">cat /sys/module/qla2xxx/parameters/ql2xextended_error_logging</div><div class="line"></div><div class="line"><span class="comment">#重启lvm服务是识别共享存储vg信息</span></div><div class="line">systemctl restart lvm2-lvmetad.service</div><div class="line">pvs</div><div class="line"></div><div class="line"><span class="comment">#屏蔽WARNING: duplicate提示信息</span></div><div class="line">vim /etc/lvm/lvm.conf</div><div class="line"></div><div class="line">	<span class="comment"># Configuration option devices/filter.</span></div><div class="line">	<span class="comment"># Limit the block devices that are used by LVM commands.</span></div><div class="line">	<span class="comment"># This is a list of regular expressions used to accept or reject block</span></div><div class="line">	<span class="comment"># device path names. Each regex is delimited by a vertical bar '|'</span></div><div class="line">	<span class="comment"># (or any character) and is preceded by 'a' to accept the path, or</span></div><div class="line">	<span class="comment"># by 'r' to reject the path. The first regex in the list to match the</span></div><div class="line">	<span class="comment"># path is used, producing the 'a' or 'r' result for the device.</span></div><div class="line">	<span class="comment"># When multiple path names exist for a block device, if any path name</span></div><div class="line">	<span class="comment"># matches an 'a' pattern before an 'r' pattern, then the device is</span></div><div class="line">	<span class="comment"># accepted. If all the path names match an 'r' pattern first, then the</span></div><div class="line">	<span class="comment"># device is rejected. Unmatching path names do not affect the accept</span></div><div class="line">	<span class="comment"># or reject decision. If no path names for a device match a pattern,</span></div><div class="line">	<span class="comment"># then the device is accepted. Be careful mixing 'a' and 'r' patterns,</span></div><div class="line">	<span class="comment"># as the combination might produce unexpected results (test changes.)</span></div><div class="line">	<span class="comment"># Run vgscan after changing the filter to regenerate the cache.</span></div><div class="line">	<span class="comment"># See the use_lvmetad comment for a special case regarding filters.</span></div><div class="line">	<span class="comment"># </span></div><div class="line">	<span class="comment"># Example</span></div><div class="line">	<span class="comment"># Accept every block device:</span></div><div class="line">	<span class="comment"># filter = [ "a|.*/|" ]</span></div><div class="line">	<span class="comment"># Reject the cdrom drive:</span></div><div class="line">	<span class="comment"># filter = [ "r|/dev/cdrom|" ]</span></div><div class="line">	<span class="comment"># Work with just loopback devices, e.g. for testing:</span></div><div class="line">	<span class="comment"># filter = [ "a|loop|", "r|.*|" ]</span></div><div class="line">	<span class="comment"># Accept all loop devices and ide drives except hdc:</span></div><div class="line">	<span class="comment"># filter = [ "a|loop|", "r|/dev/hdc|", "a|/dev/ide|", "r|.*|" ]</span></div><div class="line">	<span class="comment"># Use anchors to be very specific:</span></div><div class="line">	<span class="comment"># filter = [ "a|^/dev/hda8$|", "r|.*/|" ]</span></div><div class="line">	<span class="comment"># </span></div><div class="line">	<span class="comment"># This configuration option has an automatic default value.</span></div><div class="line">	<span class="comment"># filter = [ "a|.*/|" ]</span></div><div class="line">	filter = [<span class="string">"a/sda/"</span>,<span class="string">"a/mapper/3PAR8400_DEV_LUN26p1/"</span>,<span class="string">"r/.*/"</span>]</div><div class="line"><span class="comment">#filter = ["a/sda/","r/.*/"]</span></div><div class="line"></div><div class="line">	<span class="comment"># Configuration option devices/global_filter.</span></div><div class="line">	<span class="comment"># Limit the block devices that are used by LVM system components.</span></div><div class="line">	<span class="comment"># Because devices/filter may be overridden from the command line, it is</span></div><div class="line">	<span class="comment"># not suitable for system-wide device filtering, e.g. udev and lvmetad.</span></div><div class="line">	<span class="comment"># Use global_filter to hide devices from these LVM system components.</span></div><div class="line">	<span class="comment"># The syntax is the same as devices/filter. Devices rejected by</span></div><div class="line">	<span class="comment"># global_filter are not opened by LVM.</span></div><div class="line">	<span class="comment"># This configuration option has an automatic default value.</span></div><div class="line">	<span class="comment"># global_filter = [ "a|.*/|" ]</span></div><div class="line">	global_filter = [<span class="string">"a/sda/"</span>,<span class="string">"a/mapper/3PAR8400_DEV_LUN26p1/"</span>,<span class="string">"r/.*/"</span>]</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#一个简单的multipath.conf配置文件</span></div><div class="line">[root@controller01 ~]<span class="comment"># cat /etc/multipath.conf</span></div><div class="line"><span class="comment"># This is a basic configuration file with some examples, for device mapper</span></div><div class="line"><span class="comment"># multipath.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># For a complete list of the default configuration values, run either</span></div><div class="line"><span class="comment"># multipath -t</span></div><div class="line"><span class="comment"># or</span></div><div class="line"><span class="comment"># multipathd show config</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># For a list of configuration options with descriptions, see the multipath.conf</span></div><div class="line"><span class="comment"># man page</span></div><div class="line"></div><div class="line"><span class="comment">## By default, devices with vendor = "IBM" and product = "S/390.*" are</span></div><div class="line"><span class="comment">## blacklisted. To enable mulitpathing on these devies, uncomment the</span></div><div class="line"><span class="comment">## following lines.</span></div><div class="line"><span class="comment">#blacklist_exceptions &#123;</span></div><div class="line"><span class="comment">#	device &#123;</span></div><div class="line"><span class="comment">#		vendor	"IBM"</span></div><div class="line"><span class="comment">#		product	"S/390.*"</span></div><div class="line"><span class="comment">#	&#125;</span></div><div class="line"><span class="comment">#&#125;</span></div><div class="line"></div><div class="line"><span class="comment">## Use user friendly names, instead of using WWIDs as names.</span></div><div class="line">defaults &#123;</div><div class="line">	user_friendly_names yes</div><div class="line">	find_multipaths yes</div><div class="line">&#125;</div><div class="line"><span class="comment">##</span></div><div class="line"><span class="comment">## Here is an example of how to configure some standard options.</span></div><div class="line"><span class="comment">##</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#defaults &#123;</span></div><div class="line"><span class="comment">#	polling_interval 	10</span></div><div class="line"><span class="comment">#	path_selector		"round-robin 0"</span></div><div class="line"><span class="comment">#	path_grouping_policy	multibus</span></div><div class="line"><span class="comment">#	uid_attribute		ID_SERIAL</span></div><div class="line"><span class="comment">#	prio			alua</span></div><div class="line"><span class="comment">#	path_checker		readsector0</span></div><div class="line"><span class="comment">#	rr_min_io		100</span></div><div class="line"><span class="comment">#	max_fds			8192</span></div><div class="line"><span class="comment">#	rr_weight		priorities</span></div><div class="line"><span class="comment">#	failback		immediate</span></div><div class="line"><span class="comment">#	no_path_retry		fail</span></div><div class="line"><span class="comment">#	user_friendly_names	yes</span></div><div class="line"><span class="comment">#&#125;</span></div><div class="line"><span class="comment">##</span></div><div class="line"><span class="comment">## The wwid line in the following blacklist section is shown as an example</span></div><div class="line"><span class="comment">## of how to blacklist devices by wwid.  The 2 devnode lines are the</span></div><div class="line"><span class="comment">## compiled in default blacklist. If you want to blacklist entire types</span></div><div class="line"><span class="comment">## of devices, such as all scsi devices, you should use a devnode line.</span></div><div class="line"><span class="comment">## However, if you want to blacklist specific devices, you should use</span></div><div class="line"><span class="comment">## a wwid line.  Since there is no guarantee that a specific device will</span></div><div class="line"><span class="comment">## not change names on reboot (from /dev/sda to /dev/sdb for example)</span></div><div class="line"><span class="comment">## devnode lines are not recommended for blacklisting specific devices.</span></div><div class="line"><span class="comment">##</span></div><div class="line"><span class="comment">#blacklist &#123;</span></div><div class="line"><span class="comment">#       wwid 26353900f02796769</span></div><div class="line"><span class="comment">#	devnode "^(ram|raw|loop|fd|md|dm-|sr|scd|st)[0-9]*"</span></div><div class="line"><span class="comment">#	devnode "^hd[a-z]"</span></div><div class="line"><span class="comment">#&#125;</span></div><div class="line"><span class="comment">#multipaths &#123;</span></div><div class="line"><span class="comment">#	multipath &#123;</span></div><div class="line"><span class="comment">#		wwid			3600508b4000156d700012000000b0000</span></div><div class="line"><span class="comment">#		alias			yellow</span></div><div class="line"><span class="comment">#		path_grouping_policy	multibus</span></div><div class="line"><span class="comment">#		path_selector		"round-robin 0"</span></div><div class="line"><span class="comment">#		failback		manual</span></div><div class="line"><span class="comment">#		rr_weight		priorities</span></div><div class="line"><span class="comment">#		no_path_retry		5</span></div><div class="line"><span class="comment">#	&#125;</span></div><div class="line"><span class="comment">#	multipath &#123;</span></div><div class="line"><span class="comment">#		wwid			1DEC_____321816758474</span></div><div class="line"><span class="comment">#		alias			red</span></div><div class="line"><span class="comment">#	&#125;</span></div><div class="line"><span class="comment">#&#125;</span></div><div class="line"><span class="comment">#devices &#123;</span></div><div class="line"><span class="comment">#	device &#123;</span></div><div class="line"><span class="comment">#		vendor			"COMPAQ  "</span></div><div class="line"><span class="comment">#		product			"HSV110 (C)COMPAQ"</span></div><div class="line"><span class="comment">#		path_grouping_policy	multibus</span></div><div class="line"><span class="comment">#		path_checker		readsector0</span></div><div class="line"><span class="comment">#		path_selector		"round-robin 0"</span></div><div class="line"><span class="comment">#		hardware_handler	"0"</span></div><div class="line"><span class="comment">#		failback		15</span></div><div class="line"><span class="comment">#		rr_weight		priorities</span></div><div class="line"><span class="comment">#		no_path_retry		queue</span></div><div class="line"><span class="comment">#	&#125;</span></div><div class="line"><span class="comment">#	device &#123;</span></div><div class="line"><span class="comment">#		vendor			"COMPAQ  "</span></div><div class="line"><span class="comment">#		product			"MSA1000         "</span></div><div class="line"><span class="comment">#		path_grouping_policy	multibus</span></div><div class="line"><span class="comment">#	&#125;</span></div><div class="line"><span class="comment">#&#125;</span></div><div class="line">multipaths &#123;</div><div class="line">  multipath &#123;</div><div class="line">  wwid 360002ac000000000000000260001a945</div><div class="line">  <span class="built_in">alias</span> 3PAR8400_DEV_LUN26</div><div class="line">  &#125;</div><div class="line">  multipath &#123;</div><div class="line">  wwid 360002ac000000000000000270001a945</div><div class="line">  <span class="built_in">alias</span> 3PAR8400_DEV_LUN27</div><div class="line">  &#125;</div><div class="line">  multipath &#123;</div><div class="line">  wwid 360002ac000000000000000280001a945</div><div class="line">  <span class="built_in">alias</span> 3PAR8400_DEV_LUN28</div><div class="line">  &#125;</div><div class="line">  multipath &#123;</div><div class="line">  wwid 360002ac000000000000000290001a945</div><div class="line">  <span class="built_in">alias</span> 3PAR8400_DEV_LUN29</div><div class="line">  &#125;</div><div class="line">  multipath &#123;</div><div class="line">  wwid 360002ac0000000000000002a0001a945</div><div class="line">  <span class="built_in">alias</span> 3PAR8400_DEV_LUN30</div><div class="line">  &#125;</div><div class="line">  multipath &#123;</div><div class="line">  wwid 360002ac0000000000000002b0001a945</div><div class="line">  <span class="built_in">alias</span> 3PAR8400_DEV_LUN31</div><div class="line">  &#125;</div><div class="line">  multipath &#123;</div><div class="line">  wwid 360002ac0000000000000002c0001a945</div><div class="line">  <span class="built_in">alias</span> 3PAR8400_DEV_LUN32</div><div class="line">  &#125;</div><div class="line">  multipath &#123;</div><div class="line">  wwid 360002ac0000000000000002d0001a945</div><div class="line">  <span class="built_in">alias</span> 3PAR8400_DEV_LUN33</div><div class="line">  &#125;</div><div class="line">  multipath &#123;</div><div class="line">  wwid 360002ac0000000000000002e0001a945</div><div class="line">  <span class="built_in">alias</span> 3PAR8400_DEV_LUN34</div><div class="line">  &#125;</div><div class="line">  multipath &#123;</div><div class="line">  wwid 360002ac0000000000000002f0001a945</div><div class="line">  <span class="built_in">alias</span> 3PAR8400_DEV_LUN35</div><div class="line">  &#125;</div><div class="line">  multipath &#123;</div><div class="line">  wwid 360002ac000000000000000320001a945</div><div class="line">  <span class="built_in">alias</span> 3PAR8400_DEV_LUN36</div><div class="line">  &#125;</div><div class="line">  multipath &#123;</div><div class="line">  wwid 360002ac000000000000000330001a945</div><div class="line">  <span class="built_in">alias</span> 3PAR8400_DEV_LUN37</div><div class="line">  &#125;</div><div class="line">  multipath &#123;</div><div class="line">  wwid 360002ac000000000000000340001a945</div><div class="line">  <span class="built_in">alias</span> 3PAR8400_DEV_LUN38</div><div class="line">  &#125;</div><div class="line">  multipath &#123;</div><div class="line">  wwid 360002ac000000000000000350001a945</div><div class="line">  <span class="built_in">alias</span> 3PAR8400_DEV_LUN39</div><div class="line">  &#125;</div><div class="line">  multipath &#123;</div><div class="line">  wwid 360002ac000000000000000360001a945</div><div class="line">  <span class="built_in">alias</span> 3PAR8400_DEV_LUN40</div><div class="line">  &#125;</div><div class="line">  multipath &#123;</div><div class="line">  wwid 360002ac000000000000000370001a945</div><div class="line">  <span class="built_in">alias</span> 3PAR8400_DEV_LUN41</div><div class="line">  &#125;</div><div class="line">  multipath &#123;</div><div class="line">  wwid 360002ac000000000000000380001a945</div><div class="line">  <span class="built_in">alias</span> 3PAR8400_DEV_LUN42</div><div class="line">  &#125;</div><div class="line">  multipath &#123;</div><div class="line">  wwid 360002ac000000000000000390001a945</div><div class="line">  <span class="built_in">alias</span> 3PAR8400_DEV_LUN43</div><div class="line">  &#125;</div><div class="line">  multipath &#123;</div><div class="line">  wwid 360002ac0000000000000003a0001a945</div><div class="line">  <span class="built_in">alias</span> 3PAR8400_DEV_LUN44</div><div class="line">  &#125;</div><div class="line">  multipath &#123;</div><div class="line">  wwid 360002ac0000000000000003b0001a945</div><div class="line">  <span class="built_in">alias</span> 3PAR8400_DEV_LUN45</div><div class="line">  &#125;</div><div class="line">  multipath &#123;</div><div class="line">  wwid 360002ac0000000000000003d0001a945</div><div class="line">  <span class="built_in">alias</span> 3PAR8400_DEV_LUN46</div><div class="line">  &#125;</div><div class="line">  multipath &#123;</div><div class="line">  wwid 360002ac0000000000000003e0001a945</div><div class="line">  <span class="built_in">alias</span> 3PAR8400_DEV_LUN47</div><div class="line">  &#125;</div><div class="line">  multipath &#123;</div><div class="line">  wwid 360002ac0000000000000003f0001a945</div><div class="line">  <span class="built_in">alias</span> 3PAR8400_DEV_LUN48</div><div class="line">  &#125;</div><div class="line">  multipath &#123;</div><div class="line">  wwid 360002ac000000000000000400001a945</div><div class="line">  <span class="built_in">alias</span> 3PAR8400_DEV_LUN49</div><div class="line">  &#125;</div><div class="line">  multipath &#123;</div><div class="line">  wwid 360002ac000000000000000410001a945</div><div class="line">  <span class="built_in">alias</span> 3PAR8400_DEV_LUN50</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      记录 3PAR8400 存储 Multipath 多路径配置
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>Veritas NetBackup 学习笔记</title>
    <link href="https://wsgzao.github.io/post/nbu/"/>
    <id>https://wsgzao.github.io/post/nbu/</id>
    <published>2017-04-28T07:22:32.000Z</published>
    <updated>2017-06-22T00:21:38.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Veritas NetBackup 简称 NBU 是一款商业化的备份和恢复软件，在金融行业占据了90%以上的市场份额，除了软件产品以外也开始推自家的备份一体机。关于产品方面的介绍交给NBU的售前就行了，行业内负责备份恢复的朋友基本也都清楚我就不再赘述了。文章重点记录了学NBU时的原理和三层架构，比较核心的内容当然是Policy部分，此外还增加了简单的动手实践环节方便大家在自己的虚拟机中练习和理解。</p>
<blockquote>
<p>记录 Veritas NetBackup 学习心得</p>
</blockquote>
<hr>
<h2 id="更新记录"><a href="#更新记录" class="headerlink" title="更新记录"></a>更新记录</h2><p>2017年04月28日 - 初稿</p>
<p>阅读原文 - <a href="https://wsgzao.github.io/post/nbu/">https://wsgzao.github.io/post/nbu/</a></p>
<p>扩展阅读</p>
<ul>
<li>Veritas - <a href="https://www.veritas.com/zh/cn/product/backup-and-recovery/" target="_blank" rel="external">https://www.veritas.com/zh/cn/product/backup-and-recovery/</a></li>
</ul>
<hr>
<h2 id="NetBackup-Downloads"><a href="#NetBackup-Downloads" class="headerlink" title="NetBackup Downloads"></a>NetBackup Downloads</h2><blockquote>
<p>最新版为 NBU 8.0，生产环境推荐使用 NBU 7.7.3</p>
</blockquote>
<p>Article URL:<a href="http://www.veritas.com/docs/000036173" target="_blank" rel="external">http://www.veritas.com/docs/000036173</a></p>
<p>NetBackup 8.0</p>
<p>To obtain NetBackup 8.0 installation media:<br> <a href="http://www.veritas.com/docs/000115679" target="_blank" rel="external">http://www.veritas.com/docs/000115679</a></p>
<p>NetBackup 7.7.3</p>
<p>To obtain NetBackup 7.7.3 installation media:<br> <a href="http://www.veritas.com/docs/000108154" target="_blank" rel="external">http://www.veritas.com/docs/000108154</a></p>
<blockquote>
<p>以下为实验环境使用测试License，切勿用于生产，申请请通过官方渠道</p>
</blockquote>
<h2 id="NBU部署"><a href="#NBU部署" class="headerlink" title="NBU部署"></a>NBU部署</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div><div class="line">433</div><div class="line">434</div><div class="line">435</div><div class="line">436</div><div class="line">437</div><div class="line">438</div><div class="line">439</div><div class="line">440</div><div class="line">441</div><div class="line">442</div><div class="line">443</div><div class="line">444</div><div class="line">445</div><div class="line">446</div><div class="line">447</div><div class="line">448</div><div class="line">449</div><div class="line">450</div><div class="line">451</div><div class="line">452</div><div class="line">453</div><div class="line">454</div><div class="line">455</div><div class="line">456</div><div class="line">457</div><div class="line">458</div><div class="line">459</div><div class="line">460</div><div class="line">461</div><div class="line">462</div><div class="line">463</div><div class="line">464</div><div class="line">465</div><div class="line">466</div><div class="line">467</div><div class="line">468</div><div class="line">469</div><div class="line">470</div><div class="line">471</div><div class="line">472</div><div class="line">473</div><div class="line">474</div><div class="line">475</div><div class="line">476</div><div class="line">477</div><div class="line">478</div><div class="line">479</div><div class="line">480</div><div class="line">481</div><div class="line">482</div><div class="line">483</div><div class="line">484</div><div class="line">485</div><div class="line">486</div><div class="line">487</div><div class="line">488</div><div class="line">489</div><div class="line">490</div><div class="line">491</div><div class="line">492</div><div class="line">493</div><div class="line">494</div><div class="line">495</div><div class="line">496</div><div class="line">497</div><div class="line">498</div><div class="line">499</div><div class="line">500</div><div class="line">501</div><div class="line">502</div><div class="line">503</div><div class="line">504</div><div class="line">505</div><div class="line">506</div><div class="line">507</div><div class="line">508</div><div class="line">509</div><div class="line">510</div><div class="line">511</div><div class="line">512</div><div class="line">513</div><div class="line">514</div><div class="line">515</div><div class="line">516</div><div class="line">517</div><div class="line">518</div><div class="line">519</div><div class="line">520</div><div class="line">521</div><div class="line">522</div><div class="line">523</div><div class="line">524</div><div class="line">525</div><div class="line">526</div><div class="line">527</div><div class="line">528</div><div class="line">529</div><div class="line">530</div><div class="line">531</div><div class="line">532</div><div class="line">533</div><div class="line">534</div><div class="line">535</div><div class="line">536</div><div class="line">537</div><div class="line">538</div><div class="line">539</div><div class="line">540</div><div class="line">541</div><div class="line">542</div><div class="line">543</div><div class="line">544</div><div class="line">545</div><div class="line">546</div><div class="line">547</div><div class="line">548</div><div class="line">549</div><div class="line">550</div><div class="line">551</div><div class="line">552</div><div class="line">553</div><div class="line">554</div><div class="line">555</div><div class="line">556</div><div class="line">557</div><div class="line">558</div></pre></td><td class="code"><pre><div class="line">[root@rhel6-01 ~]<span class="comment"># tar xf NetBackup_7.7.3_LinuxR_x86_64.tar.gz</span></div><div class="line">[root@rhel6-01 ~]<span class="comment"># ls</span></div><div class="line">anaconda-ks.cfg  Documents  install.log         Music                          NetBackup_7.7.3_LinuxR_x86_64.tar.gz  Public     Videos</div><div class="line">Desktop          Downloads  install.log.syslog  NetBackup_7.7.3_LinuxR_x86_64  Pictures                              Templates</div><div class="line">[root@rhel6-01 ~]<span class="comment"># cd NetBackup_7.7.3_LinuxR_x86_64</span></div><div class="line">[root@rhel6-01 NetBackup_7.7.3_LinuxR_x86_64]<span class="comment"># ls</span></div><div class="line">Doc  install  LICENSE  linuxR_x86</div><div class="line">[root@rhel6-01 NetBackup_7.7.3_LinuxR_x86_64]<span class="comment"># ./install</span></div><div class="line"></div><div class="line"></div><div class="line">Symantec Installation Script</div><div class="line">Copyright 1993 - 2016 Symantec Corporation, All Rights Reserved.</div><div class="line"></div><div class="line"></div><div class="line">	Installing NetBackup Server Software</div><div class="line"></div><div class="line"></div><div class="line">Please review the SYMANTEC SOFTWARE LICENSE AGREEMENT located on</div><div class="line">the installation media before proceeding.  The agreement includes</div><div class="line">details on the NetBackup Product Improvement Program.</div><div class="line"></div><div class="line">For NetBackup installation and upgrade information specific to your</div><div class="line">platform and to find out <span class="keyword">if</span> your installed EEBs or hot fixes are</div><div class="line">contained <span class="keyword">in</span> this release, check out the Symantec Operations Readiness</div><div class="line">Tools (SORT) Installation and Upgrade Checklist and Hot fix and EEB</div><div class="line">Release Auditor, respectively, at https://sort.veritas.com/netbackup.</div><div class="line"></div><div class="line">ATTENTION!  To <span class="built_in">help</span> ensure a successful upgrade to NetBackup 7.7.3,</div><div class="line">please visit the NetBackup 7.x Upgrade Portal:</div><div class="line">https://www.veritas.com/support/en_US/article.TECH74584.</div><div class="line"></div><div class="line">Do you wish to <span class="built_in">continue</span>? [y,n] (y) y</div><div class="line">Starting NetBackup Deduplication installer</div><div class="line">testing: /tmp/pdde_pkg_dir_27939</div><div class="line">NetBackup Deduplication preinstall check passed</div><div class="line"></div><div class="line">Is this host the master server? [y,n] (y)</div><div class="line"></div><div class="line">Checking <span class="keyword">for</span> required system conditions...</div><div class="line"></div><div class="line">ok nbdb_maintenance_space: no NBDB maintenance required on new install: skipping</div><div class="line">ok remote_emm: NetBackup is not installed: skipping</div><div class="line">ok be_nb_same_host: inapplicable on linux: skipping</div><div class="line">ok unsupported_platform: Passed checks <span class="keyword">for</span> unsupported platforms.</div><div class="line">ok nbdb_ntfs_dir_symlink: inapplicable on linux: skipping</div><div class="line"></div><div class="line">Checking <span class="keyword">for</span> recommended system conditions...</div><div class="line"></div><div class="line">not ok ulimit_nofiles: nofiles <span class="built_in">ulimit</span> 1024 is too low.</div><div class="line">  NetBackup Master and Media Server processes may run slower <span class="keyword">if</span> they are</div><div class="line">  limited to fewer than 8000 open file descriptors.  This <span class="built_in">test</span> runs</div><div class="line">  <span class="string">'ulimit -n'</span> and checks that the result is at least 8000 on NetBackup</div><div class="line">  servers.  See</div><div class="line">    https://www.veritas.com/support/en_US/article.TECH75332</div><div class="line">  <span class="keyword">for</span> more information.</div><div class="line">ok hotfix_auditor: NetBackup is not installed or there is no hotfix or EEB data present. Skipping HF/EEB Auditor check.</div><div class="line">not ok wsl_account: User existence <span class="built_in">command</span> [id nbwebsvc 2&gt;&amp;1] returned status 256: [].</div><div class="line">  A user [nbwebsvc] <span class="keyword">in</span> group [nbwebgrp] does not exist on the Master Server.</div><div class="line">  This is needed to <span class="built_in">enable</span> web services, and will be a requirement of Master Server installation</div><div class="line">  <span class="keyword">in</span> NetBackup 8.0 and beyond.  See</div><div class="line">        http://www.veritas.com/docs/000081350</div><div class="line">  <span class="keyword">for</span> more information.</div><div class="line">not ok semaphore_limits: too low:</div><div class="line">  Performance of NetBackup Master and Media Servers can be affected</div><div class="line">  adversely <span class="keyword">if</span> the system is configured with low semaphore limits.  This</div><div class="line">  <span class="built_in">test</span> checks whether the current semaphore limits are <span class="built_in">set</span> as</div><div class="line">  recommended.  See https://www.veritas.com/support/en_US/article.TECH203066 <span class="keyword">for</span></div><div class="line">  details.</div><div class="line"></div><div class="line">  The current SEMMNI setting is   128; at least  1024 is recommended.</div><div class="line">  The current SEMMSL setting is   250; at least   300 is recommended.</div><div class="line">  The current SEMMNS setting is 32000; at least 307200 is recommended.</div><div class="line"></div><div class="line">WARNING: One or more non-critical preinstall checks have failed.</div><div class="line"></div><div class="line">The NetBackup and Media Manager software is built <span class="keyword">for</span> use on LINUX_RH_X86 hardware.</div><div class="line">Do you want to install NetBackup and Media Manager files? [y,n] (y)</div><div class="line"></div><div class="line">NetBackup and Media Manager are normally installed <span class="keyword">in</span> /usr/openv.</div><div class="line">Is it OK to install <span class="keyword">in</span> /usr/openv? [y,n] (y)</div><div class="line"></div><div class="line">Saving server binaries <span class="keyword">for</span> LINUX_RH_X86.</div><div class="line"></div><div class="line">Reading NetBackup files from /root/NetBackup_7.7.3_LinuxR_x86_64/linuxR_x86/anb</div><div class="line"></div><div class="line">Checking <span class="keyword">for</span> pre-existing SYMCnetbp package.</div><div class="line">Installing SYMCnetbp package.</div><div class="line">Installation of SYMCnetbp was successful.</div><div class="line">More details regarding SYMCnetbp can be found <span class="keyword">in</span> file</div><div class="line">/tmp/install_netbppkg_trace.28059 on rhel6-01.</div><div class="line"></div><div class="line">x openv/netbackup/client/Linux/</div><div class="line">x openv/netbackup/client/Linux/Debian2.6.18/</div><div class="line">x openv/netbackup/client/Linux/Debian2.6.18/nbj.conf</div><div class="line">x openv/netbackup/client/Linux/Debian2.6.18/client_config</div><div class="line">x openv/netbackup/client/Linux/Debian2.6.18/cp_to_client</div><div class="line">x openv/netbackup/client/Linux/Debian2.6.18/extract_java</div><div class="line">x openv/netbackup/client/Linux/Debian2.6.18/version</div><div class="line">x openv/netbackup/client/Linux/Debian2.6.18/install_client</div><div class="line">x openv/netbackup/client/Linux/Debian2.6.18/ftp_to_client</div><div class="line">x openv/netbackup/client/Linux/Debian2.6.18/sftp_to_client</div><div class="line">x openv/netbackup/client/Linux/Debian2.6.18/ssh_to_client</div><div class="line">x openv/netbackup/client/Linux/Debian2.6.18/nb_init_cfg</div><div class="line">x openv/netbackup/client/Linux/Debian2.6.18/pdinstall</div><div class="line">x openv/netbackup/client/Linux/Debian2.6.18/nbcheck</div><div class="line">x openv/netbackup/client/Linux/Debian2.6.18/nbbsdtar</div><div class="line">x openv/netbackup/client/Linux/Debian2.6.18/PBX.tar.gz</div><div class="line">x openv/netbackup/client/Linux/Debian2.6.18/installpbx</div><div class="line">x openv/netbackup/client/Linux/Debian2.6.18/VRTSpddea.rpm</div><div class="line">x openv/netbackup/client/Linux/Debian2.6.18/client_bin.tar.gz</div><div class="line">x openv/netbackup/client/Linux/Debian2.6.18/.sizes_client_bin</div><div class="line">x openv/netbackup/client/Linux/Debian2.6.18/.sizes</div><div class="line">x openv/netbackup/client/Linux/Debian2.6.18/NB-Java.tar.gz</div><div class="line">x openv/netbackup/client/Linux/Debian2.6.18/.sizes_NB-Java</div><div class="line">x openv/netbackup/client/Linux/Debian2.6.18/JRE.tar.gz</div><div class="line">x openv/netbackup/client/Linux/Debian2.6.18/.sizes_JRE</div><div class="line">x openv/netbackup/client/Linux/RedHat2.6.18/</div><div class="line">x openv/netbackup/client/Linux/RedHat2.6.18/nbj.conf</div><div class="line">x openv/netbackup/client/Linux/RedHat2.6.18/client_config</div><div class="line">x openv/netbackup/client/Linux/RedHat2.6.18/cp_to_client</div><div class="line">x openv/netbackup/client/Linux/RedHat2.6.18/extract_java</div><div class="line">x openv/netbackup/client/Linux/RedHat2.6.18/nb_init_cfg</div><div class="line">x openv/netbackup/client/Linux/RedHat2.6.18/install_client</div><div class="line">x openv/netbackup/client/Linux/RedHat2.6.18/ftp_to_client</div><div class="line">x openv/netbackup/client/Linux/RedHat2.6.18/sftp_to_client</div><div class="line">x openv/netbackup/client/Linux/RedHat2.6.18/ssh_to_client</div><div class="line">x openv/netbackup/client/Linux/RedHat2.6.18/VRTSnbpck.rpm</div><div class="line">x openv/netbackup/client/Linux/RedHat2.6.18/pdinstall</div><div class="line">x openv/netbackup/client/Linux/RedHat2.6.18/nbcheck</div><div class="line">x openv/netbackup/client/Linux/RedHat2.6.18/nbbsdtar</div><div class="line">x openv/netbackup/client/Linux/RedHat2.6.18/VRTSnbcfg.rpm</div><div class="line">x openv/netbackup/client/Linux/RedHat2.6.18/VRTSnbclt.rpm</div><div class="line">x openv/netbackup/client/Linux/RedHat2.6.18/version</div><div class="line">x openv/netbackup/client/Linux/RedHat2.6.18/VRTSpddea.rpm</div><div class="line">x openv/netbackup/client/Linux/RedHat2.6.18/VRTSpbx.rpm</div><div class="line">x openv/netbackup/client/Linux/RedHat2.6.18/.sizes</div><div class="line">x openv/netbackup/client/Linux/RedHat2.6.18/VRTSnbjava.rpm</div><div class="line">x openv/netbackup/client/Linux/RedHat2.6.18/VRTSnbjre.rpm</div><div class="line">x openv/netbackup/client/Linux/SuSE3.0.76/</div><div class="line">x openv/netbackup/client/Linux/SuSE3.0.76/nbj.conf</div><div class="line">x openv/netbackup/client/Linux/SuSE3.0.76/VRTSnbpck.rpm</div><div class="line">x openv/netbackup/client/Linux/SuSE3.0.76/pdinstall</div><div class="line">x openv/netbackup/client/Linux/SuSE3.0.76/nbcheck</div><div class="line">x openv/netbackup/client/Linux/SuSE3.0.76/nbbsdtar</div><div class="line">x openv/netbackup/client/Linux/SuSE3.0.76/client_config</div><div class="line">x openv/netbackup/client/Linux/SuSE3.0.76/cp_to_client</div><div class="line">x openv/netbackup/client/Linux/SuSE3.0.76/extract_java</div><div class="line">x openv/netbackup/client/Linux/SuSE3.0.76/nb_init_cfg</div><div class="line">x openv/netbackup/client/Linux/SuSE3.0.76/install_client</div><div class="line">x openv/netbackup/client/Linux/SuSE3.0.76/ftp_to_client</div><div class="line">x openv/netbackup/client/Linux/SuSE3.0.76/sftp_to_client</div><div class="line">x openv/netbackup/client/Linux/SuSE3.0.76/ssh_to_client</div><div class="line">x openv/netbackup/client/Linux/SuSE3.0.76/VRTSnbcfg.rpm</div><div class="line">x openv/netbackup/client/Linux/SuSE3.0.76/VRTSnbclt.rpm</div><div class="line">x openv/netbackup/client/Linux/SuSE3.0.76/VRTSpddea.rpm</div><div class="line">x openv/netbackup/client/Linux/SuSE3.0.76/version</div><div class="line">x openv/netbackup/client/Linux/SuSE3.0.76/VRTSpbx.rpm</div><div class="line">x openv/netbackup/client/Linux/SuSE3.0.76/.sizes</div><div class="line">x openv/netbackup/client/Linux/SuSE3.0.76/VRTSnbjava.rpm</div><div class="line">x openv/netbackup/client/Linux/SuSE3.0.76/VRTSnbjre.rpm</div><div class="line"></div><div class="line">Copying RedHat2.6.18 Client Binaries</div><div class="line">Installing VRTSnbpck ...</div><div class="line">Installing VRTSpbx ...</div><div class="line">Installing VRTSnbclt ...</div><div class="line"></div><div class="line">Terminating NetBackup and/or Media Manager processes.</div><div class="line"></div><div class="line">Installing NB-Java.</div><div class="line">Installing VRTSnbjre ...</div><div class="line"></div><div class="line">Installing VRTSnbjava ...</div><div class="line"></div><div class="line">+ /bin/cp ./nbj.conf /usr/openv/java</div><div class="line"></div><div class="line">Migrating <span class="built_in">log</span> files <span class="keyword">in</span> /usr/openv/logs</div><div class="line">Migration of <span class="built_in">log</span> files complete.</div><div class="line"></div><div class="line">No [x]inetd process found.</div><div class="line">Installing VRTSpddea.rpm ...</div><div class="line">Starting NetBackup Deduplication installer</div><div class="line">testing: /tmp/pdde_pkg_dir_29478</div><div class="line">Checking <span class="keyword">for</span> SYMCpddea package...</div><div class="line">Checking <span class="keyword">for</span> VRTSpddea package...</div><div class="line">   Package VRTSpddea found.</div><div class="line"></div><div class="line">NetBackup Deduplication software is installed.</div><div class="line"></div><div class="line">NetBackup Deduplication is not yet configured.</div><div class="line">Checking <span class="keyword">for</span> SYMCpddes package...</div><div class="line">Checking <span class="keyword">for</span> SYMCpddea package...</div><div class="line">Installing NetBackup Deduplication server package (/usr/openv/pddeserver.tar.gz)...</div><div class="line">Extracting package SYMCpddes <span class="keyword">in</span> /tmp/pdde_pkg_dir_29478.</div><div class="line">   Package SYMCpddes extracted to /tmp/pdde_pkg_dir_29478.</div><div class="line">Installing package SYMCpddes.</div><div class="line">   Package SYMCpddes installed.</div><div class="line">Running NetBackup Deduplication upgrade script (server mode)...</div><div class="line">NetBackup Deduplication install finished successfully.</div><div class="line">Version now installed: 9.0300.0016.0512</div><div class="line">Full NetBackup Deduplication installation <span class="built_in">log</span> saved to: /var/<span class="built_in">log</span>/puredisk/2017-04-19_14:27-pdde-install.log</div><div class="line"></div><div class="line">Installing VRTSnbcfg.rpm ...</div><div class="line"></div><div class="line">Done executing NB.inst.</div><div class="line"></div><div class="line">If you ran NB.inst instead of &lt;cdrom_path&gt;/install, you must</div><div class="line">run /usr/openv/netbackup/bin/install_bp to initiate NetBackup.</div><div class="line">Running /usr/openv/netbackup/bin/install_bp</div><div class="line"></div><div class="line"></div><div class="line">A NetBackup Server or Enterprise Server license key is needed</div><div class="line"><span class="keyword">for</span> installation to <span class="built_in">continue</span>.</div><div class="line"></div><div class="line">Enter license key:</div><div class="line">Evaluation NetBackup Enterprise Server with May 19, 2017 expiration date will be registered.</div><div class="line">Is this OK? [y,n] (y)</div><div class="line"></div><div class="line"></div><div class="line">KJNW-P39N-WK8O-HZUW-6CPC-IR4K-SOYK-Y7FF-YUPP-P:</div><div class="line">	Evaluation NetBackup Enterprise Server Base product with the following features enabled:</div><div class="line">            Replication Director</div><div class="line">            Accelerator</div><div class="line">            PureDisk Remote Office</div><div class="line">            PureDisk Option</div><div class="line">            SAN Client</div><div class="line">            PureDisk MS Exchange Agent</div><div class="line">            Enterprise Vault Agent</div><div class="line">            PureDisk MS SQL Server Agent</div><div class="line">            Flexible Disk Option</div><div class="line">            OpenStorage Disk Option</div><div class="line">            Virtual Tape Option</div><div class="line">            Bare Metal Restore</div><div class="line">            Encryption</div><div class="line">            Open File Backup</div><div class="line">            Remote Client Support</div><div class="line">            Robotic Library Sharing Support</div><div class="line">            Remote Media Server Support</div><div class="line">            Microsoft RSM Robotic Libraries</div><div class="line">            ADIC DAS/SDLC Robotic Libraries</div><div class="line">            IBM ATL Robotic Libraries</div><div class="line">            Fujitsu LMF Robotic Libraries</div><div class="line">            StorageTek ACS Robotic Libraries</div><div class="line">            Snapshot Client</div><div class="line">            MS SharePoint Agent</div><div class="line">            Inline Tape Copy</div><div class="line">            Vault</div><div class="line">            Library Based Tape Drives</div><div class="line">            DataStore</div><div class="line">            Encryption (Legacy DES 56-bit)</div><div class="line">            Encryption (Legacy DES 40-bit)</div><div class="line">            SAP extension</div><div class="line">            Sybase extension</div><div class="line">            Informix extension</div><div class="line">            Oracle extension</div><div class="line">            Lotus Notes extension</div><div class="line">            DB2 extension</div><div class="line">            MS SQL Server extension</div><div class="line">            MS Exchange extension</div><div class="line">            Shared Storage Option</div><div class="line">            NDMP</div><div class="line">            Additional clients</div><div class="line">	has been registered.</div><div class="line"></div><div class="line"></div><div class="line">All additional keys should be added at this time.</div><div class="line">Do you want to add additional license keys now? [y,n] (y) n</div><div class="line"></div><div class="line">Use /usr/openv/netbackup/bin/admincmd/get_license_key</div><div class="line">to add, delete or list license keys at a later time.</div><div class="line"></div><div class="line">Installing NetBackup Enterprise Server version: 7.7.3</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">If this machine will be using a different network interface than the</div><div class="line">default (rhel6-01), the name of the preferred interface should be used</div><div class="line">as the configured server name.  If this machine will be part of a</div><div class="line">cluster, the virtual name should be used as the configured server name.</div><div class="line"></div><div class="line">Would you like to use <span class="string">"rhel6-01"</span> as the configured</div><div class="line">NetBackup server name of this machine? [y,n] (y)</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">Media servers can be added during this installation or</div><div class="line">to a NetBackup environment after installation completes.</div><div class="line">Refer to the NetBackup Administrator<span class="string">'s Guide, Volume I for</span></div><div class="line"><span class="string">more information.</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">Do you want to add any media servers now? [y,n] (n)</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">Checking network connections.</span></div><div class="line"><span class="string">bp.conf: IP_ADDRESS_FAMILY = AF_INET: default value, no update needed</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">Machine rhel6-01 is a master server, and it is the EMMSERVER.</span></div><div class="line"><span class="string">Converting STREAMS files.  This may take a few minutes.</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">STREAMS files conversion is complete.</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">Successfully updated the session cache parameters.</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">Done processing parameter files, no files found to convert</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">Starting the NetBackup Authentication daemon.</span></div><div class="line"><span class="string">Starting the NetBackup network daemon.</span></div><div class="line"><span class="string">Starting the NetBackup client daemon.</span></div><div class="line"><span class="string">Starting the NetBackup SAN Client Fibre Transport daemon.</span></div><div class="line"><span class="string">Starting the NetBackup Discovery Framework.</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">Configuring nbatd.</span></div><div class="line"><span class="string">Gathering configuration information.</span></div><div class="line"><span class="string">Waiting for the security services to start operation.</span></div><div class="line"><span class="string">Generating identity for host '</span>rhel6-01<span class="string">'</span></div><div class="line"><span class="string">Setting up security on target host: rhel6-01</span></div><div class="line"><span class="string">nbatd is successfully configured on NetBackup Master Server.</span></div><div class="line"><span class="string">Operation completed successfully.</span></div><div class="line"><span class="string">Creating /usr/openv/tmp/sqlany</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">Installed SQL Anywhere Version 16.0.0.2184</span></div><div class="line"><span class="string">Installation completed successfully</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">x openv/wmc/</span></div><div class="line"><span class="string">x openv/wmc/war/</span></div><div class="line"><span class="string">x openv/wmc/war/nbwebservice.war</span></div><div class="line"><span class="string">x openv/wmc/config/</span></div><div class="line"><span class="string">x openv/wmc/config/index.html</span></div><div class="line"><span class="string">x openv/wmc/config/log4j.properties</span></div><div class="line"><span class="string">x openv/wmc/config/tomcat.logging.properties</span></div><div class="line"><span class="string">x openv/wmc/lib/</span></div><div class="line"><span class="string">x openv/wmc/lib/goodies.jar</span></div><div class="line"><span class="string">x openv/wmc/bin/</span></div><div class="line"><span class="string">x openv/wmc/bin/install/</span></div><div class="line"><span class="string">x openv/wmc/bin/install/configurePorts</span></div><div class="line"><span class="string">x openv/wmc/bin/install/configureWmc</span></div><div class="line"><span class="string">x openv/wmc/bin/install/configureWsDefaults</span></div><div class="line"><span class="string">x openv/wmc/bin/install/createSslStore</span></div><div class="line"><span class="string">x openv/wmc/bin/install/manageClientCerts</span></div><div class="line"><span class="string">x openv/wmc/bin/install/setupWmc</span></div><div class="line"><span class="string">x openv/wmc/bin/install/configureCerts</span></div><div class="line"><span class="string">x openv/wmc/bin/install/configureEnv</span></div><div class="line"><span class="string">x openv/wmc/webserver/</span></div><div class="line"><span class="string">x openv/wmc/webserver/LICENSE</span></div><div class="line"><span class="string">x openv/wmc/webserver/NOTICE</span></div><div class="line"><span class="string">x openv/wmc/webserver/RELEASE-NOTES</span></div><div class="line"><span class="string">x openv/wmc/webserver/RUNNING.txt</span></div><div class="line"><span class="string">x openv/wmc/webserver/bin/</span></div><div class="line"><span class="string">x openv/wmc/webserver/bin/bootstrap.jar</span></div><div class="line"><span class="string">x openv/wmc/webserver/bin/catalina-tasks.xml</span></div><div class="line"><span class="string">x openv/wmc/webserver/bin/catalina.sh</span></div><div class="line"><span class="string">x openv/wmc/webserver/bin/commons-daemon-native.tar.gz</span></div><div class="line"><span class="string">x openv/wmc/webserver/bin/commons-daemon.jar</span></div><div class="line"><span class="string">x openv/wmc/webserver/bin/configtest.sh</span></div><div class="line"><span class="string">x openv/wmc/webserver/bin/daemon.sh</span></div><div class="line"><span class="string">x openv/wmc/webserver/bin/digest.sh</span></div><div class="line"><span class="string">x openv/wmc/webserver/bin/setclasspath.sh</span></div><div class="line"><span class="string">x openv/wmc/webserver/bin/shutdown.sh</span></div><div class="line"><span class="string">x openv/wmc/webserver/bin/startup.sh</span></div><div class="line"><span class="string">x openv/wmc/webserver/bin/tomcat-juli.jar</span></div><div class="line"><span class="string">x openv/wmc/webserver/bin/tomcat-native.tar.gz</span></div><div class="line"><span class="string">x openv/wmc/webserver/bin/tool-wrapper.sh</span></div><div class="line"><span class="string">x openv/wmc/webserver/bin/version.sh</span></div><div class="line"><span class="string">x openv/wmc/webserver/conf/</span></div><div class="line"><span class="string">x openv/wmc/webserver/conf/catalina.policy</span></div><div class="line"><span class="string">x openv/wmc/webserver/conf/catalina.properties</span></div><div class="line"><span class="string">x openv/wmc/webserver/conf/context.xml.template</span></div><div class="line"><span class="string">x openv/wmc/webserver/conf/server.xml.template</span></div><div class="line"><span class="string">x openv/wmc/webserver/conf/tomcat-users.xml</span></div><div class="line"><span class="string">x openv/wmc/webserver/conf/tomcat-users.xsd</span></div><div class="line"><span class="string">x openv/wmc/webserver/conf/web.xml.template</span></div><div class="line"><span class="string">x openv/wmc/webserver/lib/</span></div><div class="line"><span class="string">x openv/wmc/webserver/lib/annotations-api.jar</span></div><div class="line"><span class="string">x openv/wmc/webserver/lib/catalina-ant.jar</span></div><div class="line"><span class="string">x openv/wmc/webserver/lib/catalina-ha.jar</span></div><div class="line"><span class="string">x openv/wmc/webserver/lib/catalina-storeconfig.jar</span></div><div class="line"><span class="string">x openv/wmc/webserver/lib/catalina-tribes.jar</span></div><div class="line"><span class="string">x openv/wmc/webserver/lib/catalina.jar</span></div><div class="line"><span class="string">x openv/wmc/webserver/lib/ecj-4.4.2.jar</span></div><div class="line"><span class="string">x openv/wmc/webserver/lib/el-api.jar</span></div><div class="line"><span class="string">x openv/wmc/webserver/lib/jasper-el.jar</span></div><div class="line"><span class="string">x openv/wmc/webserver/lib/jasper.jar</span></div><div class="line"><span class="string">x openv/wmc/webserver/lib/jsp-api.jar</span></div><div class="line"><span class="string">x openv/wmc/webserver/lib/servlet-api.jar</span></div><div class="line"><span class="string">x openv/wmc/webserver/lib/tomcat-api.jar</span></div><div class="line"><span class="string">x openv/wmc/webserver/lib/tomcat-coyote.jar</span></div><div class="line"><span class="string">x openv/wmc/webserver/lib/tomcat-dbcp.jar</span></div><div class="line"><span class="string">x openv/wmc/webserver/lib/tomcat-i18n-es.jar</span></div><div class="line"><span class="string">x openv/wmc/webserver/lib/tomcat-i18n-fr.jar</span></div><div class="line"><span class="string">x openv/wmc/webserver/lib/tomcat-i18n-ja.jar</span></div><div class="line"><span class="string">x openv/wmc/webserver/lib/tomcat-jdbc.jar</span></div><div class="line"><span class="string">x openv/wmc/webserver/lib/tomcat-jni.jar</span></div><div class="line"><span class="string">x openv/wmc/webserver/lib/tomcat-util-scan.jar</span></div><div class="line"><span class="string">x openv/wmc/webserver/lib/tomcat-util.jar</span></div><div class="line"><span class="string">x openv/wmc/webserver/lib/tomcat-websocket.jar</span></div><div class="line"><span class="string">x openv/wmc/webserver/lib/websocket-api.jar</span></div><div class="line"><span class="string">x openv/wmc/webserver/temp/</span></div><div class="line"><span class="string">x openv/wmc/webserver/temp/safeToDelete.tmp</span></div><div class="line"><span class="string">x openv/wmc/webserver/webapps/</span></div><div class="line"><span class="string">x openv/wmc/webserver/webapps/ROOT/</span></div><div class="line"><span class="string">x openv/wmc/webserver/webapps/ROOT/RELEASE-NOTES.txt</span></div><div class="line"><span class="string">x openv/wmc/webserver/webapps/ROOT/WEB-INF/</span></div><div class="line"><span class="string">x openv/wmc/webserver/webapps/ROOT/WEB-INF/web.xml</span></div><div class="line"><span class="string">x openv/wmc/webserver/webapps/ROOT/asf-logo-wide.gif</span></div><div class="line"><span class="string">x openv/wmc/webserver/webapps/ROOT/asf-logo.png</span></div><div class="line"><span class="string">x openv/wmc/webserver/webapps/ROOT/bg-button.png</span></div><div class="line"><span class="string">x openv/wmc/webserver/webapps/ROOT/bg-middle.png</span></div><div class="line"><span class="string">x openv/wmc/webserver/webapps/ROOT/bg-nav-item.png</span></div><div class="line"><span class="string">x openv/wmc/webserver/webapps/ROOT/bg-nav.png</span></div><div class="line"><span class="string">x openv/wmc/webserver/webapps/ROOT/bg-upper.png</span></div><div class="line"><span class="string">x openv/wmc/webserver/webapps/ROOT/build.xml</span></div><div class="line"><span class="string">x openv/wmc/webserver/webapps/ROOT/favicon.ico</span></div><div class="line"><span class="string">x openv/wmc/webserver/webapps/ROOT/index.jsp</span></div><div class="line"><span class="string">x openv/wmc/webserver/webapps/ROOT/tomcat-power.gif</span></div><div class="line"><span class="string">x openv/wmc/webserver/webapps/ROOT/tomcat.css</span></div><div class="line"><span class="string">x openv/wmc/webserver/webapps/ROOT/tomcat.gif</span></div><div class="line"><span class="string">x openv/wmc/webserver/webapps/ROOT/tomcat.png</span></div><div class="line"><span class="string">x openv/wmc/webserver/webapps/ROOT/tomcat.svg</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">Creating WSL server certificate ...</span></div><div class="line"><span class="string">set_value: Key "AZDBPasswordFilePath" successfully updated</span></div><div class="line"><span class="string">AZ database setup complete.</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">Database server is NB_rhel6-01</span></div><div class="line"><span class="string">Creating the NetBackup database.</span></div><div class="line"><span class="string">Creating NetBackup staging directory in: /usr/openv/db/staging</span></div><div class="line"><span class="string">Starting the NetBackup database.</span></div><div class="line"><span class="string">Authenticating the NetBackup database.</span></div><div class="line"><span class="string">VXDBMS_NB_DATA entry in bp.conf updated successfully.</span></div><div class="line"><span class="string">Setting of database authentication for NBDB successful.</span></div><div class="line"><span class="string">Change of dba password for NBDB successful.</span></div><div class="line"><span class="string">Creating the NetBackup database files.</span></div><div class="line"><span class="string">The NetBackup database files creation complete.</span></div><div class="line"><span class="string">Creating the NetBackup database schema.</span></div><div class="line"><span class="string">Verifying the running version of NBDB ...</span></div><div class="line"><span class="string">NBDB version 7.7.3.0 verified.</span></div><div class="line"><span class="string">Upgrading NBDB (7.7.3.0) to (7.7.3.0) ...</span></div><div class="line"><span class="string">NBDB version remains the same.</span></div><div class="line"><span class="string">Starting NBDB database self-tuning. This may take some time...</span></div><div class="line"><span class="string">	Found 0 fragmented records in database.</span></div><div class="line"><span class="string">NBDB database self-tuning is complete.</span></div><div class="line"><span class="string">Database [NBDB] validation successful.</span></div><div class="line"><span class="string">The NetBackup database creation complete.</span></div><div class="line"><span class="string">Database [NBDB] is alive and well on server [NB_rhel6-01].</span></div><div class="line"><span class="string">Creating the NetBackup Authorization database.</span></div><div class="line"><span class="string">Creation of NetBackup Authorization database is complete.</span></div><div class="line"><span class="string">Exiting from create_nbdb, status[0].</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">Migrating SLP definitions into the NetBackup relational database.</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">Starting the NetBackup Event Manager.</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">Starting the NetBackup Audit Manager.</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">Starting the NetBackup Deduplication Manager.</span></div><div class="line"><span class="string">Starting the NetBackup Deduplication Engine.</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">Starting the NetBackup database manager process (bpdbm).</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">Creating Directive Set for LotusNotes</span></div><div class="line"><span class="string">Creating Directive Set for MS_Exchange_Mailbox</span></div><div class="line"><span class="string">Creating Directive Set for MS_Exchange_Database</span></div><div class="line"><span class="string">Creating Directive Set for MS_Exchange_Public_Folders</span></div><div class="line"><span class="string">Creating Directive Set for MS_Exchange_Database_Availability_Groups</span></div><div class="line"><span class="string">Creating Directive Set for MS_SharePoint_Portal_Server</span></div><div class="line"><span class="string">Creating Template Set for Oracle_RMAN</span></div><div class="line"><span class="string">Creating Template Set for Oracle_XML_Export</span></div><div class="line"><span class="string">Creating Template Set for DB2</span></div><div class="line"><span class="string">Creating Directive Set for Windows2003</span></div><div class="line"><span class="string">Creating Directive Set for Windows2008</span></div><div class="line"><span class="string">Creating Directive Set for Windows</span></div><div class="line"><span class="string">Creating Directive Set for Enterprise_Vault_7.5</span></div><div class="line"><span class="string">Creating Directive Set for Enterprise_Vault_8.0</span></div><div class="line"><span class="string">Creating Directive Set for Enterprise_Vault_9.0</span></div><div class="line"><span class="string">Creating Directive Set for Enterprise_Vault_10.0</span></div><div class="line"><span class="string">Creating Directive Set for Enterprise_Vault_11.0</span></div><div class="line"><span class="string">Creating Directive Set for NDMP</span></div><div class="line"><span class="string">Creating Directive Set for FlashBackup</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">Converting snapshot policies:</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">Policy conversion summary:</span></div><div class="line"><span class="string">	Number of original policies:			0</span></div><div class="line"><span class="string">	Number of non-snapshot policies skipped:	0</span></div><div class="line"><span class="string">	Number of policies not needing conversion:	0</span></div><div class="line"><span class="string">	Number of policies converted to</span></div><div class="line"><span class="string">	  '</span>auto<span class="string">' snapshot method:			0</span></div><div class="line"><span class="string">	Number of policies converted:			0</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">Updating client hardware definitions:</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">Hardware update conversion summary:</span></div><div class="line"><span class="string">	Number of policies processed:			      0</span></div><div class="line"><span class="string">	Number of policies with affected clients:	      0</span></div><div class="line"><span class="string">	Number of clients processed:			      0</span></div><div class="line"><span class="string">	Number of clients converted:			      0</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">Updating policy identifiers:</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">Policy identifier update summary:</span></div><div class="line"><span class="string">	Number of policies processed:				      0</span></div><div class="line"><span class="string">	Number of policies with duplicate identifier:	      0</span></div><div class="line"><span class="string">	Number of policies with empty identifier:		      0</span></div><div class="line"><span class="string">	Number of policies with affected identifier:	      0</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">Starting the NetBackup compatibility daemon.</span></div><div class="line"><span class="string">Starting the NetBackup Enterprise Media Manager.</span></div><div class="line"><span class="string">Starting the NetBackup Resource Broker.</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">Populating the database tables.  This will take some time.</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">Starting the Media Manager device daemon processes.</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">Do you want to start the job-related NetBackup daemons</span></div><div class="line"><span class="string">so backups and restores can be initiated? [y,n] (y)</span></div><div class="line"><span class="string">Starting the NetBackup request daemon process (bprd).</span></div><div class="line"><span class="string">Starting the NetBackup Job Manager.</span></div><div class="line"><span class="string">Starting the NetBackup Policy Execution Manager.</span></div><div class="line"><span class="string">Starting the NetBackup Storage Lifecycle Manager.</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">Starting the NetBackup Remote Monitoring Management System.</span></div><div class="line"><span class="string">Starting the NetBackup Key Management daemon.</span></div><div class="line"><span class="string">Starting the NetBackup Service Layer.</span></div><div class="line"><span class="string">Starting the NetBackup Indexing Manager.</span></div><div class="line"><span class="string">Starting the NetBackup Agent Request Server.</span></div><div class="line"><span class="string">Starting the NetBackup Bare Metal Restore daemon.</span></div><div class="line"><span class="string">Starting the NetBackup Web Management Console.</span></div><div class="line"><span class="string">Starting the NetBackup Vault daemon.</span></div><div class="line"><span class="string">Starting the NetBackup CloudStore Service Container.</span></div><div class="line"><span class="string">Starting the NetBackup Service Monitor.</span></div><div class="line"><span class="string">Starting the NetBackup Bare Metal Restore Boot Server daemon.</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">OpsCenter is the next-generation monitoring, reporting and</span></div><div class="line"><span class="string">administrative solution designed to centrally manage one or</span></div><div class="line"><span class="string">more NetBackup installations from a web browser.</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">If an OpsCenter server already exists in your environment</span></div><div class="line"><span class="string">or you plan to install one, enter the real hostname of that</span></div><div class="line"><span class="string">OpsCenter server here.  Do not use a virtual name.  If you</span></div><div class="line"><span class="string">do not want this local machine to be an OpsCenter server,</span></div><div class="line"><span class="string">enter NONE.</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">Enter the OpsCenter server (default: NONE):</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">NetBackup server installation complete.</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">File /usr/openv/tmp/install_trace.27898 contains a trace of this install.</span></div><div class="line"><span class="string">That file can be deleted after you are sure the install was successful.</span></div><div class="line"><span class="string">[root@rhel6-01 NetBackup_7.7.3_LinuxR_x86_64]#</span></div></pre></td></tr></table></figure>
<h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Console，登录用户名和密码为本地root帐号</span></div><div class="line">/usr/openv/netbackup/bin/jnbSA</div><div class="line"></div><div class="line"><span class="comment"># 图形化配置</span></div><div class="line">- 新建一个policy</div><div class="line">- 在Attributes先确认Policy Type，修改Policy storage</div><div class="line">- 可以配置一个或者多个Schedules</div><div class="line"></div><div class="line"><span class="comment"># 修改环境变量</span></div><div class="line">vim /root/.bash_profile</div><div class="line"></div><div class="line">PATH=<span class="variable">$PATH</span>:<span class="variable">$HOME</span>/bin:/usr/openv/netbackup/bin:/usr/openv/netbackup/bin/admincmd:/usr/openv/netbackup/bin/goodies:/usr/openv/volmgr/bin</div><div class="line"></div><div class="line"><span class="comment"># 停止服务</span></div><div class="line">/usr/openv/netbackup/bin/goodies/netbackup stop</div><div class="line">/usr/openv/netbackup/bin/bp.kill_all</div><div class="line"></div><div class="line"><span class="comment"># 查看进程</span></div><div class="line">/usr/openv/netbackup/bin/bpps -x</div><div class="line"></div><div class="line"><span class="comment"># 未开启重复删除功能前的常见端口，双向+长连接</span></div><div class="line">1556</div><div class="line">13724</div><div class="line"><span class="comment"># 开启重删后增加2个端口</span></div><div class="line">10082</div><div class="line">10102</div><div class="line"></div><div class="line"><span class="comment"># 导入ovf后需要做2件事</span></div><div class="line">1. 修改IP和hosts</div><div class="line">2. 执行bpclntcmd: -clear_host_cache</div><div class="line">3. 升级或者重新安装一定要保存好NBU catalog数据库</div></pre></td></tr></table></figure>
<h2 id="配置加速备份实践"><a href="#配置加速备份实践" class="headerlink" title="配置加速备份实践"></a>配置加速备份实践</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 增加独立存储空间</span></div><div class="line">fdisk /dev/sdb</div><div class="line">pvcreate /dev/sdb1</div><div class="line">mkfs.ext4 /dev/sdb1</div><div class="line">mkdir /pool</div><div class="line">mount /dev/sdb1 /pool</div><div class="line"></div><div class="line"><span class="comment"># 图形化配置</span></div><div class="line">jnbSA</div><div class="line"></div><div class="line">Configure Disk Storage Servers</div><div class="line">- Media Server Deduplication Pool</div><div class="line">- Storage Path: /pool</div><div class="line"></div><div class="line">policy: pool</div><div class="line">- Policy <span class="built_in">type</span>: Standard</div><div class="line">-- Policy storage: pool-stu</div><div class="line">-- Use Accelerator</div><div class="line"></div><div class="line"><span class="comment"># 测试备份加速</span></div><div class="line">执行2次Manual Backup，观察增量备份时间区别</div></pre></td></tr></table></figure>
<h2 id="配置Oracle数据库备份和恢复实践"><a href="#配置Oracle数据库备份和恢复实践" class="headerlink" title="配置Oracle数据库备份和恢复实践"></a>配置Oracle数据库备份和恢复实践</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 数据库打开归档</span></div><div class="line">shutdown immediate</div><div class="line">startup mount</div><div class="line">alter database archivelog;</div><div class="line">alter system <span class="built_in">set</span> log_archive_dest_1=<span class="string">'location=/archivelog/rman_backup'</span> scope=both;</div><div class="line">archive <span class="built_in">log</span> start</div><div class="line">alter database open;</div><div class="line">archive <span class="built_in">log</span> list;</div><div class="line"></div><div class="line"><span class="comment"># 配置环境变量</span></div><div class="line">su - oracle</div><div class="line"></div><div class="line">[oracle@rhel6-01 ~]$ vim .bash_profile</div><div class="line"><span class="comment"># .bash_profile</span></div><div class="line"></div><div class="line"><span class="comment"># Get the aliases and functions</span></div><div class="line"><span class="keyword">if</span> [ -f ~/.bashrc ]; <span class="keyword">then</span></div><div class="line">	. ~/.bashrc</div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line"><span class="comment"># User specific environment and startup programs</span></div><div class="line"></div><div class="line"></div><div class="line">PATH=<span class="variable">$PATH</span>:<span class="variable">$HOME</span>/bin:/usr/openv/netbackup/bin:/usr/openv/netbackup/bin/admincmd:/usr/openv/netbackup/bin/goodies:/usr/openv/volmgr/bin</div><div class="line"></div><div class="line"><span class="built_in">export</span> ORACLE_SID=orcl</div><div class="line"><span class="built_in">export</span> ORACLE_BASE=/home/oracle/app/oracle</div><div class="line"><span class="built_in">export</span> ORACLE_HOME=/home/oracle/app/oracle/product/11.2.0/dbhome_1</div><div class="line"><span class="built_in">export</span> PATH=<span class="variable">$ORACLE_HOME</span>/bin:<span class="variable">$PATH</span></div><div class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=<span class="variable">$ORACLE_HOME</span>/lib:/lib:/usr/lib</div><div class="line"></div><div class="line"><span class="built_in">export</span> PATH</div><div class="line"></div><div class="line"><span class="comment"># 配置oracle_link</span></div><div class="line">su - oracle</div><div class="line">[oracle@rhel6-01 ~]$ oracle_link</div><div class="line">Fri Apr 21 13:41:56 CST 2017</div><div class="line">All Oracle instances should be shutdown before running this script.</div><div class="line"></div><div class="line">Please <span class="built_in">log</span> into the Unix system as the Oracle owner <span class="keyword">for</span> running this script</div><div class="line"></div><div class="line">Do you want to <span class="built_in">continue</span>? (y/n) [n] y</div><div class="line"></div><div class="line"></div><div class="line">LIBOBK path: /usr/openv/netbackup/bin</div><div class="line">ORACLE_HOME: /home/oracle/app/oracle/product/11.2.0/dbhome_1</div><div class="line">Oracle version: 11.2.0.3.0</div><div class="line">Platform <span class="built_in">type</span>: x86_64</div><div class="line">Linking LIBOBK:</div><div class="line">ln -s /usr/openv/netbackup/bin/libobk.so64 /home/oracle/app/oracle/product/11.2.0/dbhome_1/lib/libobk.so</div><div class="line">Done</div><div class="line"></div><div class="line">Please check the trace file located <span class="keyword">in</span> /tmp/make_trace.15372</div><div class="line">to make sure the linking process was successful.</div><div class="line"></div><div class="line"><span class="comment"># 修改备份脚本</span></div><div class="line">mkdir /nbu</div><div class="line">cp /usr/openv/netbackup/ext/db_ext/oracle/samples/rman/hot_database_backup.sh /nbu/</div><div class="line">vim hot_database_backup.sh</div><div class="line"></div><div class="line">ORACLE_HOME=/home/oracle/app/oracle/product/11.2.0/dbhome_1</div><div class="line"></div><div class="line">ORACLE_SID=orcl</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># 图形化配置策略</span></div><div class="line">policy</div><div class="line">- Policy <span class="built_in">type</span>: oracle</div><div class="line">- Clients: Clients <span class="keyword">for</span> use with scripts or templates</div><div class="line">- Backup Selections: /nbu/hot_database_backup.sh</div><div class="line"></div><div class="line"><span class="comment"># NetBackup 7.6以后可以通过图形化配置备份，不依赖脚本，省去前两步，直接配置策略即可</span></div><div class="line">jnbSA</div><div class="line">NetBackup Management - Applications - Oracle - All Instances</div><div class="line">- Discover Instances</div><div class="line">- 右键数据库选择Register</div><div class="line"><span class="comment"># 配置策略</span></div><div class="line">policy</div><div class="line">- Policy <span class="built_in">type</span>: oracle</div><div class="line">- Clients: Protect Instances and Databases</div><div class="line"></div><div class="line"><span class="comment"># 开启并行优化加速</span></div><div class="line">- NetBackup Management - Host Properties - Master Servers</div><div class="line">- Properties - Global Attributes - Maximum job per client</div><div class="line"><span class="comment"># policy调整参数</span></div><div class="line">- Number of parallel streams</div><div class="line"></div><div class="line"><span class="comment"># Oracle数据库恢复实践</span></div><div class="line"></div><div class="line"><span class="comment"># 模拟数据库误删除（可以跳过直接回复某个数据文件测试）</span></div><div class="line">SQL&gt; select name from v<span class="variable">$datafile</span>;</div><div class="line"></div><div class="line">NAME</div><div class="line">--------------------------------------------------------------------------------</div><div class="line">/home/oracle/app/oracle/oradata/orcl/system01.dbf</div><div class="line">/home/oracle/app/oracle/oradata/orcl/sysaux01.dbf</div><div class="line">/home/oracle/app/oracle/oradata/orcl/undotbs01.dbf</div><div class="line">/home/oracle/app/oracle/oradata/orcl/users01.dbf</div><div class="line">/home/oracle/app/oracle/oradata/orcl/example01.dbf</div><div class="line"></div><div class="line">SQL&gt; shutdown immediate</div><div class="line">Database closed.</div><div class="line">Database dismounted.</div><div class="line">ORACLE instance shut down.</div><div class="line">SQL&gt; <span class="built_in">exit</span></div><div class="line"></div><div class="line"><span class="comment"># nbu查看备份列表</span></div><div class="line">[root@rhel6-01 nbu]<span class="comment"># bplist -C rhel6-01 -t 4 -l -R /</span></div><div class="line">-rw-rw---- oracle    oracle        9961472 Apr 21 14:32 /ctrl_dORCL_u0bs28f04_s11_p1_t941898756</div><div class="line">-rw-rw---- oracle    oracle         786432 Apr 21 14:32 /arch_dORCL_u0as28evl_s10_p1_t941898741</div><div class="line">-rw-rw---- oracle    oracle        9961472 Apr 21 14:32 /bk_dORCL_u09s28ev2_s9_p1_t941898722</div><div class="line">-rw-r----- oracle    oracle      744497152 Apr 21 14:31 /home/oracle/app/oracle/oradata/orcl/system01.dbf</div><div class="line">-rw-r----- oracle    oracle      120594432 Apr 21 14:31 /home/oracle/app/oracle/oradata/orcl/undotbs01.dbf</div><div class="line">-rw-r----- oracle    oracle        5251072 Apr 21 14:31 /home/oracle/app/oracle/oradata/orcl/users01.dbf</div><div class="line">-rw-r----- oracle    oracle      597696512 Apr 21 14:30 /home/oracle/app/oracle/oradata/orcl/sysaux01.dbf</div><div class="line">-rw-r----- oracle    oracle      328343552 Apr 21 14:30 /home/oracle/app/oracle/oradata/orcl/example01.dbf</div><div class="line">-rw-rw---- oracle    oracle        9961472 Apr 21 14:04 /cntrl_7_1_941897082</div><div class="line">-rw-rw---- oracle    oracle         262144 Apr 21 14:04 /al_6_1_941897055</div><div class="line">-rw-rw---- oracle    oracle        3407872 Apr 21 14:04 /al_5_1_941897055</div><div class="line">-rw-rw---- oracle    oracle         262144 Apr 21 14:03 /bk_4_1_941897037</div><div class="line">-rw-rw---- oracle    oracle        9961472 Apr 21 14:03 /bk_3_1_941896978</div><div class="line">-rw-rw---- oracle    oracle      690487296 Apr 21 14:01 /bk_1_1_941896912</div><div class="line">-rw-rw---- oracle    oracle      516161536 Apr 21 14:01 /bk_2_1_941896912</div><div class="line"></div><div class="line"><span class="comment"># 参考nbu备份脚本</span></div><div class="line">/usr/openv/netbackup/ext/db_ext/oracle/samples/rman/complete_database_restore.sh</div><div class="line"></div><div class="line"><span class="comment"># 恢复控制文件</span></div><div class="line">RUN &#123;</div><div class="line">ALLOCATE CHANNEL ch00 TYPE <span class="string">'SBT_TAPE'</span>;</div><div class="line">ALLOCATE CHANNEL ch01 TYPE <span class="string">'SBT_TAPE'</span>;</div><div class="line">RESTORE controfile from autobackup;</div><div class="line">RELEASE CHANNEL ch00;</div><div class="line">RELEASE CHANNEL ch01;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment"># 恢复数据文件</span></div><div class="line">RUN &#123;</div><div class="line">ALLOCATE CHANNEL ch00 TYPE <span class="string">'SBT_TAPE'</span>;</div><div class="line">ALLOCATE CHANNEL ch01 TYPE <span class="string">'SBT_TAPE'</span>;</div><div class="line">RESTORE DATABASE;</div><div class="line">RECOVER DATABASE;</div><div class="line">RELEASE CHANNEL ch00;</div><div class="line">RELEASE CHANNEL ch01;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      记录 Veritas NetBackup 学习心得
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>Veritas InfoScale Enterprise 7 安装部署手册</title>
    <link href="https://wsgzao.github.io/post/infoscale/"/>
    <id>https://wsgzao.github.io/post/infoscale/</id>
    <published>2017-04-14T07:22:32.000Z</published>
    <updated>2017-04-14T09:30:35.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Veritas InfoScale Availability 能确保关键任务应用程序在遇到意外停机时能够持续正常运行，作为一款商业产品已经足够强大。</p>
<blockquote>
<p>记录 infoscale 7.0.1 安装部署心得</p>
</blockquote>
<hr>
<h2 id="更新记录"><a href="#更新记录" class="headerlink" title="更新记录"></a>更新记录</h2><p>2017年04月14日 - 初稿</p>
<p>阅读原文 - <a href="https://wsgzao.github.io/post/infoscale/">https://wsgzao.github.io/post/infoscale/</a></p>
<p>扩展阅读</p>
<ul>
<li>Veritas - <a href="https://www.veritas.com/zh/cn/product/business-continuity/infoscale-availability" target="_blank" rel="external">https://www.veritas.com/zh/cn/product/business-continuity/infoscale-availability</a></li>
</ul>
<hr>
<h2 id="部署前准备"><a href="#部署前准备" class="headerlink" title="部署前准备"></a>部署前准备</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 编辑/etc/hosts</span></div><div class="line">vim /etc/hosts</div><div class="line">172.25.242.125    qrydb1</div><div class="line">172.25.242.126    qrydb2</div><div class="line"></div><div class="line"><span class="comment"># 编辑环境变量</span></div><div class="line">vim ~/.bash_profile</div><div class="line"></div><div class="line">PATH=<span class="variable">$PATH</span>:<span class="variable">$HOME</span>/bin:/opt/VRTS/bin:/opt/VRTSvxfs/sbin:/opt/VRTSvcs/bin</div><div class="line"></div><div class="line"><span class="comment"># 禁用部分服务</span></div><div class="line">service iptables stop</div><div class="line">chkconfig iptables off</div><div class="line">chkconfig --list iptables</div><div class="line">iptables        0:off   1:off   2:off   3:off   4:off   5:off   6:off</div><div class="line"></div><div class="line">service ip6tables stop</div><div class="line">chkconfig ip6tables off</div><div class="line">chkconfig --list ip6tables</div><div class="line">ip6tables       0:off   1:off   2:off   3:off   4:off   5:off   6:off</div><div class="line"></div><div class="line"><span class="comment"># 禁用cpuspeed服务</span></div><div class="line">chkconfig --level 12345 cpuspeed off</div><div class="line">chkconfig --list cpuspeed</div><div class="line">cpuspeed        0:off   1:off   2:off   3:off   4:off   5:off   6:off</div><div class="line"></div><div class="line"><span class="comment"># 禁用SELINUX服务</span></div><div class="line">vim /etc/selinux/config</div><div class="line"> </div><div class="line"><span class="comment"># This file controls the state of SELinux on the system.</span></div><div class="line"><span class="comment"># SELINUX= can take one of these three values:</span></div><div class="line"><span class="comment">#     enforcing - SELinux security policy is enforced.</span></div><div class="line"><span class="comment">#     permissive - SELinux prints warnings instead of enforcing.</span></div><div class="line"><span class="comment">#     disabled - No SELinux policy is loaded.</span></div><div class="line">SELINUX=disabled</div><div class="line"><span class="comment"># SELINUXTYPE= can take one of these two values:</span></div><div class="line"><span class="comment">#     targeted - Targeted processes are protected,</span></div><div class="line"><span class="comment">#     mls - Multi Level Security protection.</span></div><div class="line">SELINUXTYPE=targeted </div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># 系统优化调整</span></div><div class="line"></div><div class="line"><span class="comment"># 针对数据库环境，需要把grub.con中添加elevator设置为deadline</span></div><div class="line">vim /etc/grub.conf</div><div class="line"></div><div class="line"><span class="comment"># grub.conf generated by anaconda</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Note that you do not have to rerun grub after making changes to this file</span></div><div class="line"><span class="comment"># NOTICE:  You have a /boot partition.  This means that</span></div><div class="line"><span class="comment">#          all kernel and initrd paths are relative to /boot/, eg.</span></div><div class="line"><span class="comment">#          root (hd0,0)</span></div><div class="line"><span class="comment">#          kernel /vmlinuz-version ro root=/dev/mapper/VolGroup-lv_root</span></div><div class="line"><span class="comment">#          initrd /initrd-[generic-]version.img</span></div><div class="line"><span class="comment">#boot=/dev/sda</span></div><div class="line">default=0</div><div class="line">timeout=5</div><div class="line">splashimage=(hd0,0)/grub/splash.xpm.gz</div><div class="line">hiddenmenu</div><div class="line">title Red Hat Enterprise Linux 6 (2.6.32-573.el6.x86_64)</div><div class="line">        root (hd0,0)</div><div class="line">        kernel /vmlinuz-2.6.32-573.el6.x86_64 ro root=/dev/mapper/VolGroup-lv_root rd_NO_LUKS LANG=en_US.UTF-8 rd_NO_MD rd_LVM_LV=VolGroup/lv_swap SYSFONT=latarcyrheb-sun16 crashkernel=768M rd_LVM_LV=VolGroup/lv_root  KEYBOARDTYPE=pc KEYTABLE=us rd_NO_DM rhgb quiet transparent_hugepage=never elevator=deadline</div><div class="line">        initrd /initramfs-2.6.32-573.el6.x86_64.img</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># sysctl.conf文件检查及调整</span></div><div class="line">sysctl -a | grep -i hung</div><div class="line"></div><div class="line">kernel.hung_task_panic = 0</div><div class="line">kernel.hung_task_check_count = 4194304</div><div class="line">kernel.hung_task_timeout_secs = 120</div><div class="line">kernel.hung_task_warnings = 10</div><div class="line"></div><div class="line">vim /etc/sysctl.conf</div><div class="line"></div><div class="line">kernel.panic = 10</div></pre></td></tr></table></figure>
<h2 id="安装InfoScale-Enterprise-7-0及7-0-1MR包"><a href="#安装InfoScale-Enterprise-7-0及7-0-1MR包" class="headerlink" title="安装InfoScale Enterprise 7.0及7.0.1MR包"></a>安装InfoScale Enterprise 7.0及7.0.1MR包</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /tmp/sf</div><div class="line">mkdir base</div><div class="line">mv Veritas_InfoScale_7.0_RHEL.tar.gz base/</div><div class="line"><span class="built_in">cd</span> base</div><div class="line">tar -xzvf *</div><div class="line"><span class="built_in">cd</span> ..</div><div class="line">tar -xzvf cpi-Patch-7.0.1.500.tar.gz patches/</div><div class="line"><span class="built_in">cd</span> patches</div><div class="line">mv *.pl ../.</div><div class="line"><span class="built_in">cd</span> ..</div><div class="line">tar -xzvf infoscale-rhel6_x86_64-MR-7.0.1.tar.gz</div><div class="line"><span class="built_in">cd</span> rhel6_x86_64</div><div class="line">./installmr -require /tmp/sf/CPI_7.0.1_P5.pl -base_path /tmp/sf/base/dvd1-redhatlinux/rhel6_x86_64</div><div class="line"></div><div class="line">Task Menu:</div><div class="line"></div><div class="line">    P) Perform a Pre-Installation Check     I) Install a Product</div><div class="line">    G) Upgrade a Product                    ?) Help</div><div class="line"></div><div class="line">Enter a Task: [P,I,G,?] p</div><div class="line"></div><div class="line">     1)  Veritas InfoScale Foundation</div><div class="line">     2)  Veritas InfoScale Availability</div><div class="line">     3)  Veritas InfoScale Storage</div><div class="line">     4)  Veritas InfoScale Enterprise</div><div class="line">     b)  Back to previous menu</div><div class="line"></div><div class="line">Select a product to perform pre-installation check <span class="keyword">for</span>: [1-4,b,q] 4</div><div class="line"></div><div class="line">     1)  Cluster Server (VCS)</div><div class="line">     2)  Storage Foundation (SF)</div><div class="line">     3)  Storage Foundation and High Availability (SFHA)</div><div class="line">     4)  Storage Foundation Cluster File System HA (SFCFSHA)</div><div class="line">     5)  Storage Foundation <span class="keyword">for</span> Oracle RAC (SF Oracle RAC)</div><div class="line">     6)  Storage Foundation <span class="keyword">for</span> Sybase ASE CE (SFSYBASECE)</div><div class="line"></div><div class="line">Select a component to perform pre-installation check <span class="keyword">for</span>: [1-6,q] 5</div><div class="line">Enter the system names separated by spaces: [q,?] qrydb1 qrydb2</div><div class="line"></div><div class="line">Would you like the installer to setup ssh or rsh communication automatically between the systems?</div><div class="line">Superuser passwords <span class="keyword">for</span> the systems will be asked. [y,n,q,?] (y) </div><div class="line"></div><div class="line">Enter the superuser password <span class="keyword">for</span> system qrydb2: </div><div class="line"></div><div class="line">     1)  Setup ssh between the systems</div><div class="line">     2)  Setup rsh between the systems</div><div class="line">     b)  Back to previous menu</div><div class="line"></div><div class="line">Select the communication method [1-2,b,q,?] (1) </div><div class="line"></div><div class="line">Would you like to install InfoScale Enterprise on qrydb1 qrydb2? [y,n,q] (n) y</div><div class="line"></div><div class="line">This product may contain open <span class="built_in">source</span> and other third party materials that are subject to a separate license. See the applicable Third-Party Notice at http://www.symantec.com/about/profile/policies/eulas</div><div class="line"></div><div class="line">Do you agree with the terms of the End User License Agreement as specified <span class="keyword">in</span> the EULA/en/EULA_InfoScale_Ux_7.0.pdf file under /tmp/sf/base/dvd1-redhatlinux/rhel6_x86_64? [y,n,q,?] y</div><div class="line"></div><div class="line">Systems have difference <span class="keyword">in</span> clock by more than 5 seconds</div><div class="line"></div><div class="line">System clocks can be synchronized using one or more Network Time Protocol (NTP) servers</div><div class="line"></div><div class="line">Do you want to synchronize system clocks with NTP server(s)? [y,n,q] (y) n</div><div class="line"></div><div class="line">     1)  Enter a valid license key</div><div class="line">     2)  Enable keyless licensing and complete system licensing later</div><div class="line"></div><div class="line">How would you like to license the systems? [1-2,q] (2) </div><div class="line"></div><div class="line">     1)  Veritas InfoScale Foundation</div><div class="line">     2)  Veritas InfoScale Availability</div><div class="line">     3)  Veritas InfoScale Storage</div><div class="line">     4)  Veritas InfoScale Enterprise</div><div class="line">     b)  Back to previous menu</div><div class="line"></div><div class="line">Which product would you like to register? [1-4,b,q] (4) </div><div class="line"></div><div class="line">     1)  Configure SF Oracle RAC sub-components</div><div class="line">     2)  Prepare to Install Oracle</div><div class="line">     3)  Install Oracle Clusterware/Grid Infrastructure and Database</div><div class="line">     4)  Post Oracle Installation Tasks</div><div class="line">     5)  Exit SF Oracle RAC Configuration</div><div class="line"></div><div class="line">Choose option: [1-5,q] (1) 5</div><div class="line"></div><div class="line">Would you like to <span class="keyword">do</span> post SFRAC configuration checks? [y,n,q] (y) </div><div class="line"></div><div class="line">Do you want to cleanup the communication <span class="keyword">for</span> the systems qrydb2? [y,n,q] (n) </div><div class="line"></div><div class="line">installmr <span class="built_in">log</span> files, summary file, and response file are saved at:</div><div class="line"></div><div class="line">    /opt/VRTS/install/logs/installmr-201703141635Llz</div><div class="line"></div><div class="line">Would you like to view the summary file? [y,n,q] (n)</div></pre></td></tr></table></figure>
<h2 id="安装相关hotfix包"><a href="#安装相关hotfix包" class="headerlink" title="安装相关hotfix包"></a>安装相关hotfix包</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 安装aslapm包（两个节点同时操作）</span></div><div class="line"><span class="built_in">cd</span> /tmp/sf</div><div class="line">tar -xzvf VRTSaslapm*</div><div class="line"><span class="built_in">cd</span> RHEL6</div><div class="line">rpm -Uvh VRTSaslapm*</div><div class="line"></div><div class="line"><span class="comment"># 安装vxvm包（两个节点同时操作）</span></div><div class="line"><span class="built_in">cd</span> /tmp/sf</div><div class="line">rm -rf RHEL6</div><div class="line">tar -xzvf vm-rhel6*</div><div class="line"><span class="built_in">cd</span> rpms</div><div class="line">rpm -Uvh VRTSvxvm*</div><div class="line"></div><div class="line"><span class="comment"># 安装llt包（单个节点操作）</span></div><div class="line"><span class="built_in">cd</span> /tmp/sf</div><div class="line">tar -xzvf llt*</div><div class="line">./installVRTSllt701P400</div><div class="line"></div><div class="line">Enter the system names separated by spaces: [q,?] (qrydb1) qrydb1 qrydb2</div><div class="line"></div><div class="line">Do you want to <span class="built_in">continue</span>? [y,n,q] (y) </div><div class="line"></div><div class="line">All InfoScale Enterprise processes that are currently running must be stopped</div><div class="line"></div><div class="line">Do you want to stop InfoScale Enterprise processes now? [y,n,q,?] (y) </div><div class="line"></div><div class="line">Would you like to view the summary file? [y,n,q] (n) </div><div class="line"></div><div class="line"><span class="comment"># 安装vxfs包（两个节点同时操作）</span></div><div class="line"><span class="built_in">cd</span> /tmp/sf</div><div class="line">tar -xzvf fs*</div><div class="line"><span class="built_in">cd</span> rpms</div><div class="line">rpm -Uvh VRTSvxfs*</div><div class="line"></div><div class="line"><span class="comment"># 安装vcs包（两个节点同时操作）</span></div><div class="line"><span class="built_in">cd</span> /tmp/sf</div><div class="line">tar -xzvf vcs-*</div><div class="line">/opt/VRTSvcs/bin/CmdServer -stop</div><div class="line">cp /etc/VRTSvcs/conf/config/types.cf /etc/VRTSvcs/conf/config/types.cf.orig</div><div class="line">cp /etc/VRTSvcs/conf/config/main.cf /etc/VRTSvcs/conf/config/main.cf.orig</div><div class="line"><span class="built_in">cd</span> rpms</div><div class="line">rpm -Uvh VRTSvcs*</div><div class="line"></div><div class="line"><span class="comment"># 安装Java GUI包（两个节点同时操作）</span></div><div class="line"><span class="built_in">cd</span> /tmp/sf</div><div class="line">tar -xzvf VCS_C*</div><div class="line">rpm -ivh VRTScscm*</div></pre></td></tr></table></figure>
<h2 id="重启前配置及检查"><a href="#重启前配置及检查" class="headerlink" title="重启前配置及检查"></a>重启前配置及检查</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Linux平台（所有节点）修改/etc/init.d/vxvm-recover,去掉除Stopping $daemon...外其他所有的vxrelocd字段</span></div><div class="line">vim /etc/init.d/vxvm-recover</div><div class="line"></div><div class="line"><span class="comment">#       $CHECKPROC "vxrelocd"</span></div><div class="line"><span class="comment">#       if [ $? != 0 ]</span></div><div class="line"><span class="comment">#       then</span></div><div class="line"><span class="comment">#               echo -n "Starting vxrelocd..."</span></div><div class="line"><span class="comment">#               vxrelocd root &amp;</span></div><div class="line"><span class="comment">#               sleep 1</span></div><div class="line"><span class="comment">#               pid="$(pids_pidof "vxrelocd")"</span></div><div class="line"><span class="comment">#               if [ ! -z "$pid" ]</span></div><div class="line"><span class="comment">#               then</span></div><div class="line"><span class="comment">#                       echo "  [ OK ]"</span></div><div class="line"><span class="comment">#               else</span></div><div class="line"><span class="comment">#                       echo "  [ FAILED ]"</span></div><div class="line"><span class="comment">#               fi</span></div><div class="line"><span class="comment">#       else</span></div><div class="line"><span class="comment">#               echo "vxrelocd already running..."</span></div><div class="line"><span class="comment">#       fi</span></div><div class="line"></div><div class="line"><span class="comment"># 修改tunefstab文件</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"system_default dalloc_enable=0,pdir_enable=0"</span> &gt; /etc/vx/tunefstab</div><div class="line"></div><div class="line"><span class="comment"># 修改vcsenv文件</span></div><div class="line">vim /opt/VRTSvcs/bin/vcsenv </div><div class="line"></div><div class="line">VCS_GAB_RMACTION=<span class="string">"panic"</span></div><div class="line"><span class="built_in">export</span> VCS_GAB_RMACTION</div><div class="line"></div><div class="line">VCS_GAB_TIMOUT=15000</div><div class="line"><span class="built_in">export</span> VCS_GAB_TIMEOUT</div><div class="line"></div><div class="line"><span class="comment"># 检查相关软件包版本</span></div><div class="line">rpm -qa|grep -i vrts</div><div class="line">VRTSvcs-7.0.1.101-RHEL6.x86_64</div><div class="line">VRTSperl-5.20.1.2-RHEL6.x86_64</div><div class="line">VRTSamf-7.0.1.000-RHEL6.x86_64</div><div class="line">VRTSdbac-7.0.1.000-RHEL6.x86_64</div><div class="line">VRTSvxvm-7.0.1.003-RHEL6.x86_64</div><div class="line">VRTSvcsag-7.0.1.000-RHEL6.x86_64</div><div class="line">VRTSsfcpi-7.0.1.000-GENERIC.noarch</div><div class="line">VRTSllt-7.0.1.400-RHEL6.x86_64</div><div class="line">VRTSodm-7.0.0.000-RHEL6.x86_64</div><div class="line">VRTSgab-7.0.1.000-RHEL6.x86_64</div><div class="line">VRTScps-7.0.1.000-RHEL6.i686</div><div class="line">VRTSglm-7.0.1.000-RHEL6.x86_64</div><div class="line">VRTSvbs-7.0.0.000-Linux.i686</div><div class="line">VRTSvcswiz-7.0.1.000-RHEL6.x86_64</div><div class="line">VRTSvxfs-7.0.1.003-RHEL6.x86_64</div><div class="line">VRTSgms-7.0.0.000-RHEL6.x86_64</div><div class="line">VRTSspt-7.0.1.000-RHEL6.noarch</div><div class="line">VRTSdbed-7.0.1.000-RHEL.x86_64</div><div class="line">VRTSsfmh-7.0.0.0-0.x86_64</div><div class="line">VRTSaslapm-7.0.1.200-RHEL6.x86_64</div><div class="line">VRTSvlic-3.02.70.008-RHEL6.x86_64</div><div class="line">VRTSfsadv-7.0.1.000-RHEL6.x86_64</div><div class="line">VRTSvcsea-7.0.1.000-RHEL6.x86_64</div><div class="line">VRTScscm-6.0.100.000-GA_GENERIC.noarch</div><div class="line">VRTSvxfen-7.0.1.000-RHEL6.x86_64</div><div class="line">VRTScavf-7.0.1.000-RHEL6.i686</div><div class="line"></div><div class="line"><span class="comment"># 重启所有安装节点</span></div><div class="line">shutdown -r now</div></pre></td></tr></table></figure>
<h2 id="配置集群"><a href="#配置集群" class="headerlink" title="配置集群"></a>配置集群</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /opt/VRTS/install</div><div class="line">./installer -configure</div><div class="line"></div><div class="line"></div><div class="line">     1)  Cluster Server (VCS)</div><div class="line">     2)  Storage Foundation (SF)</div><div class="line">     3)  Storage Foundation and High Availability (SFHA)</div><div class="line">     4)  Storage Foundation Cluster File System HA (SFCFSHA)</div><div class="line">     5)  Storage Foundation <span class="keyword">for</span> Oracle RAC (SF Oracle RAC)</div><div class="line">     6)  Storage Foundation <span class="keyword">for</span> Sybase ASE CE (SFSYBASECE)</div><div class="line"></div><div class="line">Select a component to configure: [1-6,q] 5</div><div class="line"></div><div class="line">Enter the system names separated by spaces: [q,?] qrydb1 qrydb2</div><div class="line"></div><div class="line">Do you want to synchronize system clocks with NTP server(s)? [y,n,q] (y) n</div><div class="line"></div><div class="line">     1)  Configure SF Oracle RAC sub-components</div><div class="line">     2)  Prepare to Install Oracle</div><div class="line">     3)  Install Oracle Clusterware/Grid Infrastructure and Database</div><div class="line">     4)  Post Oracle Installation Tasks</div><div class="line">     5)  Exit SF Oracle RAC Configuration</div><div class="line"></div><div class="line">Choose option: [1-5,q] (1) </div><div class="line"></div><div class="line">Press [Enter] to <span class="built_in">continue</span>: </div><div class="line"></div><div class="line">Enter the unique cluster name: [q,?] qrydb_cluster</div><div class="line"></div><div class="line">     1)  Configure the heartbeat links using LLT over Ethernet</div><div class="line">     2)  Configure the heartbeat links using LLT over UDP</div><div class="line">     3)  Configure the heartbeat links using LLT over RDMA</div><div class="line">     4)  Automatically detect configuration <span class="keyword">for</span> LLT over Ethernet</div><div class="line">     b)  Back to previous menu</div><div class="line"></div><div class="line">How would you like to configure heartbeat links? [1-4,b,q,?] (4) 1</div><div class="line"></div><div class="line">Enter the NIC <span class="keyword">for</span> the first private heartbeat link on qrydb1: [b,q,?] (bond1) eth8</div><div class="line"></div><div class="line">Enter the NIC <span class="keyword">for</span> the second private heartbeat link on qrydb1: [b,q,?] (bond1) eth4</div><div class="line"></div><div class="line">Would you like to configure a third private heartbeat link? [y,n,q,b,?] (n) </div><div class="line"></div><div class="line">Are you using the same NICs <span class="keyword">for</span> private heartbeat links on all systems? [y,n,q,b,?] (y) </div><div class="line"></div><div class="line">Enter a unique cluster ID number between 0-65535: [b,q,?] (58763) 4142</div><div class="line"></div><div class="line">Would you like to check <span class="keyword">if</span> the cluster ID is <span class="keyword">in</span> use by another cluster? [y,n,q] (y) </div><div class="line"></div><div class="line">Press [Enter] to <span class="built_in">continue</span>: </div><div class="line"></div><div class="line">Cluster information verification:</div><div class="line"></div><div class="line">    Cluster Name:      qrydb_cluster</div><div class="line">    Cluster ID Number: 4142</div><div class="line"></div><div class="line">    Private Heartbeat NICs <span class="keyword">for</span> qrydb1: </div><div class="line">        link1=eth8</div><div class="line">        link2=eth4</div><div class="line"></div><div class="line">    Private Heartbeat NICs <span class="keyword">for</span> qrydb2: </div><div class="line">        link1=eth8</div><div class="line">        link2=eth4</div><div class="line"></div><div class="line">Is this information correct? [y,n,q,?] (y) </div><div class="line"></div><div class="line">Do you want to configure the Virtual IP? [y,n,q,?] (n) </div><div class="line"></div><div class="line">Would you like to configure the VCS cluster <span class="keyword">in</span> secure mode? [y,n,q,?] (y) n</div><div class="line"></div><div class="line">Are you sure that you want to proceed with non-secure installation? [y,n,q] (n) y</div><div class="line"></div><div class="line">Do you wish to accept the default cluster credentials of <span class="string">'admin/password'</span>? [y,n,q] (y) </div><div class="line"></div><div class="line">Do you want to add another user to the cluster? [y,n,q] (n) </div><div class="line"></div><div class="line">VCS User verification:</div><div class="line"></div><div class="line">    User: admin     Privilege: Administrators</div><div class="line"></div><div class="line">    Passwords are not displayed</div><div class="line"></div><div class="line">Is this information correct? [y,n,q] (y) </div><div class="line"></div><div class="line">Do you want to configure SMTP notification? [y,n,q,?] (n) </div><div class="line"></div><div class="line">Do you want to configure SNMP notification? [y,n,q,?] (n) </div><div class="line"></div><div class="line">Do you want to configure the Global Cluster Option? [y,n,q,?] (n) </div><div class="line"></div><div class="line">Do you want to stop InfoScale Enterprise processes now? [y,n,q,?] (y) </div><div class="line"></div><div class="line">Press [Enter] to <span class="built_in">continue</span>: </div><div class="line"></div><div class="line">Would you like to <span class="keyword">do</span> post SFRAC configuration checks? [y,n,q] (y) </div><div class="line"></div><div class="line">Would you like to view the summary file? [y,n,q] (n) </div><div class="line"></div><div class="line"><span class="comment"># 检查配置后的HA状态</span></div><div class="line">qrydb1@NH/opt/VRTS/install<span class="comment">#/opt/VRTSvcs/bin/hastatus -sum</span></div><div class="line"></div><div class="line">-- SYSTEM STATE</div><div class="line">-- System               State                Frozen              </div><div class="line"></div><div class="line">A  qrydb1               RUNNING              0                    </div><div class="line">A  qrydb2               RUNNING              0                    </div><div class="line"></div><div class="line">-- GROUP STATE</div><div class="line">-- Group           System               Probed     AutoDisabled    State          </div><div class="line"></div><div class="line">B  cvm             qrydb1               Y          N               ONLINE         </div><div class="line">B  cvm             qrydb2               Y          N               ONLINE</div></pre></td></tr></table></figure>
<h2 id="配置I-O-Fencing"><a href="#配置I-O-Fencing" class="headerlink" title="配置I/O Fencing"></a>配置I/O Fencing</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 创建vxfendg（集群中的一个节点操作）</span></div><div class="line">qrydb1@NH/root<span class="comment">#vxdisk list</span></div><div class="line">DEVICE       TYPE            DISK         GROUP        STATUS</div><div class="line">disk_0       auto:LVM        -            -            online invalid</div><div class="line">huawei-xsg10_0 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_1 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_2 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_3 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_4 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_5 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_6 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_7 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_8 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_9 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_10 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_11 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_12 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_13 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_14 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_15 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_16 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_17 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_18 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_19 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_20 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_21 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_22 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_23 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_24 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_25 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_26 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_27 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_28 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_29 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_30 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_31 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_32 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_33 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_34 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_35 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_36 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_37 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_38 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_39 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_40 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_41 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_42 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_43 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_44 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_45 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_46 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_47 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_48 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_49 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_50 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_51 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_52 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_53 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_54 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_55 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_56 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_57 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_58 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_59 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_60 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_61 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_62 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_63 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_64 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_65 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_66 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_67 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_68 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_69 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_70 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_71 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_72 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_73 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_74 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_75 auto:none       -            -            online invalid</div><div class="line">huawei-xsg10_76 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_0 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_1 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_2 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_3 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_4 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_5 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_6 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_7 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_8 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_9 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_10 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_11 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_12 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_13 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_14 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_15 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_16 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_17 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_18 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_19 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_20 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_21 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_22 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_23 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_24 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_25 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_26 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_27 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_28 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_29 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_30 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_31 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_32 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_33 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_34 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_35 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_36 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_37 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_38 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_39 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_40 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_41 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_42 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_43 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_44 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_45 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_46 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_47 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_48 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_49 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_50 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_51 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_52 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_53 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_54 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_55 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_56 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_57 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_58 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_59 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_60 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_61 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_62 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_63 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_64 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_65 auto:none       -            -            online invalid</div><div class="line">huawei-xsg11_66 auto:none       -            -            online invalid</div><div class="line">qrydb1@NH/root<span class="comment">#</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># 初始化磁盘为online</span></div><div class="line">vxdisk list |grep -i huawei|awk <span class="string">'&#123;print "/etc/vx/bin/vxdisksetup -i "$1&#125;'</span>|sh</div><div class="line"></div><div class="line"><span class="comment"># 选择大小为1G的磁盘作为仲裁盘</span></div><div class="line">qrydb1@NH/root<span class="comment">#lsblk | grep "1G"</span></div><div class="line">sdma                            69:288   0     1G  0 disk </div><div class="line">sdme                            69:352   0     1G  0 disk </div><div class="line">sdmc                            69:320   0     1G  0 disk </div><div class="line">sdml                            69:464   0     1G  0 disk </div><div class="line">sdmm                            69:480   0     1G  0 disk </div><div class="line">sdmn                            69:496   0     1G  0 disk </div><div class="line">sdrr                           134:336   0     1G  0 disk </div><div class="line">sdrv                           134:400   0     1G  0 disk </div><div class="line">sdrt                           134:368   0     1G  0 disk </div><div class="line">sdva                            67:704   0     1G  0 disk </div><div class="line">sduz                            67:688   0     1G  0 disk </div><div class="line">sduy                            67:672   0     1G  0 disk </div><div class="line">sdaap                          132:720   0     1G  0 disk </div><div class="line">sdaao                          132:704   0     1G  0 disk </div><div class="line">sdaan                          132:688   0     1G  0 disk </div><div class="line">sdagb                           69:944   0     1G  0 disk </div><div class="line">sdagc                           69:960   0     1G  0 disk </div><div class="line">sdagd                           69:976   0     1G  0 disk </div><div class="line">sdalp                          134:944   0     1G  0 disk </div><div class="line">sdalr                          134:976   0     1G  0 disk </div><div class="line">sdalq                          134:960   0     1G  0 disk </div><div class="line">sdard                           71:1200  0     1G  0 disk </div><div class="line">sdare                           71:1216  0     1G  0 disk </div><div class="line">sdarf                           71:1232  0     1G  0 disk </div><div class="line">VxDMP74                        201:1168  0     1G  0 disk </div><div class="line">VxDMP78                        201:1232  0     1G  0 disk </div><div class="line">VxDMP83                        201:1312  0     1G  0 disk</div><div class="line"></div><div class="line"><span class="comment"># 查看路径对应关系</span></div><div class="line">qrydb1@NH/root<span class="comment">#vxdmpadm getsubpaths | grep sdma</span></div><div class="line">sdma         ENABLED    SECONDARY    huawei-xsg10_71 huawei-xsg10 c2                -</div><div class="line">qrydb1@NH/root<span class="comment">#vxdmpadm getsubpaths | grep sdme</span></div><div class="line">sdme         ENABLED(A) PRIMARY      huawei-xsg10_73 huawei-xsg10 c2                -</div><div class="line">qrydb1@NH/root<span class="comment">#vxdmpadm getsubpaths | grep sdmc</span></div><div class="line">sdmc         ENABLED    SECONDARY    huawei-xsg10_72 huawei-xsg10 c2                -</div><div class="line"></div><div class="line"></div><div class="line">vxdg init vxfencoorddg vxfencoorddg01=huawei-xsg10_71 vxfencoorddg02=huawei-xsg10_72 vxfencoorddg03=huawei-xsg10_73</div><div class="line">vxdg -g vxfencoorddg <span class="built_in">set</span> coordinator=on</div><div class="line">vxdg deport vxfencoorddg</div><div class="line">vxdg -t import vxfencoorddg</div><div class="line">vxdg deport vxfencoorddg</div><div class="line"></div><div class="line"><span class="comment"># 测试仲裁盘可用性</span></div><div class="line">/opt/VRTSvcs/vxfen/bin/vxfentsthdw -g vxfencoorddg</div><div class="line"></div><div class="line">Do you still want to <span class="built_in">continue</span> : [y/n] (default: n) y</div><div class="line"></div><div class="line">Enter the first node of the cluster:</div><div class="line">qrydb1</div><div class="line">Enter the second node of the cluster:</div><div class="line">qrydb2</div><div class="line"></div><div class="line">ALL tests on the disk /dev/vx/rdmp/huawei-xsg10_73 have PASSED.</div><div class="line">The disk is now ready to be configured <span class="keyword">for</span> I/O Fencing on node qrydb1.</div><div class="line"></div><div class="line">ALL tests on the disk /dev/vx/rdmp/huawei-xsg10_73 have PASSED.</div><div class="line">The disk is now ready to be configured <span class="keyword">for</span> I/O Fencing on node qrydb2.</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># 配置I/O Fencing</span></div><div class="line"><span class="built_in">cd</span> /opt/VRTS/install</div><div class="line">./installer -fencing</div><div class="line"></div><div class="line">Enter the name of one system <span class="keyword">in</span> the VCS cluster <span class="keyword">for</span> <span class="built_in">which</span> you would like to configure I/O fencing: qrydb1 qrydb2</div><div class="line"></div><div class="line">Cluster information verification:</div><div class="line"></div><div class="line">    Cluster Name: qrydb_cluster</div><div class="line"></div><div class="line">    Cluster ID Number: 4142</div><div class="line"></div><div class="line">    Systems: qrydb1 qrydb2</div><div class="line"></div><div class="line">Would you like to configure I/O fencing on the cluster? [y,n,q] (y) </div><div class="line"></div><div class="line">Fencing configuration</div><div class="line">     1)  Configure Coordination Point client based fencing</div><div class="line">     2)  Configure disk based fencing</div><div class="line">     3)  Configure fencing <span class="keyword">in</span> disabled mode</div><div class="line"></div><div class="line">Select the fencing mechanism to be configured <span class="keyword">in</span> this Application Cluster: [1-3,q,?] 2</div><div class="line"></div><div class="line">This I/O fencing configuration option requires a restart of VCS. Installer will stop VCS at a later stage <span class="keyword">in</span> this run. Note that the service groups will be online only on the systems that are <span class="keyword">in</span> the <span class="string">'AutoStartList'</span> after </div><div class="line">restarting VCS. Do you want to <span class="built_in">continue</span>? [y,n,q,b,?] y</div><div class="line"></div><div class="line">Do you have SCSI3 PR enabled disks? [y,n,q,b,?] (y) </div><div class="line"></div><div class="line">Select one of the options below <span class="keyword">for</span> fencing disk group:</div><div class="line">     1)  Create a new disk group</div><div class="line">     2)  Using an existing disk group</div><div class="line">     b)  Back to previous menu</div><div class="line"></div><div class="line">Enter the choice <span class="keyword">for</span> a disk group: [1-2,b,q] 2</div><div class="line">     1)  vxfencoorddg(coordinator)</div><div class="line">     b)  Back to previous menu</div><div class="line"></div><div class="line">Select one disk group as fencing disk group: [1-1,b,q] 1</div><div class="line"></div><div class="line">As per the <span class="string">'vxfentsthdw'</span> run you performed, <span class="keyword">do</span> you want to <span class="built_in">continue</span> with this disk group? [y,n,q] (y) </div><div class="line"></div><div class="line">I/O fencing configuration verification</div><div class="line"></div><div class="line">    Disk Group: vxfencoorddg</div><div class="line"></div><div class="line">    Fencing disk policy: dmp</div><div class="line"></div><div class="line">Is this information correct? [y,n,q] (y) </div><div class="line"></div><div class="line">HAD and all the applications will be stopped. Do you want to stop VCS and all its applications and apply fencing configuration on all nodes at this point? [y,n,q] (y) </div><div class="line"></div><div class="line">Do you want to configure Coordination Point Agent on the client cluster? [y,n,q] (y) </div><div class="line">Enter a non-existing name <span class="keyword">for</span> the service group <span class="keyword">for</span> Coordination Point Agent: [b] (vxfen) </div><div class="line"></div><div class="line">Do you want to <span class="built_in">set</span> LevelTwoMonitorFreq? [y,n,q] (y) </div><div class="line">Enter the value of the LevelTwoMonitorFreq attribute(0 to 65535): [b,q,?] (5) </div><div class="line"></div><div class="line">Would you like to view the summary file? [y,n,q] (n)</div><div class="line"></div><div class="line"><span class="comment"># 配置完成后会在HA中多一个vxfen的服务组</span></div><div class="line">qrydb1@NH/opt/VRTS/install<span class="comment">#hastatus -sum</span></div><div class="line"></div><div class="line">-- SYSTEM STATE</div><div class="line">-- System               State                Frozen              </div><div class="line"></div><div class="line">A  qrydb1               RUNNING              0                    </div><div class="line">A  qrydb2               RUNNING              0                    </div><div class="line"></div><div class="line">-- GROUP STATE</div><div class="line">-- Group           System               Probed     AutoDisabled    State          </div><div class="line"></div><div class="line">B  cvm             qrydb1               Y          N               ONLINE         </div><div class="line">B  cvm             qrydb2               Y          N               ONLINE         </div><div class="line">B  vxfen           qrydb1               Y          N               ONLINE         </div><div class="line">B  vxfen           qrydb2               Y          N               ONLINE</div></pre></td></tr></table></figure>
<h2 id="创建磁盘组、卷和文件系统"><a href="#创建磁盘组、卷和文件系统" class="headerlink" title="创建磁盘组、卷和文件系统"></a>创建磁盘组、卷和文件系统</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 格式化数据磁盘（集群中的一个节点操作）</span></div><div class="line">vxdisk list | grep -i huawei|awk <span class="string">'&#123;print "/etc/vx/bin/vxdisksetup -i "$1&#125;'</span>|sh</div><div class="line"></div><div class="line"><span class="comment"># /etc/vx/bin/vxdisksetup -i huawei-xsg11_76</span></div><div class="line"><span class="comment"># /etc/vx/bin/vxdisksetup -i huawei-xsg11_77</span></div><div class="line"><span class="comment"># /etc/vx/bin/vxdisksetup -i huawei-xsg11_78</span></div><div class="line"><span class="comment"># /etc/vx/bin/vxdisksetup -i huawei…….</span></div><div class="line"></div><div class="line"><span class="comment"># 创建磁盘组</span></div><div class="line"></div><div class="line"><span class="comment"># 技巧，利用excel统计磁盘和容量的对应关系</span></div><div class="line">vxdisk list</div><div class="line">vxdisk list | grep huawei | awk <span class="string">'&#123;print "/sbin/vxdisk list " $1&#125;'</span> | sh | grep public</div><div class="line"><span class="comment"># 删除dg</span></div><div class="line">vxdg destroy [dgname]</div><div class="line"></div><div class="line"><span class="comment">#ocrvotedg（每个盘10G）</span></div><div class="line">vxdg -s init ocrvotedg ocrvotedg01=huawei-xsg10_74</div><div class="line">vxdg -g ocrvotedg adddisk ocrvotedg02=huawei-xsg10_75 </div><div class="line">vxdg -g ocrvotedg adddisk ocrvotedg03=huawei-xsg10_76 </div><div class="line">vxdg -g ocrvotedg adddisk ocrvotedg01_1=huawei-xsg11_64</div><div class="line">vxdg -g ocrvotedg adddisk ocrvotedg02_1=huawei-xsg11_65</div><div class="line">vxdg -g ocrvotedg adddisk ocrvotedg03_1=huawei-xsg11_66</div><div class="line">vxdg -g ocrvotedg <span class="built_in">set</span> diskdetpolicy=<span class="built_in">local</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#qrydbbkdg（rmanbk每个盘500G）</span></div><div class="line">vxdg init qrydbbkdg qrydbbkdg01=huawei-xsg10_66</div><div class="line">vxdg -g qrydbbkdg adddisk qrydbbkdg02=huawei-xsg10_67</div><div class="line">vxdg -g qrydbbkdg adddisk qrydbbkdg03=huawei-xsg10_68</div><div class="line">vxdg -g qrydbbkdg adddisk qrydbbkdg04=huawei-xsg10_69</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#qrydbdumpdg(每个盘500G)</span></div><div class="line">vxdg init qrydbdumpdg qrydbdumpdg01=huawei-xsg10_64</div><div class="line">vxdg -g qrydbdumpdg adddisk qrydbdumpdg02=huawei-xsg10_65</div><div class="line"></div><div class="line"><span class="comment">#qrydbdsgdg（每个盘500G）</span></div><div class="line">vxdg init qrydbdsgdg qrydbdsgdg01=huawei-xsg10_70</div><div class="line"></div><div class="line"><span class="comment">#qrydbdatadg（每个盘200G）</span></div><div class="line">vxdg -s init qrydbdatadg qrydbdatadg01=huawei-xsg10_0</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg02=huawei-xsg10_1</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg02=huawei-xsg10_1</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg03=huawei-xsg10_2</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg04=huawei-xsg10_3</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg05=huawei-xsg10_4</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg06=huawei-xsg10_5</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg07=huawei-xsg10_6</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg08=huawei-xsg10_7</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg09=huawei-xsg10_8</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg10=huawei-xsg10_9</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg11=huawei-xsg10_10</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg12=huawei-xsg10_11</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg13=huawei-xsg10_12</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg14=huawei-xsg10_13</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg15=huawei-xsg10_14</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg16=huawei-xsg10_15</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg17=huawei-xsg10_16</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg18=huawei-xsg10_17</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg19=huawei-xsg10_18</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg20=huawei-xsg10_19</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg21=huawei-xsg10_20</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg22=huawei-xsg10_21</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg23=huawei-xsg10_22</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg24=huawei-xsg10_23</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg25=huawei-xsg10_24</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg26=huawei-xsg10_25</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg27=huawei-xsg10_26</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg28=huawei-xsg10_27</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg29=huawei-xsg10_28</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg30=huawei-xsg10_29</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg31=huawei-xsg10_30</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg32=huawei-xsg10_31</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg33=huawei-xsg10_32</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg34=huawei-xsg10_33</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg35=huawei-xsg10_34</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg36=huawei-xsg10_35</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg37=huawei-xsg10_36</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg38=huawei-xsg10_37</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg39=huawei-xsg10_38</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg40=huawei-xsg10_39</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg01_1=huawei-xsg11_0</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg02_1=huawei-xsg11_1</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg02_1=huawei-xsg11_1</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg03_1=huawei-xsg11_2</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg04_1=huawei-xsg11_3</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg05_1=huawei-xsg11_4</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg06_1=huawei-xsg11_5</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg07_1=huawei-xsg11_6</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg08_1=huawei-xsg11_7</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg09_1=huawei-xsg11_8</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg10_1=huawei-xsg11_9</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg11_1=huawei-xsg11_10</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg12_1=huawei-xsg11_11</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg13_1=huawei-xsg11_12</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg14_1=huawei-xsg11_13</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg15_1=huawei-xsg11_14</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg16_1=huawei-xsg11_15</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg17_1=huawei-xsg11_16</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg18_1=huawei-xsg11_17</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg19_1=huawei-xsg11_18</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg20_1=huawei-xsg11_19</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg21_1=huawei-xsg11_20</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg22_1=huawei-xsg11_21</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg23_1=huawei-xsg11_22</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg24_1=huawei-xsg11_23</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg25_1=huawei-xsg11_24</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg26_1=huawei-xsg11_25</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg27_1=huawei-xsg11_26</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg28_1=huawei-xsg11_27</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg29_1=huawei-xsg11_28</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg30_1=huawei-xsg11_29</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg31_1=huawei-xsg11_30</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg32_1=huawei-xsg11_31</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg33_1=huawei-xsg11_32</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg34_1=huawei-xsg11_33</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg35_1=huawei-xsg11_34</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg36_1=huawei-xsg11_35</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg37_1=huawei-xsg11_36</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg38_1=huawei-xsg11_37</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg39_1=huawei-xsg11_38</div><div class="line">vxdg -g qrydbdatadg adddisk qrydbdatadg40_1=huawei-xsg11_39</div><div class="line">vxdg -g qrydbdatadg <span class="built_in">set</span> diskdetpolicy=<span class="built_in">local</span></div><div class="line"></div><div class="line"><span class="comment">#qrydbhistbizdg（每个盘500G）</span></div><div class="line">vxdg -s init qrydbhistbizdg qrydbhistbizdg01=huawei-xsg10_40</div><div class="line">vxdg -g qrydbhistbizdg adddisk qrydbhistbizdg02=huawei-xsg10_41 </div><div class="line">vxdg -g qrydbhistbizdg adddisk qrydbhistbizdg03=huawei-xsg10_42 </div><div class="line">vxdg -g qrydbhistbizdg adddisk qrydbhistbizdg04=huawei-xsg10_43 </div><div class="line">vxdg -g qrydbhistbizdg adddisk qrydbhistbizdg05=huawei-xsg10_44 </div><div class="line">vxdg -g qrydbhistbizdg adddisk qrydbhistbizdg06=huawei-xsg10_45 </div><div class="line">vxdg -g qrydbhistbizdg adddisk qrydbhistbizdg07=huawei-xsg10_46 </div><div class="line">vxdg -g qrydbhistbizdg adddisk qrydbhistbizdg08=huawei-xsg10_47 </div><div class="line">vxdg -g qrydbhistbizdg adddisk qrydbhistbizdg09=huawei-xsg10_48 </div><div class="line">vxdg -g qrydbhistbizdg adddisk qrydbhistbizdg10=huawei-xsg10_49 </div><div class="line">vxdg -g qrydbhistbizdg adddisk qrydbhistbizdg11=huawei-xsg10_50 </div><div class="line">vxdg -g qrydbhistbizdg adddisk qrydbhistbizdg12=huawei-xsg10_51 </div><div class="line">vxdg -g qrydbhistbizdg adddisk qrydbhistbizdg01_1=huawei-xsg11_40 </div><div class="line">vxdg -g qrydbhistbizdg adddisk qrydbhistbizdg02_1=huawei-xsg11_41 </div><div class="line">vxdg -g qrydbhistbizdg adddisk qrydbhistbizdg03_1=huawei-xsg11_42 </div><div class="line">vxdg -g qrydbhistbizdg adddisk qrydbhistbizdg04_1=huawei-xsg11_43 </div><div class="line">vxdg -g qrydbhistbizdg adddisk qrydbhistbizdg05_1=huawei-xsg11_44 </div><div class="line">vxdg -g qrydbhistbizdg adddisk qrydbhistbizdg06_1=huawei-xsg11_45 </div><div class="line">vxdg -g qrydbhistbizdg adddisk qrydbhistbizdg07_1=huawei-xsg11_46 </div><div class="line">vxdg -g qrydbhistbizdg adddisk qrydbhistbizdg08_1=huawei-xsg11_47 </div><div class="line">vxdg -g qrydbhistbizdg adddisk qrydbhistbizdg09_1=huawei-xsg11_48 </div><div class="line">vxdg -g qrydbhistbizdg adddisk qrydbhistbizdg10_1=huawei-xsg11_49 </div><div class="line">vxdg -g qrydbhistbizdg adddisk qrydbhistbizdg11_1=huawei-xsg11_50 </div><div class="line">vxdg -g qrydbhistbizdg adddisk qrydbhistbizdg12_1=huawei-xsg11_51 </div><div class="line">vxdg -g qrydbhistbizdg <span class="built_in">set</span> diskdetpolicy=<span class="built_in">local</span></div><div class="line"></div><div class="line"><span class="comment">#qrydbhistriskdg（每个盘500G）</span></div><div class="line">vxdg -s init qrydbhistriskdg qrydbhistriskdg01=huawei-xsg10_52</div><div class="line">vxdg -g qrydbhistriskdg adddisk qrydbhistriskdg02=huawei-xsg10_53</div><div class="line">vxdg -g qrydbhistriskdg adddisk qrydbhistriskdg03=huawei-xsg10_54</div><div class="line">vxdg -g qrydbhistriskdg adddisk qrydbhistriskdg04=huawei-xsg10_55</div><div class="line">vxdg -g qrydbhistriskdg adddisk qrydbhistriskdg05=huawei-xsg10_56</div><div class="line">vxdg -g qrydbhistriskdg adddisk qrydbhistriskdg06=huawei-xsg10_57</div><div class="line">vxdg -g qrydbhistriskdg adddisk qrydbhistriskdg07=huawei-xsg10_58</div><div class="line">vxdg -g qrydbhistriskdg adddisk qrydbhistriskdg08=huawei-xsg10_59</div><div class="line">vxdg -g qrydbhistriskdg adddisk qrydbhistriskdg09=huawei-xsg10_60</div><div class="line">vxdg -g qrydbhistriskdg adddisk qrydbhistriskdg10=huawei-xsg10_61</div><div class="line">vxdg -g qrydbhistriskdg adddisk qrydbhistriskdg11=huawei-xsg10_62</div><div class="line">vxdg -g qrydbhistriskdg adddisk qrydbhistriskdg12=huawei-xsg10_63</div><div class="line">vxdg -g qrydbhistriskdg adddisk qrydbhistriskdg01_1=huawei-xsg11_52 </div><div class="line">vxdg -g qrydbhistriskdg adddisk qrydbhistriskdg02_1=huawei-xsg11_53 </div><div class="line">vxdg -g qrydbhistriskdg adddisk qrydbhistriskdg03_1=huawei-xsg11_54 </div><div class="line">vxdg -g qrydbhistriskdg adddisk qrydbhistriskdg04_1=huawei-xsg11_55 </div><div class="line">vxdg -g qrydbhistriskdg adddisk qrydbhistriskdg05_1=huawei-xsg11_56 </div><div class="line">vxdg -g qrydbhistriskdg adddisk qrydbhistriskdg06_1=huawei-xsg11_57 </div><div class="line">vxdg -g qrydbhistriskdg adddisk qrydbhistriskdg07_1=huawei-xsg11_58 </div><div class="line">vxdg -g qrydbhistriskdg adddisk qrydbhistriskdg08_1=huawei-xsg11_59 </div><div class="line">vxdg -g qrydbhistriskdg adddisk qrydbhistriskdg09_1=huawei-xsg11_60 </div><div class="line">vxdg -g qrydbhistriskdg adddisk qrydbhistriskdg10_1=huawei-xsg11_61 </div><div class="line">vxdg -g qrydbhistriskdg adddisk qrydbhistriskdg11_1=huawei-xsg11_62 </div><div class="line">vxdg -g qrydbhistriskdg adddisk qrydbhistriskdg12_1=huawei-xsg11_63 </div><div class="line">vxdg -g qrydbhistriskdg <span class="built_in">set</span> diskdetpolicy=<span class="built_in">local</span></div><div class="line"></div><div class="line"></div><div class="line">qrydb1@NH/root<span class="comment">#vxdisk list</span></div><div class="line">DEVICE       TYPE            DISK         GROUP        STATUS</div><div class="line">disk_0       auto:LVM        -            -            online invalid</div><div class="line">huawei-xsg10_0 auto:cdsdisk    qrydbdatadg01  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_1 auto:cdsdisk    qrydbdatadg02  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_2 auto:cdsdisk    qrydbdatadg03  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_3 auto:cdsdisk    qrydbdatadg04  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_4 auto:cdsdisk    qrydbdatadg05  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_5 auto:cdsdisk    qrydbdatadg06  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_6 auto:cdsdisk    qrydbdatadg07  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_7 auto:cdsdisk    qrydbdatadg08  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_8 auto:cdsdisk    qrydbdatadg09  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_9 auto:cdsdisk    qrydbdatadg10  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_10 auto:cdsdisk    qrydbdatadg11  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_11 auto:cdsdisk    qrydbdatadg12  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_12 auto:cdsdisk    qrydbdatadg13  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_13 auto:cdsdisk    qrydbdatadg14  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_14 auto:cdsdisk    qrydbdatadg15  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_15 auto:cdsdisk    qrydbdatadg16  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_16 auto:cdsdisk    qrydbdatadg17  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_17 auto:cdsdisk    qrydbdatadg18  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_18 auto:cdsdisk    qrydbdatadg19  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_19 auto:cdsdisk    qrydbdatadg20  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_20 auto:cdsdisk    qrydbdatadg21  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_21 auto:cdsdisk    qrydbdatadg22  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_22 auto:cdsdisk    qrydbdatadg23  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_23 auto:cdsdisk    qrydbdatadg24  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_24 auto:cdsdisk    qrydbdatadg25  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_25 auto:cdsdisk    qrydbdatadg26  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_26 auto:cdsdisk    qrydbdatadg27  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_27 auto:cdsdisk    qrydbdatadg28  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_28 auto:cdsdisk    qrydbdatadg29  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_29 auto:cdsdisk    qrydbdatadg30  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_30 auto:cdsdisk    qrydbdatadg31  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_31 auto:cdsdisk    qrydbdatadg32  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_32 auto:cdsdisk    qrydbdatadg33  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_33 auto:cdsdisk    qrydbdatadg34  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_34 auto:cdsdisk    qrydbdatadg35  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_35 auto:cdsdisk    qrydbdatadg36  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_36 auto:cdsdisk    qrydbdatadg37  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_37 auto:cdsdisk    qrydbdatadg38  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_38 auto:cdsdisk    qrydbdatadg39  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_39 auto:cdsdisk    qrydbdatadg40  qrydbdatadg  online shared</div><div class="line">huawei-xsg10_40 auto:cdsdisk    qrydbhistbizdg01  qrydbhistbizdg online shared</div><div class="line">huawei-xsg10_41 auto:cdsdisk    qrydbhistbizdg02  qrydbhistbizdg online shared</div><div class="line">huawei-xsg10_42 auto:cdsdisk    qrydbhistbizdg03  qrydbhistbizdg online shared</div><div class="line">huawei-xsg10_43 auto:cdsdisk    qrydbhistbizdg04  qrydbhistbizdg online shared</div><div class="line">huawei-xsg10_44 auto:cdsdisk    qrydbhistbizdg05  qrydbhistbizdg online shared</div><div class="line">huawei-xsg10_45 auto:cdsdisk    qrydbhistbizdg06  qrydbhistbizdg online shared</div><div class="line">huawei-xsg10_46 auto:cdsdisk    qrydbhistbizdg07  qrydbhistbizdg online shared</div><div class="line">huawei-xsg10_47 auto:cdsdisk    qrydbhistbizdg08  qrydbhistbizdg online shared</div><div class="line">huawei-xsg10_48 auto:cdsdisk    qrydbhistbizdg09  qrydbhistbizdg online shared</div><div class="line">huawei-xsg10_49 auto:cdsdisk    qrydbhistbizdg10  qrydbhistbizdg online shared</div><div class="line">huawei-xsg10_50 auto:cdsdisk    qrydbhistbizdg11  qrydbhistbizdg online shared</div><div class="line">huawei-xsg10_51 auto:cdsdisk    qrydbhistbizdg12  qrydbhistbizdg online shared</div><div class="line">huawei-xsg10_52 auto:cdsdisk    qrydbhistriskdg01  qrydbhistriskdg online shared</div><div class="line">huawei-xsg10_53 auto:cdsdisk    qrydbhistriskdg02  qrydbhistriskdg online shared</div><div class="line">huawei-xsg10_54 auto:cdsdisk    qrydbhistriskdg03  qrydbhistriskdg online shared</div><div class="line">huawei-xsg10_55 auto:cdsdisk    qrydbhistriskdg04  qrydbhistriskdg online shared</div><div class="line">huawei-xsg10_56 auto:cdsdisk    qrydbhistriskdg05  qrydbhistriskdg online shared</div><div class="line">huawei-xsg10_57 auto:cdsdisk    qrydbhistriskdg06  qrydbhistriskdg online shared</div><div class="line">huawei-xsg10_58 auto:cdsdisk    qrydbhistriskdg07  qrydbhistriskdg online shared</div><div class="line">huawei-xsg10_59 auto:cdsdisk    qrydbhistriskdg08  qrydbhistriskdg online shared</div><div class="line">huawei-xsg10_60 auto:cdsdisk    qrydbhistriskdg09  qrydbhistriskdg online shared</div><div class="line">huawei-xsg10_61 auto:cdsdisk    qrydbhistriskdg10  qrydbhistriskdg online shared</div><div class="line">huawei-xsg10_62 auto:cdsdisk    qrydbhistriskdg11  qrydbhistriskdg online shared</div><div class="line">huawei-xsg10_63 auto:cdsdisk    qrydbhistriskdg12  qrydbhistriskdg online shared</div><div class="line">huawei-xsg10_64 auto:cdsdisk    qrydbdumpdg01  qrydbdumpdg  online</div><div class="line">huawei-xsg10_65 auto:cdsdisk    qrydbdumpdg02  qrydbdumpdg  online</div><div class="line">huawei-xsg10_66 auto:cdsdisk    qrydbbkdg01  qrydbbkdg    online</div><div class="line">huawei-xsg10_67 auto:cdsdisk    qrydbbkdg02  qrydbbkdg    online</div><div class="line">huawei-xsg10_68 auto:cdsdisk    qrydbbkdg03  qrydbbkdg    online</div><div class="line">huawei-xsg10_69 auto:cdsdisk    qrydbbkdg04  qrydbbkdg    online</div><div class="line">huawei-xsg10_70 auto:cdsdisk    qrydbdsgdg01  qrydbdsgdg   online</div><div class="line">huawei-xsg10_71 auto:cdsdisk    -            -            online</div><div class="line">huawei-xsg10_72 auto:cdsdisk    -            -            online</div><div class="line">huawei-xsg10_73 auto:cdsdisk    -            -            online</div><div class="line">huawei-xsg10_74 auto:cdsdisk    ocrvotedg01  ocrvotedg    online shared</div><div class="line">huawei-xsg10_75 auto:cdsdisk    ocrvotedg02  ocrvotedg    online shared</div><div class="line">huawei-xsg10_76 auto:cdsdisk    ocrvotedg03  ocrvotedg    online shared</div><div class="line">huawei-xsg11_0 auto:cdsdisk    qrydbdatadg01_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_1 auto:cdsdisk    qrydbdatadg02_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_2 auto:cdsdisk    qrydbdatadg03_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_3 auto:cdsdisk    qrydbdatadg04_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_4 auto:cdsdisk    qrydbdatadg05_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_5 auto:cdsdisk    qrydbdatadg06_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_6 auto:cdsdisk    qrydbdatadg07_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_7 auto:cdsdisk    qrydbdatadg08_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_8 auto:cdsdisk    qrydbdatadg09_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_9 auto:cdsdisk    qrydbdatadg10_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_10 auto:cdsdisk    qrydbdatadg11_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_11 auto:cdsdisk    qrydbdatadg12_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_12 auto:cdsdisk    qrydbdatadg13_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_13 auto:cdsdisk    qrydbdatadg14_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_14 auto:cdsdisk    qrydbdatadg15_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_15 auto:cdsdisk    qrydbdatadg16_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_16 auto:cdsdisk    qrydbdatadg17_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_17 auto:cdsdisk    qrydbdatadg18_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_18 auto:cdsdisk    qrydbdatadg19_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_19 auto:cdsdisk    qrydbdatadg20_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_20 auto:cdsdisk    qrydbdatadg21_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_21 auto:cdsdisk    qrydbdatadg22_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_22 auto:cdsdisk    qrydbdatadg23_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_23 auto:cdsdisk    qrydbdatadg24_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_24 auto:cdsdisk    qrydbdatadg25_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_25 auto:cdsdisk    qrydbdatadg26_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_26 auto:cdsdisk    qrydbdatadg27_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_27 auto:cdsdisk    qrydbdatadg28_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_28 auto:cdsdisk    qrydbdatadg29_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_29 auto:cdsdisk    qrydbdatadg30_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_30 auto:cdsdisk    qrydbdatadg31_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_31 auto:cdsdisk    qrydbdatadg32_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_32 auto:cdsdisk    qrydbdatadg33_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_33 auto:cdsdisk    qrydbdatadg34_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_34 auto:cdsdisk    qrydbdatadg35_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_35 auto:cdsdisk    qrydbdatadg36_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_36 auto:cdsdisk    qrydbdatadg37_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_37 auto:cdsdisk    qrydbdatadg38_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_38 auto:cdsdisk    qrydbdatadg39_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_39 auto:cdsdisk    qrydbdatadg40_1  qrydbdatadg  online shared</div><div class="line">huawei-xsg11_40 auto:cdsdisk    qrydbhistbizdg01_1  qrydbhistbizdg online shared</div><div class="line">huawei-xsg11_41 auto:cdsdisk    qrydbhistbizdg02_1  qrydbhistbizdg online shared</div><div class="line">huawei-xsg11_42 auto:cdsdisk    qrydbhistbizdg03_1  qrydbhistbizdg online shared</div><div class="line">huawei-xsg11_43 auto:cdsdisk    qrydbhistbizdg04_1  qrydbhistbizdg online shared</div><div class="line">huawei-xsg11_44 auto:cdsdisk    qrydbhistbizdg05_1  qrydbhistbizdg online shared</div><div class="line">huawei-xsg11_45 auto:cdsdisk    qrydbhistbizdg06_1  qrydbhistbizdg online shared</div><div class="line">huawei-xsg11_46 auto:cdsdisk    qrydbhistbizdg07_1  qrydbhistbizdg online shared</div><div class="line">huawei-xsg11_47 auto:cdsdisk    qrydbhistbizdg08_1  qrydbhistbizdg online shared</div><div class="line">huawei-xsg11_48 auto:cdsdisk    qrydbhistbizdg09_1  qrydbhistbizdg online shared</div><div class="line">huawei-xsg11_49 auto:cdsdisk    qrydbhistbizdg10_1  qrydbhistbizdg online shared</div><div class="line">huawei-xsg11_50 auto:cdsdisk    qrydbhistbizdg11_1  qrydbhistbizdg online shared</div><div class="line">huawei-xsg11_51 auto:cdsdisk    qrydbhistbizdg12_1  qrydbhistbizdg online shared</div><div class="line">huawei-xsg11_52 auto:cdsdisk    qrydbhistriskdg01_1  qrydbhistriskdg online shared</div><div class="line">huawei-xsg11_53 auto:cdsdisk    qrydbhistriskdg02_1  qrydbhistriskdg online shared</div><div class="line">huawei-xsg11_54 auto:cdsdisk    qrydbhistriskdg03_1  qrydbhistriskdg online shared</div><div class="line">huawei-xsg11_55 auto:cdsdisk    qrydbhistriskdg04_1  qrydbhistriskdg online shared</div><div class="line">huawei-xsg11_56 auto:cdsdisk    qrydbhistriskdg05_1  qrydbhistriskdg online shared</div><div class="line">huawei-xsg11_57 auto:cdsdisk    qrydbhistriskdg06_1  qrydbhistriskdg online shared</div><div class="line">huawei-xsg11_58 auto:cdsdisk    qrydbhistriskdg07_1  qrydbhistriskdg online shared</div><div class="line">huawei-xsg11_59 auto:cdsdisk    qrydbhistriskdg08_1  qrydbhistriskdg online shared</div><div class="line">huawei-xsg11_60 auto:cdsdisk    qrydbhistriskdg09_1  qrydbhistriskdg online shared</div><div class="line">huawei-xsg11_61 auto:cdsdisk    qrydbhistriskdg10_1  qrydbhistriskdg online shared</div><div class="line">huawei-xsg11_62 auto:cdsdisk    qrydbhistriskdg11_1  qrydbhistriskdg online shared</div><div class="line">huawei-xsg11_63 auto:cdsdisk    qrydbhistriskdg12_1  qrydbhistriskdg online shared</div><div class="line">huawei-xsg11_64 auto:cdsdisk    ocrvotedg01_1  ocrvotedg    online shared</div><div class="line">huawei-xsg11_65 auto:cdsdisk    ocrvotedg02_1  ocrvotedg    online shared</div><div class="line">huawei-xsg11_66 auto:cdsdisk    ocrvotedg03_1  ocrvotedg    online shared</div><div class="line"></div><div class="line"><span class="comment"># 创建卷</span></div><div class="line"><span class="comment"># ocrvotedg</span></div><div class="line">vxassist -g ocrvotedg make ocrvotevol01 19456000 layout=mirror ocrvotedg01 ocrvotedg01_1</div><div class="line">vxassist -g ocrvotedg make ocrvotevol02 19456000 ocrvotedg02</div><div class="line">vxassist -g ocrvotedg make ocrvotevol03 19456000 ocrvotedg02_1</div><div class="line">vxsnap -g ocrvotedg prepare ocrvotevol01 alloc=ocrvotedg01,ocrvotedg01_1</div><div class="line"></div><div class="line"><span class="comment"># qrydbbkdg</span></div><div class="line">vxassist -g qrydbbkdg make qrydbbkvol 1998G layout=stripe ncol=2 stripeunit=256</div><div class="line"></div><div class="line"><span class="comment"># qrydbdumpdg</span></div><div class="line">vxassist -g qrydbdumpdg make qrydbdumpvol 998G layout=stripe ncol=2 stripeunit=256</div><div class="line"></div><div class="line"><span class="comment"># qrydbdsgdg</span></div><div class="line">vxassist -g qrydbdsgdg make qrydbdsgvol 1048469696</div><div class="line"></div><div class="line"><span class="comment"># qrydbdatadg</span></div><div class="line">qrydb1@NH/root<span class="comment">#vxassist -g qrydbdatadg maxsize layout=mirror-stripe ncol=4 stripeunit=256 mirror=enclr</span></div><div class="line">Maximum volume size: 16773924864 (8190393Mb)</div><div class="line"></div><div class="line">vxassist -g qrydbdatadg make qrydbdatavol 7800G layout=mirror-stripe ncol=4 stripeunit=256 mirror=enclr</div><div class="line">vxsnap -g qrydbdatadg prepare qrydbdatavol alloc=qrydbdatadg40,qrydbdatadg40_1</div><div class="line">vxvol -g qrydbdatadg rdpol round qrydbdatavol</div><div class="line">vxvol -g qrydbdatadg rdpol round qrydbdatavol_dcl</div><div class="line"></div><div class="line"><span class="comment"># qrydbhistbizdg</span></div><div class="line">qrydb1@NH/root<span class="comment">#vxassist -g qrydbhistbizdg maxsize layout=mirror-stripe ncol=4 stripeunit=256 mirror=enclr</span></div><div class="line">Maximum volume size: 16773924864 (8190393Mb)</div><div class="line"></div><div class="line">vxassist -g qrydbhistbizdg make qrydbhistbizvol 5800G layout=mirror-stripe ncol=4 stripeunit=256 mirror=enclr</div><div class="line">vxsnap -g qrydbhistbizdg prepare qrydbhistbizvol alloc=qrydbhistbizdg12,qrydbhistbizdg12_1</div><div class="line">vxvol -g qrydbhistbizdg rdpol round qrydbhistbizvol</div><div class="line">vxvol -g qrydbhistbizdg rdpol round qrydbhistbizvol_dcl</div><div class="line"></div><div class="line"><span class="comment"># qrydbhistriskdg</span></div><div class="line">qrydb1@NH/root<span class="comment">#vxassist -g qrydbhistriskdg maxsize layout=mirror-stripe ncol=4 stripeunit=256 mirror=enclr</span></div><div class="line">Maximum volume size: 16773924864 (8190393Mb)</div><div class="line"></div><div class="line">vxassist -g qrydbhistriskdg make qrydbhistriskvol 5800G layout=mirror-stripe ncol=4 stripeunit=256 mirror=enclr</div><div class="line">vxsnap -g qrydbhistriskdg prepare qrydbhistriskvol alloc=qrydbhistriskdg12,qrydbhistriskdg12_1</div><div class="line">vxvol -g qrydbhistriskdg rdpol round qrydbhistriskvol</div><div class="line">vxvol -g qrydbhistriskdg rdpol round qrydbhistriskvol_dcl</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># 创建文件系统</span></div><div class="line"></div><div class="line"><span class="comment"># ocrvotedg</span></div><div class="line">mkfs -t vxfs -o bsize=8192,largefiles /dev/vx/rdsk/ocrvotedg/ocrvotevol01</div><div class="line">mkfs -t vxfs -o bsize=8192,largefiles /dev/vx/rdsk/ocrvotedg/ocrvotevol02</div><div class="line">mkfs -t vxfs -o bsize=8192,largefiles /dev/vx/rdsk/ocrvotedg/ocrvotevol03</div><div class="line"></div><div class="line"><span class="comment"># qrydbbkdg</span></div><div class="line">mkfs -t vxfs -o bsize=8192,largefiles /dev/vx/rdsk/qrydbbkdg/qrydbbkvol </div><div class="line"></div><div class="line"><span class="comment"># qrydbdumpdg</span></div><div class="line">mkfs -t vxfs -o bsize=8192,largefiles /dev/vx/rdsk/qrydbdumpdg/qrydbdumpvol </div><div class="line"></div><div class="line"><span class="comment"># qrydbdsgdg</span></div><div class="line">mkfs -t vxfs -o bsize=8192,largefiles /dev/vx/rdsk/qrydbdsgdg/qrydbdsgvol </div><div class="line"></div><div class="line"><span class="comment"># qrydbdatadg</span></div><div class="line">mkfs -t vxfs -o bsize=8192,largefiles /dev/vx/rdsk/qrydbdatadg/qrydbdatavol </div><div class="line"></div><div class="line"><span class="comment"># qrydbhistbizdg</span></div><div class="line">mkfs -t vxfs -o bsize=8192,largefiles /dev/vx/rdsk/qrydbhistbizdg/qrydbhistbizvol </div><div class="line"></div><div class="line"><span class="comment"># qrydbhistriskdg</span></div><div class="line">mkfs -t vxfs -o bsize=8192,largefiles /dev/vx/rdsk/qrydbhistriskdg/qrydbhistriskvol </div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># 创建挂载点(两个节点操作)</span></div><div class="line">mkdir -p /cffex/ora_crs1</div><div class="line">mkdir -p /cffex/ora_crs2</div><div class="line">mkdir -p /cffex/ora_crs3</div><div class="line">mkdir -p /cffex/ora_data</div><div class="line">mkdir /dsg</div><div class="line">mkdir /rmanbk</div><div class="line">mkdir -p /cffex/dump</div><div class="line">mkdir -p /cffex/ora_data/histbiz</div><div class="line">mkdir -p /cffex/ora_data/histrisk</div></pre></td></tr></table></figure>
<h2 id="配置main-cf"><a href="#配置main-cf" class="headerlink" title="配置main.cf"></a>配置main.cf</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 在hastop -all的情况下，对集群所有节点的/etc/VRTSvcs/conf/config/main.cf进行修改，添加修改类似如下配置</span></div><div class="line">hastop -all</div><div class="line"><span class="comment">#vim /etc/VRTSvcs/conf/config/main.cf</span></div><div class="line"></div><div class="line"><span class="comment"># 通过图形化界面配置</span></div><div class="line">yum install -y libXext.i686 libXrender.i686 libXtst.i686</div><div class="line"><span class="built_in">export</span> DISPLAY=172.25.243.202:0.0</div><div class="line"><span class="built_in">cd</span> /opt/VRTSvcs/bin</div><div class="line">./hagui</div><div class="line"></div><div class="line">172.25.242.125</div><div class="line">admin/password</div><div class="line"></div><div class="line"><span class="comment"># 修改2处配置</span></div><div class="line">MountPoint：/dev/vx/dsk/</div><div class="line">MountOps：convosync=direct,mincache=direct,cluster</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      记录 infoscale 7.0.1 安装部署心得
    
    </summary>
    
      <category term="软件 | Soft" scheme="https://wsgzao.github.io/categories/%E8%BD%AF%E4%BB%B6-Soft/"/>
    
    
  </entry>
  
  <entry>
    <title>使用tftpd32自动化网络安装esxi6.0u2和rhel6.7实践</title>
    <link href="https://wsgzao.github.io/post/tftpd32/"/>
    <id>https://wsgzao.github.io/post/tftpd32/</id>
    <published>2017-01-19T06:59:49.000Z</published>
    <updated>2017-01-19T09:33:12.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在tftp那篇文章中我提到过一般网络安装基于Linux下PXE+TFTP+DHCP+(HTTP/FTP/NFS)来实现，然而在真实的生产环境中分别测试了Cloudboot和Cobbler，面对大量型号和配置不一样的物理机并不能满足实际需求。最后采用Windows笔记本+交换机+tftpd32+kickstart来灵活应对esxi6和rhel6.7的自动化装机，为了不依赖自动化光盘安装的低效懒人模式，中间还是踩了不少的坑。个人觉得装机并没有孰优孰劣的说法，而且未来是属于分布式存储+万兆交换机+类似VMware/OpenStack的模式，人肉装机的时代已经离我们渐行渐远。</p>
<blockquote>
<p>利用tftpd32快速搭建自动化网络搞机平台</p>
</blockquote>
<h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2017年01月19日 - 初稿</p>
<p>阅读原文 - <a href="https://wsgzao.github.io/post/tftpd32/">https://wsgzao.github.io/post/tftpd32/</a></p>
<p><strong>扩展阅读</strong></p>
<p>Tftd32 - <a href="http://tftpd32.jounin.net/" target="_blank" rel="external">http://tftpd32.jounin.net/</a><br>Kickstart Generator - <a href="https://access.redhat.com/labsinfo/kickstartconfig" target="_blank" rel="external">https://access.redhat.com/labsinfo/kickstartconfig</a></p>
<hr>
<h2 id="3点建议"><a href="#3点建议" class="headerlink" title="3点建议"></a>3点建议</h2><ol>
<li>PXE只是网络安装的引导方式，自动化的核心配置文件始终依赖kickstart/autoyast/autounattend等</li>
<li>文章内提到的引导介质均提取自rhel6.7镜像文件<code>syslinux-nonlinux-4.04-3.el6.noarch.rpm</code></li>
<li>云霁科技的Cloudboot成熟度非常高，建议大家多参考其高质量的配置方案</li>
</ol>
<p>CloudBoot 云启装机平台(开源版) - <a href="http://www.idcos.com/products/cloudboot-open-source" target="_blank" rel="external">http://www.idcos.com/products/cloudboot-open-source</a></p>
<p><img src="https://ooo.0o0.ooo/2017/01/19/588083153cca3.jpg" alt=""><br><img src="https://ooo.0o0.ooo/2017/01/19/5880832627c41.jpg" alt=""><br><img src="https://ooo.0o0.ooo/2017/01/19/5880832f2bd2a.jpg" alt=""></p>
<h2 id="esxi"><a href="#esxi" class="headerlink" title="esxi"></a>esxi</h2><blockquote>
<p>tftpd32+esxi6.0u2+kickstart+hfs</p>
</blockquote>
<ol>
<li>Windows下关闭防火墙，设置IP地址为192.168.1.1/24</li>
<li>启动tftpd32参考上图所示配置，<code>Base Directory</code>目录选择实际定义的路径，如<code>tftpboot_esxi\</code></li>
<li>解压ESXi ISO至<code>tftpboot_esxi\</code>，修改BOOT.CFG添加kernelopt=ks=<a href="http://192.168.1.1/esxi6/KS.CFG" target="_blank" rel="external">http://192.168.1.1/esxi6/KS.CFG</a></li>
<li>将KS.CFG放入自定义目录，使用hfs加载</li>
<li>复制syslinux中的pxelinux.0到<code>tftpboot_esxi\</code></li>
<li>复制syslinux中的MENU.C32<code>替换</code>tftpboot_esxi`中的同名文件</li>
<li>创建<code>tftpboot_esxi\pxelinux.cfg\</code>目录，复制ESXi ISO文件中的ISOLINUX.CFG至该目录并改名为default</li>
<li>检查tftpd32服务启动正常，测试自动化网络安装esxi</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#BOOT.CFG</span></div><div class="line"></div><div class="line">bootstate=0</div><div class="line">title=Loading ESXi installer</div><div class="line">timeout=5</div><div class="line">kernel=/tboot.b00</div><div class="line">kernelopt=ks=http://192.168.1.1/esxi6/KS.CFG</div><div class="line">modules=/b.b00 --- /jumpstrt.gz --- /useropts.gz --- /k.b00 --- /chardevs.b00 --- /a.b00 --- /user.b00 --- /uc_intel.b00 --- /uc_amd.b00 --- /sb.v00 --- /s.v00 --- /scsi_mpt.v00 --- /net_tg3.v00 --- /elxnet.v00 --- /ima_be2i.v00 --- /lpfc.v00 --- /scsi_be2.v00 --- /amsHelpe.v00 --- /conrep.v00 --- /hpbootcf.v00 --- /hpe_buil.v00 --- /hpe_esxi.v00 --- /hpe_ilo.v00 --- /hpe_smx_.v00 --- /hponcfg.v00 --- /hpssacli.v00 --- /hptestev.v00 --- /char_hpc.v00 --- /hpnmi.v00 --- /scsi_hpd.v00 --- /scsi_hps.v00 --- /scsi_hpv.v00 --- /intelcim.v00 --- /net_i40e.v00 --- /net_igb.v00 --- /net_ixgb.v00 --- /nmlx4_co.v00 --- /nmlx4_en.v00 --- /misc_cni.v00 --- /net_bnx2.v00 --- /net_bnx2.v01 --- /net_cnic.v00 --- /net_nx_n.v00 --- /net_qlcn.v00 --- /qlnative.v00 --- /scsi_bfa.v00 --- /scsi_bnx.v00 --- /scsi_bnx.v01 --- /scsi_qla.v00 --- /mtip32xx.v00 --- /ata_pata.v00 --- /ata_pata.v01 --- /ata_pata.v02 --- /ata_pata.v03 --- /ata_pata.v04 --- /ata_pata.v05 --- /ata_pata.v06 --- /ata_pata.v07 --- /block_cc.v00 --- /ehci_ehc.v00 --- /emulex_e.v00 --- /weaselin.t00 --- /esx_dvfi.v00 --- /esx_ui.v00 --- /ima_qla4.v00 --- /ipmi_ipm.v00 --- /ipmi_ipm.v01 --- /ipmi_ipm.v02 --- /lsi_mr3.v00 --- /lsi_msgp.v00 --- /lsu_hp_h.v00 --- /lsu_lsi_.v00 --- /lsu_lsi_.v01 --- /lsu_lsi_.v02 --- /lsu_lsi_.v03 --- /lsu_lsi_.v04 --- /misc_dri.v00 --- /net_e100.v00 --- /net_e100.v01 --- /net_enic.v00 --- /net_forc.v00 --- /net_mlx4.v00 --- /net_mlx4.v01 --- /net_vmxn.v00 --- /nmlx4_rd.v00 --- /nvme.v00 --- /ohci_usb.v00 --- /rste.v00 --- /sata_ahc.v00 --- /sata_ata.v00 --- /sata_sat.v00 --- /sata_sat.v01 --- /sata_sat.v02 --- /sata_sat.v03 --- /sata_sat.v04 --- /scsi_aac.v00 --- /scsi_adp.v00 --- /scsi_aic.v00 --- /scsi_fni.v00 --- /scsi_ips.v00 --- /scsi_meg.v00 --- /scsi_meg.v01 --- /scsi_meg.v02 --- /scsi_mpt.v01 --- /scsi_mpt.v02 --- /uhci_usb.v00 --- /vsan.v00 --- /vsanheal.v00 --- /vsanmgmt.v00 --- /xhci_xhc.v00 --- /tools.t00 --- /nmst.v00 --- /xorg.v00 --- /imgdb.tgz --- /imgpayld.tgz</div><div class="line">build=</div><div class="line">updated=0</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#default</span></div><div class="line"></div><div class="line">DEFAULT menu.c32</div><div class="line">MENU TITLE ESXi6.0u2 Boot Menu</div><div class="line">NOHALT 1</div><div class="line">PROMPT 0</div><div class="line">TIMEOUT 80</div><div class="line">LABEL install</div><div class="line">  KERNEL mboot.c32</div><div class="line">  APPEND -c boot.cfg</div><div class="line">  MENU LABEL ESXi6.0u2 ^Installer</div><div class="line">LABEL hddboot</div><div class="line">  LOCALBOOT 0x80</div><div class="line">  MENU LABEL ^Boot from <span class="built_in">local</span> disk</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#KS.CFG</span></div><div class="line"></div><div class="line"><span class="comment"># Accept the VMware End User License Agreement</span></div><div class="line">vmaccepteula</div><div class="line"></div><div class="line"><span class="comment"># Set the root password for the DCUI and Tech Support Mode</span></div><div class="line">rootpw admin123</div><div class="line"><span class="comment"># Install on the first local disk available on machine</span></div><div class="line">install --firstdisk --overwritevmfs</div><div class="line"></div><div class="line"><span class="comment"># Set the network to DHCP on the first network adapter</span></div><div class="line">network --bootproto=dhcp --device=vmnic0</div><div class="line"></div><div class="line"><span class="comment"># Reboot at the end</span></div><div class="line">reboot</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div></pre></td><td class="code"><pre><div class="line">file://H:\01_autoinstall\tftpboot_esxi  (3 folders, 129 files, 377.76 MB, 379.93 MB <span class="keyword">in</span> total.)</div><div class="line">│  .DISCINFO 33 bytes</div><div class="line">│  A.B00 10.96 KB</div><div class="line">│  AMSHELPE.V00  1.32 MB</div><div class="line">│  ATA_PATA.V00  8.28 KB</div><div class="line">│  ATA_PATA.V01  6.22 KB</div><div class="line">│  ATA_PATA.V02  6.47 KB</div><div class="line">│  ATA_PATA.V03  7.22 KB</div><div class="line">│  ATA_PATA.V04  8.33 KB</div><div class="line">│  ATA_PATA.V05  7.01 KB</div><div class="line">│  ATA_PATA.V06  6.17 KB</div><div class="line">│  ATA_PATA.V07  7.59 KB</div><div class="line">│  B.B00 75.03 KB</div><div class="line">│  BLOCK_CC.V00  23.75 KB</div><div class="line">│  BOOT.CAT  512 bytes</div><div class="line">│  BOOT.CFG  2.07 KB</div><div class="line">│  CHAR_HPC.V00  9.93 KB</div><div class="line">│  CHARDEVS.B00  18.67 KB</div><div class="line">│  CONREP.V00    1.87 MB</div><div class="line">│  EFIBOOT.IMG   1.00 MB</div><div class="line">│  EHCI_EHC.V00  32.99 KB</div><div class="line">│  ELXNET.V00    132.88 KB</div><div class="line">│  EMULEX_E.V00  5.68 KB</div><div class="line">│  ESX_DVFI.V00  89.19 KB</div><div class="line">│  ESX_UI.V00    2.83 MB</div><div class="line">│  HPBOOTCF.V00  28.52 KB</div><div class="line">│  HPE_BUIL.V00  458 bytes</div><div class="line">│  HPE_ESXI.V00  1.51 MB</div><div class="line">│  HPE_ILO.V00   9.50 KB</div><div class="line">│  HPE_SMX_.V00  7.81 MB</div><div class="line">│  HPNMI.V00 4.20 KB</div><div class="line">│  HPONCFG.V00   96.62 KB</div><div class="line">│  HPSSACLI.V00  4.97 MB</div><div class="line">│  HPTESTEV.V00  6.29 KB</div><div class="line">│  IMA_BE2I.V00  489.49 KB</div><div class="line">│  IMA_QLA4.V00  359.39 KB</div><div class="line">│  IMGDB.TGZ 62.35 KB</div><div class="line">│  IMGPAYLD.TGZ  3.94 MB</div><div class="line">│  INTELCIM.V00  94.06 KB</div><div class="line">│  IPMI_IPM.V00  9.38 KB</div><div class="line">│  IPMI_IPM.V01  22.99 KB</div><div class="line">│  IPMI_IPM.V02  27.91 KB</div><div class="line">│  ISOLINUX.BIN  14.00 KB</div><div class="line">│  ISOLINUX.CFG  231 bytes</div><div class="line">│  JUMPSTRT.GZ   20 bytes</div><div class="line">│  K.B00 3.26 MB</div><div class="line">│  KS.CFG    356 bytes</div><div class="line">│  LPFC.V00  555.77 KB</div><div class="line">│  LSI_MR3.V00   68.98 KB</div><div class="line">│  LSI_MSGP.V00  117.96 KB</div><div class="line">│  LSU_HP_H.V00  15.34 KB</div><div class="line">│  LSU_LSI_.V00  78.96 KB</div><div class="line">│  LSU_LSI_.V01  159.84 KB</div><div class="line">│  LSU_LSI_.V02  78.96 KB</div><div class="line">│  LSU_LSI_.V03  187.32 KB</div><div class="line">│  LSU_LSI_.V04  114.35 KB</div><div class="line">│  MBOOT.C32 84.17 KB</div><div class="line">│  MENU.C32  60.35 KB</div><div class="line">│  MISC_CNI.V00  5.51 KB</div><div class="line">│  MISC_DRI.V00  1.24 MB</div><div class="line">│  MTIP32XX.V00  67.84 KB</div><div class="line">│  NET_BNX2.V00  178.17 KB</div><div class="line">│  NET_BNX2.V01  1.00 MB</div><div class="line">│  NET_CNIC.V00  48.42 KB</div><div class="line">│  NET_E100.V00  93.66 KB</div><div class="line">│  NET_E100.V01  108.27 KB</div><div class="line">│  NET_ENIC.V00  43.63 KB</div><div class="line">│  NET_FORC.V00  36.61 KB</div><div class="line">│  NET_I40E.V00  132.01 KB</div><div class="line">│  NET_IGB.V00   101.62 KB</div><div class="line">│  NET_IXGB.V00  167.56 KB</div><div class="line">│  NET_MLX4.V00  107.78 KB</div><div class="line">│  NET_MLX4.V01  66.30 KB</div><div class="line">│  NET_NX_N.V00  1.32 MB</div><div class="line">│  NET_QLCN.V00  283.02 KB</div><div class="line">│  NET_TG3.V00   107.81 KB</div><div class="line">│  NET_VMXN.V00  30.50 KB</div><div class="line">│  NMLX4_CO.V00  117.53 KB</div><div class="line">│  NMLX4_EN.V00  119.73 KB</div><div class="line">│  NMLX4_RD.V00  39.92 KB</div><div class="line">│  NMST.V00  12.32 KB</div><div class="line">│  NVME.V00  63.07 KB</div><div class="line">│  OHCI_USB.V00  19.44 KB</div><div class="line">│  pxelinux.0    26.13 KB</div><div class="line">│  QLNATIVE.V00  731.51 KB</div><div class="line">│  RSTE.V00  209.06 KB</div><div class="line">│  S.V00 92.98 MB</div><div class="line">│  SAFEBOOT.C32  61.79 KB</div><div class="line">│  SATA_AHC.V00  19.80 KB</div><div class="line">│  SATA_ATA.V00  11.79 KB</div><div class="line">│  SATA_SAT.V00  17.16 KB</div><div class="line">│  SATA_SAT.V01  10.32 KB</div><div class="line">│  SATA_SAT.V02  10.86 KB</div><div class="line">│  SATA_SAT.V03  8.03 KB</div><div class="line">│  SATA_SAT.V04  6.35 KB</div><div class="line">│  SB.V00    48.31 MB</div><div class="line">│  SCSI_AAC.V00  52.10 KB</div><div class="line">│  SCSI_ADP.V00  143.31 KB</div><div class="line">│  SCSI_AIC.V00  95.67 KB</div><div class="line">│  SCSI_BE2.V00  247.25 KB</div><div class="line">│  SCSI_BFA.V00  1.20 MB</div><div class="line">│  SCSI_BNX.V00  95.69 KB</div><div class="line">│  SCSI_BNX.V01  78.25 KB</div><div class="line">│  SCSI_FNI.V00  64.13 KB</div><div class="line">│  SCSI_HPD.V00  937.40 KB</div><div class="line">│  SCSI_HPS.V00  72.92 KB</div><div class="line">│  SCSI_HPV.V00  704.64 KB</div><div class="line">│  SCSI_IPS.V00  32.12 KB</div><div class="line">│  SCSI_MEG.V00  28.29 KB</div><div class="line">│  SCSI_MEG.V01  54.13 KB</div><div class="line">│  SCSI_MEG.V02  26.45 KB</div><div class="line">│  SCSI_MPT.V00  132.34 KB</div><div class="line">│  SCSI_MPT.V01  147.33 KB</div><div class="line">│  SCSI_MPT.V02  124.50 KB</div><div class="line">│  SCSI_QLA.V00  147.12 KB</div><div class="line">│  TBOOT.B00 43.32 KB</div><div class="line">│  TOOLS.T00 180.67 MB</div><div class="line">│  UC_AMD.B00    3.41 KB</div><div class="line">│  UC_INTEL.B00  135.83 KB</div><div class="line">│  UHCI_USB.V00  19.82 KB</div><div class="line">│  USER.B00  447.52 KB</div><div class="line">│  USEROPTS.GZ   20 bytes</div><div class="line">│  VMWARE-ESX-BASE-OSL.TXT   1.13 MB</div><div class="line">│  VMWARE-ESX-BASE-README    2.19 KB</div><div class="line">│  VSAN.V00  6.73 MB</div><div class="line">│  VSANHEAL.V00  168.57 KB</div><div class="line">│  VSANMGMT.V00  1.35 MB</div><div class="line">│  WEASELIN.T00  1.93 MB</div><div class="line">│  XHCI_XHC.V00  72.94 KB</div><div class="line">│  XORG.V00  1.28 MB</div><div class="line">├─EFI   (1 folders, 0 files, 0 bytes, 193.17 KB <span class="keyword">in</span> total.)</div><div class="line">│  └─BOOT    (0 folders, 3 files, 193.17 KB, 193.17 KB <span class="keyword">in</span> total.)</div><div class="line">│          BOOT.CFG  2.04 KB</div><div class="line">│          BOOTIA32.EFI  94.59 KB</div><div class="line">│          BOOTX64.EFI   96.53 KB</div><div class="line">├─pxelinux.cfg  (0 folders, 1 files, 231 bytes, 231 bytes <span class="keyword">in</span> total.)</div><div class="line">│      default 231 bytes</div><div class="line">└─UPGRADE   (0 folders, 10 files, 1.98 MB, 1.98 MB <span class="keyword">in</span> total.)</div><div class="line">        ESXIMAGE.ZIP    874.17 KB</div><div class="line">        EXTLINUX    62.51 KB</div><div class="line">        ISOINFO 233.62 KB</div><div class="line">        MBR.BIN 440 bytes</div><div class="line">        MCOPY   584.17 KB</div><div class="line">        METADATA.XML    1.54 KB</div><div class="line">        METADATA.ZIP    141.08 KB</div><div class="line">        PRECHECK.PY 72.78 KB</div><div class="line">        PREP.PY 47.54 KB</div><div class="line">        PROFILE.XML 8.85 KB</div></pre></td></tr></table></figure>
<blockquote>
<p>引用他人在Linux下的安装流程</p>
</blockquote>
<p>PEX安装ESXi6 - <a href="http://blog.csdn.net/onlyshenmin/article/details/52434743" target="_blank" rel="external">http://blog.csdn.net/onlyshenmin/article/details/52434743</a> </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#安装dhcp、tftp-server、syslinux、xinetd。</span></div><div class="line">yum install dhcp tftp-server syslinux xinetd</div><div class="line"></div><div class="line"><span class="comment">#挂载ESXi ISO到/mnt</span></div><div class="line">mount /dev/cdrom /mnt</div><div class="line"></div><div class="line"><span class="comment">#修改dhcpd.conf</span></div><div class="line">ddns-update-style interim;</div><div class="line">allow booting;</div><div class="line">allow bootp;</div><div class="line">class <span class="string">"pxeclients"</span> &#123;</div><div class="line">    match <span class="keyword">if</span> substring(option vendor-class-identifier, 0, 9) = <span class="string">"PXEClient"</span>;</div><div class="line">    next-server 172.16.8.7;</div><div class="line">    filename = <span class="string">"pxelinux.0"</span>;</div><div class="line">&#125;</div><div class="line">subnet 172.16.8.0 netmask 255.255.255.0 &#123;</div><div class="line">    range 172.16.8.100 172.16.8.199;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">#启用tftp,修改/etc/xinetd.d/tftp中的disable = yes为disable = no</span></div><div class="line">service tftp</div><div class="line">&#123;</div><div class="line">        socket_type             = dgram</div><div class="line">        protocol                = udp</div><div class="line">        <span class="built_in">wait</span>                    = yes</div><div class="line">        user                    = root</div><div class="line">        server                  = /usr/sbin/in.tftpd</div><div class="line">        server_args             = -s /var/lib/tftpboot</div><div class="line">        <span class="built_in">disable</span>                 = no</div><div class="line">        per_source              = 11</div><div class="line">        cps                     = 100 2</div><div class="line">        flags                   = IPv4</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">#复制pxelinux.0到tftp根目录</span></div><div class="line">cp /usr/share/syslinux/pxelinux.0 /var/lib/tftpboot/</div><div class="line"></div><div class="line"><span class="comment">#新建目录/var/lib/tftpboot/pxelinux.cfg</span></div><div class="line">mkdir /var/lib/tftpboot/pxelinux.cfg</div><div class="line"></div><div class="line"><span class="comment">#复制ESXi ISO文件中的isolinux.cfg到/var/lib/tftpboot/pxelinux.cfg/下并改名default</span></div><div class="line">cp /mnt/isolinux.cfg /var/lib/tftpboot/pxelinux.cfg/default</div><div class="line"></div><div class="line"><span class="comment">#复制ESXi ISO中的全部文件到/var/lib/tftpboot/下</span></div><div class="line">cp -a  /mnt/* /var/lib/tftpboot/</div><div class="line"></div><div class="line"><span class="comment">#复制syslinux自带的menu.c32到tftp根目录替换掉ESXI ISO里的menu.c32。</span></div><div class="line">cp /usr/share/syslinux/menu.c32  /var/lib/tftpboot/</div><div class="line"></div><div class="line"><span class="comment">#重启dhcp、xinetd服务</span></div><div class="line">systemctl restart dhcpd</div><div class="line">systemctl restart xinetd</div><div class="line"></div><div class="line"><span class="comment">#自定义安装脚本，安装httpd，编辑脚本ks.cfg</span></div><div class="line">vim /var/www/html/ks.cfg</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Sample scripted installation file</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Accept the VMware End User License Agreement</span></div><div class="line">vmaccepteula</div><div class="line"><span class="comment"># Set the root password for the DCUI and Tech Support Mode</span></div><div class="line">rootpw mypassword</div><div class="line"><span class="comment"># Install on the first local disk available on machine</span></div><div class="line">install --firstdisk --overwritevmfs</div><div class="line"><span class="comment"># Set the network to DHCP on the first network adapter</span></div><div class="line">network --bootproto=dhcp --device=vmnic0</div><div class="line"><span class="comment"># A sample post-install script</span></div><div class="line">%post --interpreter=python --ignorefailure=<span class="literal">true</span></div><div class="line">import time</div><div class="line">stampFile = open(<span class="string">'/finished.stamp'</span>, mode=<span class="string">'w'</span>)</div><div class="line">stampFile.write( time.asctime() )</div><div class="line"></div><div class="line"><span class="comment">#编辑ESXi ISO复制过来的boot.cfg文件，添加kernelopt=ks=http://172.16.8.7/ks.cfg</span></div><div class="line">vim /var/lib/tftpboot/boot.cfg</div><div class="line"></div><div class="line">bootstate=0</div><div class="line">title=Loading ESXi installer</div><div class="line">timeout=5</div><div class="line">kernel=/tboot.b00</div><div class="line">kernelopt=ks=http://172.16.8.7/ks.cfg</div><div class="line">modules=/b.b00 --- /jumpstrt.gz --- /useropts.gz --- /k.b00 --- /chardevs.b00 --- /a.b00 --- /user.b00 --- /uc_intel.b00 --- /uc_amd.b00 --- /sb.v00 --- /s.v00 --- /mtip32xx.v00 --- /ata_pata.v00 --- /ata_pata.v01 --- /ata_pata.v02 --- /ata_pata.v03 --- /ata_pata.v04 --- /ata_pata.v05 --- /ata_pata.v06 --- /ata_pata.v07 --- /block_cc.v00 --- /ehci_ehc.v00 --- /elxnet.v00 --- /emulex_e.v00 --- /weaselin.t00 --- /esx_dvfi.v00 --- /esx_ui.v00 --- /ima_qla4.v00 --- /ipmi_ipm.v00 --- /ipmi_ipm.v01 --- /ipmi_ipm.v02 --- /lpfc.v00 --- /lsi_mr3.v00 --- /lsi_msgp.v00 --- /lsu_hp_h.v00 --- /lsu_lsi_.v00 --- /lsu_lsi_.v01 --- /lsu_lsi_.v02 --- /lsu_lsi_.v03 --- /lsu_lsi_.v04 --- /misc_cni.v00 --- /misc_dri.v00 --- /net_bnx2.v00 --- /net_bnx2.v01 --- /net_cnic.v00 --- /net_e100.v00 --- /net_e100.v01 --- /net_enic.v00 --- /net_forc.v00 --- /net_igb.v00 --- /net_ixgb.v00 --- /net_mlx4.v00 --- /net_mlx4.v01 --- /net_nx_n.v00 --- /net_tg3.v00 --- /net_vmxn.v00 --- /nmlx4_co.v00 --- /nmlx4_en.v00 --- /nmlx4_rd.v00 --- /nvme.v00 --- /ohci_usb.v00 --- /qlnative.v00 --- /rste.v00 --- /sata_ahc.v00 --- /sata_ata.v00 --- /sata_sat.v00 --- /sata_sat.v01 --- /sata_sat.v02 --- /sata_sat.v03 --- /sata_sat.v04 --- /scsi_aac.v00 --- /scsi_adp.v00 --- /scsi_aic.v00 --- /scsi_bnx.v00 --- /scsi_bnx.v01 --- /scsi_fni.v00 --- /scsi_hps.v00 --- /scsi_ips.v00 --- /scsi_meg.v00 --- /scsi_meg.v01 --- /scsi_meg.v02 --- /scsi_mpt.v00 --- /scsi_mpt.v01 --- /scsi_mpt.v02 --- /scsi_qla.v00 --- /uhci_usb.v00 --- /vsan.v00 --- /vsanheal.v00 --- /vsanmgmt.v00 --- /xhci_xhc.v00 --- /tools.t00 --- /xorg.v00 --- /imgdb.tgz --- /imgpayld.tgz</div><div class="line">build=</div><div class="line">updated=0</div></pre></td></tr></table></figure>
<h2 id="rhel"><a href="#rhel" class="headerlink" title="rhel"></a>rhel</h2><blockquote>
<p>tftpd32+rhel6.7+kickstart+hfs</p>
</blockquote>
<ol>
<li>Windows下关闭防火墙，设置IP地址为192.168.1.1/24</li>
<li>启动tftpd32参考上图所示配置，<code>Base Directory</code>目录选择实际定义的路径，如<code>tftpboot_rhel\</code></li>
<li>解压rhel6.7 ISO至自定义目录，使用hfs作为http文件服务器</li>
<li>将ks.cfg放入自定义目录，使用hfs加载</li>
<li>复制syslinux中的<code>pxelinux.0/initrd.img/vesamenu.c32/vmlinuz</code>到<code>tftpboot_rhel\</code></li>
<li>创建pxelinux.cfg目录，复制rhel6.7 ISO文件中的ISOLINUX.CFG至该目录并改名为default</li>
<li>修改default文件，ks=<a href="http://192.168.1.1/rhel67/ks.cfg" target="_blank" rel="external">http://192.168.1.1/rhel67/ks.cfg</a> ksdevice=eth10，出现<code>multiple network devices</code>提示一定要加入ksdevice确认网卡</li>
<li>检查tftpd32服务启动正常，测试自动化网络安装rhel</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#default</span></div><div class="line"></div><div class="line">default vesamenu.c32</div><div class="line"><span class="comment">#prompt 1</span></div><div class="line">timeout 60</div><div class="line"></div><div class="line">display boot.msg</div><div class="line"></div><div class="line">menu background splash.jpg</div><div class="line">menu title Welcome to Red Hat Enterprise Linux 6.7!</div><div class="line">menu color border 0 <span class="comment">#ffffffff #00000000</span></div><div class="line">menu color sel 7 <span class="comment">#ffffffff #ff000000</span></div><div class="line">menu color title 0 <span class="comment">#ffffffff #00000000</span></div><div class="line">menu color tabmsg 0 <span class="comment">#ffffffff #00000000</span></div><div class="line">menu color unsel 0 <span class="comment">#ffffffff #00000000</span></div><div class="line">menu color hotsel 0 <span class="comment">#ff000000 #ffffffff</span></div><div class="line">menu color hotkey 7 <span class="comment">#ffffffff #ff000000</span></div><div class="line">menu color scrollbar 0 <span class="comment">#ffffffff #00000000</span></div><div class="line"></div><div class="line">label linux</div><div class="line">  menu label ^Install or upgrade an existing system</div><div class="line">  menu default</div><div class="line">  kernel vmlinuz</div><div class="line">  append initrd=initrd.img ks=http://192.168.1.1/rhel67/ks.cfg ksdevice=eth10</div><div class="line">label vesa</div><div class="line">  menu label Install system with ^basic video driver</div><div class="line">  kernel vmlinuz</div><div class="line">  append initrd=initrd.img nomodeset</div><div class="line">label rescue</div><div class="line">  menu label ^Rescue installed system</div><div class="line">  kernel vmlinuz</div><div class="line">  append initrd=initrd.img rescue</div><div class="line">label <span class="built_in">local</span></div><div class="line">  menu label Boot from ^<span class="built_in">local</span> drive</div><div class="line">  localboot 0xffff</div><div class="line">label memtest86</div><div class="line">  menu label ^Memory <span class="built_in">test</span></div><div class="line">  kernel memtest</div><div class="line">  append -</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#ks.cfg</span></div><div class="line"></div><div class="line"><span class="comment">#platform=x86, AMD64, or Intel EM64T</span></div><div class="line"><span class="comment">#version=DEVEL</span></div><div class="line"><span class="comment"># Firewall configuration</span></div><div class="line">firewall --disabled</div><div class="line"><span class="comment"># Install OS instead of upgrade</span></div><div class="line">install</div><div class="line"><span class="comment">#cdrom</span></div><div class="line">url --url=http://192.168.1.1/rhel67/</div><div class="line"><span class="comment"># Network</span></div><div class="line"><span class="comment">#network --bootproto=dhcp --device=eth0</span></div><div class="line"><span class="comment"># Root password</span></div><div class="line">rootpw admin123</div><div class="line"><span class="comment"># System authorization information</span></div><div class="line">auth  --useshadow  --passalgo=sha512</div><div class="line"><span class="comment"># Use text mode install</span></div><div class="line">text</div><div class="line">firstboot --<span class="built_in">disable</span></div><div class="line"><span class="comment"># System keyboard</span></div><div class="line">keyboard us</div><div class="line"><span class="comment"># System language</span></div><div class="line">lang en_US.UTF-8</div><div class="line"><span class="comment"># SELinux configuration</span></div><div class="line">selinux --disabled</div><div class="line"><span class="comment"># Installation logging level</span></div><div class="line">logging --level=info</div><div class="line"><span class="comment"># Reboot after installation</span></div><div class="line">reboot</div><div class="line"><span class="comment"># System timezone</span></div><div class="line">timezone Asia/Shanghai</div><div class="line"><span class="comment"># System bootloader configuration</span></div><div class="line">bootloader --location=mbr --append=<span class="string">"rhgb quiet crashkernel=auto"</span></div><div class="line"><span class="comment"># Clear the Master Boot Record</span></div><div class="line">zerombr</div><div class="line"><span class="comment"># Partition clearing information</span></div><div class="line">clearpart --all --initlabel</div><div class="line"><span class="comment"># Partition</span></div><div class="line"><span class="comment">#autopart</span></div><div class="line">part /boot --fstype=ext4 --size=500</div><div class="line">part pv.008002 --grow --size=1</div><div class="line">volgroup VolGroup --pesize=4096 pv.008002</div><div class="line">logvol / --fstype=ext4 --name=lv_root --vgname=VolGroup --size=20480</div><div class="line">logvol /home --fstype=ext4 --name=lv_home --vgname=VolGroup --size=20480</div><div class="line">logvol /opt --fstype=ext4 --name=lv_opt --vgname=VolGroup --size=20480</div><div class="line">logvol /tmp --fstype=ext4 --name=lv_tmp --vgname=VolGroup --size=20480</div><div class="line">logvol /usr --fstype=ext4 --name=lv_usr --vgname=VolGroup --size=20480</div><div class="line">logvol /var --fstype=ext4 --name=lv_var --vgname=VolGroup --size=20480</div><div class="line">logvol swap --name=lv_swap --vgname=VolGroup --size=65536</div><div class="line"><span class="comment"># Packages</span></div><div class="line">%packages</div><div class="line">@base</div><div class="line">@chinese-support</div><div class="line">@client-mgmt-tools</div><div class="line">@core</div><div class="line">@debugging</div><div class="line">@basic-desktop</div><div class="line">@desktop-debugging</div><div class="line">@desktop-platform</div><div class="line">@directory-client</div><div class="line">@fonts</div><div class="line">@general-desktop</div><div class="line">@graphical-admin-tools</div><div class="line">@input-methods</div><div class="line">@internet-browser</div><div class="line">@java-platform</div><div class="line">@legacy-x</div><div class="line">@network-file-system-client</div><div class="line">@perl-runtime</div><div class="line">@<span class="built_in">print</span>-client</div><div class="line">@remote-desktop-clients</div><div class="line">@server-platform</div><div class="line">@server-policy</div><div class="line">@x11</div><div class="line">pax</div><div class="line">python-dmidecode</div><div class="line">oddjob</div><div class="line">wodim</div><div class="line">sgpio</div><div class="line">genisoimage</div><div class="line">mtools</div><div class="line">abrt-gui</div><div class="line">certmonger</div><div class="line">pam_krb5</div><div class="line">krb5-workstation</div><div class="line">libXmu</div><div class="line">perl-DBD-SQLite</div><div class="line">%end</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">file://H:\01_autoinstall\tftpboot_rhel  (1 folders, 4 files, 38.93 MB, 38.93 MB <span class="keyword">in</span> total.)</div><div class="line">│  initrd.img    34.72 MB</div><div class="line">│  pxelinux.0    26.13 KB</div><div class="line">│  vesamenu.c32  159.89 KB</div><div class="line">│  vmlinuz   4.03 MB</div><div class="line">└─pxelinux.cfg  (0 folders, 1 files, 991 bytes, 991 bytes <span class="keyword">in</span> total.)</div><div class="line">        default 991 bytes</div></pre></td></tr></table></figure>
<blockquote>
<p>引用他人在Linux下的安装流程</p>
</blockquote>
<p>RHEL6 (64bits)系统上利用PXE+DHCP+TFTP+KickStart批量安装系统<br><a href="http://chrinux.blog.51cto.com/6466723/1214641" target="_blank" rel="external">http://chrinux.blog.51cto.com/6466723/1214641</a></p>
<p>CentOS 6.4下PXE+Kickstart无人值守安装操作系统<br><a href="http://www.cnblogs.com/mchina/p/centos-pxe-kickstart-auto-install-os.html" target="_blank" rel="external">http://www.cnblogs.com/mchina/p/centos-pxe-kickstart-auto-install-os.html</a></p>
<h2 id="tftpd32"><a href="#tftpd32" class="headerlink" title="tftpd32"></a>tftpd32</h2><blockquote>
<p>请允许我直接偷懒引用官方简洁纯朴的英文说明，希望大家在遇到问题前回顾下每个选项的解释，谢谢</p>
</blockquote>
<p>Tftpd32 is a free, opensource IPv6 ready application which includes DHCP, TFTP, DNS, SNTP and Syslog servers as well as a TFTP client.</p>
<h3 id="TFTP"><a href="#TFTP" class="headerlink" title="TFTP"></a>TFTP</h3><p>Trivial File Transfer Protocol was first defined in 1980, it is a lightweight version of the FTP protocol that has no directory browsing or password capability. Employing UDP rather than TCP for transport, TFTP is typically used to transfer firmware upgrades to network equipment such as routers, switches and IP phones.It is also used to boot diskless computers (PXE). </p>
<h3 id="SNTP"><a href="#SNTP" class="headerlink" title="SNTP"></a>SNTP</h3><p>Simple Network Timle Protocol is a simplified version of NTP (Network Time Protocol). They synchronise the time on workstations across a network. </p>
<h3 id="DHCP"><a href="#DHCP" class="headerlink" title="DHCP"></a>DHCP</h3><p>DHCP assigns IP addresses to client stations logging onto a TCP/IP network. It eliminates having to manually assign permanent IP addresses on each station. </p>
<h3 id="Syslog"><a href="#Syslog" class="headerlink" title="Syslog"></a>Syslog</h3><p>Syslog is a service for remotely logging data. For example, it allows to monitor videoless network equipments. </p>
<h3 id="Tftpd-server-Settings"><a href="#Tftpd-server-Settings" class="headerlink" title="Tftpd server Settings"></a>Tftpd server Settings</h3><p><strong>Base directory</strong><br>The default directory used by the TFTP client and server. It may be changed from the main window.</p>
<p><strong>Global Settings</strong><br>Enable or disable tftpd32 servers and clients.</p>
<p><strong>TFTP security</strong></p>
<ul>
<li>NONE   (Not recommended !)<br>read and write requests are allowed on all disks/directories. </li>
<li>Standard<br>read and write requests are allowed but limited to the current directory. </li>
<li>High<br>idem standard + write requests are allowed only if the input file exists and is empty. </li>
<li>Read only<br>idem standard + write requests are rejected. </li>
</ul>
<p><strong>TFTP Configuration</strong></p>
<ul>
<li>Timeout<br>The maximum timeout between two retransmissions </li>
<li>Max Retransmit<br>The maximum retransmission for the same packet </li>
<li>Tftp Port<br>The port used to listen incoming requests </li>
<li>local ports pool<br>A range of ports (for example 3000:3030). These ports are used for the file transfers. </li>
</ul>
<p><strong>TFTP Configuration</strong></p>
<ul>
<li>Option Negotiation<br>Enables the negotiation between client and server (RFC 2347) </li>
<li>PXE compatibility<br>Enables only the file size negotiation </li>
<li>Show progress Bar<br>Creates a gauge window for each transfer </li>
<li>Translate Unix file names<br>Translates any slash characters to a backslash </li>
<li>Bind Tftpd32 to this address<br>Enables TFTP only on one interface </li>
<li>Allow ‘\’ As virtual root<br>A file name beginning with ‘\’ points to the TFTP directory and not to the root of the disk </li>
<li>Use anticipation window of ??? bytes<br>Tftpd32 is able to send packets before receiving acknowledgements. This feature may dramatically speed up the transfer. </li>
<li>Hide window at startup<br>Tftpd32 main window remains hidden, but the icon in the tasktray is still present </li>
<li>Create dir.txt files<br>For each incoming read request, Tftpd32 lists the content of the directory and put the result in a file named “dir.txt”. </li>
<li>Create md5 file<br>For each successfull read request, Tftpd32 creates a file which is the MD5 signature of the previous file<br>Beep for long transfer<br>Tftpd32 sends a beep once a transfer has ended.    </li>
</ul>
<h3 id="DHCP-Setup"><a href="#DHCP-Setup" class="headerlink" title="DHCP Setup"></a>DHCP Setup</h3><ul>
<li>IP Pool starting Address<br>This is the first address which will be distributed. </li>
<li>Size of pool<br>This is the number of hosts which may be configured by Tftpd32. </li>
<li>Lease<br>This is the amount of time in minutes the address is leased for. </li>
<li>Boot File<br>Used by diskless stations. It is the file which will be retrieved by TFTP to start up the boot process.<br>The strings $MAC$ and $IP$ are pseudo variables which are translated into the MAC address of the client and its assignated IP address. </li>
<li>Default router<br>The IP address of the LAN gateway. </li>
<li>Mask<br>The network mask which will be assigned to the DHCP clients. </li>
<li>DNS servers<br>The IP address of the DNS. Two DNS can be configured. </li>
<li>WINS Server<br>The IP address of the WINS server. </li>
<li>NTP Server<br>The IP address of the NTP server used for synchronisation. </li>
<li>SIP Server<br>The IP address of the SIP server. It concerns mostly IP phones. </li>
<li>Domain Name<br>Either the NT domain or the internet domain. </li>
<li>Additional Option<br>The first field is the number of the option to be handled<br>The second filed is the value of the field. The value is prefixed with its type (a for list of IPv4 address, x for list of hex digits, b for list of decimal bytes, s for an ASCII string) [legacy prefixes: i for integer, n for network order integers] </li>
<li>More Additional Options ?<br>Tftpd32 supports up to 10 additionnal options. They have to be configured by editing the tftpd32.ini settings file. Their syntax is similar to the previous one. </li>
</ul>
]]></content>
    
    <summary type="html">
    
      利用tftpd32快速搭建网络自动化搞机平台
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>tftp安装和使用小结</title>
    <link href="https://wsgzao.github.io/post/tftp/"/>
    <id>https://wsgzao.github.io/post/tftp/</id>
    <published>2017-01-18T06:59:49.000Z</published>
    <updated>2017-01-18T03:43:45.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>我相信大家接触到tftp大多数原因是PXE网络自动化部署的功劳，一般是在Linux环境下采用PXE+TFTP+DHCP+(HTTP/FTP/NFS)来实现，因为最近在生产环境中分别测试使用了云霁科技的Cloudboot和大名鼎鼎的Cobbler，只是针对大规模型号和配置不一样的物理机实现成本太高配置不够灵活，最后考虑采用Windows笔记本+交换机+tftpd32来实现。而且最近在更新Cisco网络交换机固件的时候发现使用tftp相比ftp来说更加容易，想想就整一篇简单的文档出来。</p>
<blockquote>
<p>tftp是一个非常简单好用的文件传输协议</p>
</blockquote>
<h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2017年01月18日 - 初稿</p>
<p>阅读原文 - <a href="https://wsgzao.github.io/post/tftp/">https://wsgzao.github.io/post/tftp/</a></p>
<p><strong>扩展阅读</strong></p>
<p>TFTP - <a href="http://www.tftp-server.com/" target="_blank" rel="external">http://www.tftp-server.com/</a></p>
<hr>
<h2 id="tftp应用场景"><a href="#tftp应用场景" class="headerlink" title="tftp应用场景"></a>tftp应用场景</h2><p>TFTP（Trivial File Transfer Protocol，简单文件传输协议）是TCP/IP协议族中的一个用来在客户机与服务器之间进行简单文件传输的协议，提供不复杂、开销不大的文件传输服务。端口号为69，它基于UDP协议而实现。</p>
<ol>
<li>交换机或路由器升级或备份</li>
<li>无盘工作站存放boot loader</li>
<li>嵌入式开发时装载系统</li>
<li>大规模的服务安装布署</li>
</ol>
<h2 id="tftp使用"><a href="#tftp使用" class="headerlink" title="tftp使用"></a>tftp使用</h2><blockquote>
<p>注意修改防火墙和selinux配置</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#安装</span></div><div class="line">yum install -y tftp-server</div><div class="line"></div><div class="line"><span class="comment">#注意disable选项为no</span></div><div class="line"><span class="comment">#修改项server_args=，可以修改tftp-server的根目录，参数-s指定chroot，-c指定了可以创建文件</span></div><div class="line">vi /etc/xinetd.d/tftp</div><div class="line">service tftp</div><div class="line">&#123;</div><div class="line">        socket_type             = dgram</div><div class="line">        protocol                = udp</div><div class="line">        <span class="built_in">wait</span>                    = yes</div><div class="line">        user                    = root</div><div class="line">        server                  = /usr/sbin/in.tftpd</div><div class="line">        server_args             = -s /var/lib/tftpboot</div><div class="line">        <span class="built_in">disable</span>                 = no</div><div class="line">        per_source              = 11</div><div class="line">        cps                     = 100 2</div><div class="line">        flags                   = IPv4</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">#设置tftp开机自动启动</span></div><div class="line">chkconfig tftp on  </div><div class="line"></div><div class="line"><span class="comment">#启动xinetd服务</span></div><div class="line">/etc/init.d/xinetd restart </div><div class="line"></div><div class="line"><span class="comment">#验证tftp是否启动成功并监听本地69端口</span></div><div class="line">netstat -anup | grep 69</div><div class="line">udp    0    0    0.0.0.0:69    0.0.0.0:*    15763/xinetd      </div><div class="line"></div><div class="line"><span class="comment">#测试上传和下载</span></div><div class="line">yum install tftp</div><div class="line">tftp -i 192.168.1.1 put <span class="built_in">test</span></div><div class="line">tftp -i 192.168.1.1 get <span class="built_in">test</span></div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      tftp是一个非常简单好用的文件传输协议
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
</feed>
