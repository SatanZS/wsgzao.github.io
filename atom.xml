<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>HelloDog</title>
  
  <subtitle>Keep Calm and Carry On</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://wsgzao.github.io/"/>
  <updated>2018-08-01T09:22:43.636Z</updated>
  <id>https://wsgzao.github.io/</id>
  
  <author>
    <name>wsgzao</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>新加坡生活指北</title>
    <link href="https://wsgzao.github.io/post/singapore/"/>
    <id>https://wsgzao.github.io/post/singapore/</id>
    <published>2018-08-01T06:59:49.000Z</published>
    <updated>2018-08-01T09:22:43.636Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>为帮助大家玩转新加坡，快速适应当地生活。如果你想了解我是如何来到新加坡的可以直接跳到最后一章。</p><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018年08月01日 - 更新个人经验<br>2018年05月15日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/singapore/">https://wsgzao.github.io/post/singapore/</a></p><p><strong>扩展阅读</strong></p><p>新加坡外交部 - <a href="https://www.mfa.gov.sg/content/mfa/overseasmission/beijing/ch.html" target="_blank" rel="noopener">https://www.mfa.gov.sg/content/mfa/overseasmission/beijing/ch.html</a></p><hr><h2 id="认识狮城"><a href="#认识狮城" class="headerlink" title="认识狮城"></a>认识狮城</h2><p>姓名：新加坡</p><p>年龄：53岁（成立于1965年，国庆日为每年的8月9日）</p><p>家庭住址：北半球赤道地区，位于马来半岛最南端 （北纬1°22′，东经103°48′）</p><p>住房面积：新加坡国土面积710.3平方公里 （只比北京朝阳区大一点）</p><p>家庭成员：人口约520万，密度达到每平方公里7700多人（排在世界前列）</p><p>相貌特征：新加坡多元种族和文化的相互融合是其极具魅力的原因之一，由华族（占全国人口约四分之三）、欧亚族、印度族、马来族、土生华人构成。</p><p>性格特征：新加坡以实行严格的法律和制度著称，无论是居民还是游客，都需要予以足够重视，否则可能会被课以重罚。当然，如果您遵循当地法律规章，也不必过分担心。</p><blockquote><p>所获荣誉：或许这些荣誉只属于过去，我们更需要关心的是现在和未来会怎样</p></blockquote><p>让人最想移民的国家全球排名第一<br>全球最具竞争力国家排名第一<br>最适应亚洲人士居住的地方全球排名第一<br>城市基础设施建设全球排名第一<br>全球化程度最高的城市排名第一</p><p>其他方面：<a href="http://www.visitsingapore.com.cn/travel-guide-tips/about-singapore/" target="_blank" rel="noopener">http://www.visitsingapore.com.cn/travel-guide-tips/about-singapore/</a></p><h2 id="旅游出入境"><a href="#旅游出入境" class="headerlink" title="旅游出入境"></a>旅游出入境</h2><blockquote><p>签证</p></blockquote><p>中国公民去新加坡须提前申请有效签证，不可以落地签。</p><p>中国公民申请的新加坡旅游/商务签证为电子签证（e-Visa），在获得签证后，建议上网打印多份有效签证以防遗失。签证费为每人SG$30。</p><p>新加坡签证可多次入境，有效期分别有35天/62天/2年，由签证官根据申请人资料而定。逗留时间则由入境官决定，通常为14-30天。从2015年6月1日起新加坡将给予符合条件的中国公民有效期长达10年的多次入境签证。</p><p><a href="http://www.visitsingapore.com.cn/travel-guide-tips/travelling-to-singapore/" target="_blank" rel="noopener">http://www.visitsingapore.com.cn/travel-guide-tips/travelling-to-singapore/</a></p><blockquote><p>申请途径How to Apply</p></blockquote><p>2014年12月8日起大使馆及各领事馆停止接收签证申请，可登录新加坡外交部官网，查询中国国内官方指定的签证机构，办理新加坡签证。</p><blockquote><p>所需资料Required Information</p></blockquote><ol><li>个人信息表（登录新加坡外交部官网下载表格，链接：<a href="http://www.mfa.gov.sg）" target="_blank" rel="noopener">www.mfa.gov.sg）</a></li><li>户口本（原件或扫描电子版，户主+个人页复印件）</li><li>身份证（原件或正反面扫描电子版，正反面复印件）</li><li>护照（原件或个人页扫描电子版，个人页复印件，有效期6个月以上）</li><li>2张2寸白底免冠照片</li><li>在职证明原件或相关职业证书</li></ol><blockquote><p>出入境</p></blockquote><p>飞机上空姐会派发入境卡给需要的乘客，也可以在出入境大堂领取，入境卡为英文，入境后记得保留副联，离境时需再次出示并提交。</p><p>离境前别忘了退税，在附有“退税”标志的场所消费满100新币以上，即可退回7%的商品及服务税，退税时需出示购物发票或收据。具体的退税要求，可咨询工作人员。</p><blockquote><p>其它注意事项</p></blockquote><p>电源插座：新加坡使用的标准电流是 220-240 伏特交流电（50 赫兹），在这里，您可以使用三眼电源插座。</p><p><a href="http://www.visitsingapore.com.cn/travel-guide-tips/" target="_blank" rel="noopener">http://www.visitsingapore.com.cn/travel-guide-tips/</a></p><p><img src="//ws3.sinaimg.cn/large/7207510dgy1frc1wdtdd7j20vh12047o.jpg" alt="image"></p><h2 id="新加坡重要电话"><a href="#新加坡重要电话" class="headerlink" title="新加坡重要电话"></a>新加坡重要电话</h2><p>报警：999<br>火警和救护车：995<br>海关：6355 2000<br>中国驻新加坡大使馆：6471 2117（证件咨询）<br>中国银行：6439 8741（汇款业务）<br>中央医院：6222 3322<br>樟宜医院：6788 8833<br>德士电话：6552 1111 / 6363 6888 / 67780808<br>新加坡人力部：6438 5122<br>新加坡税务局（个人）：1800 356 8300<br>新加坡海关：6355 2000<br>新加坡建屋局：6490 1111<br>新加坡移民局：6391 6100</p><h2 id="新加坡公共假期"><a href="#新加坡公共假期" class="headerlink" title="新加坡公共假期"></a>新加坡公共假期</h2><p><a href="https://www.mfa.gov.sg/content/mfa/overseasmission/beijing/ch/public_holidays.html" target="_blank" rel="noopener">https://www.mfa.gov.sg/content/mfa/overseasmission/beijing/ch/public_holidays.html</a></p><h2 id="新加坡通讯指南"><a href="#新加坡通讯指南" class="headerlink" title="新加坡通讯指南"></a>新加坡通讯指南</h2><p>国内的手机大部分都可以在新加坡直接换卡使用，除非你的手机是中国移动4G定制版本，由于网络制式的区别，无法使用新加坡4G网络，新加坡目前 2G 网络停止服务。</p><blockquote><p>小贴士：建议使用全网通手机，去国外任何地方都可以直接换卡使用。</p></blockquote><p>运营商：新电信（Singtel）、星河（Starhub）和 M1（Mobile One）</p><p>在新加坡机场、邮局、7-11便利店和代理商都可以购买和充值电话卡，记得一定要带上护照，新加坡的手机卡采用实名制。推荐大家下载所用运营商的 App，查询和购买话费、流量等。</p><p>1.新电信（Singtel）:新加坡最大电信公司，使用人数最多，信号强。</p><p>流量：10新币可以购买1GB，30天之内使用。20新币可以购买 3GB，30 天之内使用。</p><p>查询话费：<em>139#  查询流量: </em>139<em>3#  订购流量：</em>363</p><p>拨打国内电话：如拨打国内电话，请在拨打国内手机号之前加拨 01986，可节省部分话费；若拨打国内固定电话，请先拨打01986，再拨打区号（去掉前面第一个0）和固话号码。</p><p>详情请参考官网：<a href="http://info.singtel.com/" target="_blank" rel="noopener">http://info.singtel.com/</a></p><p>2.星河（Starhub）：电话费用经济实惠。流量的价格和新电信基本一致。</p><p>查询话费：<em>131#  查询流量: </em>123<em>300#  订购流量：</em>123*</p><p>拨打国内电话：如拨打国内电话，请在拨打国内手机号之前加拨 01886，可节省部分话费；若拨打国内固定电话，请先拨打01886，再拨打区号（去掉前面第一个 0）和固话号码。</p><p>详情请参考官网：<a href="http://www.starhub.com/" target="_blank" rel="noopener">http://www.starhub.com/</a></p><p>3.M1(Mobile One): 电话费用和流量价格与新电信基本一致。</p><p>查询话费：拨打 1267  订购流量：#100<em>7#  查询流量:#100</em>2#</p><p>如拨打国内长途电话，请在拨打国内手机号之前加拨 02186，可节省部分话费；若拨打国内固定电话，请先拨打 02186，再拨打区号（去掉前面第一个0）和固话号码。</p><p>详情请参考官网：<a href="https://www.m1.com.sg" target="_blank" rel="noopener">https://www.m1.com.sg</a></p><p>4.Circles.Life: The Best No-Contract Mobile Plan</p><p>详情请参考官网：<a href="https://pages.circles.life/" target="_blank" rel="noopener">https://pages.circles.life/</a></p><p>5.Zero1: No data cap. No excess data charges ever! $29.99 Unlimited Data* mobile plan</p><p>详情请参考官网：<a href="https://zero1.sg/" target="_blank" rel="noopener">https://zero1.sg/</a></p><h2 id="新加坡交通指南"><a href="#新加坡交通指南" class="headerlink" title="新加坡交通指南"></a>新加坡交通指南</h2><p>新加坡主要交通出行方式：地铁（MRT）、轻轨（LRT）、巴士（Bus）和德士（Taxi）。</p><p>其中地铁（MRT）是新加坡最便捷的交通工具，也是日常最佳的出行方式。根据官方 2017 年 1 月份提供的最新信息显示，全岛共设有 142 个车站，目前主要的运营线中，南北运营线以“NS”红线标明，东西运营线以“EW”绿线标明，东北运营线以“NE”紫线标明，环线以“CC”黄线标明，市区运营线以“DT”蓝线。</p><p><img src="http://ws2.sinaimg.cn/large/7207510dgy1ftu6uc735wj215o0xp48v.jpg" alt="新加坡地铁图"></p><p>新加坡地铁图</p><p><a href="https://exploresg.com/ditie/" target="_blank" rel="noopener">https://exploresg.com/ditie/</a></p><p>新加坡地铁和巴士车(站)内规定</p><ol><li>不可吃喝、吸烟、携带榴莲、大声喧哗和带宠物 </li><li>Bus 不报站、上下车需要刷卡</li></ol><p>温馨提示</p><ol><li>地铁和巴士上冷气很足，建议携带薄外套</li><li>在 20 分钟内，地铁和巴士之间转换，车资有优惠</li><li>在地铁或者商场等使用扶梯时，左侧是站立侧，右侧是快速通道</li></ol><h2 id="新加坡医疗指南"><a href="#新加坡医疗指南" class="headerlink" title="新加坡医疗指南"></a>新加坡医疗指南</h2><p>新加坡是一个热带国家，从国内刚过去有可能因水土不服引起的伤风、感冒、皮肤敏感或蚊虫叮咬等。出行之前可以带一些三九胃泰、牛黄解毒等日常药品之类的药品，防范于未然是最好的。</p><p>看医生：在新加坡持有工作签证，所在的公司会按照新加坡劳工部规定给每位员工会购买医疗保险或者费用报销。</p><p>医疗保险：一般是三种模式</p><ol><li>直接去合作门诊，提供公司信息，看病不用自己拿钱。</li><li>直接去合作门诊，提供公司信息，看病前给门诊 5 新币（每个公司不一样），其它的费用不用自己拿。</li><li>直接去合作门诊，自己先付产生的费用，然后去公司报销。意外伤害险等（视公司合同规定）。</li></ol><h2 id="新加坡房屋指南"><a href="#新加坡房屋指南" class="headerlink" title="新加坡房屋指南"></a>新加坡房屋指南</h2><blockquote><p>组屋(HDB)</p></blockquote><p>新加坡的“组屋”，全称为组合房屋。由新加坡建屋发展局（HDB）不以盈利为目的承担建筑的楼房，为大部分新加坡人（80%）的住所。</p><p>组屋一般分为三房式、四房式和五房式。三房式指一厅两房，使用面积约 60 平方米；四房式是一厅三房，使用面积约 90 平方米；五房式是两厅三房，使用面积大致在 110 平方米。</p><p>组屋的区分都是按照地区名+数字，例如：PasirRis Block 186（巴西立大牌 186）、YishunBlock 210（义顺大牌 210）等。</p><p>屋内客厅，厨房，卫生间都是公用设施，一般会配备冰箱，洗衣机，空调或者风扇。</p><p>租房费用（一般情况下）：</p><p>新型组屋(近10年内建成的)相对条件会好很多 (平均价格S$1000-1200/间)<br>单人单间：500-1000新币<br>二人间：350-550新币/人<br>四人间：270-350新币/人</p><p><strong>小贴士</strong></p><ol><li>新加坡政府规定租住的房子必须要能在建屋局上注册。正常情况下，注册要求至少住 6 个月。如果不能注册，就是不合法的房屋。</li><li>如果退租，一定要提前一月声明，以防押金不退。</li><li>仔细看合同，仔细看合同，仔细看合同。</li></ol><blockquote><p>私人公寓(Condo)</p></blockquote><p>公寓，常见两房式或三房式，相当于国内的高档成熟社区，内有免费游泳池、健身房，BBQ等公共设施，住宿环境相对较好，价格也相对高一些；大部分的condo房间都有主人房与非主人房之分，主人房有自己独立的洗手间和相对宽敞的卧室，当然价格也比非主人房高200-300/月(非主人房平均价格<br>S$1,000-1,500/间/月)</p><blockquote><p>排屋(Terrace)</p></blockquote><p>独门不独栋的联排别墅，此类出租房源相对较少，住宿环境、价格与房子位置、条件有相当大的关系。</p><blockquote><p>独栋别墅(Landedproperty)</p></blockquote><p>少见于房间出租。</p><h2 id="货币兑换和汇款"><a href="#货币兑换和汇款" class="headerlink" title="货币兑换和汇款"></a>货币兑换和汇款</h2><blockquote><p>如果时间宽裕，推荐走新加坡工商银行渠道</p></blockquote><p>新加坡实行货币开放政策，货币兑换中心随处可见，尤其是在牛车水(China Town)附近。如有汇款需求到国内，可以先去牛车水汇款(珍珠坊二楼)，方便快捷。等周围熟悉后，推荐去淡宾尼(Tampines)汇款到国内，汇率会比其它地方高一些。具体的地方，在地图搜索Tampines Money Exchange Center。 </p><p>小贴士：汇款中心一般可以汇到中国邮政、中国农业、中国交通、中国招商和中国银行等。第一次汇钱到国内，当填写汇款单据的时候一定要知道对方银行卡是在<strong>省</strong>市**银行支行开户的(很重要)。</p><h2 id="法律法规"><a href="#法律法规" class="headerlink" title="法律法规"></a>法律法规</h2><p>新加坡向来是给世人展示优美环境，井然秩序，舒适安全的名片，然而这些美好的展现离不开新加坡法律制度的约束和规范。Singaporeis a“fine”country完整的诠释了这两方面。所以在新加坡生活，你需要注意以下细节：</p><ol><li>自动排队：公共场合最经常听到的一句话就是please queue！</li><li>着装：不同场合穿不同衣服,建议每天换衣服。</li><li>公共习惯：乘坐公共交通或者在公共场合用餐时,切忌大声喧哗,不然你一样会被当做异类奥!而且记得再饿也要撑到下车再用餐。</li><li>言论：新加坡是多文化和宗教融合的国家,公共场合不要发表敏感政治言论或者宗教话题,这也体现互相尊重。</li><li>不当行为：竖中指可能会被当做种族歧视处理的</li><li>如厕：来也匆匆,去也冲冲。如若不然请准备 500 新币吧。</li><li>口香糖：公共场所不允许嚼口香糖,不可以随意买卖,允许带少量入境,正是这个奇葩的规定维护了公共环境的整洁。</li><li>吸烟：新加坡公共场所绝对禁烟。如若吸烟不幸被抓到,恭喜你一个月的工资(高达 2000 新币)为国家做贡献了!</li><li>垃圾：乱丢垃圾初犯者将处高达 1000 新币罚款,再犯者将罚款额提高至 2000 新币以及在劳改法令下受罚。</li><li>交通规则：闯红灯,随便乱穿马路这些不多啰嗦。违反的是规则,伤害的是人身安全,因为小编也感觉马路上的车如同闪电般行驶。</li><li>不可非法聚会和使用暴力</li></ol><p>以上内容是提醒大家在生活细节方面应遵守的规则,但有些行为未必就可以罚款结案的,比如:签证到期后逾期逗留、抢劫、公共场所涂鸦、纵火、携带毒品等这些可都是在鞭刑的定罪范围内的。</p><p><strong>最后郑重的提醒各位：</strong>在机场不要发扬助人为乐精神帮陌生人携带物品,因为很有可能你同时把生命交给了别人(运输毒品和贩毒同罪)。</p><h2 id="工作准证遗失如何处理"><a href="#工作准证遗失如何处理" class="headerlink" title="工作准证遗失如何处理"></a>工作准证遗失如何处理</h2><ol><li>发现丢失后立即携带护照或者工作准证的复印件到任何一间警察局报案，记得保存报案记录原件。</li><li>通知雇主公司 HR,让其在 7 天之内在新加坡人力部网上提交补办工作准证的申请。</li><li>费用:首次补办 100 新币,第二次是 300 新币(一般在提交申请补办 4 个工作日可去新卡)</li></ol><h2 id="银行卡遗失如何处理"><a href="#银行卡遗失如何处理" class="headerlink" title="银行卡遗失如何处理"></a>银行卡遗失如何处理</h2><ol><li>发现遗失后立即拨打银行客户服务中心热线挂失</li><li>银行客户专员会核对护照和工作准证信息,然后等待新卡邮寄到住处或者去支行直接领取。</li></ol><p>POSB 用户请拨打 18003396963<br>DBS 用户请拨打 18001111111<br>UOB 用户请拨打 18002222121<br>OCBC 用户请拨打 18003633333</p><h2 id="护照遗失如何处理"><a href="#护照遗失如何处理" class="headerlink" title="护照遗失如何处理"></a>护照遗失如何处理</h2><p>如护照遗失或被盗,请立即到中国驻新加坡大使馆如实填写《护照遗失陈述表》，提供关于护照遗失或被盗的情况说明,以及提供报警记录原件及复印件。如护照损毁,请提交损毁的护照,以及护照损毁的原因说明。</p><p>具体的更换护照和网上预约等等详细流程请参考大使馆的官网：<a href="http://www.chinaembassy.org.sg/chn/" target="_blank" rel="noopener">http://www.chinaembassy.org.sg/chn/</a></p><p>中国驻新加坡大使馆信息:</p><p>地址:150 TANGLIN ROAD,SINGAPORE 247969</p><p>Ø领事部：64712117；92971517(仅限紧急领保求助,不接受证件咨询)</p><p>Email: <a href="mailto:chinaemb_sg@mfa.gov.cn" target="_blank" rel="noopener">chinaemb_sg@mfa.gov.cn</a></p><p>办公时间：周一至周五(节假日除外)</p><p>上午 9:00-11:30</p><h2 id="新加坡日常-App-推荐"><a href="#新加坡日常-App-推荐" class="headerlink" title="新加坡日常 App 推荐"></a>新加坡日常 App 推荐</h2><blockquote><p>如果是 Android 记得安装 Google 框架，如果是 iOS 记得调整更改 Apple ID 国家或地区</p></blockquote><p>交通: Grab(类似国内滴滴)、Google Map(谷歌地图)、SG Buses(公交时刻表)、Mobike（摩拜单车国内账户通用）</p><p>社交: Facebook、WhatsApp、Twitter、Instagram</p><p>购物: Shopee、Lazada、eBay、Amazon、淘宝国际、京东国际、网易考拉、网易严选、小米有品</p><p>娱乐: Youtube(视频必备)、 Golden Village(电影院)、CATHAY (电影院)</p><p>快递: 小坡岛集运</p><h2 id="新加坡入境卡模板-重要"><a href="#新加坡入境卡模板-重要" class="headerlink" title="新加坡入境卡模板(重要)"></a>新加坡入境卡模板(重要)</h2><p><img src="//ws3.sinaimg.cn/large/7207510dgy1frc1vhyoaqj20fa0skq56.jpg" alt="image"></p><p><img src="//ws3.sinaimg.cn/large/7207510dgy1frc1w3vig9j20f60egq3m.jpg" alt="image"></p><h2 id="租房"><a href="#租房" class="headerlink" title="租房"></a>租房</h2><blockquote><p>如果英语不是太差，不推荐狮城BBS或者微博租房，如果你有认识的新加坡房产中介自然是最佳选择</p></blockquote><p>Property Guru - <a href="http://www.propertyguru.com.sg/" target="_blank" rel="noopener">http://www.propertyguru.com.sg/</a></p><p>新加坡本地发布平台，房源多。使用下来感觉Property Guru信息发布是最多的，信息筛选条件多，容易搜索到希望的房源。多为中介发布，有中介费。</p><p>Nestia - <a href="https://www.nestia.com/" target="_blank" rel="noopener">https://www.nestia.com/</a></p><p>新加坡本地发布平台，功能强。Nestia上的房源也比较多，但感觉不如Property Guru。不过Nestia可以以某一建筑（公司地址）为中心从远及近的搜索房源。找步行距离的房源就很合适了。另外自带的导航也不错。所以我是Property Guru和Nestia结合使用。</p><p>99.co - <a href="https://www.99.co/" target="_blank" rel="noopener">https://www.99.co/</a></p><p>新加坡本地发布平台，平台新。和上面两个相比算是一个比较新的平台，数据没有Property Guru多但是针对房屋本身的介绍更加详细，房源信息相对真实。</p><p>在新加坡租房，有哪些经验可以分享？<br><a href="https://www.zhihu.com/question/22430961" target="_blank" rel="noopener">https://www.zhihu.com/question/22430961</a></p><h2 id="新加坡父母签证"><a href="#新加坡父母签证" class="headerlink" title="新加坡父母签证"></a>新加坡父母签证</h2><blockquote><p>网上找到的，忘记出处了，如果有错误描述请及时指正</p></blockquote><p>本人PR，老婆七月份预产期。打算让父母6月中旬来。计划步骤如下:<br>1,先买往返机票（返程可更改的）。<br>===对的。<br>2,  5月份申请父母旅游签证。<br>===旅游签证可提前一个月内申请，有效期多数63天，也有一年，两年，非固定。有效期内入境即可。<br>3,父母来新后申请延期至89天。<br>===对的。<br>4,同时申请LTVP。<br>===也没错。<br>5,悲剧后申诉。<br>===步骤没错。<br>请指点一下按这样做有什么不拖吗？<br>===有什么不妥是吧？没什么不妥的，如果觉得自己条件还可以，就可以早点安排申请LTVP，如果觉得条件比较牵强，可以晚一点入境，晚一点延期，晚一点申请ltvp，争取在月子后多待一点时间帮你们带孩子。<br>可以现在就申请旅行签证吗?<br>===提前一个月内申请，一个月内，内。<br>旅行签证有效期多久?一年多次吗？<br>===上面已经回答了。<br>申请LTVP必须人在新加坡吗？<br>===是的。必须入境后申请。</p><p><a href="https://www.ica.gov.sg/" target="_blank" rel="noopener">https://www.ica.gov.sg/</a></p><h2 id="个人经验"><a href="#个人经验" class="headerlink" title="个人经验"></a>个人经验</h2><blockquote><p>选择新加坡的理由：给自己多一种选择</p></blockquote><ul><li>MOM: Ministry of Manpower</li><li>IPA: In-Principle Approval</li><li>EP: Employment Pass</li><li>DP: Dependant’s Pass</li></ul><ol><li>原始坐标：上海，无留学经验也没有去过新加坡</li><li>猎头推荐新加坡的职位，想想自己那被遗忘的蹩脚英语抱着试一试的心态</li><li>一共3轮Skype远程视频面试，约4周时间到最后确认offer</li><li>约1天时间思考，离职申请，签电子合同</li><li>检查护照有效期，下载学信网英文翻译认证，由HR帮助提交申请EP，约3周内收到IPA</li><li>在上海户口所在区公证处办理结婚证公证翻译，约3周时间完成，又慢又麻烦</li><li>完成EP后由HR帮助提交申请DP，约1周内收到IPA</li><li>购买机票，打印IPA，带上护照，打包行李，兑换4000新币，确认人事档案存放地址，选择不缴纳每月养老保险和医疗保险约1500元人民币(可由父母代缴，中断非连续缴纳暂时不影响回国养老，以政策变化为准)</li><li>飞机上填写好新加坡入境卡，完成入境登记，无需录入指纹，开启华为天际通</li><li>抵达公司提前安排好的住址，熟悉新加坡环境</li><li>办理EZ-Link交通卡和Singtel Prepaid手机卡(如果没有强需求可以暂时不办理)</li><li>公司HR提交EP现场办理申请，收到邮件后预约MOM办理时间（我没有被要求体检，根据不同公司情况而定）</li><li>约1周后收到EP绿色实体卡，使用SGWorkPass扫描保存照片，注册SingPass后约1周左右收到密码信封</li><li>公司开具证明办理银行卡，新加坡本地我选择UOB(保持1000新币存款)，另外强烈推荐再办理工商银行卡(持卡0门槛，转账回国0费用)</li><li>网上申请Zero1的无限流量手机卡，约3个工作日收到直接使用，弃用Singtel Prepaid（浪费了25新币）</li><li>新加坡日常消费以现金为主，我本人习惯手机支付无奈降级至刷信用卡阶段(持有浦发AE白/Visa/Master)，怀念下国内的支付宝和微信</li></ol><p>我刚来新加坡1个多月，不用担心语言不通，大部分人都会说华语。新加坡真的不算大，地铁和公交都很方便，空气质量很好至少我的鼻炎消失了，天气没有国内那么热，居然没有蚊子，没有蚊子，没有蚊子。在这段时间里我幸运了结识了交大和复旦的校友，跟随专业的中介实地考察了新加坡的租房和买房市场，走遍了几个重要的核心区域，顺便吃了几顿亲民的米其林一星。之后我应该还会继续更新自己在新加坡的经历，比如健身、快递、看病等日常生活，希望对大家有所帮助。</p>]]></content>
    
    <summary type="html">
    
      为帮助大家玩转新加坡、快速适应当地生活
    
    </summary>
    
      <category term="生活 | Life" scheme="https://wsgzao.github.io/categories/%E7%94%9F%E6%B4%BB-Life/"/>
    
    
  </entry>
  
  <entry>
    <title>在Windows和Macbook上自动更新和推送Hexo至GitHub</title>
    <link href="https://wsgzao.github.io/post/hexo-deploy/"/>
    <id>https://wsgzao.github.io/post/hexo-deploy/</id>
    <published>2018-07-31T12:40:07.000Z</published>
    <updated>2018-08-01T09:37:18.410Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Hexo自带deploy模块，网上也有很多大神分享各种各样的CI/CD方案，我没有想过写Blog需要这么复杂，而且Hexo已经很稳定了。我因为开始学习使用MacBook，所以逼着自己把之前用在Windows上的脚本用Python重新写了下，很简陋但也很好用，相信大家可以写出更加通用和优美的代码。</p><blockquote><p>使用Powershell和Python自动化更新和推送Hexo静态Blog</p></blockquote><hr><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018年07月31日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/hexo-deploy/">https://wsgzao.github.io/post/hexo-deploy/</a></p><hr><h2 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h2><blockquote><p>./deploy_hexo.ps1</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># hexo g</span><br><span class="line">cd .\hexo</span><br><span class="line">hexo clean</span><br><span class="line">hexo g</span><br><span class="line"></span><br><span class="line"># del old files</span><br><span class="line">cd ..\wsgzao.github.io</span><br><span class="line">Remove-Item about,archives,categories,css,fancybox,font,img,index,js,page,post -recurse -force</span><br><span class="line"></span><br><span class="line"># deploy github</span><br><span class="line">Copy-Item ..\hexo\public\* .\ -recurse -force</span><br><span class="line">git add *</span><br><span class="line">git commit -m &quot;mod&quot;</span><br><span class="line">git push</span><br><span class="line"></span><br><span class="line">cd ..</span><br></pre></td></tr></table></figure><h2 id="MacBook"><a href="#MacBook" class="headerlink" title="MacBook"></a>MacBook</h2><blockquote><p>python3 deploy_hexo.py</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">hexo = os.path.join(os.getcwd(), <span class="string">"hexo"</span>)</span><br><span class="line">wsgzao = os.path.join(os.getcwd(), <span class="string">"wsgzao.github.io"</span>)</span><br><span class="line"></span><br><span class="line">home = os.getcwd()</span><br><span class="line"><span class="keyword">print</span> (<span class="string">"current directory %s"</span> % home)</span><br><span class="line"></span><br><span class="line">os.chdir(hexo)</span><br><span class="line">retval = os.getcwd()</span><br><span class="line"><span class="keyword">print</span> (<span class="string">"chdir to hexo %s"</span> % retval)</span><br><span class="line"></span><br><span class="line">subprocess.call([<span class="string">'hexo clean'</span>], shell=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line">subprocess.call([<span class="string">'hexo g'</span>], shell=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line">os.chdir(wsgzao)</span><br><span class="line">retval = os.getcwd()</span><br><span class="line"><span class="keyword">print</span> (<span class="string">"chdir to wsgzao %s"</span> % retval)</span><br><span class="line"></span><br><span class="line">subprocess.call([<span class="string">'rm -rf about archives categories css fancybox font img index js page post'</span>], shell=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line">subprocess.call([<span class="string">'cp -rf ../hexo/public/* ./'</span>], shell=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line">subprocess.call([<span class="string">'git add *'</span>], shell=<span class="keyword">True</span>)</span><br><span class="line">subprocess.call([<span class="string">'git commit -m "mod"'</span>], shell=<span class="keyword">True</span>)</span><br><span class="line">subprocess.call([<span class="string">'git push'</span>], shell=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      使用Powershell和Python自动化更新和推送Hexo静态Blog
    
    </summary>
    
      <category term="Hexo" scheme="https://wsgzao.github.io/categories/Hexo/"/>
    
    
  </entry>
  
  <entry>
    <title>LVS+Keepalived 使用指北</title>
    <link href="https://wsgzao.github.io/post/lvs-keepalived/"/>
    <id>https://wsgzao.github.io/post/lvs-keepalived/</id>
    <published>2018-07-31T06:59:49.000Z</published>
    <updated>2018-08-01T08:58:14.933Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>负载均衡技术是构建大型网站必不可少的架构策略之一。它的目的是把用户的请求分发到多台后端的设备上，用以均衡服务器的负载。我们可以把负载均衡器划分为两大类：硬件负载均衡器和软件负载均衡器。这里重点介绍软件实现方法中的LVS+Keepalived。</p><blockquote><p>学习使用 LVS+Keepalived</p></blockquote><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018年07月31日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/lvs-keepalived/">https://wsgzao.github.io/post/lvs-keepalived/</a></p><p><strong>扩展阅读</strong></p><p>LVS - <a href="http://www.linuxvirtualserver.org/zh/index.html" target="_blank" rel="noopener">http://www.linuxvirtualserver.org/zh/index.html</a><br>Keepalived - <a href="http://www.keepalived.org/" target="_blank" rel="noopener">http://www.keepalived.org/</a></p><hr><h2 id="推荐阅读"><a href="#推荐阅读" class="headerlink" title="推荐阅读"></a>推荐阅读</h2><p>LVS - <a href="http://www.linuxvirtualserver.org/Documents.html" target="_blank" rel="noopener">http://www.linuxvirtualserver.org/Documents.html</a><br>Keepalived - <a href="http://www.keepalived.org/doc/" target="_blank" rel="noopener">http://www.keepalived.org/doc/</a><br>LVS入门系列：初识LVS与LVS-NAT - <a href="http://www.zsythink.net/archives/2134" target="_blank" rel="noopener">http://www.zsythink.net/archives/2134</a><br>lvs-keepalived - <a href="https://pan.baidu.com/s/1s0P6nUt8WF6o_N3wdE3uKg" target="_blank" rel="noopener">https://pan.baidu.com/s/1s0P6nUt8WF6o_N3wdE3uKg</a></p><p>关键词：</p><ul><li>LB (Load Balancer 负载均衡) </li><li>HA (High Available 高可用) </li><li>FailOver (失败切换) </li><li>CLUSTER (集群) </li><li>LVS (Linux Virtual Server Linux 虚拟服务器) </li><li>RealServer 后端真实服务器，这个概念相对于LVS Director,指lvs集群中真正执行客户端请求的服务器。 </li><li>Director 前端调度器，指安装lvs(ipvsadm)的服务器，负责调度 realserver 提供负载均衡。 </li><li>VIP (Virtual_IP_address) 虚拟的IP地址</li><li>DIP (Director IP) 前段调度器的IP地址</li><li>RIP (RealServer IP) 后端正式服务器的IP地址</li></ul><h2 id="负载均衡（LB-Cluster）"><a href="#负载均衡（LB-Cluster）" class="headerlink" title="负载均衡（LB Cluster）"></a>负载均衡（LB Cluster）</h2><blockquote><p>负载均衡实现方法有两种：硬件实现和软件实现</p></blockquote><p>硬件比较常见的有：</p><ol><li>F5 Big-IP</li><li>Citrix Netscaler</li></ol><p>软件比较常见的有：</p><ol><li>LVS（Linux Virtual Server）</li><li>HAProxy</li><li>Nginx</li></ol><p>LVS特点是：</p><ol><li>首先它是基于4层的网络协议的，抗负载能力强，对于服务器的硬件要求除了网卡外，其他没有太多要求；</li><li>配置性比较低，这是一个缺点也是一个优点，因为没有可太多配置的东西，大大减少了人为出错的几率；</li><li>应用范围比较广，不仅仅对web服务做负载均衡，还可以对其他应用（mysql）做负载均衡；</li><li>LVS架构中存在一个虚拟IP的概念，需要向IDC多申请一个IP来做虚拟IP。</li></ol><p>Nginx负载均衡器的特点是：</p><ol><li>工作在网络的7层之上，可以针对http应用做一些分流的策略，比如针对域名、目录结构；</li><li>Nginx安装和配置比较简单，测试起来比较方便；</li><li>也可以承担高的负载压力且稳定，一般能支撑超过上万次的并发；</li><li>Nginx可以通过端口检测到服务器内部的故障，比如根据服务器处理网页返回的状态码、超时等等，并且会把返回错误的请求重新提交到另一个节点，不过其中缺点就是不支持url来检测；</li><li>Nginx对请求的异步处理可以帮助节点服务器减轻负载；</li><li>Nginx能支持http和Email，这样就在适用范围上面小很多；</li><li>默认有三种调度算法: 轮询、weight以及ip_hash（可以解决会话保持的问题），还可以支持第三方的fair和url_hash等调度算法；</li></ol><p>HAProxy的特点是：</p><ol><li>HAProxy是工作在网络7层之上；</li><li>支持Session的保持，Cookie的引导等；</li><li>支持url检测后端的服务器出问题的检测会有很好的帮助；</li><li>支持的负载均衡算法：动态加权轮循(Dynamic Round Robin)，加权源地址哈希(Weighted Source Hash)，加权URL哈希和加权参数哈希(Weighted Parameter Hash)；</li><li>单纯从效率上来讲HAProxy更会比Nginx有更出色的负载均衡速度；</li><li>HAProxy可以对Mysql进行负载均衡，对后端的DB节点进行检测和负载均衡。</li></ol><h2 id="LVS-keepalived-简介"><a href="#LVS-keepalived-简介" class="headerlink" title="LVS+keepalived 简介"></a>LVS+keepalived 简介</h2><p>在lvs+keepalived环境里面，lvs主要的工作是提供调度算法，把客户端请求按照需求调度在real服务器，keepalived主要的工作是提供lvs控制器的一个冗余，并且对real服务器做健康检查，发现不健康的real服务器，就把它从lvs集群中剔除，real服务器只负责提供服务。</p><h2 id="LVS"><a href="#LVS" class="headerlink" title="LVS"></a>LVS</h2><p>LVS是一个开源的软件，可以实现LINUX平台下的简单负载均衡。LVS是Linux Virtual Server的缩写，意思是Linux虚拟服务器。<br>目前有三种IP负载均衡技术（VS/NAT,VS/TUN,VS/DR）</p><p>Virtual Server via Network Address Translation（VS/NAT）<br>通过网络地址转换，调度器重写请求报文的目标地址，根据预设的调度算法，将请求分派给后端的真实服务器；真实服务器的响应报文通过调度器时，报文的源地址被重写，再返回给客户，完成整个负载调度过程。</p><p>Virtual Server via IP Tunneling（VS/TUN）<br>采用NAT技术时，由于请求和响应报文都必须经过调度器地址重写，当客户请求越来越多时，调度器的处理能力将成为瓶颈。为了解决这个问题，调度器把请求报 文通过IP隧道转发至真实服务器，而真实服务器将响应直接返回给客户，所以调度器只处理请求报文。由于一般网络服务应答比请求报文大许多，采用 VS/TUN技术后，集群系统的最大吞吐量可以提高10倍。</p><p>Virtual Server via Direct Routing（VS/DR）<br>VS/DR通过改写请求报文的MAC地址，将请求发送到真实服务器，而真实服务器将响应直接返回给客户。同VS/TUN技术一样，VS/DR技术可极大地 提高集群系统的伸缩性。这种方法没有IP隧道的开销，对集群中的真实服务器也没有必须支持IP隧道协议的要求，但是要求调度器与真实服务器都有一块网卡连 在同一物理网段上。</p><p>八种调度算法（rr,wrr,lc,wlc,lblc,lblcr,dh,sh）</p><h3 id="工作模式"><a href="#工作模式" class="headerlink" title="工作模式"></a>工作模式</h3><blockquote><p>原生只有3种模式(NAT,TUN,DR), fullnat工作模式默认不支持</p></blockquote><p>LVS是四层负载均衡，也就是说建立在OSI模型的第四层——传输层之上，传输层上有我们熟悉的TCP/UDP，LVS支持TCP/UDP的负载均衡。因为LVS是四层负载均衡，因此它相对于其它高层负载均衡的解决办法，比如DNS域名轮流解析、应用层负载的调度、客户端的调度等，它的效率是非常高的。</p><p>LVS的IP负载均衡技术是通过IPVS模块来实现的，IPVS是LVS集群系统的核心软件，它的主要作用是：安装在Director Server上，同时在Director Server上虚拟出一个IP地址，用户必须通过这个虚拟的IP地址访问服务。这个虚拟IP一般称为LVS的VIP，即Virtual IP。访问的请求首先经过VIP到达负载调度器，然后由负载调度器从Real Server列表中选取一个服务节点响应用户的请求。 当用户的请求到达负载调度器后，调度器如何将请求发送到提供服务的Real Server节点，而Real Server节点如何返回数据给用户，是IPVS实现的重点技术，IPVS实现负载均衡机制有几种，分别是NAT、DR、TUN及FULLNAT。</p><h4 id="lvs-nat"><a href="#lvs-nat" class="headerlink" title="lvs-nat"></a>lvs-nat</h4><p>NAT（Network Address Translation 网络地址转换）是一种外网和内外地址映射的技术，内网可以是私有网址，外网可以使用NAT方法修改数据报头，让外网与内网能够互相通信。NAT模式下，网络数据报的进出都要经过LVS的处理。LVS需作为RS（真实服务器）的网关。当包到达LVS时，LVS做目标地址转换（DNAT），将目标IP改为RS的IP。RS接收到包以后，仿佛是客户端直接发给它的一样。RS处理完，返回响应时，源IP是RS IP，目标IP是客户端的IP。这时RS的包通过网（LVS）中转，LVS会做源地址转换（SNAT），将包的源地址改为VIP，这样，这个包对客户端看起来就仿佛是LVS直接返回给它的。客户端无法感知到后端RS的存在。</p><p>（1）RIP和DIP必须在同一个IP网络，且应该使用私网地址；RS的网关要指向DIP；<br>（2）请求报文和响应报文都必须经由Director转发；Director易于成为系统瓶颈；<br>（3）支持端口映射，可修改请求报文的目标PORT；<br>（4）vs必须是Linux系统，rs可以是任意系统；</p><p>缺点：在整个过程中，所有输入输出的流量都要经过LVS 调度服务器。显然，LVS 调度服务器的网络I/O压力将会非常大，因此很容易成为瓶颈，特别是对于请求流量很小，而响应流量很大的Web类应用来说尤为如此。</p><p>优点：NAT模式的优点在于配置及管理简单，由于了使用NAT技术，LVS 调度器及应用服务器可以在不同网段中，网络架构更灵活，应用服务器只需要进行简单的网络设定即可加入集群。</p><h4 id="lvs-dr"><a href="#lvs-dr" class="headerlink" title="lvs-dr"></a>lvs-dr</h4><blockquote><p>lvs-dr工作模式最为常用</p></blockquote><p>DR（Direct Routing 直接路由模式）此模式时LVS 调度器只接收客户发来的请求并将请求转发给后端服务器，后端服务器处理请求后直接把内容直接响应给客户，而不用再次经过LVS调度器。LVS只需要将网络帧的MAC地址修改为某一台后端服务器RS的MAC，该包就会被转发到相应的RS处理，注意此时的源IP和目标IP都没变。RS收到LVS转发来的包时，链路层发现MAC是自己的，到上面的网络层，发现IP也是自己的，于是这个包被合法地接受，RS感知不到前面有LVS的存在。而当RS返回响应时，只要直接向源IP（即用户的IP）返回即可，不再经过LVS。</p><p>注意：<br>(1) 确保前端路由器将目标IP为VIP的请求报文发往Director：<br>    (a) 在前端网关做静态绑定；<br>    (b) 在RS上使用arptables；<br>    (c) 在RS上修改内核参数以限制arp通告及应答级别；<br>            arp_announce<br>            arp_ignore<br>(2) RS的RIP可以使用私网地址，也可以是公网地址；RIP与DIP在同一IP网络；RIP的网关不能指向DIP，以确保响应报文不会经由Director；<br>(3) RS跟Director要在同一个物理网络；<br>(4) 请求报文要经由Director，但响应不能经由Director，而是由RS直接发往Client；<br>(5) 此模式不支持端口映射；</p><p>缺点：唯一的缺陷在于它要求LVS 调度器及所有应用服务器在同一个网段中，因此不能实现集群的跨网段应用。</p><p>优点：可见在处理过程中LVS Route只处理请求的直接路由转发，所有响应结果由各个应用服务器自行处理，并对用户进行回复，网络流量将集中在LVS调度器之上。</p><h4 id="lvs-tun"><a href="#lvs-tun" class="headerlink" title="lvs-tun"></a>lvs-tun</h4><p>TUN（virtual server via ip tunneling　IP 隧道）调度器把请求的报文通过IP隧道转发到真实的服务器。真实的服务器将响应处理后的数据直接返回给客户端。这样调度器就只处理请求入站报文。此转发方式不修改请求报文的IP首部（源IP为CIP，目标IP为VIP），而在原IP报文之外再封装一个IP首部（源IP是DIP，目标IP是RIP），将报文发往挑选出的目标RS；RS直接响应给客户端（源IP是VIP，目标IP是CIP），由于一般网络服务应答数据比请求报文大很多，采用lvs-tun模式后，集群系统的最大吞吐量可以提高10倍</p><p>注意：<br>(1) DIP, VIP, RIP都应该是公网地址；<br>(2) RS的网关不能，也不可能指向DIP；<br>(3) 请求报文要经由Director，但响应不能经由Director；<br>(4) 此模式不支持端口映射；<br>(5) RS的操作系统得支持隧道功能</p><p>缺点:由于后端服务器RS处理数据后响应发送给用户，此时需要租借大量IP（特别是后端服务器使用较多的情况下）。</p><p>优点:实现lvs-tun模式时，LVS 调度器将TCP/IP请求进行重新封装并转发给后端服务器，由目标应用服务器直接回复用户。应用服务器之间是通过IP 隧道来进行转发，故两者可以存在于不同的网段中。</p><h4 id="lvs-fullnat"><a href="#lvs-fullnat" class="headerlink" title="lvs-fullnat"></a>lvs-fullnat</h4><blockquote><p>lvs-fullnat工作模式默认不支持</p></blockquote><p>此模式类似DNAT，它通过同时修改请求报文的源IP地址和目标IP地址进行转发</p><p>注意：<br>(1) VIP是公网地址，RIP和DIP是私网地址，且通常不在同一IP网络；因此，RIP的网关一般不会指向DIP；<br>(2) RS收到的请求报文源地址是DIP，因此，只需响应给DIP；但Director还要将其发往Client；<br>(3) 请求和响应报文都经由Director；<br>(4) 支持端口映射；</p><h3 id="调度算法"><a href="#调度算法" class="headerlink" title="调度算法"></a>调度算法</h3><p>针对不同的网络服务需求和服务器配置，IPVS调度器实现了如下八种负载调度算法：</p><p>轮叫（Round Robin）<br>调度器通过”轮叫”调度算法将外部请求按顺序轮流分配到集群中的真实服务器上，它均等地对待每一台服务器，而不管服务器上实际的连接数和系统负载。</p><p>加权轮叫（Weighted Round Robin）<br>调度器通过”加权轮叫”调度算法根据真实服务器的不同处理能力来调度访问请求。这样可以保证处理能力强的服务器处理更多的访问流量。调度器可以自动问询真实服务器的负载情况，并动态地调整其权值。</p><p>最少链接（Least Connections）<br>调度器通过”最少连接”调度算法动态地将网络请求调度到已建立的链接数最少的服务器上。如果集群系统的真实服务器具有相近的系统性能，采用”最小连接”调度算法可以较好地均衡负载。</p><p>加权最少链接（Weighted Least Connections）<br>在集群系统中的服务器性能差异较大的情况下，调度器采用”加权最少链接”调度算法优化负载均衡性能，具有较高权值的服务器将承受较大比例的活动连接负载。调度器可以自动问询真实服务器的负载情况，并动态地调整其权值。</p><p>基于局部性的最少链接（Locality-Based Least Connections）<br>“基于局部性的最少链接” 调度算法是针对目标IP地址的负载均衡，目前主要用于Cache集群系统。该算法根据请求的目标IP地址找出该目标IP地址最近使用的服务器，若该服务器 是可用的且没有超载，将请求发送到该服务器；若服务器不存在，或者该服务器超载且有服务器处于一半的工作负载，则用”最少链接”的原则选出一个可用的服务 器，将请求发送到该服务器。</p><p>带复制的基于局部性最少链接（Locality-Based Least Connections with Replication）<br>“带复制的基于局部性最少链接”调度算法也是针对目标IP地址的负载均衡，目前主要用于Cache集群系统。它与LBLC算法的不同之处是它要维护从一个 目标IP地址到一组服务器的映射，而LBLC算法维护从一个目标IP地址到一台服务器的映射。该算法根据请求的目标IP地址找出该目标IP地址对应的服务 器组，按”最小连接”原则从服务器组中选出一台服务器，若服务器没有超载，将请求发送到该服务器，若服务器超载；则按”最小连接”原则从这个集群中选出一 台服务器，将该服务器加入到服务器组中，将请求发送到该服务器。同时，当该服务器组有一段时间没有被修改，将最忙的服务器从服务器组中删除，以降低复制的 程度。</p><p>目标地址散列（Destination Hashing）<br>“目标地址散列”调度算法根据请求的目标IP地址，作为散列键（Hash Key）从静态分配的散列表找出对应的服务器，若该服务器是可用的且未超载，将请求发送到该服务器，否则返回空。</p><p>源地址散列（Source Hashing）<br>“源地址散列”调度算法根据请求的源IP地址，作为散列键（Hash Key）从静态分配的散列表找出对应的服务器，若该服务器是可用的且未超载，将请求发送到该服务器，否则返回空。</p><h2 id="keepalived"><a href="#keepalived" class="headerlink" title="keepalived"></a>keepalived</h2><p>Keepalived 是运行在lvs之上，是一个用于做双机热备（HA）的软件，它的主要功能是实现真实机的故障隔离及负载均衡器间的失败切换，提高系统的可用性。</p><h3 id="运行原理"><a href="#运行原理" class="headerlink" title="运行原理"></a>运行原理</h3><p>keepalived通过选举（看服务器设置的权重）挑选出一台热备服务器做MASTER机器，MASTER机器会被分配到一个指定的虚拟ip，外部程序可通过该ip访问这台服务器，如果这台服务器出现故障（断网，重启，或者本机器上的keepalived crash等），keepalived会从其他的备份机器上重选（还是看服务器设置的权重）一台机器做MASTER并分配同样的虚拟IP，充当前一台MASTER的角色。</p><h3 id="选举策略"><a href="#选举策略" class="headerlink" title="选举策略"></a>选举策略</h3><p>选举策略是根据VRRP协议，完全按照权重大小，权重最大（0～255）的是MASTER机器，下面几种情况会触发选举</p><ol><li>keepalived启动的时候</li><li>master服务器出现故障（断网，重启，或者本机器上的keepalived crash等，而本机器上其他应用程序crash不算）</li><li>有新的备份服务器加入且权重最大</li></ol><h2 id="LVS-NAT和DR-模式详细配置"><a href="#LVS-NAT和DR-模式详细配置" class="headerlink" title="LVS(NAT和DR)模式详细配置"></a>LVS(NAT和DR)模式详细配置</h2><h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><p>分别准备两台web服务器，两台服务器配置相同</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">[root@web1 ~]<span class="comment"># yum install httpd* -y</span></span><br><span class="line">[root@web1 ~]<span class="comment"># iptables -F</span></span><br><span class="line">[root@web1 ~]<span class="comment"># /etc/init.d/iptables save</span></span><br><span class="line">iptables: Saving firewall rules to /etc/sysconfig/iptables:[  OK  ]</span><br><span class="line">[root@web1 ~]<span class="comment"># /etc/init.d/iptables stop</span></span><br><span class="line">iptables: Setting chains to policy ACCEPT: filter          [  OK  ]</span><br><span class="line">iptables: Flushing firewall rules:                         [  OK  ]</span><br><span class="line">iptables: Unloading modules:                               [  OK  ]</span><br><span class="line">[root@web1 ~]<span class="comment"># chkconfig iptables off</span></span><br><span class="line">[root@web1 ~]<span class="comment"># sed -i "s/SELINUX=enforcing/SELINUX disabled/g" /etc/selinux/config</span></span><br><span class="line">[root@web1 ~]<span class="comment"># setenforce 0</span></span><br><span class="line">[root@web1 ~]<span class="comment"># /etc/init.d/httpd start</span></span><br><span class="line">[root@web1 ~]<span class="comment"># ps -ef | grep httpd</span></span><br><span class="line">root       1482      1  0 18:24 ?        00:00:00 /usr/sbin/httpd</span><br><span class="line">apache     1484   1482  0 18:24 ?        00:00:00 /usr/sbin/httpd</span><br><span class="line">apache     1485   1482  0 18:24 ?        00:00:00 /usr/sbin/httpd</span><br><span class="line">apache     1486   1482  0 18:24 ?        00:00:00 /usr/sbin/httpd</span><br><span class="line">apache     1487   1482  0 18:24 ?        00:00:00 /usr/sbin/httpd</span><br><span class="line">apache     1488   1482  0 18:24 ?        00:00:00 /usr/sbin/httpd</span><br><span class="line">apache     1489   1482  0 18:24 ?        00:00:00 /usr/sbin/httpd</span><br><span class="line">apache     1490   1482  0 18:24 ?        00:00:00 /usr/sbin/httpd</span><br><span class="line">apache     1491   1482  0 18:24 ?        00:00:00 /usr/sbin/httpd</span><br><span class="line">root       1494   1331  0 18:24 pts/0    00:00:00 grep httpd</span><br><span class="line">[root@web1 ~]<span class="comment"># netstat --lntup | grep 80</span></span><br><span class="line">[root@web1 ~]<span class="comment"># netstat -lntup | grep 80</span></span><br><span class="line">tcp        0      0 :::80                       :::*                        LISTEN      1482/httpd</span><br><span class="line">[root@web1 ~]<span class="comment"># echo "webserver1" &gt; /var/www/html/index.html</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># LVS在3种方式下均需要打开ip_forward 功能</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"1"</span> &gt; /proc/sys/net/ipv4/ip_forward</span><br><span class="line">vim /etc/sysctl.conf</span><br><span class="line">net.ipv4.ip_forward = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置snat，如需永久保存可以编辑/etc/sysconfig/iptables</span></span><br><span class="line">/sbin/iptables -t nat -A POSTROUTING -j MASQUERAD</span><br><span class="line"></span><br><span class="line">vim /etc/sysconfig/iptables</span><br><span class="line"></span><br><span class="line">*nat</span><br><span class="line">:PREROUTING ACCEPT [6:504]</span><br><span class="line">:INPUT ACCEPT [0:0]</span><br><span class="line">:OUTPUT ACCEPT [1:52]</span><br><span class="line">:POSTROUTING ACCEPT [1:52]</span><br><span class="line"><span class="comment"># SNAT</span></span><br><span class="line">-A POSTROUTING -j MASQUERADE</span><br><span class="line">COMMIT</span><br><span class="line"></span><br><span class="line">*filter</span><br><span class="line">:INPUT ACCEPT [0:0]</span><br><span class="line">:FORWARD ACCEPT [0:0]</span><br><span class="line">:OUTPUT ACCEPT [0:0]</span><br><span class="line"><span class="comment"># 配置外网白名单</span></span><br><span class="line">-A INPUT -s 180.168.36.198 -j ACCEPT </span><br><span class="line">-A INPUT -s 180.168.34.218 -j ACCEPT </span><br><span class="line">-A INPUT -s 222.73.202.251 -j ACCEPT </span><br><span class="line"><span class="comment"># 控制端口</span></span><br><span class="line">-A INPUT -p tcp --dport 80 -j ACCEPT </span><br><span class="line">-A INPUT -p tcp --dport 22 -j ACCEPT</span><br><span class="line"><span class="comment"># For keepalived</span></span><br><span class="line"><span class="comment"># allow vrrp</span></span><br><span class="line">-A INPUT -p vrrp -j ACCEPT</span><br><span class="line">-A INPUT -p igmp -j ACCEPT</span><br><span class="line"><span class="comment"># allow multicast</span></span><br><span class="line">-A INPUT -d 224.0.0.18 -j ACCEPT</span><br><span class="line"><span class="comment"># 配置内网白名单</span></span><br><span class="line">-A INPUT -s 10.0.0.0/8 -j ACCEPT</span><br><span class="line">-A INPUT -s 172.16.0.0/12 -j ACCEPT</span><br><span class="line">-A INPUT -s 192.168.0.0/16 -j ACCEPT</span><br><span class="line"><span class="comment"># 开放本地和Ping</span></span><br><span class="line">-A INPUT -i lo -j ACCEPT  </span><br><span class="line">-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT </span><br><span class="line">-A INPUT -p icmp -j ACCEPT</span><br><span class="line"><span class="comment"># 拒绝其它</span></span><br><span class="line">-A INPUT -j DROP </span><br><span class="line">-A FORWARD -j DROP </span><br><span class="line"><span class="comment"># 开放出口</span></span><br><span class="line">-A OUTPUT -j ACCEPT </span><br><span class="line">COMMIT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启生效</span></span><br><span class="line">service iptables restart</span><br><span class="line"><span class="comment"># 复查结果</span></span><br><span class="line">iptables -nvL</span><br></pre></td></tr></table></figure><h3 id="LVS-NAT模式"><a href="#LVS-NAT模式" class="headerlink" title="LVS-NAT模式"></a>LVS-NAT模式</h3><p><img src="http://wx1.sinaimg.cn/large/7207510dgy1ft8axb9vd4j20ni09zjsh.jpg" alt="image"></p><p>VS/NAT 是最简单的方式,所有的 RealServer只需要将自己的网关指向 lvs(负载均衡器)即可,客户端可以是任意操作系统。VS/NAT 将报文的目标IP地址与目标端口改写成选定服务器(realserver)的地址,最后将修改后的报文发送给选定的服务器(realserver) </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装ipvsadm</span></span><br><span class="line"></span><br><span class="line">[root@LVS ~]<span class="comment"># yum install ipvsadm* -y</span></span><br><span class="line">[root@LVS ~]<span class="comment"># lsmod | grep lv_</span></span><br><span class="line">[root@LVS ~]<span class="comment"># lsmod | grep ip_vs</span></span><br><span class="line">ip_vs_rr                1420  0 </span><br><span class="line">ip_vs                 126897  2 ip_vs_rr</span><br><span class="line">libcrc32c               1246  1 ip_vs</span><br><span class="line">ipv6                  336282  270 ip_vs,ip6t_REJECT,nf_conntrack_ipv6,nf_defrag_ipv6</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置脚本如下</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">VIP=192.168.10.10 <span class="comment">#外网用户直接访问网站的IP地址</span></span><br><span class="line">RIP1=192.168.84.104 <span class="comment">#后端web1服务器的IP地址</span></span><br><span class="line">RIP2=192.168.84.105 <span class="comment">#后端web2服务器的IP地址</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></span><br><span class="line">start)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Start LVS as the mode NAT"</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"1"</span> &gt; /proc/sys/net/ipv4/ip_forward <span class="comment">#开启LVS服务器的IP路由转发功能</span></span><br><span class="line">    /sbin/ifconfig eth0:0 <span class="variable">$VIP</span> netmask 255.255.255.0 up <span class="comment">#设定VIP地址</span></span><br><span class="line">    /sbin/ipvsadm -A -t <span class="variable">$VIP</span>:80 -s rr</span><br><span class="line">    /sbin/ipvsadm -a -t <span class="variable">$VIP</span>:80 -r <span class="variable">$RIP1</span> -m</span><br><span class="line">    /sbin/ipvsadm -a -t <span class="variable">$VIP</span>:80 -r <span class="variable">$RIP2</span> -m</span><br><span class="line">    /sbin/ipvsadm </span><br><span class="line">    ;;</span><br><span class="line">stop)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Stop LVS"</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"0"</span> &gt; /proc/sys/net/ipv4/ip_forward</span><br><span class="line">    /sbin/ifconfig eth0:0 down</span><br><span class="line">    ;;</span><br><span class="line">*)  </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Usage:<span class="variable">$0</span> &#123;start|stop&#125;"</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行脚本后结果如下</span></span><br><span class="line"></span><br><span class="line">[root@LVS ~]<span class="comment"># sh lvs_nat.sh start</span></span><br><span class="line">Start LVS as the mode NAT</span><br><span class="line">IP Virtual Server version 1.2.1 (size=4096)</span><br><span class="line">Prot LocalAddress:Port Scheduler Flags</span><br><span class="line">  -&gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn</span><br><span class="line">TCP  192.168.10.10:http rr</span><br><span class="line">  -&gt; 192.168.84.104:http          Masq    1      0          0         </span><br><span class="line">  -&gt; 192.168.84.105:http          Masq    1      0          0 </span><br><span class="line"></span><br><span class="line"><span class="comment"># web服务器需要删除默认的路由网关，重新设置路由网关为LVS主机IP地址</span></span><br><span class="line"></span><br><span class="line">[root@web1 ~]<span class="comment"># route del default</span></span><br><span class="line">[root@web1 ~]<span class="comment"># route add default gateway 192.168.84.103</span></span><br><span class="line">[root@web1 ~]<span class="comment"># route</span></span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">192.168.84.0    *               255.255.255.0   U     0      0        0 eth0</span><br><span class="line">link-local      *               255.255.0.0     U     1002   0        0 eth0</span><br><span class="line">default         192.168.84.103  0.0.0.0         UG    0      0        0 eth0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过curl命令查看是否成功</span></span><br><span class="line"></span><br><span class="line">[root@LVS ~]<span class="comment"># curl 192.168.10.10</span></span><br><span class="line">webserver2</span><br><span class="line">[root@LVS ~]<span class="comment"># curl 192.168.10.10</span></span><br><span class="line">webserver1</span><br><span class="line">[root@LVS ~]<span class="comment"># curl 192.168.10.10</span></span><br><span class="line">webserver2</span><br><span class="line">[root@LVS ~]<span class="comment"># curl 192.168.10.10</span></span><br><span class="line">webserver1</span><br><span class="line">[root@LVS ~]<span class="comment"># curl 192.168.10.10</span></span><br><span class="line">webserver2</span><br><span class="line">[root@LVS ~]<span class="comment"># curl 192.168.10.10</span></span><br><span class="line">webserver1</span><br></pre></td></tr></table></figure><h3 id="LVS-DR模式"><a href="#LVS-DR模式" class="headerlink" title="LVS-DR模式"></a>LVS-DR模式</h3><p><img src="http://ws4.sinaimg.cn/large/7207510dgy1ft8awsu0mfj20o70bwabc.jpg" alt="image"></p><p>在 web服务中, 请求的流量一般小于回应的流量,VS/DR 方式利用这种非对称的特点,Director只负责调度请求, 而RealServer直接将相应的报文返回给客户机。VS/DR 方式是通过改写请求报文中的 “MAC” 地址部分来实现的, Director 和 RealServer 必需在同一个广播域/vlan的局域网。<br>RealServer 上绑定的VIP配置在各自 Non-ARP 网络设备上(如 lo 或 tunl),Director的VIP地址对外可见, RealServer的VIP对外是不可见的。 </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># LVS-DR RealServer服务器脚本，由于VS/DR工作原理，Realserver 需要抑制arp广播 </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#!/bin/bash </span></span><br><span class="line">VIP=192.168.84.200 </span><br><span class="line">/etc/rc.d/init.d/<span class="built_in">functions</span> </span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span> </span><br><span class="line">start) </span><br><span class="line">           <span class="built_in">echo</span> <span class="string">"start LVS of RealServer DR"</span> </span><br><span class="line">           /sbin/ifconfig lo:0 <span class="variable">$VIP</span> broadcast <span class="variable">$VIP</span> netmask 255.255.255.255 up </span><br><span class="line">           /sbin/route add -host <span class="variable">$VIP</span> dev lo:0  </span><br><span class="line">           <span class="built_in">echo</span> <span class="string">"1"</span> &gt;/proc/sys/net/ipv4/conf/lo/arp_ignore </span><br><span class="line">           <span class="built_in">echo</span> <span class="string">"2"</span> &gt;/proc/sys/net/ipv4/conf/lo/arp_announce </span><br><span class="line">           <span class="built_in">echo</span> <span class="string">"1"</span> &gt;/proc/sys/net/ipv4/conf/all/arp_ignore </span><br><span class="line">           <span class="built_in">echo</span> <span class="string">"2"</span> &gt;/proc/sys/net/ipv4/conf/all/arp_announce  </span><br><span class="line">       ;; </span><br><span class="line">stop) </span><br><span class="line">           /sbin/ifconfig lo:0 down </span><br><span class="line">           <span class="built_in">echo</span> <span class="string">"close LVS of RealServer DR"</span> </span><br><span class="line">           <span class="built_in">echo</span> <span class="string">"0"</span> &gt;/proc/sys/net/ipv4/conf/lo/arp_ignore </span><br><span class="line">           <span class="built_in">echo</span> <span class="string">"0"</span> &gt;/proc/sys/net/ipv4/conf/lo/arp_announce </span><br><span class="line">           <span class="built_in">echo</span> <span class="string">"0"</span> &gt;/proc/sys/net/ipv4/conf/all/arp_ignore </span><br><span class="line">           <span class="built_in">echo</span> <span class="string">"0"</span> &gt;/proc/sys/net/ipv4/conf/all/arp_announce </span><br><span class="line">           ;; </span><br><span class="line">  </span><br><span class="line">*) </span><br><span class="line">          <span class="built_in">echo</span> <span class="string">"Usage: <span class="variable">$0</span> &#123;start|stop&#125;"</span> </span><br><span class="line">          <span class="built_in">exit</span> 1 </span><br><span class="line"><span class="keyword">esac</span>  </span><br><span class="line"><span class="built_in">exit</span> 0 </span><br><span class="line"></span><br><span class="line"><span class="comment"># Lvs-DR 启动脚本</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#!/bin/bash </span></span><br><span class="line">VIP=192.168.84.200 </span><br><span class="line">RIP1=192.168.84.104 </span><br><span class="line">RIP2=192.168.84.105</span><br><span class="line">/etc/rc.d/init.d/<span class="built_in">functions</span> </span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span> </span><br><span class="line">start) </span><br><span class="line">           <span class="built_in">echo</span> <span class="string">"start LVS of DirectorServer DR"</span> </span><br><span class="line">           /sbin/ifconfig eth0:0 <span class="variable">$VIP</span> broadcast <span class="variable">$VIP</span> netmask 255.255.255.255 up </span><br><span class="line">           /sbin/route add -host <span class="variable">$VIP</span> dev eth0:0 </span><br><span class="line">           <span class="built_in">echo</span> <span class="string">"1"</span> &gt;/proc/sys/net/ipv4/ip_forward </span><br><span class="line">           /sbin/ipvsadm -C </span><br><span class="line">           /sbin/ipvsadm -A -t <span class="variable">$VIP</span>:80 -s rr  </span><br><span class="line">           /sbin/ipvsadm -a -t <span class="variable">$VIP</span>:80 -r <span class="variable">$RIP1</span>:80 -g </span><br><span class="line">           /sbin/ipvsadm -a -t <span class="variable">$VIP</span>:80 -r <span class="variable">$RIP2</span>:80 -g </span><br><span class="line">           /sbin/ipvsadm </span><br><span class="line">       ;; </span><br><span class="line">stop) </span><br><span class="line">           <span class="built_in">echo</span> <span class="string">"stop LVS of DirectorServer DR"</span> </span><br><span class="line">           <span class="built_in">echo</span> <span class="string">"0"</span> &gt;/proc/sys/net/ipv4/ip_forward </span><br><span class="line">           /sbin/ipvsadm -C </span><br><span class="line">           /sbin/ifconfig eth0:0 down </span><br><span class="line">           ;; </span><br><span class="line">*) </span><br><span class="line">          <span class="built_in">echo</span> <span class="string">"Usage: <span class="variable">$0</span> &#123;start|stop&#125;"</span> </span><br><span class="line">          <span class="built_in">exit</span> 1 </span><br><span class="line"><span class="keyword">esac</span> </span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure><h3 id="ipvsadm"><a href="#ipvsadm" class="headerlink" title="ipvsadm"></a>ipvsadm</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 每台realserver index.html文件内容为ip 地址，例如： </span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"172.27.233.43"</span> &gt; /var/www/html/index.html</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"172.27.233.44"</span> &gt; /var/www/html/index.html</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动http服务</span></span><br><span class="line">/etc/init.d/httpd start</span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端模拟请求</span></span><br><span class="line"><span class="keyword">for</span>((i=1;i&lt;=10;i++));<span class="keyword">do</span> curl http://172.27.233.45/; <span class="keyword">done</span></span><br><span class="line">172.27.233.44 </span><br><span class="line">172.27.233.43 </span><br><span class="line">172.27.233.44 </span><br><span class="line">172.27.233.43 </span><br><span class="line">172.27.233.44 </span><br><span class="line">172.27.233.43 </span><br><span class="line">172.27.233.44 </span><br><span class="line">172.27.233.43 </span><br><span class="line">172.27.233.44 </span><br><span class="line">172.27.233.43 </span><br><span class="line"></span><br><span class="line"><span class="comment"># 请求分配结果</span></span><br><span class="line">ipvsadm -Ln --stats</span><br><span class="line">IP Virtual Server version 1.2.1 (size=4096) </span><br><span class="line">Prot LocalAddress:Port               Conns   InPkts  OutPkts  InBytes OutBytes </span><br><span class="line">  -&gt; RemoteAddress:Port </span><br><span class="line">TCP  172.27.233.45:80                   10      50        0     4330        0 </span><br><span class="line">  -&gt; 172.27.233.43:80                    5       25        0     2165        0 </span><br><span class="line">  -&gt; 172.27.233.44:80                    5       25        0     2165        0 </span><br><span class="line"></span><br><span class="line">参数含义 </span><br><span class="line">--stats 显示统计信息 </span><br><span class="line">Prot LocalAddress:Port Conns InPkts OutPkts InBytes OutBytes </span><br><span class="line">                       连接数 输入包 输出包 输入流量 输出流量</span><br></pre></td></tr></table></figure><h2 id="keepalived的配置文件说明"><a href="#keepalived的配置文件说明" class="headerlink" title="keepalived的配置文件说明"></a>keepalived的配置文件说明</h2><p>Keepalived 是运行在lvs之上,它的主要功能是实现RealServer(真实服务器)的故障隔离及Director(负载均衡器)间的FailOver(失败切换). </p><ul><li>keepalived 是lvs的扩展项目,因此它们之间具备良好的兼容性</li><li>对RealServer的健康检查,实现对失效机器/服务的故障隔离</li><li>负载均衡器之间的失败切换 failover</li></ul><h3 id="全局定义"><a href="#全局定义" class="headerlink" title="全局定义"></a>全局定义</h3><p>全局配置又包括两个子配置</p><ol><li>全局定义(global definition)</li><li>静态路由配置(static ipaddress/routes)</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全局定义(global definition) </span></span><br><span class="line">global_defs &#123;                      </span><br><span class="line">   notification_email &#123;      </span><br><span class="line">   acassen@firewall.loc     </span><br><span class="line">   failover@firewall.loc</span><br><span class="line">   sysadmin@firewall.loc</span><br><span class="line">   &#125;</span><br><span class="line">   notification_email_from Alexandre.Cassen@firewall.loc   </span><br><span class="line">   smtp_server 192.168.200.1                         </span><br><span class="line">   smtp_connect_timeout 30                                  </span><br><span class="line">   router_id LVS_DEVEL     </span><br><span class="line">&#125;</span><br><span class="line">notification_email: 表示keepalived在发生诸如切换操作时需要发送email通知以及email发送给哪些邮件地址邮件地址可以多个每行一个</span><br><span class="line">notification_email_from admin@example.com: 表示发送通知邮件时邮件源地址是谁</span><br><span class="line">smtp_server 127.0.0.1: 表示发送email时使用的smtp服务器地址这里可以用本地的sendmail来实现</span><br><span class="line">smtp_connect_timeout 30: 连接smtp连接超时时间</span><br><span class="line">router_id node1: 机器标识，通常配置主机名</span><br><span class="line"></span><br><span class="line"><span class="comment"># 静态地址和路由配置范例</span></span><br><span class="line">static_ipaddress &#123;</span><br><span class="line">    192.168.1.1/24 brd + dev eth0 scope global</span><br><span class="line">    192.168.1.2/24 brd + dev eth1 scope global</span><br><span class="line">&#125;</span><br><span class="line">static_routes &#123;</span><br><span class="line">    src <span class="variable">$SRC_IP</span> to <span class="variable">$DST_IP</span> dev <span class="variable">$SRC_DEVICE</span></span><br><span class="line">    src <span class="variable">$SRC_IP</span> to <span class="variable">$DST_IP</span> via <span class="variable">$GW</span> dev <span class="variable">$SRC_DEVICE</span></span><br><span class="line">&#125;</span><br><span class="line">这里实际上和系统里面命令配置IP地址和路由一样例如</span><br><span class="line">192.168.1.1/24 brd + dev eth0 scope global 相当于: ip addr add 192.168.1.1/24 brd + dev eth0 scope global</span><br><span class="line">就是给eth0配置IP地址路由同理,一般这个区域不需要配置</span><br><span class="line">这里实际上就是给服务器配置真实的IP地址和路由的在复杂的环境下可能需要配置一般不会用这个来配置我们可以直接用vi /etc/sysconfig/network-script/ifcfg-eth1来配置切记这里可不是VIP不要搞混淆了切记切记</span><br></pre></td></tr></table></figure><h3 id="VRRPD配置"><a href="#VRRPD配置" class="headerlink" title="VRRPD配置"></a>VRRPD配置</h3><p>包括三个类:</p><ol><li>VRRP同步组(synchroization group) </li><li>VRRP实例(VRRP Instance) </li><li>VRRP脚本</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># VRRP同步组(synchroization group)配置范例</span></span><br><span class="line">vrrp_sync_group VG_1 &#123;   //注意vrrp_sync_group  后面可自定义名称如lvs_httpd ,httpd</span><br><span class="line">group &#123;</span><br><span class="line">http</span><br><span class="line">mysql</span><br><span class="line">&#125;</span><br><span class="line">notify_master /path/to/to_master.sh</span><br><span class="line">notify_backup /path_to/to_backup.sh</span><br><span class="line">notify_fault <span class="string">"/path/fault.sh VG_1"</span></span><br><span class="line">notify /path/to/notify.sh</span><br><span class="line">smtp_alert </span><br><span class="line">&#125;</span><br><span class="line">其中http和mysql是实例名和下面的实例名一致</span><br><span class="line">notify_master /path/to/to_master.sh //表示当切换到master状态时要执行的脚本</span><br><span class="line">notify_backup /path_to/to_backup.sh //表示当切换到backup状态时要执行的脚本</span><br><span class="line">notify_fault <span class="string">"/path/fault.sh VG_1"</span>  // keepalived出现故障时执行的脚本</span><br><span class="line">notify /path/to/notify.sh  </span><br><span class="line">smtp_alert           //表示切换时给global defs中定义的邮件地址发送邮件通知</span><br><span class="line"></span><br><span class="line"><span class="comment"># VRRP实例(instance)配置范例</span></span><br><span class="line">vrrp_instance http &#123;  //注意vrrp_instance 后面可自定义名称如lvs_httpd ,httpd</span><br><span class="line">state MASTER</span><br><span class="line">interface eth0</span><br><span class="line">dont_track_primary</span><br><span class="line">track_interface &#123;</span><br><span class="line">eth0</span><br><span class="line">eth1</span><br><span class="line">&#125;</span><br><span class="line">mcast_src_ip &lt;IPADDR&gt;</span><br><span class="line">garp_master_delay 10</span><br><span class="line">virtual_router_id 51</span><br><span class="line">priority 100</span><br><span class="line">advert_int 1</span><br><span class="line">authentication &#123;</span><br><span class="line">auth_type PASS</span><br><span class="line">autp_pass 1234</span><br><span class="line">&#125;</span><br><span class="line">virtual_ipaddress &#123;</span><br><span class="line"><span class="comment">#&lt;IPADDR&gt;/&lt;MASK&gt; brd &lt;IPADDR&gt; dev &lt;STRING&gt; scope &lt;SCOPT&gt; label &lt;LABEL&gt;</span></span><br><span class="line">192.168.200.17/24 dev eth1</span><br><span class="line">192.168.200.18/24 dev eth2 label eth2:1</span><br><span class="line">&#125;</span><br><span class="line">virtual_routes &#123;</span><br><span class="line"><span class="comment"># src &lt;IPADDR&gt; [to] &lt;IPADDR&gt;/&lt;MASK&gt; via|gw &lt;IPADDR&gt; dev &lt;STRING&gt; scope &lt;SCOPE&gt; tab</span></span><br><span class="line">src 192.168.100.1 to 192.168.109.0/24 via 192.168.200.254 dev eth1</span><br><span class="line">192.168.110.0/24 via 192.168.200.254 dev eth1</span><br><span class="line">192.168.111.0/24 dev eth2</span><br><span class="line">192.168.112.0/24 via 192.168.100.254</span><br><span class="line">&#125;</span><br><span class="line">nopreempt</span><br><span class="line">preemtp_delay 300</span><br><span class="line">debug</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>state: state指定instance(Initial)的初始状态就是说在配置好后这台 服务器的初始状态就是这里指定的但这里指定的不算还是得要通过竞选通过优先级来确定里如果这里设置为master但如若他的优先级不及另外一台 那么这台在发送通告时会发送自己的优先级另外一台发现优先级不如自己的高那么他会就回抢占为master</p><p>interface: 实例绑定的网卡因为在配置虚拟VIP的时候必须是在已有的网卡上添加的</p><p>dont track primary: 忽略VRRP的interface错误</p><p>track interface: 跟踪接口设置额外的监控里面任意一块网卡出现问题都会进入故障(FAULT)状态例如用nginx做均衡器的时候内网必须正常工作如果内网出问题了这个均衡器也就无法运作了所以必须对内外网同时做健康检查</p><p>mcast src ip: 发送多播数据包时的源IP地址这里注意了这里实际上就是在那个地址上发送VRRP通告这个非常重要一定要选择稳定的网卡端口来发送这里相当于heartbeat的心跳端口如果没有设置那么就用默认的绑定的网卡的IP也就是interface指定的IP地址</p><p>garp master delay: 在切换到master状态后延迟进行免费的ARP(gratuitous ARP)请求，默认5s</p><p>virtual router id: 这里设置VRID这里非常重要相同的VRID为一个组他将决定多播的MAC地址</p><p>priority 100: 设置本节点的优先级优先级高的为master</p><p>advert int: 设置MASTER与BACKUP负载均衡之间同步即主备间通告时间检查的时间间隔,单位为秒，默认1s</p><p>virtual ipaddress: 这里设置的就是VIP也就是虚拟IP地址他随着state的变化而增加删除当state为master的时候就添加当state为backup的时候删除这里主要是有优先级来决定的和state设置的值没有多大关系这里可以设置多个IP地址</p><p>virtual routes: 原理和virtual ipaddress一样只不过这里是增加和删除路由</p><p>lvs sync daemon interface: lvs syncd绑定的网卡，类似HA中的心跳检测绑定的网卡</p><p>authentication: 这里设置认证</p><p>auth type: 认证方式可以是PASS或AH两种认证方式</p><p>auth pass: 认证密码</p><p>nopreempt: 设置不抢占master，这里只能设置在state为backup的节点上而且这个节点的优先级必须别另外的高，比如master因为异常将调度圈交给了备份serve，master serve检修后没问题，如果不设置nopreempt就会将调度权重新夺回来，这样就容易造成业务中断问题</p><p>preempt delay: 抢占延迟多少秒，即延迟多少秒后竞选master</p><p>debug：debug级别</p><p>notify master：和sync group这里设置的含义一样可以单独设置例如不同的实例通知不同的管理人员http实例发给网站管理员mysql的就发邮件给DBA</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># VRRP脚本</span></span><br><span class="line"><span class="comment"># 如下所示为相关配置示例</span></span><br><span class="line">vrrp_script check_running &#123;</span><br><span class="line">   script <span class="string">"/usr/local/bin/check_running"</span></span><br><span class="line">   interval 10</span><br><span class="line">   weight 10</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance http &#123;</span><br><span class="line">   state BACKUP</span><br><span class="line">   smtp_alert</span><br><span class="line">   interface eth0</span><br><span class="line">   virtual_router_id 101</span><br><span class="line">   priority 90</span><br><span class="line">   advert_int 3</span><br><span class="line">   authentication &#123;</span><br><span class="line">   auth_type PASS</span><br><span class="line">   auth_pass whatever</span><br><span class="line">   &#125;</span><br><span class="line">   virtual_ipaddress &#123;</span><br><span class="line">   1.1.1.1</span><br><span class="line">   &#125;</span><br><span class="line">   track_script &#123;</span><br><span class="line">   check_running </span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 首先在vrrp_script区域定义脚本名字和脚本执行的间隔和脚本执行的优先级变更,如下所示:</span></span><br><span class="line">vrrp_script check_running &#123;</span><br><span class="line">            script <span class="string">"/usr/local/bin/check_running"</span></span><br><span class="line">            interval 10     <span class="comment">#脚本执行间隔</span></span><br><span class="line">            weight 10       <span class="comment">#脚本结果导致的优先级变更10表示优先级+10-10则表示优先级-10</span></span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment"># 然后在实例(vrrp_instance)里面引用有点类似脚本里面的函数引用一样先定义后引用函数名</span></span><br><span class="line">track_script &#123;</span><br><span class="line">      check_running </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意:<br>VRRP脚本(vrrp_script)和VRRP实例(vrrp_instance)属于同一个级别<br>keepalived会定时执行脚本并对脚本执行的结果进行分析，动态调整vrrp_instance的优先级。一般脚本检测返回的值为0，说明脚本检测成功，如果为非0数值，则说明检测失败<br>如果脚本执行结果为0，并且weight配置的值大于0，则优先级相应的增加, 如果weight为非0，则优先级不变<br>如果脚本执行结果非0，并且weight配置的值小于0，则优先级相应的减少, 如果weight为0，则优先级不变<br>其他情况，维持原本配置的优先级，即配置文件中priority对应的值。<br>这里需要注意的是：<br>1） 优先级不会不断的提高或者降低<br>2） 可以编写多个检测脚本并为每个检测脚本设置不同的weight<br>3） 不管提高优先级还是降低优先级，最终优先级的范围是在[1,254]，不会出现优先级小于等于0或者优先级大于等于255的情况<br>这样可以做到利用脚本检测业务进程的状态，并动态调整优先级从而实现主备切换。</p><h3 id="virtual-server-虚拟主机配置"><a href="#virtual-server-虚拟主机配置" class="headerlink" title="virtual_server 虚拟主机配置"></a>virtual_server 虚拟主机配置</h3><p>关于keeplived的虚拟主机配置有三种如下所示<br>virtual server IP port<br>virtual server fwmark int<br>virtual server group string</p><p>以常用的第一种为例<br>virtual_server 192.168.1.2 80<br>含义:设置一个virtual server: VIP:Vport</p><p>delay_loop 3<br>含义:设置service polling的delay时间即服务轮询的时间间隔</p><p>lb_algo rr|wrr|lc|wlc|lblc|sh|dh<br>含义:设置LVS调度算法</p><p>lb_kind NAT|DR|TUN<br>含义:设置LVS集群模式  </p><p>persistence_timeout 120<br>含义:设置会话保持时间秒为单位即以用户在120秒内被分配到同一个后端realserver,超过此时间就重新分配</p><p>persistence_granularity <netmask><br>含义:设置LVS会话保持粒度ipvsadm中的-M参数默认是0xffffffff即每个客户端都做会话保持</netmask></p><p>protocol TCP<br>含义:设置健康检查用的是TCP还是UDP</p><p>ha_suspend<br>含义:suspendhealthchecker’s activity</p><p>virtualhost <string><br>含义:HTTP_GET做健康检查时检查的web服务器的虚拟主机即host头</string></p><p>sorry_server <ipaddr> <port><br>含义:设置backupserver就是当所有后端realserver节点都不可用时就用这里设置的也就是临时把所有的请求都发送到这里</port></ipaddr></p><p>real_server <ipaddr> <port><br>含义:设置后端真实节点主机的权重等设置主要后端有几台这里就要设置几个</port></ipaddr></p><p>weight 1<br>含义:设置给每台的权重0表示失效(不知给他转发请求知道他恢复正常)默认是1</p><p>inhibit_on_failure<br>含义:表示在节点失败后把他权重设置成0而不是冲IPVS中删除</p><p>notify_up <string> | <quoted-string><br>含义:设置检查服务器正常(UP)后要执行的脚本<br>notify_down <string> | <quoted-string><br>含义:设置检查服务器失败(down)后要执行的脚本</quoted-string></string></quoted-string></string></p><p>注:keepalived检查机制说明<br>keepalived健康检查方式有:HTTP_GET|SSL_GET|TCP_CHECK|SMTP_CHECK|MISC_CHECK几种如下所示</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#HTTP/HTTPS方式 </span></span><br><span class="line">HTTP_GET|SSL_GET &#123;      <span class="comment">#设置健康检查方式</span></span><br><span class="line"></span><br><span class="line">url &#123;                   <span class="comment">#设置要检查的URL可以有多个</span></span><br><span class="line">path /                  <span class="comment">#设置URL具体路径</span></span><br><span class="line">digest &lt;STRING&gt;         <span class="comment">#检查后的摘要信息这些摘要信息可以通过genhash命令工具获取                                   </span></span><br><span class="line">status_code 200         <span class="comment">#设置返回状态码</span></span><br><span class="line">&#125;</span><br><span class="line">connect_port 80         <span class="comment">#设置监控检查的端口</span></span><br><span class="line">bindto  &lt;IPADD&gt;         <span class="comment">#设置健康检查的IP地址</span></span><br><span class="line">connect_timeout   3     <span class="comment">#设置连接超时时间</span></span><br><span class="line">nb_get_retry  3         <span class="comment">#设置重连次数</span></span><br><span class="line">delay_before_retry  2   <span class="comment">#设置重连间隔</span></span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">#TCP方式  </span></span><br><span class="line">TCP_CHECK     &#123;</span><br><span class="line">connect_port 80         <span class="comment">#设置监控检查的端口</span></span><br><span class="line">bindto  &lt;IPADD&gt;         <span class="comment">#设置健康检查的IP地址</span></span><br><span class="line">connect_timeout   3     <span class="comment">#设置连接超时时间</span></span><br><span class="line">nb_get_retry  3         <span class="comment">#设置重连次数</span></span><br><span class="line">delay_before_retry  2   <span class="comment">#设置重连间隔</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#SMTP方式 (这个可以用来给邮件服务器做集群)</span></span><br><span class="line">SMTP_CHECK &#123;</span><br><span class="line">host &#123;</span><br><span class="line">connect_ip &lt;IP ADDRESS&gt;</span><br><span class="line">connect_port &lt;PORT&gt;     <span class="comment">#默认检查25端口</span></span><br><span class="line">14 KEEPALIVED</span><br><span class="line">bindto &lt;IP ADDRESS&gt;</span><br><span class="line">&#125;</span><br><span class="line">connect_timeout &lt;INTEGER&gt;</span><br><span class="line">retry &lt;INTEGER&gt;</span><br><span class="line">delay_before_retry &lt;INTEGER&gt;</span><br><span class="line">helo_name &lt;STRING&gt;|&lt;QUOTED-STRING&gt;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">#MISC方式 这个可以用来检查很多服务器只需要自己会些脚本即可</span></span><br><span class="line">MISC_CHECK &#123;</span><br><span class="line">misc_path &lt;STRING&gt;|&lt;QUOTED-STRING&gt;  <span class="comment">#外部程序或脚本</span></span><br><span class="line">misc_timeout &lt;INT&gt;                  <span class="comment">#脚本或程序执行超时时间</span></span><br><span class="line">misc_dynamic                                              </span><br><span class="line"><span class="comment">#这个就很好用了可以非常精确的来调整权重是后端每天服务器的压力都能均衡调配这个主要是通过执行的程序或脚本返回的状态代码来动态调整weight值使权重根据真实的后端压力来适当调整不过这需要有过硬的脚本功夫才行哦</span></span><br><span class="line"><span class="comment">#返回0健康检查没问题不修改权重</span></span><br><span class="line"><span class="comment">#返回1健康检查失败权重设置为0</span></span><br><span class="line"><span class="comment">#返回2-255健康检查没问题但是权重却要根据返回代码修改为返回码-2例如如果程序或脚本执行后返回的代码为200#那么权重这回被修改为 200-2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上就是keepalived的配置项说明虽然配置项很多但很多时候很多配置项保持默认即可</p><h2 id="lvs-keepalived配置实践"><a href="#lvs-keepalived配置实践" class="headerlink" title="lvs+keepalived配置实践"></a>lvs+keepalived配置实践</h2><blockquote><p>防火墙的配置不在本文的范围，请关闭selinux和firewall</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 关闭防火墙</span></span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br><span class="line">systemctl stop firewalld</span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁用selinux</span></span><br><span class="line">setenforce 0</span><br><span class="line">vi /etc/selinux/config</span><br><span class="line"></span><br><span class="line">SELINUX=disabled</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装keepalived,ipvsadm</span></span><br><span class="line">yum install keepalived ipvsadm -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启LVS服务器的IP路由转发功能</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"1"</span> &gt; /proc/sys/net/ipv4/ip_forward</span><br><span class="line"><span class="comment"># 添加路由转发至sysctl.conf</span></span><br><span class="line">vi /etc/sysctl.conf</span><br><span class="line">net.ipv4.ip_forward = 1</span><br></pre></td></tr></table></figure><h3 id="最简单的keepalived做HA"><a href="#最简单的keepalived做HA" class="headerlink" title="最简单的keepalived做HA"></a>最简单的keepalived做HA</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑keepalived配置文件</span></span><br><span class="line">vi /etc/keepalived/keepalived.conf</span><br><span class="line"></span><br><span class="line">vrrp_sync_group VI_GOP_NC1_LB1 &#123;</span><br><span class="line">    group &#123;</span><br><span class="line">        VI_VI_GOP_NC1_LB1_1</span><br><span class="line">        VI_VI_GOP_NC1_LB1_2</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_VI_GOP_NC1_LB1_1 &#123;</span><br><span class="line">    state BACKUP</span><br><span class="line">    interface bond0</span><br><span class="line">    virtual_router_id 28</span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">    nopreempt</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        10.65.32.28/23 dev bond0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_VI_GOP_NC1_LB1_2 &#123;</span><br><span class="line">    state BACKUP</span><br><span class="line">    interface bond0</span><br><span class="line">    virtual_router_id 29</span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">    nopreempt</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        10.65.32.29/23 dev bond0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="配置LVS-DR"><a href="#配置LVS-DR" class="headerlink" title="配置LVS-DR"></a>配置LVS-DR</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Install keepalived</span></span><br><span class="line"><span class="comment"># Ubuntu</span></span><br><span class="line">apt-get install keepalived ipvsadm</span><br><span class="line"><span class="comment"># CentOS</span></span><br><span class="line">yum install keepalived ipvsadm</span><br><span class="line"><span class="comment"># mod iptables</span></span><br><span class="line">vim /etc/sysconfig/iptables</span><br><span class="line"></span><br><span class="line"><span class="comment"># LVS configuration</span></span><br><span class="line"><span class="comment">## For keepalived:</span></span><br><span class="line"><span class="comment">### allow vrrp (112)</span></span><br><span class="line">-A INPUT -p vrrp -j ACCEPT</span><br><span class="line">-A INPUT -p igmp -j ACCEPT</span><br><span class="line"><span class="comment">### allow multicast</span></span><br><span class="line">-A INPUT -d 224.0.0.18 -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># restart iptables</span></span><br><span class="line">service iptables restart</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># example</span></span><br><span class="line"><span class="comment"># two vip for lvs-dr</span></span><br><span class="line"></span><br><span class="line">vrrp_sync_group GOP &#123;</span><br><span class="line">    group &#123;</span><br><span class="line">        VI_PRI_CONNECT</span><br><span class="line">        VI_PRI_AUTH</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_PRI_CONNECT &#123;</span><br><span class="line">    state BACKUP</span><br><span class="line">    interface bond0</span><br><span class="line">    virtual_router_id 128</span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">    nopreempt</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        10.65.32.28/23 dev bond0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">virtual_server 10.65.32.28 80 &#123;</span><br><span class="line">    delay_loop 6</span><br><span class="line">    lb_algo rr</span><br><span class="line">    lb_kind DR</span><br><span class="line">    protocol TCP</span><br><span class="line"></span><br><span class="line">    real_server 10.65.32.13 80 &#123;</span><br><span class="line">        weight 100</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">                connect_timeout 3</span><br><span class="line">                nb_get_retry 3</span><br><span class="line">                delay_before_retry 3</span><br><span class="line">                connect_port 80</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    real_server 10.65.32.14 80 &#123;</span><br><span class="line">        weight 100</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">                connect_timeout 3</span><br><span class="line">                nb_get_retry 3</span><br><span class="line">                delay_before_retry 3</span><br><span class="line">                connect_port 80</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    real_server 10.65.32.15 80 &#123;</span><br><span class="line">        weight 100</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">                connect_timeout 3</span><br><span class="line">                nb_get_retry 3</span><br><span class="line">                delay_before_retry 3</span><br><span class="line">                connect_port 80</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    real_server 10.65.32.16 80 &#123;</span><br><span class="line">        weight 100</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">                connect_timeout 3</span><br><span class="line">                nb_get_retry 3</span><br><span class="line">                delay_before_retry 3</span><br><span class="line">                connect_port 80</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    real_server 10.65.32.17 80 &#123;</span><br><span class="line">        weight 100</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">                connect_timeout 3</span><br><span class="line">                nb_get_retry 3</span><br><span class="line">                delay_before_retry 3</span><br><span class="line">                connect_port 80</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    real_server 10.65.32.18 80 &#123;</span><br><span class="line">        weight 100</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">                connect_timeout 3</span><br><span class="line">                nb_get_retry 3</span><br><span class="line">                delay_before_retry 3</span><br><span class="line">                connect_port 80</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">virtual_server 10.65.32.28 443 &#123;</span><br><span class="line">    delay_loop 6</span><br><span class="line">    lb_algo rr</span><br><span class="line">    lb_kind DR</span><br><span class="line">    protocol TCP</span><br><span class="line"></span><br><span class="line">    real_server 10.65.32.13 443 &#123;</span><br><span class="line">        weight 100</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">                connect_timeout 3</span><br><span class="line">                nb_get_retry 3</span><br><span class="line">                delay_before_retry 3</span><br><span class="line">                connect_port 443</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    real_server 10.65.32.14 80 &#123;</span><br><span class="line">        weight 100</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">                connect_timeout 3</span><br><span class="line">                nb_get_retry 3</span><br><span class="line">                delay_before_retry 3</span><br><span class="line">                connect_port 443</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    real_server 10.65.32.15 443 &#123;</span><br><span class="line">        weight 100</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">                connect_timeout 3</span><br><span class="line">                nb_get_retry 3</span><br><span class="line">                delay_before_retry 3</span><br><span class="line">                connect_port 443</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    real_server 10.65.32.16 443 &#123;</span><br><span class="line">        weight 100</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">                connect_timeout 3</span><br><span class="line">                nb_get_retry 3</span><br><span class="line">                delay_before_retry 3</span><br><span class="line">                connect_port 443</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    real_server 10.65.32.17 443 &#123;</span><br><span class="line">        weight 100</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">                connect_timeout 3</span><br><span class="line">                nb_get_retry 3</span><br><span class="line">                delay_before_retry 3</span><br><span class="line">                connect_port 443</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    real_server 10.65.32.18 443 &#123;</span><br><span class="line">        weight 100</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">                connect_timeout 3</span><br><span class="line">                nb_get_retry 3</span><br><span class="line">                delay_before_retry 3</span><br><span class="line">                connect_port 443</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_PRI_AUTH &#123;</span><br><span class="line">    state BACKUP</span><br><span class="line">    interface bond0</span><br><span class="line">    virtual_router_id 129</span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">    nopreempt</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        10.65.32.29/23 dev bond0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">virtual_server 10.65.32.29 80 &#123;</span><br><span class="line">    delay_loop 6</span><br><span class="line">    lb_algo rr</span><br><span class="line">    lb_kind DR</span><br><span class="line">    protocol TCP</span><br><span class="line"></span><br><span class="line">    real_server 10.65.32.22 80 &#123;</span><br><span class="line">        weight 100</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">                connect_timeout 3</span><br><span class="line">                nb_get_retry 3</span><br><span class="line">                delay_before_retry 3</span><br><span class="line">                connect_port 80</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    real_server 110.65.32.23 80 &#123;</span><br><span class="line">        weight 100</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">                connect_timeout 3</span><br><span class="line">                nb_get_retry 3</span><br><span class="line">                delay_before_retry 3</span><br><span class="line">                connect_port 80</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">virtual_server 10.65.32.29 443 &#123;</span><br><span class="line">    delay_loop 6</span><br><span class="line">    lb_algo rr</span><br><span class="line">    lb_kind DR</span><br><span class="line">    protocol TCP</span><br><span class="line"></span><br><span class="line">    real_server 10.65.32.22 443 &#123;</span><br><span class="line">        weight 100</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">                connect_timeout 3</span><br><span class="line">                nb_get_retry 3</span><br><span class="line">                delay_before_retry 3</span><br><span class="line">                connect_port 443</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    real_server 110.65.32.23 443 &#123;</span><br><span class="line">        weight 100</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">                connect_timeout 3</span><br><span class="line">                nb_get_retry 3</span><br><span class="line">                delay_before_retry 3</span><br><span class="line">                connect_port 443</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># enable and start keepalived</span></span><br><span class="line">systemctl start keepalived</span><br><span class="line">systemctl <span class="built_in">enable</span> keepalived</span><br><span class="line">watch ipvsadm -L -n --stats</span><br></pre></td></tr></table></figure><h3 id="real-server"><a href="#real-server" class="headerlink" title="real server"></a>real server</h3><ol><li>Edit “/etc/sysconfig/network-scripts/ifcfg-lo” to patch bug in Centos 7 (if using Centos 7). Add TYPE=Loopback to the file.</li><li>Add loopback for each Virtual IP on each worker. E.g. first virtual IP create file “/etc/sysconfig/network-scripts/ifcfg-lo:0”.</li><li>Start adapters if not yet started</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add TYPE=Loopback</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"TYPE=Loopback"</span> &gt;&gt; /etc/sysconfig/network-scripts/ifcfg-lo</span><br><span class="line"><span class="comment"># add ifcfg-lo:0</span></span><br><span class="line">cat &gt; /etc/sysconfig/network-scripts/ifcfg-lo:0 &lt;&lt; EOF</span><br><span class="line">DEVICE=lo:0</span><br><span class="line">IPADDR=10.65.32.28</span><br><span class="line">NETMASK=255.255.255.255</span><br><span class="line">ONBOOT=yes</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># ifup lo:0</span></span><br><span class="line">ifup lo:0</span><br><span class="line"></span><br><span class="line"><span class="comment"># add real_start</span></span><br><span class="line">cat &gt; /root/real_start.sh &lt;&lt; EOF</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"1"</span> &gt;/proc/sys/net/ipv4/conf/lo/arp_ignore</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"2"</span> &gt;/proc/sys/net/ipv4/conf/lo/arp_announce</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"1"</span> &gt;/proc/sys/net/ipv4/conf/all/arp_ignore</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"2"</span> &gt;/proc/sys/net/ipv4/conf/all/arp_announce</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># chmod 755</span></span><br><span class="line">chmod 755 /root/real_start.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># add real.service</span></span><br><span class="line">cat &gt; /usr/lib/systemd/system/real.service &lt;&lt; EOF</span><br><span class="line">[Unit]</span><br><span class="line">Description=autostart lvs real</span><br><span class="line">After=network.target remote-fs.target nss-lookup.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/root/real_start.sh</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># enable service</span></span><br><span class="line">systemctl <span class="built_in">enable</span> real.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># lvs real server example</span></span><br><span class="line">vim /root/lvs_real.sh</span><br><span class="line"></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">### BEGIN INIT INFO</span></span><br><span class="line"><span class="comment"># Provides:</span></span><br><span class="line"><span class="comment"># Default-Start:     2 3 4 5</span></span><br><span class="line"><span class="comment"># Default-Stop:      0 1 6</span></span><br><span class="line"><span class="comment"># Short-Description: Start realserver</span></span><br><span class="line"><span class="comment"># Description:       Start realserver</span></span><br><span class="line"><span class="comment">### END INIT INFO</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># change the VIP to proper value</span></span><br><span class="line">VIP=10.65.32.28</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></span><br><span class="line">    start)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Start REAL Server"</span></span><br><span class="line">    /sbin/ifconfig lo:0 <span class="variable">$VIP</span> broadcast <span class="variable">$VIP</span> netmask 255.255.255.255 up</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"1"</span> &gt;/proc/sys/net/ipv4/conf/lo/arp_ignore</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"2"</span> &gt;/proc/sys/net/ipv4/conf/lo/arp_announce</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"1"</span> &gt;/proc/sys/net/ipv4/conf/all/arp_ignore</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"2"</span> &gt;/proc/sys/net/ipv4/conf/all/arp_announce</span><br><span class="line"></span><br><span class="line">    ;;</span><br><span class="line"></span><br><span class="line">    stop)</span><br><span class="line"></span><br><span class="line">    /sbin/ifconfig lo:0 down</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Stop REAL Server"</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"0"</span> &gt;/proc/sys/net/ipv4/conf/lo/arp_ignore</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"0"</span> &gt;/proc/sys/net/ipv4/conf/lo/arp_announce</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"0"</span> &gt;/proc/sys/net/ipv4/conf/all/arp_ignore</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"0"</span> &gt;/proc/sys/net/ipv4/conf/all/arp_announce</span><br><span class="line"></span><br><span class="line">    ;;</span><br><span class="line"></span><br><span class="line">    restart)</span><br><span class="line"></span><br><span class="line">    <span class="variable">$0</span> stop</span><br><span class="line">    <span class="variable">$0</span> start</span><br><span class="line"></span><br><span class="line">    ;;</span><br><span class="line"></span><br><span class="line">    *)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Usage: <span class="variable">$0</span> &#123;start|stop&#125;"</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"></span><br><span class="line">    ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure><h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><h3 id="ARP导致MAC地址冲突"><a href="#ARP导致MAC地址冲突" class="headerlink" title="ARP导致MAC地址冲突"></a>ARP导致MAC地址冲突</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@sg-gop-10-65-32-35 wangao]<span class="comment"># arp -n</span></span><br><span class="line">Address                  HWtype  HWaddress           Flags Mask            Iface</span><br><span class="line">10.65.32.31              ether   48:8e:ef:7b:c6:0a   C                     bond0</span><br><span class="line">10.65.32.83              ether   50:5d:ac:ed:89:dd   C                     bond0</span><br><span class="line">10.65.32.254             ether   00:00:0c:9f:f0:ec   C                     bond0</span><br><span class="line">10.65.32.252             ether   bc:16:65:68:07:81   C                     bond0</span><br><span class="line">10.65.32.34              ether   50:1d:93:f5:eb:97   C                     bond0</span><br><span class="line">10.65.32.8               ether   48:8e:ef:7c:0a:8d   C                     bond0</span><br><span class="line">10.65.32.253             ether   18:e7:28:97:e5:01   C                     bond0</span><br><span class="line">[root@sg-gop-10-65-32-35 wangao]<span class="comment"># arp -d 10.65.32.31</span></span><br><span class="line">[root@sg-gop-10-65-32-35 wangao]<span class="comment">#</span></span><br><span class="line">[root@sg-gop-10-65-32-35 wangao]<span class="comment">#</span></span><br><span class="line">[root@sg-gop-10-65-32-35 wangao]<span class="comment"># telnet 10.65.32.31 12100</span></span><br><span class="line">Trying 10.65.32.31...</span><br><span class="line">Connected to 10.65.32.31.</span><br><span class="line">Escape character is <span class="string">'^]'</span>.</span><br><span class="line"></span><br><span class="line">[root@sg-gop-10-65-32-35 wangao]<span class="comment"># arp -n</span></span><br><span class="line">Address                  HWtype  HWaddress           Flags Mask            Iface</span><br><span class="line">10.65.32.31              ether   48:8e:ef:7b:c7:5a   C                     bond0</span><br><span class="line">10.65.32.70              ether   00:2e:c7:3a:a5:b5   C                     bond0</span><br><span class="line">10.65.32.83              ether   50:5d:ac:ed:89:dd   C                     bond0</span><br><span class="line">10.65.32.254             ether   00:00:0c:9f:f0:ec   C                     bond0</span><br><span class="line">10.65.32.252             ether   bc:16:65:68:07:81   C                     bond0</span><br><span class="line">10.65.32.34              ether   50:1d:93:f5:eb:97   C                     bond0</span><br><span class="line">10.65.32.8               ether   48:8e:ef:7c:0a:8d   C                     bond0</span><br><span class="line">10.65.32.253             ether   18:e7:28:97:e5:01   C                     bond0</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      学习使用 LVS+Keepalived
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>MacBook 使用指北</title>
    <link href="https://wsgzao.github.io/post/macbook/"/>
    <id>https://wsgzao.github.io/post/macbook/</id>
    <published>2018-07-25T06:59:49.000Z</published>
    <updated>2018-07-31T04:16:36.279Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://i.v2ex.co/y2JB0IAD.png" alt=""></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>MacBook刚拿到手，相信和各位一样有一个熟悉的过程，这里做下持续的更新记录</p><blockquote><p>学习使用MacBook</p></blockquote><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018年07月25日 - 补充细节<br>2018年07月05日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/macbook/">https://wsgzao.github.io/post/macbook/</a></p><p><strong>扩展阅读</strong></p><p>Awesome Mac - <a href="http://wangchujiang.com/awesome-mac/index.zh.html" target="_blank" rel="noopener">http://wangchujiang.com/awesome-mac/index.zh.html</a></p><hr><h2 id="System-Preferences"><a href="#System-Preferences" class="headerlink" title="System Preferences"></a>System Preferences</h2><blockquote><p>在任何的操作系统中，首先你需要做一件事就是更新系统，点击窗口左上角的  &gt; 关于本机 &gt; 软件更新 。此外，如果这是一部新的电脑，你还需要到系统设置进行一些适当调整。如何调整，取决于个人喜好。</p></blockquote><h3 id="触控板"><a href="#触控板" class="headerlink" title="触控板"></a>触控板</h3><p>系统设置 &gt; 触控板</p><p>光标与点击</p><ul><li>轻拍来点按</li><li>辅助点按</li><li>查找</li><li>三指拖移</li></ul><p>滚动缩放</p><ul><li>默认全选</li></ul><p>更多手势</p><ul><li>默认全选</li></ul><h3 id="Dock"><a href="#Dock" class="headerlink" title="Dock"></a>Dock</h3><p>置于屏幕上的位置：左边<br>设置 Dock 图标更小（大小随个人喜好）<br>✓ 自动显示和隐藏 Dock</p><h3 id="Finder"><a href="#Finder" class="headerlink" title="Finder"></a>Finder</h3><p>Finder &gt; 显示</p><ul><li>显示标签页栏</li><li>显示路径栏</li><li>显示状态栏</li><li>自定工具栏 &gt; 去除所有按钮，仅剩搜索栏</li></ul><p>Finder &gt; 偏好设置</p><p>通用</p><ul><li>开启新 Finder 窗口时打开：HOME「用户名」目录</li></ul><p>边栏</p><ul><li>添加 HOME「用户名」目录 和 创建代码文件目录</li><li>将 共享的(shared) 和 标记(tags) 目录去掉</li></ul><h3 id="菜单栏"><a href="#菜单栏" class="headerlink" title="菜单栏"></a>菜单栏</h3><p>去掉蓝牙等无需经常使用的图标<br>将电池显示设置为百分比</p><h3 id="Spotlight"><a href="#Spotlight" class="headerlink" title="Spotlight"></a>Spotlight</h3><p>去掉字体和书签与历史记录等不需要的内容<br>设置合适的快捷键</p><h3 id="互联网帐户"><a href="#互联网帐户" class="headerlink" title="互联网帐户"></a>互联网帐户</h3><p>添加 iCloud 用户，同步日历，联系人和 Find my mac 等等</p><h3 id="English"><a href="#English" class="headerlink" title="English"></a>English</h3><p>Trackpad</p><ul><li>Tap to click</li></ul><p>Accessibility -&gt; Mouse &amp; Trackpad -&gt; Trackpad Options</p><ul><li>Enable dragging | three finger drag</li></ul><p>Language &amp; Region</p><ul><li>Time format | 24-Hour Time</li><li>click add button | Chinese, Simplified</li></ul><p>Language &amp; Region -&gt; Keyboard Preferences -&gt; Shortcuts -&gt; Input Sources</p><ul><li>Select the previous input source</li></ul><p>Display -&gt; Arrangement</p><ul><li>Drag the graphics and just make what you want</li><li>if the display rotates 90 degrees then change Rotation to 90° or 270° and click confirm button to save</li></ul><h2 id="Mac-键盘快捷键"><a href="#Mac-键盘快捷键" class="headerlink" title="Mac 键盘快捷键"></a>Mac 键盘快捷键</h2><p><a href="https://support.apple.com/zh-cn/HT201236" target="_blank" rel="noopener">https://support.apple.com/zh-cn/HT201236</a></p><p>Command ⌘<br>Shift ⇧<br>Option ⌥<br>Control ⌃<br>Caps Lock ⇪<br>Fn</p><blockquote><p>我自己常用的快捷键</p></blockquote><table><thead><tr><th>快捷键</th><th>描述</th></tr></thead><tbody><tr><td>Command(⌘)-C</td><td>复制</td></tr><tr><td>Command(⌘)-V</td><td>粘贴</td></tr><tr><td>Command(⌘)-Z</td><td>撤销</td></tr><tr><td>Command(⌘)-Option-V</td><td>剪切粘贴</td></tr><tr><td>Command(⌘)-A</td><td>全选</td></tr><tr><td>Command(⌘)-F</td><td>查找</td></tr><tr><td>Command(⌘)-S</td><td>保存</td></tr><tr><td>Command(⌘)-W</td><td>关闭当前窗口</td></tr><tr><td>Command(⌘)-空格键</td><td>聚焦</td></tr><tr><td>Command(⌘)-方向左键</td><td>后退</td></tr><tr><td>Command(⌘)-方向右键</td><td>前进</td></tr><tr><td>Control-A</td><td>移至行或段落的开头</td></tr><tr><td>Control-E</td><td>移至行或段落的末尾</td></tr><tr><td>Control-空格键</td><td>切换输入法（需要手动设置）</td></tr><tr><td>Control-Command-Q</td><td>系统自带锁屏快捷键</td></tr></tbody></table><h2 id="Mac-Soft"><a href="#Mac-Soft" class="headerlink" title="Mac Soft"></a>Mac Soft</h2><p>Homebrew<br><a href="https://brew.sh/" target="_blank" rel="noopener">https://brew.sh/</a></p><p>Mounty for NTFS<br><a href="http://enjoygineering.com/mounty/" target="_blank" rel="noopener">http://enjoygineering.com/mounty/</a></p><p>Sougou Input - Sogou<br><a href="https://pinyin.sogou.com/mac/" target="_blank" rel="noopener">https://pinyin.sogou.com/mac/</a></p><p>Youdao Dict - Netesse<br><a href="http://cidian.youdao.com/index-mac.html" target="_blank" rel="noopener">http://cidian.youdao.com/index-mac.html</a></p><p>Jietu - Tencent<br><a href="http://jietu.qq.com/" target="_blank" rel="noopener">http://jietu.qq.com/</a></p><p>Kantu - Tencent<br><a href="https://kantu.qq.com/" target="_blank" rel="noopener">https://kantu.qq.com/</a></p><p>f.lux<br><a href="https://justgetflux.com/" target="_blank" rel="noopener">https://justgetflux.com/</a></p><p>Foxit Reader<br><a href="https://www.foxitsoftware.com/pdf-reader/" target="_blank" rel="noopener">https://www.foxitsoftware.com/pdf-reader/</a></p><p>Clearview<br><a href="https://itunes.apple.com/app/clearview/id557090104?mt=12&amp;ls=1" target="_blank" rel="noopener">https://itunes.apple.com/app/clearview/id557090104?mt=12&amp;ls=1</a></p><p>Evernote<br><a href="https://evernote.com/" target="_blank" rel="noopener">https://evernote.com/</a></p><p>Dropbox<br><a href="https://www.dropbox.com/" target="_blank" rel="noopener">https://www.dropbox.com/</a></p><p>Keka<br><a href="https://www.keka.io/en/" target="_blank" rel="noopener">https://www.keka.io/en/</a></p><p>FOLX<br><a href="https://mac.eltima.com/download-manager.html" target="_blank" rel="noopener">https://mac.eltima.com/download-manager.html</a></p><p>IINA<br><a href="https://lhc70000.github.io/iina/" target="_blank" rel="noopener">https://lhc70000.github.io/iina/</a></p><p>Sourcetree<br><a href="https://www.sourcetreeapp.com/" target="_blank" rel="noopener">https://www.sourcetreeapp.com/</a></p><p>Microsoft Remote Desktop<br><a href="https://itunes.apple.com/us/app/microsoft-remote-desktop-10/id1295203466?mt=12" target="_blank" rel="noopener">https://itunes.apple.com/us/app/microsoft-remote-desktop-10/id1295203466?mt=12</a></p><p>VirtualBox<br><a href="http://www.oracle.com/technetwork/server-storage/virtualbox/downloads/index.html" target="_blank" rel="noopener">http://www.oracle.com/technetwork/server-storage/virtualbox/downloads/index.html</a></p><p>VMware OS Optimization Tool<br><a href="https://labs.vmware.com/flings/vmware-os-optimization-tool" target="_blank" rel="noopener">https://labs.vmware.com/flings/vmware-os-optimization-tool</a></p><h3 id="Homebrew"><a href="#Homebrew" class="headerlink" title="Homebrew"></a>Homebrew</h3><p><a href="https://docs.brew.sh/Installation" target="_blank" rel="noopener">https://docs.brew.sh/Installation</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install xcode first</span></span><br><span class="line">https://itunes.apple.com/us/app/xcode/id497799835</span><br><span class="line"></span><br><span class="line"><span class="comment"># install homebrew</span></span><br><span class="line">/usr/bin/ruby -e <span class="string">"<span class="variable">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># install packages</span></span><br><span class="line">brew install zsh</span><br><span class="line">brew install wget</span><br><span class="line">brew install git</span><br><span class="line"><span class="comment"># default install is python3 now, if you need python2 just run `brew install python2`</span></span><br><span class="line">brew install python</span><br></pre></td></tr></table></figure><h3 id="iTerm2-zsh-Oh-My-Zsh"><a href="#iTerm2-zsh-Oh-My-Zsh" class="headerlink" title="iTerm2 + zsh + Oh My Zsh"></a>iTerm2 + zsh + Oh My Zsh</h3><p>iTerm2<br><a href="https://www.iterm2.com/" target="_blank" rel="noopener">https://www.iterm2.com/</a></p><p>Oh My Zsh<br><a href="http://ohmyz.sh/" target="_blank" rel="noopener">http://ohmyz.sh/</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install latest zsh zsh-syntax-highlighting</span></span><br><span class="line">brew install zsh zsh-syntax-highlighting</span><br><span class="line"><span class="comment"># 修改默认 shell，在 /etc/shells 文件中加入如下一行</span></span><br><span class="line">vi /etc/shells</span><br><span class="line"></span><br><span class="line">/usr/<span class="built_in">local</span>/bin/zsh</span><br><span class="line"><span class="comment"># 然后运行命令切换 shell</span></span><br><span class="line">chsh -s /usr/<span class="built_in">local</span>/bin/zsh</span><br><span class="line"></span><br><span class="line"><span class="comment"># install oh-my-zsh</span></span><br><span class="line">sh -c <span class="string">"<span class="variable">$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改主题为agnoster，增加一行zsh-syntax-highlighting</span></span><br><span class="line">vi ~/.zshrc</span><br><span class="line"></span><br><span class="line">ZSH_THEME=<span class="string">"agnoster"</span></span><br><span class="line"><span class="built_in">source</span> /usr/<span class="built_in">local</span>/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可选增加visual studio code命令行code支持zsh</span></span><br><span class="line"><span class="keyword">function</span> code &#123;</span><br><span class="line">    <span class="keyword">if</span> [[ <span class="variable">$#</span> = 0 ]]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        open -a <span class="string">"Visual Studio Code"</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">local</span> argPath=<span class="string">"<span class="variable">$1</span>"</span></span><br><span class="line">        [[ <span class="variable">$1</span> = /* ]] &amp;&amp; argPath=<span class="string">"<span class="variable">$1</span>"</span> || argPath=<span class="string">"<span class="variable">$PWD</span>/<span class="variable">$&#123;1#./&#125;</span>"</span></span><br><span class="line">        open -a <span class="string">"Visual Studio Code"</span> <span class="string">"<span class="variable">$argPath</span>"</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解决 Too many files open error</span></span><br><span class="line"><span class="built_in">ulimit</span> -n 10000</span><br><span class="line"><span class="built_in">ulimit</span> -u 2048</span><br><span class="line"></span><br><span class="line"><span class="comment"># 刷新环境变量</span></span><br><span class="line"><span class="built_in">source</span> ~/.zshrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装powerline字体</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/powerline/fonts.git</span><br><span class="line"><span class="built_in">cd</span> fonts</span><br><span class="line">./install.sh</span><br></pre></td></tr></table></figure><blockquote><p>配置iTerm2主题，主题可以从iterm2colorschemes下载</p></blockquote><p><a href="https://iterm2colorschemes.com/" target="_blank" rel="noopener">https://iterm2colorschemes.com/</a></p><ol><li>Download iTerm2 color you like</li><li>Open iTerm2 that we already downloaded at the first section</li><li>Go to iTerm2 &gt; Preferences &gt; Profiles &gt; Colors Tab</li><li>Click Color Presets at the bottom right</li><li>Click Import</li><li>Select the *.itermcolors file</li><li>Select the * from Load Presets</li></ol><p>在 Keys -&gt; Hotkey 中设置 <code>command + i</code> 快速显示和隐藏 iTerm<br>在 Profiles -&gt; Default -&gt; Colors -&gt; Load Presets 导入主题，作为默认颜色，我的主题是<code>3024 Night</code><br>在 Profiles -&gt; Text -&gt; Change Font 调整字体/大小/颜色等，我的字体是<code>18pt Ubuntu Mono derivative Powerline</code></p><h2 id="Others"><a href="#Others" class="headerlink" title="Others"></a>Others</h2><h3 id="提示应用程序被破坏无法打开"><a href="#提示应用程序被破坏无法打开" class="headerlink" title="提示应用程序被破坏无法打开"></a>提示应用程序被破坏无法打开</h3><blockquote><p>SOLVED: “Application” is damaged and can’t be opened in macOS Sierra</p></blockquote><pre><code>sudo spctl --master-disable</code></pre><p>输入密码重新打开 System Preferences &gt; Security &amp; Privacy &gt; General 即可看到之前隐藏的“Anywhere”<br><a href="https://www.santoshsrinivas.com/disable-gatekeeper-in-macos-sierra/" target="_blank" rel="noopener">https://www.santoshsrinivas.com/disable-gatekeeper-in-macos-sierra/</a></p><h3 id="更改-Apple-ID-国家或地区"><a href="#更改-Apple-ID-国家或地区" class="headerlink" title="更改 Apple ID 国家或地区"></a>更改 Apple ID 国家或地区</h3><blockquote><p>区域在国内即使身在国外也看不到你需要的很多东东，建议修改</p></blockquote><p><a href="https://support.apple.com/zh-cn/ht201389" target="_blank" rel="noopener">https://support.apple.com/zh-cn/ht201389</a></p><h3 id="USB-Type-C-耳机"><a href="#USB-Type-C-耳机" class="headerlink" title="USB Type-C 耳机"></a>USB Type-C 耳机</h3><ol><li>插入耳机至任意USB Type-C 接口</li><li>System Preferences -&gt; Sound -&gt; Output -&gt; 选择识别到的耳机设备即可</li></ol><h3 id="配置从命令提示行启动vscode"><a href="#配置从命令提示行启动vscode" class="headerlink" title="配置从命令提示行启动vscode"></a>配置从命令提示行启动vscode</h3><p>安装Visual Studio Code，打开命令面板（按F1 或 command + shift + p）输入Shell 命令找到Shell 命令: 在PATH中安装“code”命令。命令执行完成之后，重启终端工具使新的$PATH可用。现在，您可以简单地在终端中任意文件夹下输入‘code .’来编辑该文件夹下的文件了。</p><h3 id="Git-Ignore"><a href="#Git-Ignore" class="headerlink" title="Git Ignore"></a>Git Ignore</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个新文件 ~/.gitignore ，并将以下内容添加进去，这样全部 git 仓库将会忽略以下内容所提及的文件。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Folder view configuration files</span></span><br><span class="line">.DS_Store</span><br><span class="line">Desktop.ini</span><br><span class="line"></span><br><span class="line"><span class="comment"># Thumbnail cache files</span></span><br><span class="line">._*</span><br><span class="line">Thumbs.db</span><br><span class="line"></span><br><span class="line"><span class="comment"># Files that might appear on external disks</span></span><br><span class="line">.Spotlight-V100</span><br><span class="line">.Trashes</span><br><span class="line"></span><br><span class="line"><span class="comment"># Compiled Python files</span></span><br><span class="line">*.pyc</span><br><span class="line"></span><br><span class="line"><span class="comment"># Compiled C++ files</span></span><br><span class="line">*.out</span><br><span class="line"></span><br><span class="line"><span class="comment"># Application specific files</span></span><br><span class="line">venv</span><br><span class="line">node_modules</span><br><span class="line">.sass-cache</span><br></pre></td></tr></table></figure><h3 id="禁止-DS-store生成"><a href="#禁止-DS-store生成" class="headerlink" title="禁止.DS_store生成"></a>禁止.DS_store生成</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 禁止 .DS_store 生成，打开“终端”，复制黏贴下面的命令，回车执行，重启 Mac 即可生效。</span></span><br><span class="line">defaults write com.apple.desktopservices DSDontWriteNetworkStores -bool TRUE</span><br><span class="line"><span class="comment"># 恢复 .DS_store 生成</span></span><br><span class="line">defaults delete com.apple.desktopservices DSDontWriteNetworkStores</span><br><span class="line"><span class="comment"># 刪除已存在的.DS_Store</span></span><br><span class="line">sudo find . -name <span class="string">".DS_Store"</span> -depth -<span class="built_in">exec</span> rm &#123;&#125; \;</span><br></pre></td></tr></table></figure><h3 id="ssh相关"><a href="#ssh相关" class="headerlink" title="ssh相关"></a>ssh相关</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -bash: warning: setlocale: LC_CTYPE: cannot change locale (UTF-8): No such file or directory</span></span><br><span class="line"><span class="comment"># 禁止OpenSSH客户端从OS X/Linux/Unix桌面发送LC_*变量</span></span><br><span class="line">vi /etc/ssh/ssh_config</span><br><span class="line"><span class="comment">#SendEnv LANG LC_*</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># port forwarding</span></span><br><span class="line">ssh -p 22202 wangao@127.0.0.1</span><br><span class="line">ssh -p 22202 wangao@127.0.0.1 -X</span><br><span class="line">scp -P 22202 -r sysctl.sh sysctl.d/ wangao@127.0.0.1:/tmp</span><br><span class="line"></span><br><span class="line"><span class="comment"># ssh tunnel for one-time</span></span><br><span class="line">ssh -t -A wangao@xx.xx.xx.xx ssh wangao@10.65.32.60</span><br><span class="line"></span><br><span class="line"><span class="comment"># config ssh tunnel to make easy connect everyday</span></span><br><span class="line">vim ~/.ssh/config</span><br><span class="line"></span><br><span class="line">StrictHostKeyChecking=no</span><br><span class="line"></span><br><span class="line">Host 10.65.32.*</span><br><span class="line">  HostName %h</span><br><span class="line">  ProxyCommand ssh bastion_GOP_SG_NC_MAIN -W %h:%p</span><br><span class="line">Host bastion_GOP_SG_NC_MAIN</span><br><span class="line">  HostName 8.8.8.8</span><br><span class="line">  port 22</span><br><span class="line">  User wangao</span><br><span class="line"></span><br><span class="line"><span class="comment"># test</span></span><br><span class="line">ssh 10.65.32.60</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      学习使用MacBook
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>iptables配置实践</title>
    <link href="https://wsgzao.github.io/post/iptables/"/>
    <id>https://wsgzao.github.io/post/iptables/</id>
    <published>2018-07-18T07:52:17.000Z</published>
    <updated>2018-07-19T09:42:02.871Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在大企业中防火墙角色主要交给硬件来支持，效果自然没话说只是需要增加一点点成本，但对于大多数个人或者互联网公司来说选择系统自带的<code>iptables</code>或者第三方云防火墙似乎是更加合适的选择，通过一些合理的优化和灵活的配置，我们也可以很轻松实现硬件防火墙的部分功能，够用就好。</p><blockquote><p>建立防火墙白名单机制很重要   </p></blockquote><hr><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018年07月18日 - 更新iptables原理和NAT配置<br>2015年07月24日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/iptables/">https://wsgzao.github.io/post/iptables/</a></p><p><strong>扩展阅读</strong></p><p>Linux 防火墙和 iptables - <a href="http://liaoph.com/iptables/" target="_blank" rel="noopener">http://liaoph.com/iptables/</a><br>iptables零基础快速入门系列 - <a href="http://www.zsythink.net/archives/tag/iptables/" target="_blank" rel="noopener">http://www.zsythink.net/archives/tag/iptables/</a></p><hr><h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><h3 id="Netfilter-与-iptables-的关系"><a href="#Netfilter-与-iptables-的关系" class="headerlink" title="Netfilter 与 iptables 的关系"></a>Netfilter 与 iptables 的关系</h3><p>Linux 系统在内核中提供了对报文数据包过滤和修改的官方项目名为 Netfilter，它指的是 Linux 内核中的一个框架，它可以用于在不同阶段将某些钩子函数（hook）作用域网络协议栈。Netfilter 本身并不对数据包进行过滤，它只是允许可以过滤数据包或修改数据包的函数挂接到内核网络协议栈中的适当位置。这些函数是可以自定义的。</p><p>iptables 是用户层的工具，它提供命令行接口，能够向 Netfilter 中添加规则策略，从而实现报文过滤，修改等功能。Linux 系统中并不止有 iptables 能够生成防火墙规则，其他的工具如 firewalld 等也能实现类似的功能。</p><h3 id="使用-iptables-进行包过滤"><a href="#使用-iptables-进行包过滤" class="headerlink" title="使用 iptables 进行包过滤"></a>使用 iptables 进行包过滤</h3><p>iptables 策略是由一组有序的规则建立的，它告诉内核应该如何处理某些类别的数据包。每一个 iptables 规则应用于一个表中的一个链。一个 iptables 链就是一个规则集，这些规则按序与包含某种特征的数据包进行比较匹配。</p><h3 id="表"><a href="#表" class="headerlink" title="表"></a>表</h3><p>iptables 根据功能分类，iptables 的内建有多个表，如包过滤（filter）或者网络地址转换（NAT）。iptables 中共有 4 个表：filter，nat，mangle 和 raw。filter 表主要实现过滤功能，nat 表实现 NAT 功能，mangle 表用于修改分组数据，raw 表用于修改俩节追踪的功能。</p><h3 id="链"><a href="#链" class="headerlink" title="链"></a>链</h3><p>每个表都有一组内置链，用户还可以添加自定义的链。最重要的内置链是 filter 表中的 INPUT、OUTPUT 和 FORWARD 链。</p><p>INPUT 链：发往本机的报文<br>OUTPUT 链：由本机发出的报文<br>FORWARD 链：经由本机转发的报文<br>PREROUTING 链：报文到达本机，进行路由决策之前<br>POSTROUTING 链：报文由本机发出，进行路由决策之后<br>下图展现了一个数据包是如何通过内核中的 net 和 filter 表的：</p><p><img src="//i.v2ex.co/4WFXrnn2.png" alt=""><br><img src="http://wx4.sinaimg.cn/large/7207510dgy1ftfb6rbw5tj20sr0f73z2.jpg" alt="image"></p><h3 id="匹配"><a href="#匹配" class="headerlink" title="匹配"></a>匹配</h3><p>每个 iptables 规则都包含一组匹配和一个目标动作，后者定义了复合规则的数据包应该采取什么处理行为。iptables 匹配指定是数据包必须匹配的条件，只有当数据包满足所有的匹配条件时，iptables 才能根据规则的目标所指定的动作来处理该数据包。</p><p>每个匹配都在 iptables 的命令行中指定。下面是一些常用的基本匹配：</p><table><thead><tr><th>参数</th><th>作用</th></tr></thead><tbody><tr><td>-P</td><td>设置默认策略</td></tr><tr><td>-F</td><td>清空规则链</td></tr><tr><td>-L</td><td>查看规则链</td></tr><tr><td>-A</td><td>在规则链的末尾加入新规则                        </td></tr><tr><td>-I num</td><td>在规则链的头部加入新规则                        </td></tr><tr><td>-D num</td><td>删除某一条规则                                    </td></tr><tr><td>-s</td><td>匹配来源地址IP/MASK，加叹号“!”表示除这个IP外    </td></tr><tr><td>-d</td><td>匹配目标地址                                    </td></tr><tr><td>-i网卡名称</td><td>匹配从这块网卡流入的数据                        </td></tr><tr><td>-o网卡名称</td><td>匹配从这块网卡流出的数据                        </td></tr><tr><td>-p</td><td>匹配协议，如TCP、UDP、ICMP                        </td></tr><tr><td>–dport num</td><td>匹配目标端口号                                    </td></tr><tr><td>–sport num</td><td>匹配来源端口号                                    </td></tr></tbody></table><h3 id="关闭iptables"><a href="#关闭iptables" class="headerlink" title="关闭iptables"></a>关闭iptables</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/iptables stop</span><br><span class="line">chkconfig iptables off</span><br></pre></td></tr></table></figure><h3 id="基础语法"><a href="#基础语法" class="headerlink" title="基础语法"></a>基础语法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#规则的观察与清除</span></span><br><span class="line"></span><br><span class="line">     iptables [-t tables] [-L] [-nv]</span><br><span class="line"></span><br><span class="line">选项与参数：</span><br><span class="line">-t ：后面接 table ，例如 nat 或 filter ，若省略此项目，则使用默认的 filter</span><br><span class="line">-L ：列出目前的 table 的规则</span><br><span class="line">-n ：不进行 IP 与 HOSTNAME 的反查，显示讯息的速度会快很多！</span><br><span class="line">-v ：列出更多的信息，包括通过该规则的封包总位数、相关的网络接口等</span><br><span class="line"></span><br><span class="line">     iptables [-t tables] [-FXZ]</span><br><span class="line"></span><br><span class="line">选项与参数：</span><br><span class="line">-F ：清除所有的已订定的规则；</span><br><span class="line">-X ：杀掉所有使用者 <span class="string">"自定义"</span> 的 chain (应该说的是 tables ）啰；</span><br><span class="line">-Z ：将所有的 chain 的计数与流量统计都归零</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#封包的基础比对：IP, 网域及接口装置</span></span><br><span class="line"></span><br><span class="line">    iptables [-AI 链名] [-io 网络接口] [-p 协议] [-s 来源IP/网域] [-d 目标IP/网域] -j [ACCEPT|DROP|REJECT|LOG]</span><br><span class="line"></span><br><span class="line">选项与参数：</span><br><span class="line">-AI 链名：针对某的链进行规则的 <span class="string">"插入"</span> 或 <span class="string">"累加"</span></span><br><span class="line">    -A ：新增加一条规则，该规则增加在原本规则的最后面。例如原本已经有四条规则，</span><br><span class="line">         使用 -A 就可以加上第五条规则！</span><br><span class="line">    -I ：插入一条规则。如果没有指定此规则的顺序，默认是插入变成第一条规则。</span><br><span class="line">         例如原本有四条规则，使用 -I 则该规则变成第一条，而原本四条变成 2~5 号</span><br><span class="line">    链 ：有 INPUT, OUTPUT, FORWARD 等，此链名称又与 -io 有关，请看底下。</span><br><span class="line"></span><br><span class="line">-io 网络接口：设定封包进出的接口规范</span><br><span class="line">    -i ：封包所进入的那个网络接口，例如 eth0, lo 等接口。需与 INPUT 链配合；</span><br><span class="line">    -o ：封包所传出的那个网络接口，需与 OUTPUT 链配合；</span><br><span class="line"></span><br><span class="line">-p 协定：设定此规则适用于哪种封包格式</span><br><span class="line">   主要的封包格式有： tcp, udp, icmp 及 all 。</span><br><span class="line"></span><br><span class="line">-s 来源 IP/网域：设定此规则之封包的来源项目，可指定单纯的 IP 或包括网域，例如：</span><br><span class="line">   IP  ：192.168.0.100</span><br><span class="line">   网域：192.168.0.0/24, 192.168.0.0/255.255.255.0 均可。</span><br><span class="line">   若规范为『不许』时，则加上 ! 即可，例如：</span><br><span class="line">   -s ! 192.168.100.0/24 表示不许 192.168.100.0/24 之封包来源；</span><br><span class="line"></span><br><span class="line">-d 目标 IP/网域：同 -s ，只不过这里指的是目标的 IP 或网域。</span><br><span class="line"></span><br><span class="line">-j ：后面接动作，主要的动作有接受(ACCEPT)、丢弃(DROP)、拒绝(REJECT)及记录(LOG)</span><br><span class="line"></span><br><span class="line"><span class="comment">#TCP, UDP 的规则比对：针对端口设定</span></span><br><span class="line"></span><br><span class="line">    iptables [-AI 链] [-io 网络接口] [-p tcp,udp] [-s 来源IP/网域] [--sport 埠口范围] [-d 目标IP/网域] [--dport 端口范围] -j [ACCEPT|DROP|REJECT]</span><br><span class="line"></span><br><span class="line">选项与参数：</span><br><span class="line">--sport 埠口范围：限制来源的端口号码，端口号码可以是连续的，例如 1024:65535</span><br><span class="line">--dport 埠口范围：限制目标的端口号码。</span><br><span class="line"></span><br><span class="line"><span class="comment">#iptables 外挂模块：mac 与 state</span></span><br><span class="line"></span><br><span class="line">    iptables -A INPUT [-m state] [--state 状态]</span><br><span class="line"></span><br><span class="line">选项与参数：</span><br><span class="line">-m ：一些 iptables 的外挂模块，主要常见的有：</span><br><span class="line">     state ：状态模块</span><br><span class="line">     mac   ：网络卡硬件地址 (hardware address)</span><br><span class="line">--state ：一些封包的状态，主要有：</span><br><span class="line">     INVALID    ：无效的封包，例如数据破损的封包状态</span><br><span class="line">     ESTABLISHED：已经联机成功的联机状态；</span><br><span class="line">     NEW        ：想要新建立联机的封包状态；</span><br><span class="line">     RELATED    ：这个最常用！表示这个封包是与我们主机发送出去的封包有关</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ICMP 封包规则的比对：针对是否响应 ping 来设计</span></span><br><span class="line"></span><br><span class="line">    iptables -A INPUT [-p icmp] [--icmp-type 类型] -j ACCEPT</span><br><span class="line"></span><br><span class="line">选项与参数：</span><br><span class="line">--icmp-type ：后面必须要接 ICMP 的封包类型，也可以使用代号，</span><br><span class="line">              例如 8  代表 <span class="built_in">echo</span> request 的意思。</span><br></pre></td></tr></table></figure><h2 id="配置iptables白名单机制"><a href="#配置iptables白名单机制" class="headerlink" title="配置iptables白名单机制"></a>配置iptables白名单机制</h2><blockquote><p>配置iptables白名单是相对简单有效的管理手段</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#清除所有规则(慎用)</span></span><br><span class="line">iptables -F</span><br><span class="line">iptables -X</span><br><span class="line">iptables -Z</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看iptable和行号</span></span><br><span class="line">iptables -nL --line-number</span><br><span class="line"></span><br><span class="line"><span class="comment">#保存当前防火墙配置</span></span><br><span class="line">service iptables save</span><br><span class="line"></span><br><span class="line"><span class="comment">#手动编辑防火墙策略</span></span><br><span class="line">vi /etc/sysconfig/iptables</span><br><span class="line"></span><br><span class="line">*filter</span><br><span class="line">:INPUT ACCEPT [0:0]</span><br><span class="line">:FORWARD ACCEPT [0:0]</span><br><span class="line">:OUTPUT ACCEPT [0:0]</span><br><span class="line"><span class="comment">#开放本地和Ping</span></span><br><span class="line">-A INPUT -i lo -j ACCEPT  </span><br><span class="line">-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT </span><br><span class="line">-A INPUT -p icmp -j ACCEPT</span><br><span class="line"><span class="comment">#配置内网白名单</span></span><br><span class="line">-A INPUT -s 10.0.0.0/8 -j ACCEPT</span><br><span class="line">-A INPUT -s 172.16.0.0/12 -j ACCEPT</span><br><span class="line">-A INPUT -s 192.168.0.0/16 -j ACCEPT</span><br><span class="line"><span class="comment">#配置外网白名单</span></span><br><span class="line">-A INPUT -s 180.168.36.198 -j ACCEPT </span><br><span class="line">-A INPUT -s 180.168.34.218 -j ACCEPT </span><br><span class="line">-A INPUT -s 222.73.202.251 -j ACCEPT </span><br><span class="line"><span class="comment">#控制端口</span></span><br><span class="line">-A INPUT -p tcp --dport 80 -j ACCEPT </span><br><span class="line">-A INPUT -p tcp --dport 22 -j ACCEPT</span><br><span class="line"><span class="comment">#拒绝其它</span></span><br><span class="line">-A INPUT -j DROP </span><br><span class="line">-A FORWARD -j DROP </span><br><span class="line"><span class="comment">#开放出口</span></span><br><span class="line">-A OUTPUT -j ACCEPT </span><br><span class="line">COMMIT</span><br><span class="line"></span><br><span class="line"><span class="comment">#重启生效</span></span><br><span class="line">service iptables restart</span><br><span class="line"></span><br><span class="line"><span class="comment">#复查结果</span></span><br><span class="line"></span><br><span class="line">iptables -nL --line-number</span><br><span class="line"></span><br><span class="line">Chain INPUT (policy ACCEPT)</span><br><span class="line">num  target     prot opt <span class="built_in">source</span>               destination         </span><br><span class="line">1    ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0           </span><br><span class="line">2    ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0           state RELATED,ESTABLISHED </span><br><span class="line">3    ACCEPT     icmp --  0.0.0.0/0            0.0.0.0/0           </span><br><span class="line">4    ACCEPT     all  --  10.0.0.0/8           0.0.0.0/0           </span><br><span class="line">5    ACCEPT     all  --  172.16.0.0/12        0.0.0.0/0           </span><br><span class="line">6    ACCEPT     all  --  192.168.0.0/16       0.0.0.0/0           </span><br><span class="line">7    ACCEPT     all  --  180.168.36.198       0.0.0.0/0           </span><br><span class="line">8    ACCEPT     all  --  180.168.34.218       0.0.0.0/0           </span><br><span class="line">9    ACCEPT     all  --  222.73.202.251       0.0.0.0/0           </span><br><span class="line">10   ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0           tcp dpt:80 </span><br><span class="line">11   ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0           tcp dpt:22 </span><br><span class="line">12   DROP       all  --  0.0.0.0/0            0.0.0.0/0           </span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy ACCEPT)</span><br><span class="line">num  target     prot opt <span class="built_in">source</span>               destination         </span><br><span class="line">1    DROP       all  --  0.0.0.0/0            0.0.0.0/0           </span><br><span class="line"></span><br><span class="line">Chain OUTPUT (policy ACCEPT)</span><br><span class="line">num  target     prot opt <span class="built_in">source</span>               destination         </span><br><span class="line">1    ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0</span><br></pre></td></tr></table></figure><h2 id="设置crontab脚本"><a href="#设置crontab脚本" class="headerlink" title="设置crontab脚本"></a>设置crontab脚本</h2><blockquote><p>便于运维集中化管理扩展</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">vi /root/start_iptables.sh</span><br><span class="line"></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#0 0 * * * /root/start_iptables.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#清除配置</span></span><br><span class="line">/sbin/iptables -P INPUT ACCEPT</span><br><span class="line">/sbin/iptables -F</span><br><span class="line">/sbin/iptables -X</span><br><span class="line"><span class="comment">#开放本地和Ping</span></span><br><span class="line">/sbin/iptables -A INPUT -i lo -j ACCEPT  </span><br><span class="line">/sbin/iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT </span><br><span class="line">/sbin/iptables -A INPUT -p icmp -j ACCEPT</span><br><span class="line"><span class="comment">#配置内网白名单</span></span><br><span class="line">/sbin/iptables -A INPUT -s 10.0.0.0/8 -j ACCEPT</span><br><span class="line">/sbin/iptables -A INPUT -s 172.16.0.0/12 -j ACCEPT</span><br><span class="line">/sbin/iptables -A INPUT -s 192.168.0.0/16 -j ACCEPT</span><br><span class="line"><span class="comment">#配置外网白名单</span></span><br><span class="line">/sbin/iptables -A INPUT -s 180.168.36.198 -j ACCEPT </span><br><span class="line">/sbin/iptables -A INPUT -s 180.168.34.218 -j ACCEPT </span><br><span class="line">/sbin/iptables -A INPUT -s 222.73.202.251 -j ACCEPT </span><br><span class="line"><span class="comment">#控制端口</span></span><br><span class="line">/sbin/iptables -A INPUT -p tcp --dport 80 -j ACCEPT </span><br><span class="line">/sbin/iptables -A INPUT -p tcp --dport 22 -j ACCEPT</span><br><span class="line"><span class="comment">#拒绝其它</span></span><br><span class="line">/sbin/iptables -A INPUT -j DROP </span><br><span class="line">/sbin/iptables -A FORWARD -j DROP </span><br><span class="line"><span class="comment">#开放出口</span></span><br><span class="line">/sbin/iptables -A OUTPUT -j ACCEPT </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">chmod 755 /root/start_iptables.sh</span><br><span class="line">crontab -e</span><br><span class="line">0 0 * * * /root/start_iptables.sh</span><br></pre></td></tr></table></figure><h2 id="配置NAT-Tunnel"><a href="#配置NAT-Tunnel" class="headerlink" title="配置NAT Tunnel"></a>配置NAT Tunnel</h2><blockquote><p>俗称跳板机</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置iptables</span></span><br><span class="line">vi /etc/sysconfig/iptables</span><br><span class="line">*nat</span><br><span class="line">:PREROUTING ACCEPT [6:504]</span><br><span class="line">:INPUT ACCEPT [0:0]</span><br><span class="line">:OUTPUT ACCEPT [1:52]</span><br><span class="line">:POSTROUTING ACCEPT [1:52]</span><br><span class="line"></span><br><span class="line">-A POSTROUTING -j MASQUERADE</span><br><span class="line">COMMIT</span><br><span class="line"></span><br><span class="line">*filter</span><br><span class="line">:INPUT DROP [1029028:53321694]</span><br><span class="line">:FORWARD ACCEPT [0:0]</span><br><span class="line">:OUTPUT ACCEPT [44723822:21524638399]</span><br><span class="line"></span><br><span class="line"><span class="comment">#zabbix</span></span><br><span class="line">-A INPUT -s 10.65.200.90 -p tcp -m tcp --dport 10050 -j ACCEPT</span><br><span class="line"></span><br><span class="line">-A INPUT -p tcp --dport 22 -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># For keepalived:</span></span><br><span class="line"><span class="comment"># allow vrrp</span></span><br><span class="line">-A INPUT -p vrrp -j ACCEPT</span><br><span class="line">-A INPUT -p igmp -j ACCEPT</span><br><span class="line"><span class="comment"># allow multicast</span></span><br><span class="line">-A INPUT -d 224.0.0.18 -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># Drop packets from spoofed networks</span></span><br><span class="line">-A INPUT -s 169.254.0.0/16   -j DROP</span><br><span class="line"><span class="comment">#-A INPUT -s 10.0.0.0/8       -j DROP</span></span><br><span class="line"><span class="comment">#-A INPUT -s 127.0.0.0/8      -j DROP</span></span><br><span class="line">-A INPUT -s 224.0.0.0/4      -j DROP</span><br><span class="line">-A INPUT -d 224.0.0.0/4      -j DROP</span><br><span class="line">-A INPUT -s 240.0.0.0/5      -j DROP</span><br><span class="line">-A INPUT -d 240.0.0.0/5      -j DROP</span><br><span class="line">-A INPUT -s 0.0.0.0/8        -j DROP</span><br><span class="line">-A INPUT -d 0.0.0.0/8        -j DROP</span><br><span class="line">-A INPUT -d 239.255.255.0/24 -j DROP</span><br><span class="line">-A INPUT -d 255.255.255.255  -j DROP</span><br><span class="line"></span><br><span class="line"><span class="comment"># Drop Invalid packets</span></span><br><span class="line">-A INPUT   -m state --state INVALID -j DROP</span><br><span class="line"><span class="comment">#-A FORWARD -m state --state INVALID -j DROP</span></span><br><span class="line">-A OUTPUT  -m state --state INVALID -j DROP</span><br><span class="line"></span><br><span class="line"><span class="comment"># Drop Bogus TCP packets</span></span><br><span class="line">-A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP</span><br><span class="line">-A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP</span><br><span class="line"></span><br><span class="line">-A INPUT -p icmp --icmp-type <span class="built_in">echo</span>-reply -j ACCEPT</span><br><span class="line">-A INPUT -p icmp --icmp-type destination-unreachable -j ACCEPT</span><br><span class="line">-A INPUT -p icmp --icmp-type redirect -j ACCEPT</span><br><span class="line">-A INPUT -p icmp --icmp-type <span class="built_in">echo</span>-request -j ACCEPT</span><br><span class="line">-A INPUT -p icmp --icmp-type time-exceeded -j ACCEPT</span><br><span class="line">-A INPUT -i lo -j ACCEPT</span><br><span class="line">-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br><span class="line">COMMIT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启生效并检查</span></span><br><span class="line">service iptables restart</span><br><span class="line">iptables -nvL</span><br></pre></td></tr></table></figure><h2 id="CentOS7配置iptables"><a href="#CentOS7配置iptables" class="headerlink" title="CentOS7配置iptables"></a>CentOS7配置iptables</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置好yum源以后安装iptables-service</span></span><br><span class="line">yum install -y iptables-services</span><br><span class="line"><span class="comment"># 停止firewalld</span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line"><span class="comment"># 禁止firewalld自动启动</span></span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br><span class="line"><span class="comment"># 启动iptables</span></span><br><span class="line">systemctl start iptables</span><br><span class="line"><span class="comment"># 将iptables设置为开机自动启动，以后即可通过iptables-service控制iptables服务</span></span><br><span class="line">systemctl <span class="built_in">enable</span> iptables</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      建立防火墙白名单机制很重要
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>批量创建和导入SecureCRT Sessions</title>
    <link href="https://wsgzao.github.io/post/securecrt/"/>
    <id>https://wsgzao.github.io/post/securecrt/</id>
    <published>2018-07-17T06:59:49.000Z</published>
    <updated>2018-07-19T08:51:35.193Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>批量创建和导入SecureCRT Sessions过程很简单，只是我花了一点时间寻找合适的方法，没想到还是官方的最简单，如果大家已经有现成的配置文件，直接把别人的拷贝过来就好了，不用自己造轮子。说实话我在Windows上用Xmanager/Xshell，MacBook上使用iTerm2，Mac上似乎也没有特别舒服的GUI，批量操作还是推荐Ansible。</p><blockquote><p>Import Arbitrary Data From File To SecureCRT Sessions</p></blockquote><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018年07月17日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/securecrt/">https://wsgzao.github.io/post/securecrt/</a></p><p><strong>扩展阅读</strong></p><p>VanDyke Software Forums - <a href="https://forums.vandyke.com/forumdisplay.php?f=14" target="_blank" rel="noopener">https://forums.vandyke.com/forumdisplay.php?f=14</a></p><hr><h2 id="使用前提"><a href="#使用前提" class="headerlink" title="使用前提"></a>使用前提</h2><p>This example shows how to create sessions from information in a text file (.csv format by default, but this can be edited to fit the format you have).</p><p>Note: This script will only work with SecureCRT version 7.2 and later.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ImportArbitraryDataFromFileToSecureCRTSessions.py</span></span><br><span class="line"><span class="comment">#   (Designed for use with SecureCRT 7.2 and later)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   Last Modified: 16 May, 2018</span></span><br><span class="line"><span class="comment">#     - Add a section to the results log that shows lines that weren't</span></span><br><span class="line"><span class="comment">#       imported. Lines are shown in a way that makes it easier to re-</span></span><br><span class="line"><span class="comment">#       run the script to import those lines after they've been modified</span></span><br><span class="line"><span class="comment">#       to correct any issues idendified (missing fields, too many fields,</span></span><br><span class="line"><span class="comment">#       disallowed characters in folder or session name, etc.) Also</span></span><br><span class="line"><span class="comment">#       modified the results log to have a formatting that more closely</span></span><br><span class="line"><span class="comment">#       matches that of the vbscript version to provide more consistency</span></span><br><span class="line"><span class="comment">#       when running the script regardless of the platform.</span></span><br><span class="line"><span class="comment">#     - Set session options for all imported sessions to reflect commonly</span></span><br><span class="line"><span class="comment">#       desired configurations (color scheme, anti-idle, log file naming,</span></span><br><span class="line"><span class="comment">#       larger scrollback buffer, etc.)</span></span><br><span class="line"><span class="comment">#     - Validate both folder paths and session names to prevent errors</span></span><br><span class="line"><span class="comment">#       that would normally stop the script. Report such failures at the</span></span><br><span class="line"><span class="comment">#       end of the scipt rather than halting the script in media res.</span></span><br><span class="line"><span class="comment">#       This validation includes preventing any attempts to name a session</span></span><br><span class="line"><span class="comment">#       with any disallowed character or illegal name (CON, PRN, AUX, NUL,</span></span><br><span class="line"><span class="comment">#       etc.)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   Last Modified: 23 Feb, 2018</span></span><br><span class="line"><span class="comment">#     - Info-blurb about sessions that were created during the import was</span></span><br><span class="line"><span class="comment">#       missing from the results log</span></span><br><span class="line"><span class="comment">#     - If running on Windows, and unable to write to results log, make</span></span><br><span class="line"><span class="comment">#       sure clipboard data containing the results log info is formatted</span></span><br><span class="line"><span class="comment">#       with \r\n instead of just \n so that it's legible in Notepad, for</span></span><br><span class="line"><span class="comment">#       example, when pasted.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   Last Modified: 21 Dec, 2017</span></span><br><span class="line"><span class="comment">#      - Allow multiple 'description' fields on the same line. All will be</span></span><br><span class="line"><span class="comment">#        compounded together with each one ending up on a separate line in</span></span><br><span class="line"><span class="comment">#        the Session's Description session option.</span></span><br><span class="line"><span class="comment">#      - Allow 'username' field to be defaulted in the header line</span></span><br><span class="line"><span class="comment">#      - Duplicate sessions are now imported with unique time-stamped</span></span><br><span class="line"><span class="comment">#        names (for each additional duplicate). Earlier versions of this</span></span><br><span class="line"><span class="comment">#        script would overwrite the first duplicate with any subsequent</span></span><br><span class="line"><span class="comment">#        duplicates that were found in the data file.</span></span><br><span class="line"><span class="comment">#      - Allow header fields to be case-insentive so that "Description"</span></span><br><span class="line"><span class="comment">#        and "HostName", etc. work just as well as "description" and "hostname"</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   Last Modified: 18 Dec, 2017</span></span><br><span class="line"><span class="comment">#      - Remove unused (commented out) code block left in from the</span></span><br><span class="line"><span class="comment">#        20 Apr, 2017 changes.</span></span><br><span class="line"><span class="comment">#      - Fix required header line message to no longer reference</span></span><br><span class="line"><span class="comment">#        'protocol' field as required.</span></span><br><span class="line"><span class="comment">#      - Add fallback locations where the script will attempt to</span></span><br><span class="line"><span class="comment">#        write summary log of script's activities/errors/warnings.</span></span><br><span class="line"><span class="comment">#        This attempts to facilitate running this script in environments</span></span><br><span class="line"><span class="comment">#        where SecureCRT may not have access to a "Documents" folder</span></span><br><span class="line"><span class="comment">#        (such as when SecureCRT is being launched through VDI publishing).</span></span><br><span class="line"><span class="comment">#         --&gt; First try Documents,</span></span><br><span class="line"><span class="comment">#         --&gt; Then try Desktop,</span></span><br><span class="line"><span class="comment">#         --&gt; Then try SecureCRT's config folder.</span></span><br><span class="line"><span class="comment">#         --&gt; If none of the above are accessible for writing, the</span></span><br><span class="line"><span class="comment">#             script will copy the summary report to the clipboard,</span></span><br><span class="line"><span class="comment">#             providing the user with a way to see the summary report</span></span><br><span class="line"><span class="comment">#             if pasted into a text editor.</span></span><br><span class="line"><span class="comment">#      - Added support for defaulting the "folder" header so that all</span></span><br><span class="line"><span class="comment">#        new entries could be imported into a folder w/o having to</span></span><br><span class="line"><span class="comment">#        specify the folder on each line. Example header line for</span></span><br><span class="line"><span class="comment">#        CSV file with only hostname data would be:</span></span><br><span class="line"><span class="comment">#            hostname,folder=default_import_folder_name</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   Last Modified: 17 Nov, 2017</span></span><br><span class="line"><span class="comment">#      - No longer attempt to use platform to determine OS ver info,</span></span><br><span class="line"><span class="comment">#        as it's no longer needed.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   Last Modified: 20 Apr, 2017</span></span><br><span class="line"><span class="comment">#      - No longer require protocol in header. Use the Default session's</span></span><br><span class="line"><span class="comment">#        protocol if the protocol field is not present in the header line.</span></span><br><span class="line"><span class="comment">#      - Conform to python join() method requiring only one argument.</span></span><br><span class="line"><span class="comment">#      - Prompt for delimiter character if it isn't found in the header line.</span></span><br><span class="line"><span class="comment">#      - Allow delimiter character to be NONE, so that a single field (hostname)</span></span><br><span class="line"><span class="comment">#        and corresponding data can be used to import sessions (say for example</span></span><br><span class="line"><span class="comment">#        if you have a file that just contains hostnames, one per line).</span></span><br><span class="line"><span class="comment">#      - [Bug Fix]: can't use + to concatenate str and int, so use format()</span></span><br><span class="line"><span class="comment">#        instead.</span></span><br><span class="line"><span class="comment">#      - [Bug Fix]: "Procotol" typo fixed to "Protocol" in error case where</span></span><br><span class="line"><span class="comment">#        protocol header field not found/set.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   Last Modified: 04 Jan, 2017</span></span><br><span class="line"><span class="comment">#      - Added support for specifying logon script file to be set for</span></span><br><span class="line"><span class="comment">#        imported sessions.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   Last Modified: 02 Jul, 2015</span></span><br><span class="line"><span class="comment">#      - Display status bar info for each line we're processing so that if</span></span><br><span class="line"><span class="comment">#        there's an error, the individual running the script might have</span></span><br><span class="line"><span class="comment">#        better information about why the error might have occurred.</span></span><br><span class="line"><span class="comment">#      - Handle cases where a line in the data file might have more fields</span></span><br><span class="line"><span class="comment">#        in it than the number of header fields designated for import. This</span></span><br><span class="line"><span class="comment">#        fixes an error reported by forum user wixxyl here:</span></span><br><span class="line"><span class="comment">#           https://forums.vandyke.com/showthread.php?t=12021</span></span><br><span class="line"><span class="comment">#        If a line has too many fields, create a warning to be displayed</span></span><br><span class="line"><span class="comment">#        later on, and move on to the next line -- skipping the current line</span></span><br><span class="line"><span class="comment">#        because it's unknown whether the data is even valid for import.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   Last Modified: 20 Jan, 2015</span></span><br><span class="line"><span class="comment">#      - Combined TAPI protocol handling (which is no longer</span></span><br><span class="line"><span class="comment">#        supported for mass import) with Serial protocol</span></span><br><span class="line"><span class="comment">#        import errors.</span></span><br><span class="line"><span class="comment">#      - Enhanced example .csv file data to show subfolder specification.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   Last Modified: 21 Mar, 2012</span></span><br><span class="line"><span class="comment">#      - Initial version for public forums</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># DESCRIPTION</span></span><br><span class="line"><span class="comment"># This sample script is designed to create sessions from a text file (.csv</span></span><br><span class="line"><span class="comment"># format by default, but this can be edited to fit the format you have).</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># To launch this script, map a button on the button bar to run this script:</span></span><br><span class="line"><span class="comment">#    http://www.vandyke.com/support/tips/buttonbar.html</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The first line of your data file should contain a comma-separated (or whatever</span></span><br><span class="line"><span class="comment"># you define as the g_strDelimiter below) list of supported "fields" designated</span></span><br><span class="line"><span class="comment"># by the following keywords:</span></span><br><span class="line"><span class="comment"># -----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># session_name: The name that should be used for the session. If this field</span></span><br><span class="line"><span class="comment">#               does not exist, the hostname field is used as the session_name.</span></span><br><span class="line"><span class="comment">#       folder: Relative path for session as displayed in the Connect dialog.</span></span><br><span class="line"><span class="comment">#     hostname: The hostname or IP for the remote server.</span></span><br><span class="line"><span class="comment">#     protocol: The protocol (SSH2, SSH1, telnet, rlogin)</span></span><br><span class="line"><span class="comment">#         port: The port on which remote server is listening</span></span><br><span class="line"><span class="comment">#     username: The username for the account on the remote server</span></span><br><span class="line"><span class="comment">#    emulation: The emulation (vt100, xterm, etc.)</span></span><br><span class="line"><span class="comment">#  description: The comment/description. Multiple lines are separated with '\r'</span></span><br><span class="line"><span class="comment"># logon_script: The full path to the Logon Script filename for the session.</span></span><br><span class="line"><span class="comment"># =============================================================================</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># As mentioned above, the first line of the data file instructs this script as</span></span><br><span class="line"><span class="comment"># to the format of the fields in your data file and their meaning.  It is not a</span></span><br><span class="line"><span class="comment"># requirement that all the options be used. For example, notice the first line</span></span><br><span class="line"><span class="comment"># of the following file only uses the "hostname", "username", and "protocol"</span></span><br><span class="line"><span class="comment"># fields.  Note also that the "protocol" field can be defaulted so that if a</span></span><br><span class="line"><span class="comment"># protocol field is empty it will use the default value.</span></span><br><span class="line"><span class="comment"># -----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#   hostname,username,folder,protocol=SSH2</span></span><br><span class="line"><span class="comment">#   192.168.0.1,root,_imported,SSH1</span></span><br><span class="line"><span class="comment">#   192.168.0.2,admin,_imported,SSH2</span></span><br><span class="line"><span class="comment">#   192.168.0.3,root,_imported/folderA,</span></span><br><span class="line"><span class="comment">#   192.168.0.4,root,,</span></span><br><span class="line"><span class="comment">#   192.168.0.5,admin,_imported/folderB,telnet</span></span><br><span class="line"><span class="comment">#   ... and so on</span></span><br><span class="line"><span class="comment"># =============================================================================</span></span><br></pre></td></tr></table></figure><h2 id="Video"><a href="#Video" class="headerlink" title="Video"></a>Video</h2><p>Watch this YouTube video if you’re having troubles understanding what this script does, or how to go about using it.</p><p><a href="https://youtu.be/f7nMFYhGoiI" target="_blank" rel="noopener">https://youtu.be/f7nMFYhGoiI</a></p><h2 id="实践过程"><a href="#实践过程" class="headerlink" title="实践过程"></a>实践过程</h2><blockquote><p>批量导入列表适合于使用SSH密钥登录方式管理</p></blockquote><ol><li>下载ImportArbitraryDataFromFileToSecureCRTSessions</li><li>配置自定义SecureCRTSessions.csv格式的文件</li><li>运行SecureCRT，选择菜单栏<code>Script-Run</code>,先选择脚本再选择自定义配置文件</li><li>关闭Session Manager或者重新打开SecureCRT即可看到导入的配置信息</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 找到Seesions目录</span></span><br><span class="line">/Users/wangao/Library/Application Support/VanDyke/SecureCRT/Config/Sessions</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编辑SecureCRTSessions.csv</span></span><br><span class="line">folder,username,hostname,protocol</span><br><span class="line">GOP/NGINX,wangao,192.168.0.13,SSH2</span><br><span class="line">GOP/NGINX,wangao,192.168.0.14,SSH2</span><br><span class="line">GOP/NGINX,wangao,192.168.0.15,SSH2</span><br><span class="line">GOP/NGINX,wangao,192.168.0.16,SSH2</span><br></pre></td></tr></table></figure><h2 id="Files"><a href="#Files" class="headerlink" title="Files"></a>Files</h2><ul><li>Mac/Unix: ImportArbitraryDataFromFileToSecureCRTSessions.py.txt</li><li>Windows: ImportArbitraryDataFromFileToSecureCRTSessions.vbs.txt</li></ul><p><a href="https://forums.vandyke.com/showpost.php?p=37089&amp;postcount=1" target="_blank" rel="noopener">https://forums.vandyke.com/showpost.php?p=37089&amp;postcount=1</a></p>]]></content>
    
    <summary type="html">
    
      Import Arbitrary Data From File To SecureCRT Sessions
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>CoreDNS 使用指北</title>
    <link href="https://wsgzao.github.io/post/coredns/"/>
    <id>https://wsgzao.github.io/post/coredns/</id>
    <published>2018-07-10T06:59:49.000Z</published>
    <updated>2018-07-11T10:02:09.890Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>CoreDNS 是一个从 Caddy 中Fork出来的项目（同时继承了它的链式中间件风格），作为CNCF项目中的一员，它的目标是提供一个快速且灵活的DNS服务。</p><blockquote><p>CoreDNS - DNS and Service Discovery</p></blockquote><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018年07月10日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/coredns/">https://wsgzao.github.io/post/coredns/</a></p><p><strong>扩展阅读</strong></p><p>CoreDNS - <a href="https://coredns.io/" target="_blank" rel="noopener">https://coredns.io/</a></p><hr><h2 id="CoreDNS-简介"><a href="#CoreDNS-简介" class="headerlink" title="CoreDNS 简介"></a>CoreDNS 简介</h2><blockquote><p>In Kubernetes 1.11, CoreDNS is the default DNS server.</p></blockquote><p>CoreDNS is a DNS server. It is written in Go. It can be used in a multitude of environments because of its flexibility. CoreDNS is licensed under the Apache License Version 2, and completely open source.<br>Development takes place on Github. Most devs hang out on Slack on the #coredns channel.</p><h2 id="CoreDNS-安装"><a href="#CoreDNS-安装" class="headerlink" title="CoreDNS 安装"></a>CoreDNS 安装</h2><p>直接在Github上下载对应执行文件压缩包<br><a href="https://github.com/coredns/coredns/releases" target="_blank" rel="noopener">https://github.com/coredns/coredns/releases</a></p><p>Linux上下载安装（以官方新版本为基准）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/coredns/coredns/releases/download/v1.1.4/coredns_1.1.4_linux_amd64.tgz</span><br><span class="line">tar xzf coredns_1.1.4_linux_amd64.tgz</span><br><span class="line">mv coredns /usr/<span class="built_in">local</span>/bin</span><br></pre></td></tr></table></figure><h2 id="CoreDNS-配置"><a href="#CoreDNS-配置" class="headerlink" title="CoreDNS 配置"></a>CoreDNS 配置</h2><p>参考 QuickStart 中的配置<br><a href="https://coredns.io/2017/07/24/quick-start/" target="_blank" rel="noopener">https://coredns.io/2017/07/24/quick-start/</a></p><p>配置文件Corefile示例如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">. &#123;</span><br><span class="line">    proxy . 223.5.5.5:53 &#123;</span><br><span class="line">        except example.org</span><br><span class="line">        protocol dns</span><br><span class="line">    &#125;</span><br><span class="line">    prometheus     <span class="comment"># enable metrics</span></span><br><span class="line">    errors stdout  <span class="comment"># show errors</span></span><br><span class="line">    <span class="built_in">log</span> stdout     <span class="comment"># show query logs</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">example.org &#123;</span><br><span class="line">    file /etc/coredns/zones/example.org</span><br><span class="line">    prometheus     <span class="comment"># enable metrics</span></span><br><span class="line">    errors stdout  <span class="comment"># show errors</span></span><br><span class="line">    <span class="built_in">log</span> stdout     <span class="comment"># show query logs</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>具体Corefile配置说明请参考文档<br><a href="https://coredns.io/2017/07/23/corefile-explained/" target="_blank" rel="noopener">https://coredns.io/2017/07/23/corefile-explained/</a></p><p>而/etc/coredns/zones/example.org的配置文件示例如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ORIGIN</span> example.org.</span><br><span class="line">@3600 INSOA sns.dns.icann.org. noc.dns.icann.org. (</span><br><span class="line">2017042745 ; serial</span><br><span class="line">7200       ; refresh (2 hours)</span><br><span class="line">3600       ; retry (1 hour)</span><br><span class="line">1209600    ; expire (2 weeks)</span><br><span class="line">3600       ; minimum (1 hour)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">    3600 IN NS a.iana-servers.net.</span><br><span class="line">3600 IN NS b.iana-servers.net.</span><br><span class="line"></span><br><span class="line">www     IN A     127.0.0.1</span><br><span class="line">        IN AAAA  ::1</span><br><span class="line"></span><br><span class="line">tt      IN A     192.168.2.4</span><br><span class="line">        IN AAAA  ::1</span><br><span class="line">        IN TXT   HelloExampleTest</span><br></pre></td></tr></table></figure><h2 id="CoreDNS-测试"><a href="#CoreDNS-测试" class="headerlink" title="CoreDNS 测试"></a>CoreDNS 测试</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑本地 nameserver</span></span><br><span class="line">vi /etc/resolv.conf</span><br><span class="line">nameserver 8.8.8.8</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编辑 corefile 文件</span></span><br><span class="line">vi /etc/coredns/corefile</span><br><span class="line"></span><br><span class="line">coredns:53 &#123;</span><br><span class="line">    errors         <span class="comment"># show errors</span></span><br><span class="line">    <span class="built_in">log</span>            <span class="comment"># enable query logs</span></span><br><span class="line">    zookeeper up_timeout=5 zk_timeout=10 zk_ttl=5 zk_addrs=10.65.200.36:2181,10.65.200.37:2181,10.65.200.138:2181 zk_znode=/dns</span><br><span class="line">    loadbalance round_robin</span><br><span class="line">    cache 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.:53 &#123;</span><br><span class="line">    errors         <span class="comment"># show errors</span></span><br><span class="line">    <span class="built_in">log</span>            <span class="comment"># enable query logs</span></span><br><span class="line">    proxy . /etc/resolv.conf</span><br><span class="line">    loadbalance round_robin</span><br><span class="line">    cache 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行 CoreDNS 很简单，命令如下</span></span><br><span class="line">coredns -conf /etc/coredns/Corefile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 dig 命令测试</span></span><br><span class="line">https://www.diggui.com/</span><br><span class="line"></span><br><span class="line">dig +short @10.65.200.105 google.com</span><br><span class="line">dig google.com</span><br></pre></td></tr></table></figure><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><blockquote><p>CoreDNS Manual</p></blockquote><p><a href="https://coredns.io/manual/toc/" target="_blank" rel="noopener">https://coredns.io/manual/toc/</a></p>]]></content>
    
    <summary type="html">
    
      CoreDNS - DNS and Service Discovery
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>我的线上线下购物变迁史</title>
    <link href="https://wsgzao.github.io/post/buy/"/>
    <id>https://wsgzao.github.io/post/buy/</id>
    <published>2018-05-28T06:59:49.000Z</published>
    <updated>2018-05-28T09:03:37.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>很久很久以前，我们利用信息不对称在互联网未普及时赚取差价，在互联网浪潮以及无限移动流量不断下调门槛的欢呼声中，我们不知不觉的进入到无现金社会中，用手机支付转账抢红包，刷地铁公交，办理各种和生活息息相关的琐事，甚至即将普及的电子身份证和电子驾照等。虽然核心硬实力大家已经看清楚差距，但软实力上同行业的激烈竞争和跨行业的降维攻击在不断推着咱们的传统行业持续变革，总有很多事情不尽如人意，但至少技术让生活越来越便利，我们也在慢慢向前进击。</p><blockquote><p>如果可以兼顾隐私安全的话，希望未来一部手机就可以完成所有事情</p></blockquote><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018年05月28日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/buy/">https://wsgzao.github.io/post/buy/</a></p><hr><h2 id="国内线上购物"><a href="#国内线上购物" class="headerlink" title="国内线上购物"></a>国内线上购物</h2><blockquote><p>网易严选 &gt; 网易考拉 &gt; 小米有品 &gt; 京东 &gt; 淘宝</p></blockquote><p>淘宝.Taobao - <a href="https://www.taobao.com/" target="_blank" rel="noopener">https://www.taobao.com/</a></p><ul><li>还记得当时神秘的程序员漫画作者西乔和霍炬移民前往加拿大时留下一句话，会想念万能的淘宝</li><li>我所怀念的应该是现在和未来支付宝和微信所垄断的无现金社会吧</li></ul><p>京东.JD - <a href="https://www.jd.com/" target="_blank" rel="noopener">https://www.jd.com/</a></p><ul><li>自营大概率正品+极速物流+优质售后让我第一眼就喜欢上京东，只是现在不怎么用了，当然也不是付费会员</li><li>京东和顺丰的极速物流定位不同，前者建仓库后者上天入地，但都为实体经济创造了不可磨灭的价值，值得尊重</li><li>希望顺丰，京东，菜鸟们能积极向国外物流巨头看齐，不仅要做大更要做强</li></ul><p>网易考拉.Kaola - <a href="https://www.kaola.com/" target="_blank" rel="noopener">https://www.kaola.com/</a></p><ul><li>此前我一直想当然的认为国内海淘市场Amazon亚马逊是老大，可当我自己需要海淘购物时才发现网易考拉海购才是隐形冠军</li><li>我办理了网易考拉黑卡会员，值</li></ul><p>网易严选 - <a href="https://you.163.com/" target="_blank" rel="noopener">https://you.163.com/</a></p><ul><li>我需要买什么会先搜索网易严选，而严选的slogan我也很喜欢“好的生活，没那么贵”</li><li>网易严选和小米有品也选择了两条不同的路，目前严选的品类更多一些，高标准的服务让我第一时间联想到京东</li><li>我办理了网易严选超级会员，值</li></ul><p>小米有品 - <a href="https://youpin.mi.com/" target="_blank" rel="noopener">https://youpin.mi.com/</a></p><ul><li>如果你很喜欢新奇的智能硬件产品，小米有品相信可以满足很多人的好奇心</li><li>不管外界如何评论小米的商业模式，即使我也享受过饥饿营销的恶心，但不可否认因为小米的坚持让我可以花更少的钱享受到科技的乐趣</li></ul><p>闲鱼 - <a href="https://2.taobao.com/" target="_blank" rel="noopener">https://2.taobao.com/</a></p><ul><li>淘宝内部孵化出来的二手闲置交易平台，再一次看到了芝麻信用的威力</li><li>我也偶尔会在闲鱼上购买或者低价卖出自己的闲置</li></ul><p>百果园 - <a href="https://www.pagoda.com.cn/" target="_blank" rel="noopener">https://www.pagoda.com.cn/</a></p><ul><li>推荐这个大家可能比较意外，因为百果园应该是线下强于线上，以实体店为主，但我想说的是百果园才是继便利店之后我高频消费的第二场所</li><li>百果园的商业式不多谈，但有一个服务我希望让大家知晓，不好吃瞬间退款，如果这个服务哪天不存在了，我引用官网的一句话来表达遗憾，三无退货并非零门槛，他的门槛是“人”之所以称之为“人”的最基础门槛，那就是“良知”</li></ul><p><strong>其它</strong></p><ol><li>唯品会 - 不买，但不去妨碍别人选择</li><li>拼多多 - 不买，但不去妨碍别人选择</li><li>美团点评 - 按需搜索，看真实评价</li><li>外卖平台 - 越来越成熟和规范，造福大家吧</li><li>优衣库 - 个人认为是目前线上和线下融合的最佳案例之一，不仅产品性价比高，营销也是业内一把好手，不过因为网易严选我买的很少了</li></ol><h2 id="国外线上购物"><a href="#国外线上购物" class="headerlink" title="国外线上购物"></a>国外线上购物</h2><blockquote><p>待定</p></blockquote>]]></content>
    
    <summary type="html">
    
      如果可以兼顾隐私安全的话，希望未来一部手机就可以完成所有事情
    
    </summary>
    
      <category term="生活 | Life" scheme="https://wsgzao.github.io/categories/%E7%94%9F%E6%B4%BB-Life/"/>
    
    
  </entry>
  
  <entry>
    <title>Docker 使用指北</title>
    <link href="https://wsgzao.github.io/post/docker/"/>
    <id>https://wsgzao.github.io/post/docker/</id>
    <published>2018-05-21T06:59:49.000Z</published>
    <updated>2018-05-21T07:07:39.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>把docker-ce安装和使用部分先独立抽取出来，关于使用可以参考阮一峰写的《Docker入门教程》</p><blockquote><p>基于docker-ce的部署和使用手册</p></blockquote><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018年05月21日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/docker/">https://wsgzao.github.io/post/docker/</a></p><p><strong>扩展阅读</strong></p><p>Docker - <a href="https://www.docker.com/" target="_blank" rel="noopener">https://www.docker.com/</a></p><hr><h2 id="环境说明"><a href="#环境说明" class="headerlink" title="环境说明"></a>环境说明</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 操作系统版本</span></span><br><span class="line">cat /etc/redhat-release</span><br><span class="line">CentOS Linux release 7.4.1708 (Core)</span><br><span class="line"><span class="comment"># 操作系统内核</span></span><br><span class="line">uname -r</span><br><span class="line">3.10.0-693.21.1.el7.x86_64</span><br><span class="line"><span class="comment"># 硬件架构</span></span><br><span class="line">uname -m</span><br><span class="line">x86_64</span><br><span class="line"><span class="comment"># docker版本</span></span><br><span class="line">docker version</span><br><span class="line">Client:</span><br><span class="line"> Version:18.03.0-ce</span><br><span class="line"> API version:1.37</span><br><span class="line"> Go version:go1.9.4</span><br><span class="line"> Git commit:0520e24</span><br><span class="line"> Built:Wed Mar 21 23:09:15 2018</span><br><span class="line"> OS/Arch:linux/amd64</span><br><span class="line"> Experimental:<span class="literal">false</span></span><br><span class="line"> Orchestrator:swarm</span><br><span class="line"></span><br><span class="line">Server:</span><br><span class="line"> Engine:</span><br><span class="line">  Version:18.03.0-ce</span><br><span class="line">  API version:1.37 (minimum version 1.12)</span><br><span class="line">  Go version:go1.9.4</span><br><span class="line">  Git commit:0520e24</span><br><span class="line">  Built:Wed Mar 21 23:13:03 2018</span><br><span class="line">  OS/Arch:linux/amd64</span><br><span class="line">  Experimental:<span class="literal">false</span></span><br></pre></td></tr></table></figure><h2 id="部署Docker"><a href="#部署Docker" class="headerlink" title="部署Docker"></a>部署Docker</h2><h3 id="使用阿里云加速器加快获取docker官方的镜像"><a href="#使用阿里云加速器加快获取docker官方的镜像" class="headerlink" title="使用阿里云加速器加快获取docker官方的镜像"></a>使用阿里云加速器加快获取docker官方的镜像</h3><p>步骤一：如果没有阿里云账号，需要注册阿里云开发账号</p><p><a href="https://dev.aliyun.com/" target="_blank" rel="noopener">https://dev.aliyun.com/</a></p><p>步骤二：进入加速器页面获取加速信息</p><p><a href="https://cr.console.aliyun.com/#/accelerator" target="_blank" rel="noopener">https://cr.console.aliyun.com/#/accelerator</a></p><h3 id="安装／升级你的Docker客户端"><a href="#安装／升级你的Docker客户端" class="headerlink" title="安装／升级你的Docker客户端"></a>安装／升级你的Docker客户端</h3><p>推荐安装1.10.0以上版本的Docker客户端，参考文档 docker-ce<br><a href="https://yq.aliyun.com/articles/110806?spm=5176.8351553.0.0.6a721991ZTvV8S" target="_blank" rel="noopener">https://yq.aliyun.com/articles/110806?spm=5176.8351553.0.0.6a721991ZTvV8S</a></p><blockquote><p>Docker CE 镜像源站</p></blockquote><p>使用官方安装脚本自动安装</p><pre><code>curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun</code></pre><p>CentOS 7 (使用yum进行安装)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># step 1: 安装必要的一些系统工具</span></span><br><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line"><span class="comment"># Step 2: 添加软件源信息</span></span><br><span class="line">sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"><span class="comment"># Step 3: 更新并安装 Docker-CE</span></span><br><span class="line">sudo yum makecache fast</span><br><span class="line">sudo yum -y install docker-ce</span><br><span class="line"><span class="comment"># Step 4: 开启Docker服务</span></span><br><span class="line">sudo service docker start</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意：</span></span><br><span class="line"><span class="comment"># 官方软件源默认启用了最新的软件，您可以通过编辑软件源的方式获取各个版本的软件包。例如官方并没有将测试版本的软件源置为可用，你可以通过以下方式开启。同理可以开启各种测试版本等。</span></span><br><span class="line"><span class="comment"># vim /etc/yum.repos.d/docker-ce.repo</span></span><br><span class="line"><span class="comment">#   将 [docker-ce-test] 下方的 enabled=0 修改为 enabled=1</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 安装指定版本的Docker-CE:</span></span><br><span class="line"><span class="comment"># Step 1: 查找Docker-CE的版本:</span></span><br><span class="line"><span class="comment"># yum list docker-ce.x86_64 --showduplicates | sort -r</span></span><br><span class="line"><span class="comment">#   Loading mirror speeds from cached hostfile</span></span><br><span class="line"><span class="comment">#   Loaded plugins: branch, fastestmirror, langpacks</span></span><br><span class="line"><span class="comment">#   docker-ce.x86_64            17.03.1.ce-1.el7.centos            docker-ce-stable</span></span><br><span class="line"><span class="comment">#   docker-ce.x86_64            17.03.1.ce-1.el7.centos            @docker-ce-stable</span></span><br><span class="line"><span class="comment">#   docker-ce.x86_64            17.03.0.ce-1.el7.centos            docker-ce-stable</span></span><br><span class="line"><span class="comment">#   Available Packages</span></span><br><span class="line"><span class="comment"># Step2 : 安装指定版本的Docker-CE: (VERSION 例如上面的 17.03.0.ce.1-1.el7.centos)</span></span><br><span class="line"><span class="comment"># sudo yum -y install docker-ce-[VERSION]</span></span><br></pre></td></tr></table></figure><h3 id="如何配置镜像加速器"><a href="#如何配置镜像加速器" class="headerlink" title="如何配置镜像加速器"></a>如何配置镜像加速器</h3><p>针对Docker客户端版本大于1.10.0的用户</p><p>您可以通过修改daemon配置文件/etc/docker/daemon.json来使用加速器：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-<span class="string">'EOF'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"registry-mirrors"</span>: [<span class="string">"https://ffia7t7n.mirror.aliyuncs.com"</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure></p><h3 id="安装Docker"><a href="#安装Docker" class="headerlink" title="安装Docker"></a>安装Docker</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用阿里云作加速</span></span><br><span class="line"><span class="built_in">cd</span> /etc/yum.repos.d/ &amp;&amp; rm -f *.repo</span><br><span class="line">wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">yum remove -y docker docker-common docker-selinux docker-engine</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装docker官方源，国内下载较慢建议切换为阿里云加速</span></span><br><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line">yum-config-manager --<span class="built_in">enable</span> docker-ce-edge</span><br><span class="line">yum list docker-ce --showduplicates | sort -r |grep stable</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装docker，可以选择制定版本</span></span><br><span class="line">yum install -y docker-ce</span><br><span class="line">systemctl start docker</span><br><span class="line">systemctl <span class="built_in">enable</span> docker</span><br><span class="line">mkdir -p /etc/docker</span><br><span class="line">tee /etc/docker/daemon.json &lt;&lt;-<span class="string">'EOF'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"registry-mirrors"</span>: [<span class="string">"https://ffia7t7n.mirror.aliyuncs.com"</span>]                <span class="comment"># 为了后期方便添加阿里云的加速镜像站</span></span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure><h3 id="测试Docker服务正常"><a href="#测试Docker服务正常" class="headerlink" title="测试Docker服务正常"></a>测试Docker服务正常</h3><p>例行跑个hello world测试下Docker服务是否正常</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 测试docker</span></span><br><span class="line">docker run hello-world</span><br><span class="line">Unable to find image <span class="string">'hello-world:latest'</span> locally</span><br><span class="line">latest: Pulling from library/hello-world</span><br><span class="line">ca4f61b1923c: Pull complete </span><br><span class="line">Digest: sha256:97ce6fa4b6cdc0790cda65fe7290b74cfebd9fa0c9b8c38e979330d547d22ce1</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> hello-world:latest</span><br><span class="line"></span><br><span class="line">Hello from Docker!</span><br><span class="line">This message shows that your installation appears to be working correctly.</span><br><span class="line"></span><br><span class="line">To generate this message, Docker took the following steps:</span><br><span class="line"> 1. The Docker client contacted the Docker daemon.</span><br><span class="line"> 2. The Docker daemon pulled the <span class="string">"hello-world"</span> image from the Docker Hub.</span><br><span class="line">    (amd64)</span><br><span class="line"> 3. The Docker daemon created a new container from that image <span class="built_in">which</span> runs the</span><br><span class="line">    executable that produces the output you are currently reading.</span><br><span class="line"> 4. The Docker daemon streamed that output to the Docker client, <span class="built_in">which</span> sent it</span><br><span class="line">    to your terminal.</span><br><span class="line"></span><br><span class="line">To try something more ambitious, you can run an Ubuntu container with:</span><br><span class="line"> $ docker run -it ubuntu bash</span><br><span class="line"></span><br><span class="line">Share images, automate workflows, and more with a free Docker ID:</span><br><span class="line"> https://cloud.docker.com/</span><br><span class="line"></span><br><span class="line">For more examples and ideas, visit:</span><br><span class="line"> https://docs.docker.com/engine/userguide/</span><br></pre></td></tr></table></figure><h3 id="安装docker-compose"><a href="#安装docker-compose" class="headerlink" title="安装docker-compose"></a>安装docker-compose</h3><pre><code>yum install -y docker-compose</code></pre><h2 id="离线安装Docker"><a href="#离线安装Docker" class="headerlink" title="离线安装Docker"></a>离线安装Docker</h2><p>先在一台可以联网的相同操作系统环境下下载离线安装包，然后内网服务器构建本地yum源，最后安装docker</p><h3 id="下载离线安装包"><a href="#下载离线安装包" class="headerlink" title="下载离线安装包"></a>下载离线安装包</h3><blockquote><p>在可以联网的机器上下载rpm包</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装yum-plugin-downloadonly插件</span></span><br><span class="line">yum install -y yum-plugin-downloadonly</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载createrepo相关rpm到指定目录，构建本地源之前需要在本地安装createrepo，用于构建本地源</span></span><br><span class="line">mkdir -p /tmp/repo/createrepo/</span><br><span class="line">yum install --downloadonly --downloaddir=/tmp/repo/createrepo/ createrepo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载docker相关rpm到指定目录</span></span><br><span class="line">mkdir -p /tmp/repo/docker-ce/</span><br><span class="line">yum install --downloadonly --downloaddir=/tmp/repo/docker-ce/ docker-ce</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载docker-compose相关rpm到指定目录</span></span><br><span class="line">mkdir -p /tmp/repo/docker-compose/</span><br><span class="line">yum install --downloadonly --downloaddir=/tmp/repo/docker-compose/ docker-compose</span><br></pre></td></tr></table></figure><h3 id="构建本地yum源"><a href="#构建本地yum源" class="headerlink" title="构建本地yum源"></a>构建本地yum源</h3><p>将docker的rpm包拷贝到需要安装docker的局域网集群上面，例如：<br>/tmp/repo/docker-ce/</p><p>将docker的rpm包拷贝到需要安装docker的局域网集群上面，例如：<br>/tmp/repo/createrepo/</p><p>构建本地yum源</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装createrepo</span></span><br><span class="line">rpm -ivh /tmp/repo/createrepo/*.rpm</span><br><span class="line"><span class="comment"># 备份/etc/yum.repos.d目录下文件</span></span><br><span class="line">ls /etc/yum.repos.d | xargs -I&#123;&#125; mv /etc/yum.repos.d/&#123;&#125; /etc/yum.repos.d/&#123;&#125;.bk</span><br><span class="line"><span class="comment"># 创建新的*.repo文件，如：docker.repo，进行配置</span></span><br><span class="line">vim docker.repo</span><br><span class="line">[<span class="built_in">local</span>-yum]</span><br><span class="line">name=<span class="built_in">local</span>-yum</span><br><span class="line">baseurl=file:////tmp/repo/docker-ce/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line"><span class="comment"># 设置本地源</span></span><br><span class="line">createrepo -d /tmp/repo/docker-ce/</span><br><span class="line"><span class="comment"># 查看看是否能看到自己构建的本地源</span></span><br><span class="line">yum repolist</span><br><span class="line"><span class="comment"># 清除缓存</span></span><br><span class="line">yum clean all</span><br><span class="line"><span class="comment"># 创建缓存</span></span><br><span class="line">yum makecache</span><br><span class="line"><span class="comment"># 看本地源是否配置成功，通过yum list看是否输出了新的rpm包，如果能查询到，证明配置成功</span></span><br><span class="line">yum list | grep docker</span><br><span class="line"><span class="comment"># 离线安装docker</span></span><br><span class="line">yum install docker -y</span><br></pre></td></tr></table></figure><h2 id="Docker入门教程"><a href="#Docker入门教程" class="headerlink" title="Docker入门教程"></a>Docker入门教程</h2><p><a href="http://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html</a></p>]]></content>
    
    <summary type="html">
    
      基于docker-ce的部署和使用手册
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>使用Ansible管理Windows</title>
    <link href="https://wsgzao.github.io/post/ansible-windows/"/>
    <id>https://wsgzao.github.io/post/ansible-windows/</id>
    <published>2018-05-21T02:59:49.000Z</published>
    <updated>2018-05-21T07:34:21.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本文主要介绍在如何使用Ansible管理Windows客户端，Ansible官方提供了一个很方便的安装脚本，对于外网用户来说安装真的很轻松，可惜我遇到的问题是如何在内网部署，有相同烦恼的小伙伴不妨参考下</p><blockquote><p>轻轻松松使用Ansible管理Windows客户端</p></blockquote><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018年05月21日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/ansible-windows/">https://wsgzao.github.io/post/ansible-windows/</a></p><p><strong>扩展阅读</strong></p><p>Ansible Windows Guides - <a href="http://docs.ansible.com/ansible/latest/user_guide/windows.html" target="_blank" rel="noopener">http://docs.ansible.com/ansible/latest/user_guide/windows.html</a></p><hr><h2 id="Ansible-Windows-Support"><a href="#Ansible-Windows-Support" class="headerlink" title="Ansible Windows Support"></a>Ansible Windows Support</h2><blockquote><p>Ansible在2.3版本之前对于Windows支持的并不算很友好，从2.4版本开始已经可以使用原生模块实现很多需求</p></blockquote><p>Because Windows is a non-POSIX-compliant operating system, there are differences between how Ansible interacts with them and the way Windows works. These guides will highlight some of the differences between Linux/Unix hosts and hosts running Windows.</p><ul><li>Ansible’s supported Windows versions generally match those under current and extended support from Microsoft. Supported desktop OSs include Windows 7, 8.1, and 10, and supported server OSs are Windows Server 2008, 2008 R2, 2012, 2012 R2, and - 2016.</li><li>Ansible requires PowerShell 3.0 or newer and at least .NET 4.0 to be installed on the Windows host.</li><li>A WinRM listener should be created and activated. More details for this can be found below.</li></ul><p><img src="http://ws1.sinaimg.cn/large/7207510dgy1frixssianuj20w30ecwfi.jpg" alt="image"></p><blockquote><p>Ansible does not support managing Windows XP or Server 2003 hosts. The supported operating system versions are:</p></blockquote><p>Windows Server 2008<br>Windows Server 2008 R2<br>Windows Server 2012<br>Windows Server 2012 R2<br>Windows Server 2016<br>Windows 7<br>Windows 8.1<br>Windows 10</p><ol><li>在官方文档中已经提到了在Windows中使用Ansible的最要前提，WinRM</li><li>WinRM依赖Powershell 3.0以上版本的支持，牵扯出PowerShell 2.0 to PowerShell 3.0/5.0的问题</li><li>而Powershell升级则带来.Net Framework是否跟随升级至4.6.2/4.7.2的选择</li><li>关于WinRM的参数配置可以参考下面的链接Setting up a Windows Host</li></ol><p><a href="https://github.com/ansible/ansible/blob/devel/examples/scripts/upgrade_to_ps3.ps1" target="_blank" rel="noopener">https://github.com/ansible/ansible/blob/devel/examples/scripts/upgrade_to_ps3.ps1</a><br><a href="https://github.com/ansible/ansible/blob/devel/examples/scripts/ConfigureRemotingForAnsible.ps1" target="_blank" rel="noopener">https://github.com/ansible/ansible/blob/devel/examples/scripts/ConfigureRemotingForAnsible.ps1</a></p><p>Setting up a Windows Host<br><a href="http://docs.ansible.com/ansible/latest/user_guide/windows_setup.html" target="_blank" rel="noopener">http://docs.ansible.com/ansible/latest/user_guide/windows_setup.html</a></p><p>.NET Framework 4.7.2/4.6.2<br><a href="https://www.microsoft.com/net/download/dotnet-framework-runtime" target="_blank" rel="noopener">https://www.microsoft.com/net/download/dotnet-framework-runtime</a></p><p>Powershell 3.0<br><a href="https://www.microsoft.com/en-us/download/details.aspx?id=34595" target="_blank" rel="noopener">https://www.microsoft.com/en-us/download/details.aspx?id=34595</a></p><p>Powershell 5.1<br><a href="https://www.microsoft.com/en-us/download/details.aspx?id=54616" target="_blank" rel="noopener">https://www.microsoft.com/en-us/download/details.aspx?id=54616</a></p><blockquote><p>我个人目前的建议是Win7/2008升级至Powershell 3.0，.Net Framework升级至4.6.2，其他情况需要可以参考官方文档后做决定</p></blockquote><p>Ansible Windows Guides - <a href="http://docs.ansible.com/ansible/latest/user_guide/windows.html" target="_blank" rel="noopener">http://docs.ansible.com/ansible/latest/user_guide/windows.html</a></p><h2 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h2><p>1.客户端配置windows主机,以管理员身份打开powershell, 并查看当前ps版本<br>get-host<br>2.系统自带的powershell版本是2.0，需要更新至powershell 3 以上版本<br><a href="https://www.microsoft.com/net/download/dotnet-framework-runtime" target="_blank" rel="noopener">https://www.microsoft.com/net/download/dotnet-framework-runtime</a><br><a href="https://www.microsoft.com/en-us/download/details.aspx?id=34595" target="_blank" rel="noopener">https://www.microsoft.com/en-us/download/details.aspx?id=34595</a><br>3.安装完重启服务器查看powershell版本</p><p>.NET Framework 4.6以上版本无法建立到信任根颁发机构的证书链<br>原因：系统缺少信任 Microsoft Root Certificate Authority 2011 根证书<br>下载：MicrosoftRootCertificateAuthority2011.cer<br><a href="http://go.microsoft.com/fwlink/?LinkID=747875&amp;clcid=0x409" target="_blank" rel="noopener">http://go.microsoft.com/fwlink/?LinkID=747875&amp;clcid=0x409</a><br>运行 certmgr.msc<br>导入证书到“受信任的根证书颁发机构”</p><p><img src="http://ws4.sinaimg.cn/large/7207510dgy1frizys458dj20b109k3yq.jpg" alt="image"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置winrm</span></span><br><span class="line">mkdir C:\temp</span><br><span class="line"><span class="built_in">cd</span> C:\temp</span><br><span class="line"><span class="comment"># 下载ConfigureRemotingForAnsible.ps1</span></span><br><span class="line">https://raw.githubusercontent.com/ansible/ansible/devel/examples/scripts/ConfigureRemotingForAnsible.ps1</span><br><span class="line"><span class="comment"># 开启WinRM服务</span></span><br><span class="line">powershell -ExecutionPolicy RemoteSigned .\ConfigureRemotingForAnsible.ps1 -SkipNetworkProfileCheck</span><br></pre></td></tr></table></figure><h2 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 服务端使用pip安装pywinrm</span></span><br><span class="line">pip install pywinrm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 功能测试，配置ansible控制机</span></span><br><span class="line">vi /etc/ansible/hosts</span><br><span class="line"></span><br><span class="line">[windows]</span><br><span class="line">192.168.67.139</span><br><span class="line">[windows:vars]</span><br><span class="line">ansible_user=Administrator</span><br><span class="line">ansible_password=Admin123</span><br><span class="line">ansible_port=5986</span><br><span class="line">ansible_connection=winrm</span><br><span class="line">ansible_winrm_server_cert_validation=ignore  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 要注意的是端口方面ssl即https方式的使用5986，http使用5985</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试ping通信</span></span><br><span class="line">ansible windows -m win_ping </span><br><span class="line"><span class="comment"># 查看ip地址 </span></span><br><span class="line">ansible windows -m win_command -a <span class="string">"ipconfig"</span></span><br></pre></td></tr></table></figure><h2 id="网盘下载"><a href="#网盘下载" class="headerlink" title="网盘下载"></a>网盘下载</h2><blockquote><p>Windows作为客户端所需的软件包我上传到百度网盘，.Net Framework安装失败提示证书错误记得手动导入MicrosoftRootCertificateAuthority2011.cer</p></blockquote><p><a href="https://pan.baidu.com/s/1JNV2pXjwUn14ojAtdEH_Sg" target="_blank" rel="noopener">https://pan.baidu.com/s/1JNV2pXjwUn14ojAtdEH_Sg</a></p><ol><li>安装 .Net Framework 4.6.2（NDP462-KB3151800-x86-x64-AllOS-ENU.exe）</li><li>升级 Windows 7 SP1 和 Windows 2008 R2 SP1 的 PowerShell版本从2.0至3.0（Windows6.1-KB2506143-x64.msu）</li><li><p>执行.\ConfigureRemotingForAnsible.ps1脚本开启WinRM远程管理服务</p><p> powershell -ExecutionPolicy RemoteSigned .\ConfigureRemotingForAnsible.ps1 -SkipNetworkProfileCheck</p></li></ol>]]></content>
    
    <summary type="html">
    
      轻轻松松使用Ansible管理Windows客户端
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>CentOS通用优化和配置</title>
    <link href="https://wsgzao.github.io/post/centos/"/>
    <id>https://wsgzao.github.io/post/centos/</id>
    <published>2018-05-20T06:59:49.000Z</published>
    <updated>2018-05-21T07:08:20.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>一般不购买RHEL/SLES订阅支持，通常会选择CentOS/Debian/Ubuntu等作为开源替代方案，由于工作的原因主要涉及RHEL，很多较新的技术我都会基于CentOS做实验，这里记录一些基础但实用的配置，生产环境不要直接生搬硬套。</p><blockquote><p>了解CentOS不同版本之间的差异，快速构建实验学习环境</p></blockquote><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018年05月20日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/centos/">https://wsgzao.github.io/post/centos/</a></p><p><strong>扩展阅读</strong></p><p>CentOS - <a href="https://www.centos.org/" target="_blank" rel="noopener">https://www.centos.org/</a></p><hr><h2 id="CentOS简介"><a href="#CentOS简介" class="headerlink" title="CentOS简介"></a>CentOS简介</h2><blockquote><p>如果不知道应该下载哪一个CentOS版本，Everything ISO也许是一个非常好的选择</p></blockquote><p>The CentOS Project is a community-driven free software effort focused on delivering a robust open source ecosystem. For users, we offer a consistent manageable platform that suits a wide variety of deployments. For open source communities, we offer a solid, predictable base to build upon, along with extensive resources to build, test, release, and maintain their code.</p><p><a href="https://www.centos.org/download/" target="_blank" rel="noopener">https://www.centos.org/download/</a></p><h2 id="CentOS-6"><a href="#CentOS-6" class="headerlink" title="CentOS 6"></a>CentOS 6</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置主机名</span></span><br><span class="line">hostname centos6</span><br><span class="line">vi /etc/sysconfig/network</span><br><span class="line"></span><br><span class="line"><span class="comment"># 备份yum源文件</span></span><br><span class="line">mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak</span><br><span class="line">mv /etc/yum.repos.d/epel.repo /etc/yum.repos.d/epel.repo.bak</span><br><span class="line">mv /etc/yum.repos.d/epel-testing.repo /etc/yum.repos.d/epel-testing.repo.bak</span><br><span class="line"><span class="comment"># 使用aliyun镜像加速yum和epel</span></span><br><span class="line">wget -O /etc/yum.repos.d/Centos-6.repo http://mirrors.aliyun.com/repo/Centos-6.repo</span><br><span class="line">wget -O /etc/yum.repos.d/epel-6.repo http://mirrors.aliyun.com/repo/epel-6.repo</span><br><span class="line"><span class="comment"># 更新软件包缓存</span></span><br><span class="line">yum makecache</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭selinux</span></span><br><span class="line">sed -i <span class="string">'s/SELINUX=enforcing/SELINUX=disabled/g'</span> /etc/sysconfig/selinux </span><br><span class="line"><span class="comment"># 设置selinux状态 </span></span><br><span class="line">setenforce 0</span><br><span class="line"><span class="comment"># 获取selinux状态 </span></span><br><span class="line">getenforce</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止firewall</span></span><br><span class="line">/etc/init.d/iptables stop</span><br><span class="line"><span class="comment"># 禁止firewall开机启动</span></span><br><span class="line">chkconfig iptables off</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置历史记录的时间</span></span><br><span class="line">vi /etc/profile</span><br><span class="line"><span class="comment"># 在文件末尾添加，注意中间空格</span></span><br><span class="line"><span class="built_in">export</span> HISTTIMEFORMAT=<span class="string">"%Y-%m-%d %H:%M:%S `whoami` "</span></span><br><span class="line"><span class="comment"># 默认保留10000条</span></span><br><span class="line"><span class="built_in">export</span> HISTSIZE=<span class="string">"10000"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存退出后刷新生效</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure><h2 id="CentOS-7"><a href="#CentOS-7" class="headerlink" title="CentOS 7"></a>CentOS 7</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置主机名</span></span><br><span class="line">hostnamectl <span class="built_in">set</span>-hostname centos7</span><br><span class="line"></span><br><span class="line"><span class="comment"># 备份yum源文件</span></span><br><span class="line">mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak</span><br><span class="line">mv /etc/yum.repos.d/epel.repo /etc/yum.repos.d/epel.repo.bak</span><br><span class="line">mv /etc/yum.repos.d/epel-testing.repo /etc/yum.repos.d/epel-testing.repo.bak</span><br><span class="line"><span class="comment"># 使用aliyun镜像加速yum和epel</span></span><br><span class="line">wget -O /etc/yum.repos.d/Centos-7.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">wget -O /etc/yum.repos.d/epel-7.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line"><span class="comment"># 更新软件包缓存</span></span><br><span class="line">yum makecache</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭selinux，重启后生效</span></span><br><span class="line">sed -i <span class="string">'s/SELINUX=enforcing/SELINUX=disabled/g'</span> /etc/sysconfig/selinux </span><br><span class="line"><span class="comment"># 设置selinux状态，临时生效命令</span></span><br><span class="line">setenforce 0</span><br><span class="line"><span class="comment"># 查看selinux状态 </span></span><br><span class="line">getenforce</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止firewall</span></span><br><span class="line">systemctl stop firewalld.service</span><br><span class="line"><span class="comment"># 禁止firewall开机启动</span></span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld.service </span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置 iptables service</span></span><br><span class="line">yum -y install iptables-services</span><br><span class="line"><span class="comment"># 修改iptables配置</span></span><br><span class="line">vim /etc/sysconfig/iptables</span><br><span class="line"><span class="comment"># 重启防火墙使配置生效</span></span><br><span class="line">systemctl restart iptables.service</span><br><span class="line"><span class="comment"># 设置防火墙开机启动</span></span><br><span class="line">systemctl <span class="built_in">enable</span> iptables.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置历史记录的时间</span></span><br><span class="line">vi /etc/profile</span><br><span class="line"><span class="comment"># 在文件末尾添加，注意中间空格</span></span><br><span class="line"><span class="built_in">export</span> HISTTIMEFORMAT=<span class="string">"%Y-%m-%d %H:%M:%S `whoami` "</span></span><br><span class="line"><span class="comment"># 默认保留10000条</span></span><br><span class="line"><span class="built_in">export</span> HISTSIZE=<span class="string">"10000"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存退出后刷新生效</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装pip</span></span><br><span class="line">yum install python-devel gcc zlib zlib-devel openssl-devel -y</span><br><span class="line">yum install epel-release -y</span><br><span class="line">yum install python-pip -y</span><br><span class="line">pip install --upgrade pip</span><br><span class="line"></span><br><span class="line"><span class="comment"># yum-cron</span></span><br><span class="line">yum -y install yum-cron</span><br><span class="line"></span><br><span class="line">vim /etc/yum/yum-cron.conf</span><br><span class="line">apply_updates = no</span><br><span class="line">apply_updates = yes</span><br><span class="line"></span><br><span class="line">systemctl start crond</span><br><span class="line">systemctl start yum-cron</span><br></pre></td></tr></table></figure><h2 id="CentOS通用优化和配置"><a href="#CentOS通用优化和配置" class="headerlink" title="CentOS通用优化和配置"></a>CentOS通用优化和配置</h2><h3 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h3><blockquote><p>如果各位没有标准的baseline，以下配置可作为最简单的参考</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 避免连接空闲自动断开</span></span><br><span class="line"><span class="built_in">export</span> TMOUT=0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 优化ssh参数，不使用DNS</span></span><br><span class="line">sed -i <span class="string">'/^#UseDNS/s/#UseDNS yes/UseDNS no/g'</span> /etc/ssh/sshd_config</span><br><span class="line"><span class="comment"># 重新加载sshd</span></span><br><span class="line">/etc/init.d/sshd reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调整文件描述符大小，临时生效使用 ulimit -SHn 65535</span></span><br><span class="line">cat &gt;&gt;/etc/rc.local&lt;&lt;EOF</span><br><span class="line"><span class="comment">#open files</span></span><br><span class="line"><span class="built_in">ulimit</span> -SHn 65535</span><br><span class="line"><span class="comment">#stack size</span></span><br><span class="line"><span class="built_in">ulimit</span> -s 65535</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><blockquote><p>以下配置非必须，仅供需要时参考</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 最简单的网卡配置文件</span></span><br><span class="line">mv /etc/sysconfig/network-scripts/ifcfg-eth0 /etc/sysconfig/network-scripts/ifcfg-eth0.bak</span><br><span class="line">vi /etc/sysconfig/network-scripts/ifcfg-eth0</span><br><span class="line">DEVICE=eth0 <span class="comment">#网卡设备名称</span></span><br><span class="line">HWADDR=00:0C:29:D0:C7:B5 <span class="comment">#以太网设备的对应的物理地址</span></span><br><span class="line">TYPE=Ethernet <span class="comment">#网络类型为以太网模式，手动配置时可以忽略不填</span></span><br><span class="line">UUID=080a457b-6a53-4a3a-9155-a23c1146c2c6 <span class="comment">#通用唯一识别码，手动配置时可以忽略不填</span></span><br><span class="line">ONBOOT=yes <span class="comment">#是否启动引导的时候激活YES</span></span><br><span class="line">NM_CONTROLLED=no <span class="comment">#设备eth0是否可以由Network Manager图形管理工具托管</span></span><br><span class="line">BOOTPROTO=static <span class="comment">#静态IP地址获取状态 如：DHCP表示自动获取IP地址</span></span><br><span class="line">IPADDR=192.168.1.10 <span class="comment">#IP</span></span><br><span class="line">NETMASK=255.255.255.0 <span class="comment">#网卡对应的网络掩码</span></span><br><span class="line">GATEWAY=192.168.1.1 <span class="comment">#网关地址</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装基础库</span></span><br><span class="line">yum -y install gcc gcc-c++ autoconf libjpeg libjpeg-devel libpng libpng-devel freetype freetype-devel libxml2 libxml2-devel zlib zlib-devel glibc glibc-devel glib2 glib2-devel bzip2 bzip2-devel ncurses ncurses-devel curl curl-devel e2fsprogs e2fsprogs-devel krb5-devel libidn libidn-devel openssl openssl-devel nss_ldap openldap openldap-devel  openldap-clients openldap-servers libxslt-devel libevent-devel ntp libtool-ltdl bison libtool vim-enhanced</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改hosts</span></span><br><span class="line">vim /etc/hosts</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改dns</span></span><br><span class="line">vim /etc/resolv.conf</span><br><span class="line"></span><br><span class="line">nameserver DNS1</span><br><span class="line">nameserver DNS2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清理防火墙规则</span></span><br><span class="line">iptables –F</span><br><span class="line"><span class="comment"># 查看防火墙规则</span></span><br><span class="line">iptables –L</span><br><span class="line"><span class="comment"># 编辑防火墙规则</span></span><br><span class="line">vi /etc/sysconfig/iptables</span><br><span class="line"><span class="comment"># 保存防火墙规则</span></span><br><span class="line">/etc/init.d/iptables save</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 增加SWAP分区</span></span><br><span class="line"><span class="comment"># 创建1024M的文件块</span></span><br><span class="line">dd <span class="keyword">if</span>=/dev/zero of=/home/swap bs=1M count=1024</span><br><span class="line"><span class="comment"># 创建swap文件</span></span><br><span class="line">mkswap /home/swap</span><br><span class="line"><span class="comment"># 激活swap文件</span></span><br><span class="line">swapon /home/swap</span><br><span class="line"><span class="comment"># 查看swap</span></span><br><span class="line">swapon -s</span><br><span class="line"><span class="comment"># 修改/etc/fstab文件，增加以下内容，让系统引导时自动启动</span></span><br><span class="line">vi /etc/fstab </span><br><span class="line"><span class="comment"># 在最后添加下面代码</span></span><br><span class="line">/home/swap swap swap default 0 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加普通用户并进行sudo授权管理</span></span><br><span class="line">useradd <span class="built_in">test</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"test"</span>:<span class="string">"test"</span> | chpasswd</span><br><span class="line">visudo</span><br><span class="line"><span class="comment"># all表示完全的系统权限,NOPASSWD表示提示权限命令时不需要密码</span></span><br><span class="line"><span class="built_in">test</span> ALL=(ALL) NOPASSWD: ALL</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调整字符集，使其支持中文，根据实际情况而定</span></span><br><span class="line"><span class="comment"># 安装中文语言包</span></span><br><span class="line">yum groupinstall chinese-support</span><br><span class="line"></span><br><span class="line"><span class="comment"># CentOS 6</span></span><br><span class="line">vim /etc/sysconfig/i18n</span><br><span class="line"></span><br><span class="line">LANG=<span class="string">"zh_CN.GB18030"</span></span><br><span class="line">SUPPORTED=<span class="string">"zh_CN.UTF-8:zh_CN:zh:en_US.UTF-8:en_US:en"</span></span><br><span class="line"><span class="comment">#LANG="en_US.UTF-8"</span></span><br><span class="line">SYSFONT=<span class="string">"latarcyrheb-sun16″</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># CentOS 7</span></span><br><span class="line"><span class="string">vim /etc/locale.conf</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#LANG="</span>en_US.UTF-8<span class="string">"</span></span><br><span class="line"><span class="string">LANG="</span>zh_CN.GB18030<span class="string">"</span></span><br><span class="line"><span class="string">LANGUAGE="</span>zh_CN.GB18030:zh_CN.GB2312:zh_CN<span class="string">"</span></span><br><span class="line"><span class="string">SUPPORTED="</span>zh_CN.UTF-8:zh_CN:zh:en_US.UTF-8:en_US:en<span class="string">"</span></span><br><span class="line"><span class="string">SYSFONT="</span>lat0-sun16<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 选择source或注销或重启使语言配置生效</span></span><br><span class="line"><span class="string">init 6</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 设置运行级别，5为图形化，3为命令行</span></span><br><span class="line"><span class="string"># CentOS 6</span></span><br><span class="line"><span class="string">vi /etc/inittab</span></span><br><span class="line"><span class="string"># Default runlevel. The runlevels used are:</span></span><br><span class="line"><span class="string">#   0 - halt (Do NOT set initdefault to this)</span></span><br><span class="line"><span class="string">#   1 - Single user mode</span></span><br><span class="line"><span class="string">#   2 - Multiuser, without NFS (The same as 3, if you do not have networking)</span></span><br><span class="line"><span class="string">#   3 - Full multiuser mode</span></span><br><span class="line"><span class="string">#   4 - unused</span></span><br><span class="line"><span class="string">#   5 - X11</span></span><br><span class="line"><span class="string">#   6 - reboot (Do NOT set initdefault to this)</span></span><br><span class="line"><span class="string"># </span></span><br><span class="line"><span class="string">id:5:initdefault:</span></span><br><span class="line"><span class="string">#id:3:initdefault</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># CentOS 7</span></span><br><span class="line"><span class="string"># 查看当前运行级别</span></span><br><span class="line"><span class="string">systemctl get-default</span></span><br><span class="line"><span class="string">graphical.target</span></span><br><span class="line"><span class="string"># 修改为命令行模式</span></span><br><span class="line"><span class="string">systemctl set-default multi-user.target</span></span><br><span class="line"><span class="string"># 修改为图形化模式</span></span><br><span class="line"><span class="string">systemctl set-default graphical.target</span></span><br></pre></td></tr></table></figure><h3 id="内核优化"><a href="#内核优化" class="headerlink" title="内核优化"></a>内核优化</h3><blockquote><p>以下内容不建议直接套用，该配置主要适用于 CentOS 7</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /etc/sysctl.conf</span></span><br><span class="line"><span class="comment"># System default settings live in /usr/lib/sysctl.d/00-system.conf.</span></span><br><span class="line"><span class="comment"># To override those settings, enter new settings here, or in an /etc/sysctl.d/&lt;name&gt;.conf file</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># For more information, see sysctl.conf(5) and sysctl.d(5).</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭ipv6</span></span><br><span class="line">net.ipv6.conf.all.disable_ipv6 = 1</span><br><span class="line">net.ipv6.conf.default.disable_ipv6 = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 避免放大攻击</span></span><br><span class="line">net.ipv4.icmp_echo_ignore_broadcasts = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启恶意icmp错误消息保护</span></span><br><span class="line">net.ipv4.icmp_ignore_bogus_error_responses = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭路由转发</span></span><br><span class="line">net.ipv4.ip_forward = 0</span><br><span class="line">net.ipv4.conf.all.send_redirects = 0</span><br><span class="line">net.ipv4.conf.default.send_redirects = 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启反向路径过滤</span></span><br><span class="line">net.ipv4.conf.all.rp_filter = 1</span><br><span class="line">net.ipv4.conf.default.rp_filter = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理无源路由的包</span></span><br><span class="line">net.ipv4.conf.all.accept_source_route = 0</span><br><span class="line">net.ipv4.conf.default.accept_source_route = 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭sysrq功能</span></span><br><span class="line">kernel.sysrq = 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># core文件名中添加pid作为扩展名</span></span><br><span class="line">kernel.core_uses_pid = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启SYN洪水攻击保护</span></span><br><span class="line">net.ipv4.tcp_syncookies = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改消息队列长度</span></span><br><span class="line">kernel.msgmnb = 65536</span><br><span class="line">kernel.msgmax = 65536</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置最大内存共享段大小bytes</span></span><br><span class="line">kernel.shmmax = 68719476736</span><br><span class="line">kernel.shmall = 4294967296</span><br><span class="line"></span><br><span class="line"><span class="comment"># timewait的数量，默认180000</span></span><br><span class="line">net.ipv4.tcp_max_tw_buckets = 6000</span><br><span class="line">net.ipv4.tcp_sack = 1</span><br><span class="line">net.ipv4.tcp_window_scaling = 1</span><br><span class="line">net.ipv4.tcp_rmem = 4096 87380 4194304</span><br><span class="line">net.ipv4.tcp_wmem = 4096 16384 4194304</span><br><span class="line">net.core.wmem_default = 8388608</span><br><span class="line">net.core.rmem_default = 8388608</span><br><span class="line">net.core.rmem_max = 16777216</span><br><span class="line">net.core.wmem_max = 16777216</span><br><span class="line"></span><br><span class="line"><span class="comment"># 每个网络接口接收数据包的速率比内核处理这些包的速率快时，允许送到队列的数据包的最大数目</span></span><br><span class="line">net.core.netdev_max_backlog = 262144</span><br><span class="line"></span><br><span class="line"><span class="comment"># 限制仅仅是为了防止简单的 DDoS 攻击</span></span><br><span class="line">net.ipv4.tcp_max_orphans = 3276800</span><br><span class="line"></span><br><span class="line"><span class="comment"># 未收到客户端确认信息的连接请求的最大值</span></span><br><span class="line">net.ipv4.tcp_max_syn_backlog = 262144</span><br><span class="line">net.ipv4.tcp_timestamps = 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 内核放弃建立连接之前发送SYNACK 包的数量</span></span><br><span class="line">net.ipv4.tcp_synack_retries = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 内核放弃建立连接之前发送SYN 包的数量</span></span><br><span class="line">net.ipv4.tcp_syn_retries = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启用timewait 快速回收</span></span><br><span class="line">net.ipv4.tcp_tw_recycle = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启重用，允许将TIME-WAIT sockets 重新用于新的TCP 连接</span></span><br><span class="line">net.ipv4.tcp_tw_reuse = 1</span><br><span class="line">net.ipv4.tcp_mem = 94500000 915000000 927000000</span><br><span class="line">net.ipv4.tcp_fin_timeout = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当keepalive 起用的时候，TCP 发送keepalive 消息的频度。缺省是2 小时</span></span><br><span class="line">net.ipv4.tcp_keepalive_time = 30</span><br><span class="line"></span><br><span class="line"><span class="comment">#允许系统打开的端口范围</span></span><br><span class="line">net.ipv4.ip_local_port_range = 1024    65000</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改防火墙表大小，默认65536</span></span><br><span class="line"><span class="comment">#net.netfilter.nf_conntrack_max=655350</span></span><br><span class="line"><span class="comment">#net.netfilter.nf_conntrack_tcp_timeout_established=1200</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 确保无人能修改路由表</span></span><br><span class="line">net.ipv4.conf.all.accept_redirects = 0</span><br><span class="line">net.ipv4.conf.default.accept_redirects = 0</span><br><span class="line">net.ipv4.conf.all.secure_redirects = 0</span><br><span class="line">net.ipv4.conf.default.secure_redirects = 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行命令使参数永久生效</span></span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      了解CentOS不同版本之间的差异，快速构建实验学习环境
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>DevOps实用资源分享</title>
    <link href="https://wsgzao.github.io/post/devops/"/>
    <id>https://wsgzao.github.io/post/devops/</id>
    <published>2018-05-15T08:31:24.000Z</published>
    <updated>2018-05-15T08:14:14.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="//i.v2ex.co/o2t5S8at.png" alt=""></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>其实一直很想整理一篇DevOps学习资源导航类文章，主要原因除了自己的懒惰外，技术的不断创新也让未来更加值得期待。虽然在大多数情况下我们既无法面面俱到也突破不了点的极限，但是这也不会阻碍我们对于学习的热爱。梳理这篇文章也是希望自己能够始终保持学习的态度，完善自己的知识体系，坚持技术沉淀的过程，享受点滴进步的快乐。</p><blockquote><p>DevOps是一个持续改进的过程</p></blockquote><hr><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018年05月15日 - 修改内容<br>2016年05月11日 - 增加PHPHub，Ruby China<br>2016年03月25日 - 增加InfoQ，神秘的程序员<br>2016年02月14日 - 增加Forvo，Coursera，自强学堂<br>2016年01月04日 - 增加利器<br>2015年12月22日 - 增加极客学院，网易公开课，曹政微信订阅号<br>2015年10月29日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/devops/">https://wsgzao.github.io/post/devops/</a></p><hr><h2 id="图书"><a href="#图书" class="headerlink" title="图书"></a>图书</h2><blockquote><p>我推荐大家尝试使用Kindle改变自己阅读的习惯</p></blockquote><p>Kindle Paperwhite - <a href="http://www.amazon.cn/" target="_blank" rel="noopener">http://www.amazon.cn/</a></p><h2 id="搜索引擎"><a href="#搜索引擎" class="headerlink" title="搜索引擎"></a>搜索引擎</h2><blockquote><p>善用搜索引擎，穿过一堵墙你的知识面可能会更加立体</p></blockquote><p>Google - <a href="https://www.google.com/" target="_blank" rel="noopener">https://www.google.com/</a><br>Google Images - <a href="https://images.google.com/" target="_blank" rel="noopener">https://images.google.com/</a><br>Google Scholar - <a href="https://scholar.google.com/" target="_blank" rel="noopener">https://scholar.google.com/</a></p><ul><li>事实证明大多数情况下还是Google最懂我们的心</li></ul><p>WikipediA - <a href="https://www.wikipedia.org/" target="_blank" rel="noopener">https://www.wikipedia.org/</a></p><ul><li>试着把维基百科作为你的首选，弱化自己对于百度的依赖</li></ul><p>Forvo - <a href="http://zh.forvo.com/" target="_blank" rel="noopener">http://zh.forvo.com/</a></p><ul><li>妈妈再也不用担心我不会发音了，让Forvo来做你的发音指南</li></ul><h2 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h2><blockquote><p>黑客的思路往往让人眼前一亮，多向大牛们学习</p></blockquote><p>知道创宇研发技能表 - <a href="http://blog.knownsec.com/Knownsec_RD_Checklist/" target="_blank" rel="noopener">http://blog.knownsec.com/Knownsec_RD_Checklist/</a></p><ul><li>感谢<a href="http://evilcos.me/" target="_blank" rel="noopener">@余弦</a></li></ul><p>纳威安全导航 - <a href="http://navisec.it/" target="_blank" rel="noopener">http://navisec.it/</a></p><ul><li>乌云，FreeBuf，i春秋等都值得你多逛逛</li></ul><h2 id="阅读订阅"><a href="#阅读订阅" class="headerlink" title="阅读订阅"></a>阅读订阅</h2><blockquote><p>信息爆炸的时代如何过滤噪音很重要</p></blockquote><p>知乎日报 - <a href="http://daily.zhihu.com/" target="_blank" rel="noopener">http://daily.zhihu.com/</a></p><ul><li>每天 3 次，每次 7 分钟</li><li>我习惯下班后离线阅读生活中的美</li><li>读读日报和好奇心日报也推荐大家试试</li></ul><p>开发者头条 - <a href="http://toutiao.io/" target="_blank" rel="noopener">http://toutiao.io/</a></p><ul><li>码农周刊团队为程序员设计的阅读分享平台</li><li>极客头条，稀土掘金，伯乐在线等也是类似的</li></ul><p>湾区日报 - <a href="http://wanqu.co/" target="_blank" rel="noopener">http://wanqu.co/</a></p><ul><li>关注创业与技术,每天推送5篇优质英文文章</li><li>坚持向来不易，锻炼下英文阅读能力也不错哦</li></ul><h2 id="社区"><a href="#社区" class="headerlink" title="社区"></a>社区</h2><blockquote><p>Way to Explore &amp; Way too Extreme</p></blockquote><p>V2EX - <a href="http://www.v2ex.com/" target="_blank" rel="noopener">http://www.v2ex.com/</a></p><ul><li>一个与众不同的社区</li></ul><p>Stack Overflow - <a href="http://stackoverflow.com/" target="_blank" rel="noopener">http://stackoverflow.com/</a></p><ul><li>如果你使用 Google 相信会在这里看到不少高质量的答案</li></ul><p>PHPhub - <a href="https://phphub.org/" target="_blank" rel="noopener">https://phphub.org/</a></p><ul><li>PHPhub 是积极向上的 PHP &amp; Laravel 开发者社区</li></ul><p>Ruby China - <a href="https://ruby-china.org/" target="_blank" rel="noopener">https://ruby-china.org/</a></p><ul><li>中国 Ruby 社区，由众多爱好者共同维护，致力于构建完善的 Ruby 中文社区</li></ul><h2 id="微信订阅号"><a href="#微信订阅号" class="headerlink" title="微信订阅号"></a>微信订阅号</h2><p>小道消息 - WebNotes</p><ul><li>冯大辉的小道消息已经成为微信订阅号的标杆之一</li></ul><p>曹政 - caozsay</p><ul><li>曹大做为一个有故事的人，愿意分享更愿意交流，已经很难得了</li></ul><p>高效运维 - greatops</p><ul><li>萧田国组织维护的”高效运维”公众号每周多篇干货满满的原创好文</li></ul><p>神秘的程序员 - coderstory</p><ul><li>西乔和霍炬共同创作的程序员主题漫画，为生活添加一抹色彩</li></ul><p>InfoQ - infoqchina</p><ul><li>InfoQ在微信端的推广和推送质量都是满满的诚意</li></ul><p>CloudMan - cloudman6</p><ul><li>云计算深度实践者，每天5分钟玩转XXX系列作者</li></ul><h2 id="OJ"><a href="#OJ" class="headerlink" title="OJ"></a>OJ</h2><blockquote><p>ACM和奥数类似属于有天赋的你们，但实际工作中更要注重学习方法和问题总结</p></blockquote><p>LeetCode - <a href="http://leetcode.com/" target="_blank" rel="noopener">http://leetcode.com/</a></p><ul><li>leetcode 是一个针对程序员的面试准备平台</li></ul><p>牛客网 - <a href="http://www.nowcoder.com/" target="_blank" rel="noopener">http://www.nowcoder.com/</a></p><ul><li>一个新的专业IT笔试面试备考平台</li></ul><h2 id="信息聚合"><a href="#信息聚合" class="headerlink" title="信息聚合"></a>信息聚合</h2><blockquote><p>分享一些实用的技术学习路线</p></blockquote><p>Linux就该这么学 - <a href="https://www.linuxprobe.com/" target="_blank" rel="noopener">https://www.linuxprobe.com/</a></p><ul><li>作者持续更新并开源精心制作的Linux文档，推荐优先学习作为基础铺垫</li></ul><p>每天5分钟玩转 OpenStack </p><p><a href="https://mp.weixin.qq.com/s?__biz=MzIwMTM5MjUwMg==&amp;mid=403471227&amp;idx=1&amp;sn=d645ec0df174e05384bbff40aada4cff&amp;chksm=0b1673623c61fa74f005312b9ed1713a51344824523b657a7407b03a7c54810d0d17b656d211&amp;mpshare=1&amp;scene=23&amp;srcid=0515aqzmiJECvJEVqwvgdQWQ#rd" target="_blank" rel="noopener">https://mp.weixin.qq.com/s?__biz=MzIwMTM5MjUwMg==&amp;mid=403471227&amp;idx=1&amp;sn=d645ec0df174e05384bbff40aada4cff&amp;chksm=0b1673623c61fa74f005312b9ed1713a51344824523b657a7407b03a7c54810d0d17b656d211&amp;mpshare=1&amp;scene=23&amp;srcid=0515aqzmiJECvJEVqwvgdQWQ#rd</a></p><p>每天5分钟玩转 Docker 容器技术</p><p><a href="https://mp.weixin.qq.com/s?__biz=MzIwMTM5MjUwMg==&amp;mid=506103897&amp;idx=1&amp;sn=d27cdb06390406a5bff805db173176ee&amp;chksm=0d3080403a47095666c7af813c79dcd7f3897844f77ffd126638b7ffde35ed6a83e98a5eeb47&amp;mpshare=1&amp;scene=23&amp;srcid=05156hizYEw63Km0QnEHO6AE#rd" target="_blank" rel="noopener">https://mp.weixin.qq.com/s?__biz=MzIwMTM5MjUwMg==&amp;mid=506103897&amp;idx=1&amp;sn=d27cdb06390406a5bff805db173176ee&amp;chksm=0d3080403a47095666c7af813c79dcd7f3897844f77ffd126638b7ffde35ed6a83e98a5eeb47&amp;mpshare=1&amp;scene=23&amp;srcid=05156hizYEw63Km0QnEHO6AE#rd</a></p><p>每天5分钟玩转 Kubernetes</p><p><a href="https://mp.weixin.qq.com/s?__biz=MzIwMTM5MjUwMg==&amp;mid=506104436&amp;idx=1&amp;sn=85a95ea7bbf29c33020464355e0a8ed1&amp;chksm=0d30826d3a470b7bca9c6a273700dd7f19c3473d29a5b4ee5f22787d88502697ea8efca8d757&amp;mpshare=1&amp;scene=23&amp;srcid=0515yN4SRJd1qe4RaNWwBC98#rd" target="_blank" rel="noopener">https://mp.weixin.qq.com/s?__biz=MzIwMTM5MjUwMg==&amp;mid=506104436&amp;idx=1&amp;sn=85a95ea7bbf29c33020464355e0a8ed1&amp;chksm=0d30826d3a470b7bca9c6a273700dd7f19c3473d29a5b4ee5f22787d88502697ea8efca8d757&amp;mpshare=1&amp;scene=23&amp;srcid=0515yN4SRJd1qe4RaNWwBC98#rd</a></p><p>InfoQ - <a href="http://www.infoq.com/" target="_blank" rel="noopener">http://www.infoq.com/</a></p><ul><li>促进软件开发领域知识与创新的传播</li></ul><p>鸟哥的Linux私房菜 - <a href="http://vbird.dic.ksu.edu.tw/" target="_blank" rel="noopener">http://vbird.dic.ksu.edu.tw/</a></p><ul><li>我也是跟着鸟哥的文章进入Linux</li></ul><p>存储基础知识 - <a href="https://community.emc.com/thread/176852" target="_blank" rel="noopener">https://community.emc.com/thread/176852</a></p><ul><li>EMC官方整理的教程，由浅入深知识面也很广</li></ul><p>菜鸟教程 - <a href="http://www.runoob.com/" target="_blank" rel="noopener">http://www.runoob.com/</a></p><ul><li>学的不仅是技术，更是梦想</li><li>同类型还有w3school等</li></ul><p>自强学堂 - <a href="http://www.ziqiangxuetang.com/" target="_blank" rel="noopener">http://www.ziqiangxuetang.com/</a></p><ul><li>感谢@涂伟忠，Django可是自强学堂的招牌教程</li></ul><p>优设 - <a href="http://hao.uisdc.com/" target="_blank" rel="noopener">http://hao.uisdc.com/</a></p><ul><li>以前很喜欢腾讯CDC的设计理念，现在老了只能偶尔瞅瞅</li></ul><p>VMware - <a href="http://www.vmware.com/cn/support/support-resources/pubs/" target="_blank" rel="noopener">http://www.vmware.com/cn/support/support-resources/pubs/</a></p><ul><li>没有贴图还能把虚拟化手册写得灰常清晰具有可操作性，VMware必须得算一个</li><li>当然也推荐大家阅读RedHat，SuSE，Oracle等官方帮助文档</li></ul><h2 id="Blog"><a href="#Blog" class="headerlink" title="Blog"></a>Blog</h2><blockquote><p>推荐的Blog不多，希望大家找到适合自己的博客</p></blockquote><p>编程随想 - <a href="https://program-think.blogspot.com/" target="_blank" rel="noopener">https://program-think.blogspot.com/</a></p><ul><li>你应该了解一些真实的信息</li></ul><p>阮一峰 - <a href="http://www.ruanyifeng.com/" target="_blank" rel="noopener">http://www.ruanyifeng.com/</a></p><ul><li>坚持分享技术和生活的典范</li></ul><p>酷壳 - <a href="http://coolshell.cn/" target="_blank" rel="noopener">http://coolshell.cn/</a></p><ul><li>坚持更新技术类Blog的人或团队越来越少，这也是认真做事的态度</li></ul><h2 id="在线教育"><a href="#在线教育" class="headerlink" title="在线教育"></a>在线教育</h2><p>极客学院 - <a href="http://wiki.jikexueyuan.com/" target="_blank" rel="noopener">http://wiki.jikexueyuan.com/</a></p><ul><li>在线教育类网站很多，我不做太多推荐，极客学院Wiki是一个好产品</li></ul><p>网易公开课 - <a href="http://open.163.com/" target="_blank" rel="noopener">http://open.163.com/</a></p><ul><li>国内外优质的MOOC资源很丰富，一起系统的完善自己的知识体系吧</li></ul><p>Coursera - <a href="https://www.coursera.org/" target="_blank" rel="noopener">https://www.coursera.org/</a></p><ul><li>在网上学习全世界最好的课程</li><li>在国外生活的同学几乎都会推荐的网络学习平台</li></ul><h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><blockquote><p>还有很多需要耐心等待时间的验证</p></blockquote>]]></content>
    
    <summary type="html">
    
      DevOps是一个持续改进的过程
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>Ansible 学习指北</title>
    <link href="https://wsgzao.github.io/post/ansible/"/>
    <id>https://wsgzao.github.io/post/ansible/</id>
    <published>2018-05-15T02:59:49.000Z</published>
    <updated>2018-05-15T07:19:07.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>因为工作的缘故接触并积极推动Ansible在企业级生产环境的落地，独立承担并实现了《基于ansible的主机自动化配置管理》项目，此前也先后接触过Puppet和SaltStack，本文不会讨论开源或者自主研发方案的优劣，重点是和大伙儿分享自己在ansible技术领域积累的一些项目实战经验，如果大家遇到任何问题也欢迎通过留言或者其他方式进行互动，我尽力做到有效回复。</p><blockquote><p>Ansible is Simple IT Automation</p></blockquote><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018年05月15日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/ansible/">https://wsgzao.github.io/post/ansible/</a></p><p><strong>扩展阅读</strong></p><p>ansible - <a href="https://docs.ansible.com/" target="_blank" rel="noopener">https://docs.ansible.com/</a></p><hr><h2 id="Ansible-标准化学习路径"><a href="#Ansible-标准化学习路径" class="headerlink" title="Ansible 标准化学习路径"></a>Ansible 标准化学习路径</h2><blockquote><p>Ansible相关的书籍在逐步增多，由于Ansible版本迭代更新频率高但学习成本低，个人建议书为辅，官方文档为主</p></blockquote><p>Ansible is an IT automation tool. It can configure systems, deploy software, and orchestrate more advanced IT tasks such as continuous deployments or zero downtime rolling updates.</p><p>Ansible’s main goals are simplicity and ease-of-use. It also has a strong focus on security and reliability, featuring a minimum of moving parts, usage of OpenSSH for transport (with other transports and pull modes as alternatives), and a language that is designed around auditability by humans–even those not familiar with the program.</p><p>We believe simplicity is relevant to all sizes of environments, so we design for busy users of all types: developers, sysadmins, release engineers, IT managers, and everyone in between. Ansible is appropriate for managing all environments, from small setups with a handful of instances to enterprise environments with many thousands of instances.</p><p>Ansible manages machines in an agent-less manner. There is never a question of how to upgrade remote daemons or the problem of not being able to manage systems because daemons are uninstalled. Because OpenSSH is one of the most peer-reviewed open source components, security exposure is greatly reduced. Ansible is decentralized–it relies on your existing OS credentials to control access to remote machines. If needed, Ansible can easily connect with Kerberos, LDAP, and other centralized authentication management systems.</p><p>This documentation covers the current released version of Ansible and also some development version features. For recent features, we note in each section the version of Ansible where the feature was added.</p><p>Ansible releases a new major release of Ansible approximately every two months. The core application evolves somewhat conservatively, valuing simplicity in language design and setup. However, the community around new modules and plugins being developed and contributed moves very quickly, adding many new modules in each release.</p><blockquote><p>Ansible Lightbulb 是 Ansible 官方推荐的入门教材，普通用户大概只需要10-20分钟时间即可入门</p></blockquote><p>The Ansible Lightbulb project is an effort to provide a content toolkit and educational reference for effectively communicating and teaching Ansible topics.</p><p>Ansible Lightbulb - <a href="https://github.com/ansible/lightbulb" target="_blank" rel="noopener">https://github.com/ansible/lightbulb</a></p><blockquote><p>Ansible Documentation 是 Ansible 官方文档，我的建议还是对英文不要害怕，多动手查多敲命令去理解</p></blockquote><p>Ansible Documentation - <a href="http://docs.ansible.com/ansible/latest/index.html" target="_blank" rel="noopener">http://docs.ansible.com/ansible/latest/index.html</a></p><h2 id="基于-Ansible-的开源项目"><a href="#基于-Ansible-的开源项目" class="headerlink" title="基于 Ansible 的开源项目"></a>基于 Ansible 的开源项目</h2><blockquote><p>第一个是ansible官方开源项目，其他都是和ansible相关的运维平台开源项目，推荐学习和参考</p></blockquote><p>Ansible - <a href="https://github.com/ansible/ansible" target="_blank" rel="noopener">https://github.com/ansible/ansible</a></p><p>Jumpserver - <a href="http://www.jumpserver.org/" target="_blank" rel="noopener">http://www.jumpserver.org/</a> </p><p>OpsManage - <a href="https://github.com/welliamcao/OpsManage" target="_blank" rel="noopener">https://github.com/welliamcao/OpsManage</a> </p><p>adminset - <a href="https://github.com/guohongze/adminset" target="_blank" rel="noopener">https://github.com/guohongze/adminset</a> </p><h2 id="Ansible-项目实践"><a href="#Ansible-项目实践" class="headerlink" title="Ansible 项目实践"></a>Ansible 项目实践</h2><blockquote><p>以下内容来自于《基于ansible的主机自动化配置管理》项目，基于ansible目前可以满足生产环境所有基线要求，相信对大家有一定的参考价值</p></blockquote><p><img src="//ws3.sinaimg.cn/large/7207510dgy1frc11ptyclj21092x9th8.jpg" alt="image"></p><p><img src="//ws3.sinaimg.cn/large/7207510dgy1frc11zz64jj20pe0fxtc4.jpg" alt="image"></p><h3 id="ansible-部署"><a href="#ansible-部署" class="headerlink" title="ansible 部署"></a>ansible 部署</h3><blockquote><p>因为生产环境为内外网物理隔离，所有的安装部署都是离线进行的</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Install Packages</span></span><br><span class="line">yum install gcc zlib zlib-devel openssl-devel -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install Python</span></span><br><span class="line">tar xf Python-2.7.14.tgz</span><br><span class="line"><span class="built_in">cd</span> Python-2.7.14</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line"><span class="comment"># renew python env</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ImportError: No module named six.moves</span></span><br><span class="line">tar xf six-1.11.0.tar.gz </span><br><span class="line"><span class="built_in">cd</span> six-1.11.0</span><br><span class="line">python setup.py install</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line"><span class="comment"># ImportError: No module named packaging.version</span></span><br><span class="line">tar xf packaging-17.1.tar.gz </span><br><span class="line"><span class="built_in">cd</span> packaging-17.1</span><br><span class="line">python setup.py install</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line"><span class="comment"># ImportError: No module named pyparsing</span></span><br><span class="line">tar xf pyparsing-2.2.0.tar.gz </span><br><span class="line"><span class="built_in">cd</span> pyparsing-2.2.0</span><br><span class="line">python setup.py install</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line"><span class="comment"># ImportError: No module named appdirs</span></span><br><span class="line">tar xf appdirs-1.4.3.tar.gz </span><br><span class="line"><span class="built_in">cd</span> appdirs-1.4.3</span><br><span class="line">python setup.py install</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install Setuptools</span></span><br><span class="line">unzip setuptools-38.5.2.zip</span><br><span class="line"><span class="built_in">cd</span> setuptools-38.5.2</span><br><span class="line">python setup.py install</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install pip</span></span><br><span class="line">tar xf pip-9.0.1.tar.gz</span><br><span class="line"><span class="built_in">cd</span> pip-9.0.1</span><br><span class="line">python setup.py install</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line"><span class="comment"># pip 离线下载</span></span><br><span class="line"><span class="comment"># pip download -d DIR -r requirements.txt</span></span><br><span class="line">pip download -d ~/ansible/ ansible</span><br><span class="line"></span><br><span class="line"><span class="comment"># pip 离线安装</span></span><br><span class="line"><span class="comment"># pip install --no-index --find-links=DIR -r requirements.txt</span></span><br><span class="line">pip install --no-index --find-links=pip-ansible-2.3.3/ -r requirements.txt</span><br><span class="line">pip install --no-index --find-links=pip-ansible-2.5.0/ -r requirements.txt -U</span><br><span class="line"></span><br><span class="line"><span class="comment"># pip 离线安装pipenv</span></span><br><span class="line">pip install --no-index --find-links=pip-pipenv/ pipenv</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用pipenv创建虚拟环境</span></span><br><span class="line">mkdir win_ansible</span><br><span class="line"><span class="built_in">cd</span> win_ansible</span><br><span class="line">pipenv shell</span><br><span class="line">pip install --no-index --find-links=pip-ansible-2.5.2/ -r requirements.txt</span><br></pre></td></tr></table></figure><h3 id="ansible-cfg-配置解析"><a href="#ansible-cfg-配置解析" class="headerlink" title="ansible.cfg 配置解析"></a>ansible.cfg 配置解析</h3><blockquote><p>ansible.cfg不影响执行结果但合理的配置会有效提升效率</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置文件路径（优先级）</span></span><br><span class="line">./ansible.cfg</span><br><span class="line">/etc/ansible/ansible.cfg</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置文件内容</span></span><br><span class="line">[defaults]</span><br><span class="line"><span class="comment">#inventory = /etc/ansible/hosts</span></span><br><span class="line"><span class="comment">#log_path = /var/log/ansible.log</span></span><br><span class="line">forks = 100 <span class="comment"># 设置并发数</span></span><br><span class="line">host_key_checking = False <span class="comment"># 不检查SSH主机登录的密钥</span></span><br><span class="line">display_skipped_hosts = False <span class="comment"># 不显示已跳过的主机</span></span><br><span class="line">retry_files_enabled = False <span class="comment"># 不创建任务失败后的重试文件</span></span><br><span class="line"><span class="comment"># 按照1d设置setup缓存，优化执行效率</span></span><br><span class="line">gathering = smart</span><br><span class="line">fact_caching_timeout = 86400</span><br><span class="line">fact_caching = jsonfile</span><br><span class="line">fact_caching_connection = cachedir</span><br></pre></td></tr></table></figure><h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><ul><li>服务端操作系统：RHEL 6/7（Windows不可作为控制端）</li><li>服务端Python版本：2.7.14（实测安装完成无需额外调整）</li><li>Ansible版本：2.3.3.0（实测2.4以上版本已不支持rhel5.5，客户端需simplejson）</li><li>管理对象：目前主要针对RHEL 5/6/7（Windows使用高版本Ansible）</li><li>基线标准：参考《主机岗配置基线 v1.1.xlsx》</li></ul><blockquote><p>服务端</p></blockquote><ul><li>操作系统版本：RHEL 6/7</li><li>Python版本：2.7.14</li><li>安装方式：pip离线安装依赖包</li></ul><blockquote><p>客户端</p></blockquote><ul><li>操作系统版本：RHEL 5/6/7</li><li>非最小模式安装无需做调整</li><li>RHEL5.5需要安装simplejson</li></ul><blockquote><p>核心用法</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检测ansible是否可以正常访问主机</span></span><br><span class="line">ansible-playbook -i hosts playbooks/ping.yml -v</span><br><span class="line"><span class="comment"># 配置好inventory，执行以下命令创建用户并建立信任关系</span></span><br><span class="line">ansible-playbook -i hosts playbooks/user/default.yml -v</span><br><span class="line"><span class="comment"># 配置时间同步/进程服务/基线文件</span></span><br><span class="line">ansible-playbook -i hosts playbooks/baseline/cfgset.yml -v</span><br><span class="line">ansible-playbook -i hosts playbooks/baseline/cfgset.yml -v --tags=<span class="string">"repo"</span></span><br><span class="line">ansible-playbook -i hosts playbooks/baseline/cfgset.yml -v --skip-tags=<span class="string">"ntp,repo"</span></span><br><span class="line"><span class="comment"># 更新系统软件包和补丁包</span></span><br><span class="line">ansible-playbook -i hosts playbooks/baseline/pakset.yml -v</span><br><span class="line"><span class="comment"># 修改用户密码</span></span><br><span class="line">ansible-playbook -i hosts_changepw playbooks/user/changepw.yml -v -e <span class="string">"@userpass.json"</span></span><br><span class="line"><span class="comment"># 备份配置，支持自定义日期命名，默认为"%Y%m%d"</span></span><br><span class="line">ansible-playbook -i hosts backup/backup.yml -v</span><br><span class="line"><span class="comment"># 恢复配置，支持按日期目录全局或者局部主机恢复</span></span><br><span class="line">ansible-playbook -i hosts backup/restore.yml -v -e <span class="string">"var_backup_date=20180305"</span></span><br></pre></td></tr></table></figure><h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><ul><li>服务端操作系统：RHEL 6/7（Windows不可作为控制端）</li><li>服务端Python版本：2.7.14（实测安装完成无需额外调整）</li><li>Ansible版本：2.5.0（Windows原生模块支持需要持续更新Ansible新版本）</li><li>管理对象：目前主要针对Windows 7/2008/2012（不支持xp/2003）</li><li>基线标准：参考《Windows 安全基线》</li></ul><blockquote><p>服务端</p></blockquote><ul><li>操作系统版本：RHEL 6/7</li><li>Python版本：2.7.14</li><li>安装方式：pip离线安装依赖包（目前使用pipenv切换管理Linux和Windows）</li></ul><blockquote><p>客户端</p></blockquote><ul><li>操作系统版本：Window 7/2008/2012</li><li>WinRM（Windows 7/2008 需要升级至 Powershell v3.0）</li></ul><blockquote><p>核心用法</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检测ansible是否可以正常访问主机</span></span><br><span class="line">ansible-playbook -i hosts win_playbooks/ping.yml -v</span><br><span class="line"><span class="comment"># 配置好inventory，执行以下命令创建用户并建立信任关系</span></span><br><span class="line">ansible-playbook -i hosts win_playbooks/user/default.yml -v</span><br><span class="line"><span class="comment"># 配置时间同步/进程服务/基线文件</span></span><br><span class="line">ansible-playbook -i hosts win_playbooks/baseline/cfgset.yml -v</span><br><span class="line">ansible-playbook -i hosts win_playbooks/baseline/cfgset.yml -v --tags=<span class="string">"wsus"</span></span><br><span class="line">ansible-playbook -i hosts win_playbooks/baseline/cfgset.yml -v --skip-tags=<span class="string">"ntp,wsus"</span></span><br><span class="line"><span class="comment"># 更新系统软件包和补丁包</span></span><br><span class="line">ansible-playbook -i hosts win_playbooks/baseline/pakset.yml -v</span><br><span class="line"><span class="comment"># 修改用户密码</span></span><br><span class="line">ansible-playbook -i win_hosts_changepw win_playbooks/user/changepw.yml -v -e <span class="string">"@userpass.json"</span></span><br><span class="line"><span class="comment"># 备份配置，支持自定义日期命名，默认为"%Y%m%d"</span></span><br><span class="line">ansible-playbook -i win_hosts win_backup/backup.yml -v</span><br><span class="line"><span class="comment"># 恢复配置，支持按日期目录全局或者局部主机恢复</span></span><br><span class="line">ansible-playbook -i win_hosts win_backup/restore.yml -v -e <span class="string">"var_backup_date=20180305"</span></span><br></pre></td></tr></table></figure><h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><blockquote><p>很抱歉我暂时不能分享全部信息，但是这并不妨碍技术上的交流，我会逐步分享有价值的可公开代码</p></blockquote><ol><li>遵循what/why/how思路，要理解ansible能解决什么问题，为什么选择ansible，怎么使用ansible去解决</li><li>Ansible学习成本低但不等同于没有难度，学习路径推荐参考官方文档并积极实践，官网没有答案要善用Google搜索</li><li>Ansible纯后台模式只解决了部分问题，还有更多需求要通过基于Ansible的自动化运维平台来实现，拥抱开源技术不能固步自封</li></ol>]]></content>
    
    <summary type="html">
    
      Ansible is Simple IT Automation
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>Django 1.11 和 Django 2.0 学习笔记</title>
    <link href="https://wsgzao.github.io/post/django/"/>
    <id>https://wsgzao.github.io/post/django/</id>
    <published>2018-05-10T06:59:49.000Z</published>
    <updated>2018-05-16T07:11:45.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Django 1.11<br>Django 2.0</p><blockquote><p>Django 1.x 和 Django2.x 学习笔记</p></blockquote><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018年05月04日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/django/">https://wsgzao.github.io/post/django/</a></p><p><strong>扩展阅读</strong></p><p>Django - <a href="https://www.djangoproject.com/" target="_blank" rel="noopener">https://www.djangoproject.com/</a></p><hr><h2 id="Django-简介"><a href="#Django-简介" class="headerlink" title="Django 简介"></a>Django 简介</h2><p>Django 文档 - <a href="https://docs.djangoproject.com/zh-hans/2.0/" target="_blank" rel="noopener">https://docs.djangoproject.com/zh-hans/2.0/</a></p><p>使用Anaconda实现Python2和Python3共存及相互转换 - <a href="https://wsgzao.github.io/post/anaconda/">https://wsgzao.github.io/post/anaconda/</a></p><h2 id="Django-1-11"><a href="#Django-1-11" class="headerlink" title="Django 1.11"></a>Django 1.11</h2><blockquote><p>以下操作为 anaconda python3.6 环境下进入Anaconda Prompt安装django 1.11的实践过程</p></blockquote><p><a href="https://docs.djangoproject.com/en/1.11/intro/tutorial01/" target="_blank" rel="noopener">https://docs.djangoproject.com/en/1.11/intro/tutorial01/</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在python3.6环境下进入Anaconda Prompt创建django1.x专用虚拟环境</span></span><br><span class="line">conda create -n django1.x</span><br><span class="line"><span class="comment"># 激活专用虚拟环境</span></span><br><span class="line">conda activate django1.x</span><br><span class="line"><span class="comment"># 查看conda当前django可用版本</span></span><br><span class="line">conda search django</span><br><span class="line">conda install django==1.11.10</span><br><span class="line"><span class="comment"># 切换到虚拟环境家目录</span></span><br><span class="line"><span class="built_in">cd</span> C:\Users\wsgzao\AppData\Local\conda\conda\envs\django1.x</span><br><span class="line"><span class="comment"># 创建项目</span></span><br><span class="line">django-admin startproject mysite</span><br><span class="line"><span class="comment"># 启动Django中的开发服务器</span></span><br><span class="line"><span class="built_in">cd</span> mysite</span><br><span class="line">python manage.py runserver</span><br><span class="line"><span class="comment"># 创建app</span></span><br><span class="line">python manage.py startapp myapp</span><br><span class="line"><span class="comment"># 帮助文档</span></span><br><span class="line">python manage.py -h</span><br><span class="line"><span class="comment"># Django命令</span></span><br><span class="line">python manage.py &lt;<span class="built_in">command</span>&gt; [options]</span><br></pre></td></tr></table></figure><h2 id="Django-2-0"><a href="#Django-2-0" class="headerlink" title="Django 2.0"></a>Django 2.0</h2><blockquote><p>以下操作为 anaconda python3.6 环境下进入Anaconda Prompt安装django 2.0的实践过程</p></blockquote><p><a href="https://docs.djangoproject.com/zh-hans/2.0/intro/tutorial01/" target="_blank" rel="noopener">https://docs.djangoproject.com/zh-hans/2.0/intro/tutorial01/</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在python3.6环境下进入Anaconda Prompt创建django2.x专用虚拟环境</span></span><br><span class="line">conda create -n django2.x</span><br><span class="line"><span class="comment"># 激活专用虚拟环境</span></span><br><span class="line">conda activate djangox.x</span><br><span class="line"><span class="comment"># 查看conda当前django可用版本</span></span><br><span class="line">conda search django</span><br><span class="line">conda install django</span><br><span class="line"><span class="comment"># 切换到虚拟环境家目录</span></span><br><span class="line"><span class="built_in">cd</span> C:\Users\wsgzao\AppData\Local\conda\conda\envs\django2.x</span><br><span class="line"><span class="comment"># 创建项目</span></span><br><span class="line">django-admin startproject mysite</span><br><span class="line"><span class="comment"># 启动Django中的开发服务器，万不要将这个服务器用于和生产环境相关的任何地方，这个服务器只是为了开发而设计的</span></span><br><span class="line"><span class="built_in">cd</span> mysite</span><br><span class="line">python manage.py runserver</span><br><span class="line"><span class="comment"># 默认情况下，runserver 命令会将服务器设置为监听本机内部 IP 的 8000 端口，如果你想更换服务器的监听端口，请使用命令行参数</span></span><br><span class="line">python manage.py runserver 8080</span><br><span class="line"><span class="comment"># 0 是 0.0.0.0 的简写</span></span><br><span class="line">python manage.py runserver 0:8000</span><br><span class="line"><span class="comment"># 帮助文档</span></span><br><span class="line">python manage.py -h</span><br><span class="line"><span class="comment"># Django命令</span></span><br><span class="line">python manage.py &lt;<span class="built_in">command</span>&gt; [options]</span><br><span class="line"></span><br><span class="line"><span class="comment"># mysite目录结构</span></span><br><span class="line">mysite/</span><br><span class="line">    manage.py</span><br><span class="line">    mysite/</span><br><span class="line">        __init__.py</span><br><span class="line">        settings.py</span><br><span class="line">        urls.py</span><br><span class="line">        wsgi.py</span><br></pre></td></tr></table></figure><p>这些目录和文件的用处是：</p><ul><li>最外层的:file: mysite/ 根目录只是你项目的容器， Django 不关心它的名字，你可以将它重命名为任何你喜欢的名字。</li><li>manage.py: 一个让你用各种方式管理 Django 项目的命令行工具。你可以阅读 django-admin and manage.py 获取所有 manage.py 的细节。</li><li>里面一层的 mysite/ 目录包含你的项目，它是一个纯 Python 包。它的名字就是当你引用它内部任何东西时需要用到的 Python 包名。 (比如 mysite.urls).</li><li>mysite/<strong>init</strong>.py：一个空文件，告诉 Python 这个目录应该被认为是一个 Python 包。如果你是 Python 初学者，阅读官方文档中的 更多关于包的知识。</li><li>mysite/settings.py：Django 项目的配置文件。如果你想知道这个文件是如何工作的，请查看 Django settings 了解细节。</li><li>mysite/urls.py：Django 项目的 URL 声明，就像你网站的“目录”。阅读 URL调度器 文档来获取更多关于 URL 的内容。</li><li>mysite/wsgi.py：作为你的项目的运行在 WSGI 兼容的Web服务器上的入口。阅读 如何使用 WSGI 进行部署 了解更多细节。</li></ul><blockquote><p>会自动重新加载的服务器 runserver</p></blockquote><p>用于开发的服务器在需要的情况下会对每一次的访问请求重新载入一遍 Python 代码。所以你不需要为了让修改的代码生效而频繁的重新启动服务器。然而，一些动作，比如添加新文件，将不会触发自动重新加载，这时你得自己手动重启服务器。</p>]]></content>
    
    <summary type="html">
    
      Django 1.x 和 Django2.x 学习笔记
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>HPQLOCFG 批量管理 HP iLO 实践</title>
    <link href="https://wsgzao.github.io/post/hpqlocfg/"/>
    <id>https://wsgzao.github.io/post/hpqlocfg/</id>
    <published>2018-05-06T08:40:53.000Z</published>
    <updated>2018-05-07T02:36:43.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>HP iLO, Dell iDRAC, IBM/Lenovo IMM 等这些名字对于服务器硬件工程师来说应该不会陌生，当然在服务器采购回来大规模上架的时刻很多小伙伴估计就要崩溃了，OOB带外管理的IP需要手动配置，NTP和License也需要记得配置，万一忘记了，咳咳，那可就惨喽。这次我们就碰上了NTP时间同步没有配置，导致时区和时间的显示直接影响硬件故障时收集日志判断，为了避免人力资源浪费，网上搜索了一圈发现HP iLO有自己的批量化管理客户端程序，希望大家举一反三提升运维的效率。</p><blockquote><p>HP Lights-Out Configuration Utility 批量管理 HP iLO 2/3/4</p></blockquote><h2 id="更新记录"><a href="#更新记录" class="headerlink" title="更新记录"></a>更新记录</h2><p>2018年05月06日 - 补充GitHub开源的代码<br>2018年04月01日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/hpqlocfg/">https://wsgzao.github.io/post/hpqlocfg/</a></p><p><strong>扩展阅读</strong></p><p>HP ilo4 批量管理 - <a href="http://blog.51cto.com/gregdefanhua/2089408" target="_blank" rel="noopener">http://blog.51cto.com/gregdefanhua/2089408</a></p><h2 id="下载-HP-iLO-管理软件和模板"><a href="#下载-HP-iLO-管理软件和模板" class="headerlink" title="下载 HP iLO 管理软件和模板"></a>下载 HP iLO 管理软件和模板</h2><blockquote><p>扩展阅读中的信息已过期，cpqlocfg现在更名为hpqlocfg，沿用了作者的思路在此表示感谢</p></blockquote><p>RECOMMENDED * HP Lights-Out Configuration Utility<br><a href="https://support.hpe.com/hpsc/swd/public/detail?swItemId=MTX_d7e7146b56324eb0879f0a98e2#tab1" target="_blank" rel="noopener">https://support.hpe.com/hpsc/swd/public/detail?swItemId=MTX_d7e7146b56324eb0879f0a98e2#tab1</a></p><p>用于 Windows 的 HP Lights-Out XML Scripting Sample<br><a href="https://support.hpe.com/hpsc/swd/public/detail?swItemId=MTX_f045db3f567040f291bf645684#tab1" target="_blank" rel="noopener">https://support.hpe.com/hpsc/swd/public/detail?swItemId=MTX_f045db3f567040f291bf645684#tab1</a></p><h2 id="实践方法"><a href="#实践方法" class="headerlink" title="实践方法"></a>实践方法</h2><blockquote><p>拷贝HPQLOCFG.exe和相关dll文件至脚本当前路径</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">file://C:\Users\wsgzao\Desktop\ilo_ntp(1 folders, 12 files, 211.96 KB, 3.70 MB <span class="keyword">in</span> total.)</span><br><span class="line">│  172.25.240.45266 bytes</span><br><span class="line">│  HPQLOCFG.exe59.00 KB</span><br><span class="line">│  HPQLOCFG.exe.config712 bytes</span><br><span class="line">│  HPSSLConnection.dll13.50 KB</span><br><span class="line">│  ilo_ntp.log0 bytes</span><br><span class="line">│  ip.txt150 bytes</span><br><span class="line">│  log.txt2.24 KB</span><br><span class="line">│  Parser.dll133.00 KB</span><br><span class="line">│  README.txt2.03 KB</span><br><span class="line">│  SetNTP.bat181 bytes</span><br><span class="line">│  SetNTP.xml555 bytes</span><br><span class="line">│  操作步骤.txt381 bytes</span><br><span class="line">└─HP官方文件(0 folders, 3 files, 3.50 MB, 3.50 MB <span class="keyword">in</span> total.)</span><br><span class="line">        HPE iLO 4 脚本和命令行指南.pdf2.95 MB</span><br><span class="line">        SP58155.exe392.67 KB</span><br><span class="line">        windows-LOsamplescripts4.80.0.zip168.34 KB</span><br></pre></td></tr></table></figure><p>编写XML文件 SetNTP.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">RIBCL</span> <span class="attr">VERSION</span>=<span class="string">"2.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">LOGIN</span> <span class="attr">USER_LOGIN</span>=<span class="string">"iloadmin"</span> <span class="attr">PASSWORD</span>=<span class="string">"iloadmin"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">RIB_INFO</span> <span class="attr">MODE</span>=<span class="string">"write"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">MOD_NETWORK_SETTINGS</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">DHCP_SNTP_SETTINGS</span> <span class="attr">value</span>=<span class="string">"No"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">DHCPV6_SNTP_SETTINGS</span> <span class="attr">value</span>=<span class="string">"No"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">SNTP_SERVER1</span> <span class="attr">value</span>=<span class="string">"%ntp1%"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TIMEZONE</span> <span class="attr">value</span>=<span class="string">"Asia/Shanghai"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">MOD_NETWORK_SETTINGS</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">MOD_GLOBAL_SETTINGS</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">PROPAGATE_TIME_TO_HOST</span> <span class="attr">VALUE</span>=<span class="string">"No"</span> /&gt;</span> </span><br><span class="line">            <span class="tag">&lt;/<span class="name">MOD_GLOBAL_SETTINGS</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RIB_INFO</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LOGIN</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">RIBCL</span>&gt;</span></span><br></pre></td></tr></table></figure><p>编写批处理  SetNTP.bat</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="keyword">for</span> /f <span class="variable">%%a</span> <span class="keyword">in</span> (ip.txt) <span class="keyword">do</span> (</span><br><span class="line">    <span class="built_in">set</span> ip=<span class="variable">%%a</span></span><br><span class="line">    <span class="built_in">set</span> ntp="<span class="number">172</span>.<span class="number">25</span>.<span class="number">240</span>.<span class="number">254</span>"</span><br><span class="line">    <span class="keyword">call</span> hpqlocfg -s <span class="variable">%%i</span>p%% -l log.txt -f SetNTP.xml -u iloadmin -p iloadmin -t ntp1=<span class="variable">%%n</span>tp%%</span><br><span class="line">)</span><br></pre></td></tr></table></figure><blockquote><p>修改2处内容</p></blockquote><ol><li>修改ip.txt，添加信息</li><li>修改SetNTP.bat中set ntp=”172.28.70.254”</li></ol><blockquote><p>执行方法</p></blockquote><pre><code>SetNTP.bat</code></pre><blockquote><p>文章中所有提到的代码和HP官方文件都放在GitHub中</p></blockquote><p><a href="https://github.com/wsgzao/hpqlocfg/" target="_blank" rel="noopener">https://github.com/wsgzao/hpqlocfg/</a></p>]]></content>
    
    <summary type="html">
    
      HP Lights-Out Configuration Utility 批量管理 HP iLO 2/3/4
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>使用Anaconda实现Python2和Python3共存及相互转换</title>
    <link href="https://wsgzao.github.io/post/anaconda/"/>
    <id>https://wsgzao.github.io/post/anaconda/</id>
    <published>2018-05-04T06:59:49.000Z</published>
    <updated>2018-05-10T08:16:59.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>初学Python时，总是被python的两个不太兼容的版本搞得头昏脑胀。按目前的发展趋势，python未来的主流版为python3。但是我们经常会遇到一些很有意思代码使用的是python2版本。于是我们需要同时拥有python2和python3的运行环境。这里介绍一个强大的软件Anaconda，它实现python2和python3两个版本的共存，并且可以相互转换。Anaconda 是一个用于科学计算的 Python 发行版，支持 Linux, Mac, Windows, 包含了众多流行的科学计算、数据分析的 Python 包。</p><blockquote><p>使用Anaconda轻松解决Python2和Python3共存</p></blockquote><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018年05月04日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/anaconda/">https://wsgzao.github.io/post/anaconda/</a></p><p><strong>扩展阅读</strong></p><p>Anaconda - <a href="https://anaconda.org/" target="_blank" rel="noopener">https://anaconda.org/</a></p><hr><h2 id="为什么选择Anaconda"><a href="#为什么选择Anaconda" class="headerlink" title="为什么选择Anaconda"></a>为什么选择Anaconda</h2><p>Anaconda 实际上是一个软件发行版，它附带了 conda、Python 和多个科学包及其依赖项。应用程序 conda 是包和环境管理器。Anaconda 的下载文件比较大（约 500 MB），因为它附带了 Python 中最常用的数据科学包。如果只需要某些包，或者需要节省带宽或存储空间，也可以使用 Miniconda 这个较小的发行版（仅包含 conda 和 Python）。</p><h3 id="什么是-Anaconda"><a href="#什么是-Anaconda" class="headerlink" title="什么是 Anaconda"></a>什么是 Anaconda</h3><p>Anaconda是专注于数据分析的Python发行版本，包含了conda、Python等多个科学包及其依赖项。作为好奇宝宝的你是不是发现了一个新名词 conda，那么你一定会问 conda 又是什么呢？</p><h3 id="什么是-conda"><a href="#什么是-conda" class="headerlink" title="什么是 conda"></a>什么是 conda</h3><blockquote><p>conda 是开源包（packages）和虚拟环境（environment）的管理系统</p></blockquote><p>packages 管理： 可以使用 conda 来安装、更新 、卸载工具包 ，并且它更关注于数据科学相关的工具包。在安装 anaconda 时就预先集成了像 Numpy、Scipy、 pandas、Scikit-learn 这些在数据分析中常用的包。另外值得一提的是，conda 并不仅仅管理Python的工具包，它也能安装非python的包。比如在新版的 Anaconda 中就可以安装R语言的集成开发环境 Rstudio。</p><p>虚拟环境管理： 在conda中可以建立多个虚拟环境，用于隔离不同项目所需的不同版本的工具包，以防止版本上的冲突。对纠结于 Python 版本的同学们，我们也可以建立 Python2 和 Python3 两个环境，来分别运行不同版本的 Python 代码。</p><p>知道 是什么（what） 的同时，我们也需要问一问 为什么（why）。那么，为什么要选择用Anaconda呢？</p><h3 id="Anaconda-的优点"><a href="#Anaconda-的优点" class="headerlink" title="Anaconda 的优点"></a>Anaconda 的优点</h3><p>Anaconda的优点总结起来就八个字：省时省心、分析利器。</p><p><strong>省时省心</strong>： Anaconda通过管理工具包、开发环境、Python版本，大大简化了你的工作流程。不仅可以方便地安装、更新、卸载工具包，而且安装时能自动安装相应的依赖包，同时还能使用不同的虚拟环境隔离不同要求的项目。</p><p><strong>分析利器</strong>： 在 Anaconda 官网中是这么宣传自己的：适用于企业级大数据分析的Python工具。其包含了720多个数据科学相关的开源包，在数据可视化、机器学习、深度学习等多方面都有涉及。不仅可以做数据分析，甚至可以用在大数据和人工智能领域。</p><p>解决了 <strong>是什么</strong> 以及 <strong>为什么</strong> 的问题后，下面让我们看一下 <strong>怎么做（How）</strong>。</p><p>说明一下conda的设计理念——<strong>conda将几乎所有的工具、第三方包都当做package对待，甚至包括python和conda自身！</strong>因此，conda打破了包管理与环境管理的约束，能非常方便地安装各种版本python、各种package并方便地切换。</p><h3 id="Anaconda中的重要组件"><a href="#Anaconda中的重要组件" class="headerlink" title="Anaconda中的重要组件"></a>Anaconda中的重要组件</h3><p>Anaconda Navigator ：用于管理工具包和环境的图形用户界面，后续涉及的众多管理命令也可以在 Navigator 中手工实现。</p><p>Jupyter notebook ：基于web的交互式计算环境，可以编辑易于人们阅读的文档，用于展示数据分析的过程。</p><p>qtconsole ：一个可执行 IPython 的仿终端图形界面程序，相比 Python Shell 界面，qtconsole 可以直接显示代码生成的图形，实现多行代码输入执行，以及内置许多有用的功能和函数。</p><p>spyder ：一个使用Python语言、跨平台的、科学运算集成开发环境。Spyder的最大优点就是模仿MATLAB的“工作空间”。</p><p>Conda : Conda的包管理就比较好理解了，这部分功能与pip类似。</p><h2 id="安装Anaconda"><a href="#安装Anaconda" class="headerlink" title="安装Anaconda"></a>安装Anaconda</h2><p>Anaconda 可用于 Windows、Mac OS X 和 Linux。可以在官网上找到安装程序和安装说明<br><a href="https://www.anaconda.com/download/" target="_blank" rel="noopener">https://www.anaconda.com/download/</a></p><p>如果计算机上已经安装了 Python，这不会有任何影响。实际上，脚本和程序使用的默认 Python 是 Anaconda 附带的 Python。这里需要注意的是选对自己操作系统对应的版本。安装完后打开cmd,输入conda list可以查看当前安装的内容。输入conda upgrade –all，可以更新默认环境下的所有包。并在提示是否更新的时候输入y（Yes）以便让更新继续。初次安装下的软件包版本一般都比较老旧，因此提前更新可以避免未来不必要的问题。</p><p>本人使用的操作系统：Win10，前往anaconda官网下载对应的版本，本人选择的是Python3.6 + Python 2.7（实际上下载一个即可，推荐3.6）</p><h3 id="设置Path变量"><a href="#设置Path变量" class="headerlink" title="设置Path变量"></a>设置Path变量</h3><blockquote><p>默认安装不会自动添加全局变量，如果有需求可以手动配置Path，以Anaconda2为例</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将加入到PATH路径</span></span><br><span class="line">D:\Programs\Anaconda2</span><br><span class="line">D:\Programs\Anaconda2\Scripts</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在cmd输入</span></span><br><span class="line">python -V</span><br><span class="line"></span><br><span class="line">Python 2.7.14 :: Anaconda, Inc.</span><br></pre></td></tr></table></figure><h3 id="python2和python3版本转换"><a href="#python2和python3版本转换" class="headerlink" title="python2和python3版本转换"></a>python2和python3版本转换</h3><blockquote><p>在win10环境下进行傻瓜式安装。当安装完成时，计算机便具备了Python3.6的环境，推荐使用 Anaconda Prompt 进入命令行</p></blockquote><p>接下来，在cmd的环境下，输入以下命令安装Python2.7的环境</p><pre><code>conda create -n python27 python=2.7 anaconda</code></pre><p>上面的代码创建了一个名为python27的python2.7的环境，最后一个参数表示安装anaconda下python2.7的所有默认包，这个参数时可选的。 </p><p>我们进入cmd环境，现在默认的python版本时python3.6，只需要一行简单的代码就可以转为python2.7的环境</p><pre><code>activate python27</code></pre><p>此时本窗口下的python版本变为了python2.7，那么你肯定猜到了恢复到python3.6的命令</p><pre><code>deactivate python27</code></pre><p>其实呢，一般没有必要恢复到原环境。只要打开一个新的cmd窗口，默认的python版本就是python3.6</p><h3 id="Anaconda-镜像"><a href="#Anaconda-镜像" class="headerlink" title="Anaconda 镜像"></a>Anaconda 镜像</h3><blockquote><p>这里使用了清华大学开源软件镜像站tuna提供的资源，在此表示感谢</p></blockquote><p><a href="https://mirrors.tuna.tsinghua.edu.cn/help/anaconda/" target="_blank" rel="noopener">https://mirrors.tuna.tsinghua.edu.cn/help/anaconda/</a></p><p>Anaconda 安装包可以到以下地址分流下载<br><a href="https://mirrors.tuna.tsinghua.edu.cn/anaconda/archive/" target="_blank" rel="noopener">https://mirrors.tuna.tsinghua.edu.cn/anaconda/archive/</a> </p><p>因为Anaconda.org的服务器在国外，conda下载的速度经常很慢。可以设置国内的镜像源来加速：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># TUNA 还提供了 Anaconda 仓库的镜像，运行以下命令即可添加 Anaconda Python 免费仓库</span></span><br><span class="line">conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/</span><br><span class="line">conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/</span><br><span class="line"><span class="comment"># 设置搜索时显示通道地址</span></span><br><span class="line">conda config --<span class="built_in">set</span> show_channel_urls yes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行完上述命令后，会生成配置文件记录着我们对conda的配置，直接手动创建、编辑该文件是相同的效果</span></span><br><span class="line"><span class="comment"># Linux/Mac</span></span><br><span class="line">~/.condarc</span><br><span class="line"><span class="comment"># Windows</span></span><br><span class="line">C:\Users\USER_NAME\.condarc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行测试一下吧</span></span><br><span class="line">conda install numpy</span><br></pre></td></tr></table></figure><blockquote><p>常见问题：conda无法安装更新，报错内容如下：</p></blockquote><p>CondaHTTPError: HTTP 000 CONNECTION FAILED for url <a href="https://repo.anaconda.com/pkgs/free/win-64/repodata.json.bz2" target="_blank" rel="noopener">https://repo.anaconda.com/pkgs/free/win-64/repodata.json.bz2</a><br>Elapsed: -</p><p>An HTTP error occurred when trying to retrieve this URL.<br>HTTP errors are often intermittent, and a simple retry will get you on your way.</p><p>If your current network has <a href="https://www.anaconda.com" target="_blank" rel="noopener">https://www.anaconda.com</a> blocked, please file<br>a support request with your network engineering team.</p><p>SSLError(MaxRetryError(‘HTTPSConnectionPool(host=\’repo.anaconda.com\’, port=443): Max retries exceeded with url: /pkgs/free/win-64/repodata.json.bz2 (Caused by SSLError(SSLError(“bad handshake: SysCallError(10054, \’WSAECONNRESET\’)”,),))’,),)</p><p>A reportable application error has occurred. Conda has prepared the above report.<br>If submitted, this report will be used by core maintainers to improve<br>future releases of conda.<br>Would you like conda to send this report to the core maintainers?</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑.condarc注释defalts</span></span><br><span class="line">channels:</span><br><span class="line">  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/</span><br><span class="line">  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/</span><br><span class="line"><span class="comment">#  - defaults</span></span><br><span class="line">ssl_verify: <span class="literal">true</span></span><br><span class="line">show_channel_urls: <span class="literal">true</span></span><br></pre></td></tr></table></figure><h2 id="conda安装django实践"><a href="#conda安装django实践" class="headerlink" title="conda安装django实践"></a>conda安装django实践</h2><blockquote><p>以下操作为 anaconda python3.6 环境下进入Anaconda Prompt安装django1.11的实践过程</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在python3.6环境下进入Anaconda Prompt创建django1.x专用虚拟环境</span></span><br><span class="line">conda create -n django1.x</span><br><span class="line"><span class="comment"># 激活专用虚拟环境</span></span><br><span class="line">conda activate django1.x</span><br><span class="line"><span class="comment"># 查看conda当前django可用版本</span></span><br><span class="line">conda search django</span><br><span class="line">conda install django==1.11.10</span><br><span class="line"><span class="comment"># 切换到虚拟环境家目录</span></span><br><span class="line"><span class="built_in">cd</span> C:\Users\wsgzao\AppData\Local\conda\conda\envs\django1.x</span><br><span class="line"><span class="comment"># 创建项目</span></span><br><span class="line">django-admin.py startproject myweb</span><br><span class="line"><span class="comment"># 创建app</span></span><br><span class="line">python manage.py startapp myapp</span><br><span class="line"><span class="comment"># 启动Django中的开发服务器</span></span><br><span class="line">python manage.py runserver</span><br><span class="line"><span class="comment"># 帮助文档</span></span><br><span class="line">python manage.py -h</span><br><span class="line"><span class="comment"># Django命令</span></span><br><span class="line">python manage.py &lt;<span class="built_in">command</span>&gt; [options]</span><br></pre></td></tr></table></figure><h2 id="conda常用命令"><a href="#conda常用命令" class="headerlink" title="conda常用命令"></a>conda常用命令</h2><p>最新版的conda是从site-packages文件夹中搜索已经安装的包，不依赖于pip，因此可以显示出通过各种方式安装的包。conda将conda、python等都视为package，因此完全可以使用conda来管理conda和python的版本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列出所有已安装的包</span></span><br><span class="line">conda list</span><br><span class="line"><span class="comment"># 安装软件包，同时它会自动安装此软件包的依赖项 </span></span><br><span class="line">conda install package_name</span><br><span class="line"><span class="comment"># 同时安装多个包</span></span><br><span class="line">conda install numpy pandas</span><br><span class="line"><span class="comment"># 安装指定版本的包</span></span><br><span class="line">conda install python=2.7</span><br><span class="line"><span class="comment"># 安装离线包</span></span><br><span class="line">conda install /package-path/package-filename.tar.bz2</span><br><span class="line"><span class="comment"># 卸载包</span></span><br><span class="line">conda remove package_name</span><br><span class="line"><span class="comment"># 更新环境中的所有已安装的包</span></span><br><span class="line">conda update/upgrade --all</span><br><span class="line"><span class="comment"># 更新conda，保持conda最新</span></span><br><span class="line">conda update conda</span><br><span class="line"><span class="comment"># 更新anaconda</span></span><br><span class="line">conda update anaconda</span><br><span class="line"><span class="comment"># 更新python</span></span><br><span class="line">conda update python</span><br><span class="line"><span class="comment"># 查看conda安装信息</span></span><br><span class="line">conda info</span><br><span class="line"><span class="comment"># 查看conda帮助</span></span><br><span class="line">conda <span class="built_in">help</span></span><br><span class="line"><span class="comment"># 搜索可以安装的包</span></span><br><span class="line">conda search package_name</span><br><span class="line"><span class="comment"># 创建conda虚拟环境</span></span><br><span class="line">conda create -n env_name</span><br><span class="line"><span class="comment"># 在这里，-n env_name 设置环境的名称（-n 是指名称），而 list of packages 是要安装在环境中的包的列表</span></span><br><span class="line">conda create -n env_name list of packages</span><br><span class="line"><span class="comment"># 可以创建具有特定 Python 版本的环境</span></span><br><span class="line">conda create -n py2.7.14 python=2.7.14</span><br><span class="line"><span class="comment"># 查看conda版本</span></span><br><span class="line">conda -V</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入环境</span></span><br><span class="line"><span class="comment"># linux 下用 </span></span><br><span class="line"><span class="built_in">source</span> activate env_name</span><br><span class="line"><span class="comment"># windows 下用</span></span><br><span class="line">activate env_name</span><br><span class="line"></span><br><span class="line"><span class="comment"># 离开环境</span></span><br><span class="line"><span class="comment"># linux 下用 </span></span><br><span class="line"><span class="built_in">source</span> deactivate</span><br><span class="line"><span class="comment"># windows 下用</span></span><br><span class="line">deactivate</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出环境</span></span><br><span class="line">conda env list</span><br><span class="line"><span class="comment"># 删除环境</span></span><br><span class="line">conda env remove -n env_name</span><br><span class="line"><span class="comment"># 导出环境将包保存为 YAML，输出环境中的所有包的名称（包括 Python 版本）</span></span><br><span class="line">conda env <span class="built_in">export</span> &gt; environment.yaml</span><br><span class="line"><span class="comment"># 加载环境</span></span><br><span class="line">conda env create -f environment.yaml</span><br></pre></td></tr></table></figure><h2 id="anaconda与vscode整合"><a href="#anaconda与vscode整合" class="headerlink" title="anaconda与vscode整合"></a>anaconda与vscode整合</h2><p>打开vscode，选择文件-首选项-设置，搜索<code>python.pythonPath</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"editor.minimap.enabled"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"editor.renderControlCharacters"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"editor.renderWhitespace"</span>: <span class="string">"all"</span>,</span><br><span class="line">    <span class="string">"python.disablePromptForFeatures"</span>: [</span><br><span class="line">        <span class="string">"pylint"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"python.pythonPath"</span>: <span class="string">"C:\\ProgramData\\Anaconda3"</span>,</span><br><span class="line">    <span class="string">"workbench.iconTheme"</span>: <span class="string">"vscode-icons"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      使用Anaconda轻松解决Python2和Python3共存
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>pip离线安装和配置pypi国内加速镜像实践</title>
    <link href="https://wsgzao.github.io/post/pip/"/>
    <id>https://wsgzao.github.io/post/pip/</id>
    <published>2018-05-03T06:59:49.000Z</published>
    <updated>2018-05-04T07:46:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>pip安装本身很简单官方推荐的安装方法就一条命令，但离线安装pip时就有点痛苦了，因为不知道缺少什么依赖包。有时候我们下载python的第三方库入django的时候pip install django 或者 easy_install django 发现下载的速度非常的慢。慢的原因其实就是从Python的官方源<a href="https://pypi.org/" target="_blank" rel="noopener">https://pypi.org/</a> 下载到本地，然后解包安装。不过因为某些原因，访问官方的pypi不稳定，很慢甚至有些还时不时的访问不了。为了解决这个下载慢的问题，可以使用国内的pypi镜像。</p><blockquote><p>轻轻松松解决pip离线安装，配置pypi国内加速镜像</p></blockquote><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018年05月03日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/pip/">https://wsgzao.github.io/post/pip/</a></p><p><strong>扩展阅读</strong></p><p>PyPA - <a href="https://www.pypa.io/" target="_blank" rel="noopener">https://www.pypa.io/</a></p><hr><h2 id="pip简介"><a href="#pip简介" class="headerlink" title="pip简介"></a>pip简介</h2><p>The PyPA recommended tool for installing Python packages.</p><h2 id="pip安装"><a href="#pip安装" class="headerlink" title="pip安装"></a>pip安装</h2><p><a href="https://pip.pypa.io/en/stable/installing/" target="_blank" rel="noopener">https://pip.pypa.io/en/stable/installing/</a></p><h3 id="pip在线安装"><a href="#pip在线安装" class="headerlink" title="pip在线安装"></a>pip在线安装</h3><p>To install pip, securely download get-pip.py:</p><pre><code>curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py</code></pre><p>Inspect get-pip.py for any malevolence. Then run the following:</p><pre><code>python get-pip.py</code></pre><h3 id="pip离线安装"><a href="#pip离线安装" class="headerlink" title="pip离线安装"></a>pip离线安装</h3><blockquote><p>以 Linux 下 Python 2.7.14 和 pip 9.0.1 为例，Windows 可以参考最后的推荐链接</p></blockquote><p>下文中提到的压缩包都可以在官方找到对应的版本 - <a href="https://pypi.org/" target="_blank" rel="noopener">https://pypi.org/</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Install Packages</span></span><br><span class="line">yum install gcc zlib zlib-devel openssl-devel -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install Python</span></span><br><span class="line">tar xf Python-2.7.14.tgz</span><br><span class="line"><span class="built_in">cd</span> Python-2.7.14</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line"><span class="comment"># ImportError: No module named six.moves</span></span><br><span class="line">tar xf six-1.11.0.tar.gz </span><br><span class="line"><span class="built_in">cd</span> six-1.11.0</span><br><span class="line">python setup.py install</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line"><span class="comment"># ImportError: No module named packaging.version</span></span><br><span class="line">tar xf packaging-17.1.tar.gz </span><br><span class="line"><span class="built_in">cd</span> packaging-17.1</span><br><span class="line">python setup.py install</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line"><span class="comment"># ImportError: No module named pyparsing</span></span><br><span class="line">tar xf pyparsing-2.2.0.tar.gz </span><br><span class="line"><span class="built_in">cd</span> pyparsing-2.2.0</span><br><span class="line">python setup.py install</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line"><span class="comment"># ImportError: No module named appdirs</span></span><br><span class="line">tar xf appdirs-1.4.3.tar.gz </span><br><span class="line"><span class="built_in">cd</span> appdirs-1.4.3</span><br><span class="line">python setup.py install</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install Setuptools</span></span><br><span class="line">unzip setuptools-38.5.2.zip</span><br><span class="line"><span class="built_in">cd</span> setuptools-38.5.2</span><br><span class="line">python setup.py install</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install pip</span></span><br><span class="line">tar xf pip-9.0.1.tar.gz</span><br><span class="line"><span class="built_in">cd</span> pip-9.0.1</span><br><span class="line">python setup.py install</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line"><span class="comment"># Upgrading pip</span></span><br><span class="line">pip install -U pip</span><br></pre></td></tr></table></figure><h2 id="配置pypi国内加速镜像"><a href="#配置pypi国内加速镜像" class="headerlink" title="配置pypi国内加速镜像"></a>配置pypi国内加速镜像</h2><blockquote><p>由于众所周知的原因，国内访问和下载国外的镜像仓库不畅，所以需要做些小小的优化</p></blockquote><p>阿里云(aliyun) - <a href="https://mirrors.aliyun.com/pypi/simple/" target="_blank" rel="noopener">https://mirrors.aliyun.com/pypi/simple/</a><br>豆瓣(douban) - <a href="https://pypi.douban.com/simple/" target="_blank" rel="noopener">https://pypi.douban.com/simple/</a><br>清华大学(tuna) - <a href="https://pypi.tuna.tsinghua.edu.cn/simple/" target="_blank" rel="noopener">https://pypi.tuna.tsinghua.edu.cn/simple/</a> </p><h3 id="临时使用"><a href="#临时使用" class="headerlink" title="临时使用"></a>临时使用</h3><blockquote><p>注意，simple 不能少, 是 https 而不是 http</p></blockquote><pre><code>pip install -i https://pypi.tuna.tsinghua.edu.cn/simple ansible</code></pre><h3 id="永久生效"><a href="#永久生效" class="headerlink" title="永久生效"></a>永久生效</h3><blockquote><p>pip配置文件不存在则需要手动创建，具体配置信息参考官方文档</p></blockquote><p><a href="https://pip.pypa.io/en/stable/user_guide/#config-file" target="_blank" rel="noopener">https://pip.pypa.io/en/stable/user_guide/#config-file</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Linux</span></span><br><span class="line">~/.config/pip/pip.conf</span><br><span class="line"><span class="comment"># Windows</span></span><br><span class="line">%APPDATA%\pip\pip.ini</span><br><span class="line"><span class="comment"># macOS</span></span><br><span class="line"><span class="variable">$HOME</span>/Library/Application Support/pip/pip.conf</span><br></pre></td></tr></table></figure><blockquote><p>Linux更换pypi国内源</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Linux更换pypi国内源</span></span><br><span class="line">tee ~/.config/pip/pip.conf &lt;&lt;-<span class="string">'EOF'</span></span><br><span class="line">[global]</span><br><span class="line">index-url = https://mirrors.aliyun.com/pypi/simple/</span><br><span class="line">[install]</span><br><span class="line">trusted-host= mirrors.aliyun.com</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><blockquote><p>Windows更换pypi国内源</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Windows更换pypi国内源，运行以下python代码会自动建立pip.ini</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">ini=<span class="string">"""[global]</span></span><br><span class="line"><span class="string">index-url = https://pypi.doubanio.com/simple/</span></span><br><span class="line"><span class="string">[install]</span></span><br><span class="line"><span class="string">trusted-host=pypi.doubanio.com</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">pippath=os.environ[<span class="string">"USERPROFILE"</span>]+<span class="string">"\\pip\\"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(pippath):</span><br><span class="line">    os.mkdir(pippath)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(pippath+<span class="string">"pip.ini"</span>,<span class="string">"w+"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(ini)</span><br></pre></td></tr></table></figure><h2 id="推荐参考的文章"><a href="#推荐参考的文章" class="headerlink" title="推荐参考的文章"></a>推荐参考的文章</h2><p>Python 2.6 升级至 Python 2.7 的实践心得 - <a href="https://wsgzao.github.io/post/python-2-6-update-to-2-7/">https://wsgzao.github.io/post/python-2-6-update-to-2-7/</a><br>pip离线安装和配置pypi国内加速镜像实践 - <a href="https://wsgzao.github.io/post/pip/">https://wsgzao.github.io/post/pip/</a><br>使用pypiserver快速搭建内网离线pypi仓库实践 - <a href="https://wsgzao.github.io/post/pypiserver/">https://wsgzao.github.io/post/pypiserver/</a><br>RHEL7/CentOS7在线和离线安装GitLab配置使用实践 - <a href="https://wsgzao.github.io/post/gitlab/">https://wsgzao.github.io/post/gitlab/</a><br>使用pipenv代替virtualenv管理python包 - <a href="https://wsgzao.github.io/post/pipenv/">https://wsgzao.github.io/post/pipenv/</a></p>]]></content>
    
    <summary type="html">
    
      轻轻松松解决pip离线安装，配置pypi国内加速镜像
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>通过关闭Windows Update更新解决服务主机本地系统CPU使用率高问题</title>
    <link href="https://wsgzao.github.io/post/windows-update/"/>
    <id>https://wsgzao.github.io/post/windows-update/</id>
    <published>2018-05-02T06:59:49.000Z</published>
    <updated>2018-05-02T09:04:21.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近经常发现Windows10系统卡顿，笔记本风扇声音特别响，本地系统的CPU占用就一直维持在100%左右，程序响应慢严重影响效率。不同的Windows版本情况可能不同，但通过任务管理器查看CPU较高的进程发现集中在Windows Update，而CPU高的问题也正是来源于此。然而回顾此前一路从Windows XP/Vista/7/8.1/10的自动更新经历来看其实微软一直再向前走，至少我的x230换上SSD和大内存后使用Windows10 Pro初版一路升级到现在1803，没有遇到太大的问题，也再也没因为垃圾数据太多或者系统响应慢而隔三差五重装电脑，你们的故事呢？</p><blockquote><p>CPU使用率高居然是Windows Update更新进程惹的祸</p></blockquote><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018年05月02日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/windows-update/">https://wsgzao.github.io/post/windows-update/</a></p><p><strong>扩展阅读</strong></p><p>Win10关闭自动更新,windows10怎么关闭自动更新 - <a href="http://jingyan.baidu.com/article/f71d6037702c7c1ab641d194.html" target="_blank" rel="noopener">http://jingyan.baidu.com/article/f71d6037702c7c1ab641d194.html</a></p><hr><h2 id="禁用-Windows-10-更新"><a href="#禁用-Windows-10-更新" class="headerlink" title="禁用 Windows 10 更新"></a>禁用 Windows 10 更新</h2><blockquote><p>如不想禁用Windows 10 更新，手动停止Windows Update服务观察是否可以解决即可</p></blockquote><ol><li>找到任务管理器中的“ 服务主机：本地系统”-&gt;“Windows Update”，右键，进入“服务”</li><li>在服务列表中找到“Windows Update”，右键，停止</li><li>在服务列表中找到“Windows Update”，右键，属性，启动类型选择“禁用”</li><li>打开C:\Windows\SoftwareDistribution，删除里面所有文件，如果可以删除所有文件，那么CPU应该已经恢复正常了，如果有些文件不能删除，则可能是“Windows Update”没有完全关闭，继续下面步骤</li><li>按Win键+R键调出运行，输入“gpedit.msc”点击“确定”，调出“本地组策略编辑器”</li><li>依次展开”计算机配置”，”管理模板” ，”windows组件” ，”windows更新 “，在右面找到“配置自动更新”，并双击</li><li>在配置窗口上按1-3的顺序选择“已禁用”，点击“应用”，“确定”，重启电脑</li><li>打开C:\Windows\SoftwareDistribution，删除里面所有文件</li></ol><p>至此，应该CPU会恢复正常，如果还没有，那就具体问题具体分析吧</p><h2 id="启用-Windows-10-更新"><a href="#启用-Windows-10-更新" class="headerlink" title="启用 Windows 10 更新"></a>启用 Windows 10 更新</h2><ol><li>先打开服务，把Windows Update停止并禁用</li><li>然后打开设置里的更新和安全，此时Windows更新会显示不可用</li><li>这时去服务里启用Windows Update</li><li>然后去更新里点重试</li><li>最后就等吧</li></ol>]]></content>
    
    <summary type="html">
    
      CPU使用率高居然是Windows Update更新进程惹的祸
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>使用pipenv代替virtualenv管理python包</title>
    <link href="https://wsgzao.github.io/post/pipenv/"/>
    <id>https://wsgzao.github.io/post/pipenv/</id>
    <published>2018-04-25T06:59:49.000Z</published>
    <updated>2018-05-03T03:16:05.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>第一次接触到 pipenv 是因为看到@董明伟大神的《使用pipenv管理你的项目》，之前可能和大家的选择类似使用 virtualenv 或者 pyenv 来管理 python 的包环境。virtualenv 是针对python的包的多版本管理，通过将python包安装到一个模块来作为python的包虚拟环境，通过切换目录来实现不同包环境间的切换。pyenv 是针对 python 版本的管理，通过修改环境变量的方式实现；虽然我自己对pipenv的掌握程度还不深，但是我自己能感受到更加简单而清晰的python包管理方式，并且pipenv还是Python官方正式推荐的python包管理工具。原文如下：</p><p>Pipenv — the officially recommended Python packaging tool from Python.org, free (as in freedom).</p><blockquote><p>Pipenv 官方推荐的 Python 包管理工具</p></blockquote><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2017年04月25日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/pipenv/">https://wsgzao.github.io/post/pipenv/</a></p><p><strong>扩展阅读</strong></p><p>Pipenv - <a href="https://docs.pipenv.org/" target="_blank" rel="noopener">https://docs.pipenv.org/</a><br>Pipenv &amp; 虚拟环境 - <a href="http://pythonguidecn.readthedocs.io/zh/latest/dev/virtualenvs.html" target="_blank" rel="noopener">http://pythonguidecn.readthedocs.io/zh/latest/dev/virtualenvs.html</a></p><hr><h2 id="推荐阅读"><a href="#推荐阅读" class="headerlink" title="推荐阅读"></a>推荐阅读</h2><p>使用pipenv管理你的项目 @董伟明<br><a href="http://www.dongwm.com/archives/%E4%BD%BF%E7%94%A8pipenv%E7%AE%A1%E7%90%86%E4%BD%A0%E7%9A%84%E9%A1%B9%E7%9B%AE/" target="_blank" rel="noopener">http://www.dongwm.com/archives/%E4%BD%BF%E7%94%A8pipenv%E7%AE%A1%E7%90%86%E4%BD%A0%E7%9A%84%E9%A1%B9%E7%9B%AE/</a></p><p>【 python 基础系列 】 - pipenv 试用过程分享<br><a href="http://pylixm.cc/posts/2018-01-13-python-pipenv.html" target="_blank" rel="noopener">http://pylixm.cc/posts/2018-01-13-python-pipenv.html</a></p><h2 id="Pipenv-官方简介"><a href="#Pipenv-官方简介" class="headerlink" title="Pipenv 官方简介"></a>Pipenv 官方简介</h2><blockquote><p>Pipenv: Python Development Workflow for Humans</p></blockquote><p><strong>Pipenv</strong> — the officially recommended Python packaging tool from Python.org, free (as in freedom).</p><p>Pipenv is a tool that aims to bring the best of all packaging worlds (bundler, composer, npm, cargo, yarn, etc.) to the Python world. Windows is a first–class citizen, in our world.</p><p>It automatically creates and manages a virtualenv for your projects, as well as adds/removes packages from your Pipfile as you install/uninstall packages. It also generates the ever–important Pipfile.lock, which is used to produce deterministic builds.</p><p><img src="https://i.loli.net/2018/04/26/5ae14a41a5a8e.gif" alt=""></p><blockquote><p>The problems that Pipenv seeks to solve are multi-faceted:</p></blockquote><p>You no longer need to use <code>pip</code> and <code>virtualenv</code> separately. They work together.<br>Managing a <code>requirements.txt</code> file can be problematic, so Pipenv uses the upcoming <code>Pipfile</code> and <code>Pipfile.lock</code> instead, which is superior for basic use cases.<br>Hashes are used everywhere, always. Security. Automatically expose security vulnerabilities.<br>Give you insight into your dependency graph (e.g. <code>$ pipenv graph</code>).<br>Streamline development workflow by loading <code>.env</code> files.</p><h2 id="Pipenv-安装和使用"><a href="#Pipenv-安装和使用" class="headerlink" title="Pipenv 安装和使用"></a>Pipenv 安装和使用</h2><blockquote><p>我的使用深度不高，就以目前我实际使用pipenv的方式为例</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pip 离线下载</span></span><br><span class="line"><span class="comment"># pip install --download DIR -r requirements.txt</span></span><br><span class="line">mkdir pipenv</span><br><span class="line">pip install -d ~/pipenv/ pipenv</span><br><span class="line"></span><br><span class="line"><span class="comment"># pip 离线安装pipenv</span></span><br><span class="line">pip install --no-index --find-links=pipenv/ pipenv</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用pipenv创建虚拟环境</span></span><br><span class="line">mkdir win_ansible</span><br><span class="line"><span class="built_in">cd</span> win_ansible</span><br><span class="line">pipenv shell</span><br><span class="line">pip install --no-index --find-links=pip-ansible-2.4.3.0/ -r requirements.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 升级ansible版本</span></span><br><span class="line">pip install --no-index --find-links=pip-ansible-2.5.0/ -r requirements.txt -U</span><br><span class="line"></span><br><span class="line"><span class="comment"># 退出虚拟环境</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对不同开发用户自动创建python虚拟环境</span></span><br><span class="line">vim ~/.bash_profile</span><br><span class="line">pipenv shell</span><br><span class="line"></span><br><span class="line"><span class="comment"># 虚拟环境会在当前用户家目录自动创建</span></span><br><span class="line">test101@JQ/root<span class="comment">#su - wangao</span></span><br><span class="line">Spawning environment shell (/bin/bash). Use <span class="string">'exit'</span> to leave.</span><br><span class="line">test101@JQ/home/wangao$. /home/wangao/.<span class="built_in">local</span>/share/virtualenvs/wangao-iOSX51hl/bin/activate</span><br><span class="line"></span><br><span class="line"><span class="comment"># 沿用pip创建requirements.txt，该方法相对Pipfile来说不是最佳</span></span><br><span class="line">(wangao-iOSX51hl) test101@JQ/home/wangao/git/ansible<span class="variable">$cat</span> requirements.txt </span><br><span class="line">--index-url=http://172.31.96.201:8081/simple/</span><br><span class="line">--trusted-host=172.31.96.201</span><br><span class="line">ansible</span><br><span class="line">ansible-cmdb</span><br><span class="line">pywinrm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过gitlab同步控制python包环境</span></span><br><span class="line">git checkout develop</span><br><span class="line">git pull origin develop</span><br><span class="line">pip install -r requirements.txt -U</span><br></pre></td></tr></table></figure><h2 id="推荐参考的文章"><a href="#推荐参考的文章" class="headerlink" title="推荐参考的文章"></a>推荐参考的文章</h2><p>Python 2.6 升级至 Python 2.7 的实践心得 - <a href="https://wsgzao.github.io/post/python-2-6-update-to-2-7/">https://wsgzao.github.io/post/python-2-6-update-to-2-7/</a><br>使用pypiserver快速搭建内网离线pypi仓库实践 - <a href="https://wsgzao.github.io/post/pypiserver/">https://wsgzao.github.io/post/pypiserver/</a><br>RHEL7/CentOS7在线和离线安装GitLab配置使用实践 - <a href="https://wsgzao.github.io/post/gitlab/">https://wsgzao.github.io/post/gitlab/</a></p>]]></content>
    
    <summary type="html">
    
      Pipenv 官方推荐的 Python 包管理工具
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
  <entry>
    <title>VMware兼容性检查指北</title>
    <link href="https://wsgzao.github.io/post/vmware-compatibility-guide/"/>
    <id>https://wsgzao.github.io/post/vmware-compatibility-guide/</id>
    <published>2018-04-22T06:59:49.000Z</published>
    <updated>2018-04-23T06:29:52.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本文记录了具体如何从VMware官方网站检查硬件（BIOS/RAID/NIC/HBA）等兼容性信息，提前确认VMware软硬件兼容性结果避免数据中心建设规划时候采坑回退。说一句不相关的想法，整个IT行业从VMware转投OpenStack的进程越来越快，而VMware面对的竞争者会越来越多，Nutanix/OpenStack/Docker等一波接着一波，VMware确实很成熟也很好用，但企业规模不断扩大之后也抵挡不住成本的压力和新技术的降维攻击。</p><blockquote><p>VMware Compatibility Guide</p></blockquote><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><p>2018年04月22日 - 初稿</p><p>阅读原文 - <a href="https://wsgzao.github.io/post/vmware-compatibility-guide/">https://wsgzao.github.io/post/vmware-compatibility-guide/</a></p><p><strong>扩展阅读</strong></p><p>VMware Compatibility Guide - <a href="https://www.vmware.com/resources/compatibility/" target="_blank" rel="noopener">https://www.vmware.com/resources/compatibility/</a></p><hr><h2 id="VMware兼容性检查概述"><a href="#VMware兼容性检查概述" class="headerlink" title="VMware兼容性检查概述"></a>VMware兼容性检查概述</h2><h3 id="VMware-Compatibility-Guide"><a href="#VMware-Compatibility-Guide" class="headerlink" title="VMware Compatibility Guide"></a>VMware Compatibility Guide</h3><p>登录VMware Compatibility Guide网站，输入已知硬件关键字信息如DL980<br><a href="https://www.vmware.com/resources/compatibility/search.php" target="_blank" rel="noopener">https://www.vmware.com/resources/compatibility/search.php</a></p><p>根据型号和CPU判断硬件所支持的版本，以下内容以HP DL980 Gen7为例<br><a href="https://www.vmware.com/resources/compatibility/detail.php?deviceCategory=server&amp;productid=19802&amp;deviceCategory=server&amp;details=1&amp;keyword=dl980&amp;page=1&amp;display_interval=10&amp;sortColumn=Partner&amp;sortOrder=Asc" target="_blank" rel="noopener">https://www.vmware.com/resources/compatibility/detail.php?deviceCategory=server&amp;productid=19802&amp;deviceCategory=server&amp;details=1&amp;keyword=dl980&amp;page=1&amp;display_interval=10&amp;sortColumn=Partner&amp;sortOrder=Asc</a></p><p>根据查询结果我们可以得出这样的结论<br>HP DL980 Gen7支持的最高版本为ESXi 6.0 U3，BIOS版本要求为P66</p><h3 id="VMware-Lifecycle-Product-Matrix"><a href="#VMware-Lifecycle-Product-Matrix" class="headerlink" title="VMware Lifecycle Product Matrix"></a>VMware Lifecycle Product Matrix</h3><p>根据第一步得到了ESXi的版本信息，需要了解VMware当前的生命周期技术支持政策<br><a href="https://www.vmware.com/support/policies/lifecycle.html" target="_blank" rel="noopener">https://www.vmware.com/support/policies/lifecycle.html</a><br><a href="https://www.vmware.com/content/dam/digitalmarketing/vmware/en/pdf/support/product-lifecycle-matrix.pdf" target="_blank" rel="noopener">https://www.vmware.com/content/dam/digitalmarketing/vmware/en/pdf/support/product-lifecycle-matrix.pdf</a></p><h3 id="VMware-Product-Interoperability-Matrices"><a href="#VMware-Product-Interoperability-Matrices" class="headerlink" title="VMware Product Interoperability Matrices"></a>VMware Product Interoperability Matrices</h3><p>将ESXi 6.0 U3作为已知条件，增加你需要部署的组件进一步了解兼容性上的安装建议，比如下面是增加了VMware vCenter Server和VMware Horizon，由这个页面我们可以大致确认组件的安装版本对应关系</p><p><a href="https://www.vmware.com/resources/compatibility/sim/interop_matrix.php" target="_blank" rel="noopener">https://www.vmware.com/resources/compatibility/sim/interop_matrix.php</a></p><p>VMware ESXi 6.0 U3<br>VMware vCenter Server 6.5 U1e or 6.0 U3d<br>VMware Horizon 7.4.</p><h3 id="Firmware"><a href="#Firmware" class="headerlink" title="Firmware"></a>Firmware</h3><blockquote><p>BIOS/RAID/NIC/HBA等信息获取请往下看</p></blockquote><p>Checking your firmware and BIOS levels to ensure compatibility with ESX/ESXi (1037257)<br><a href="https://kb.vmware.com/kb/1037257" target="_blank" rel="noopener">https://kb.vmware.com/kb/1037257</a></p><p>Determining Network/Storage firmware and driver version in ESXi 4.x and later (1027206)<br><a href="https://kb.vmware.com/kb/1027206" target="_blank" rel="noopener">https://kb.vmware.com/kb/1027206</a></p><p>Identifying the firmware of a Qlogic or Emulex FC HBA (1002413)<br><a href="https://kb.vmware.com/kb/1002413" target="_blank" rel="noopener">https://kb.vmware.com/kb/1002413</a></p><h2 id="ESXi兼容性信息收集"><a href="#ESXi兼容性信息收集" class="headerlink" title="ESXi兼容性信息收集"></a>ESXi兼容性信息收集</h2><h3 id="基础配置"><a href="#基础配置" class="headerlink" title="基础配置"></a>基础配置</h3><blockquote><p>开启ESXi Shell和SSH</p></blockquote><ol><li>完成ESXi系统安装</li><li>按<f2> Customize System/Viewlogs</f2></li><li>Troubleshooting Options </li><li>Enable ESXi Shell</li><li>Enable SSH</li></ol><blockquote><p>图形化与命令行切换快捷键</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切换至命令行</span></span><br><span class="line">Alt + F1</span><br><span class="line"><span class="comment"># 切换至图形化</span></span><br><span class="line">Alt + F2</span><br></pre></td></tr></table></figure><h3 id="BIOS"><a href="#BIOS" class="headerlink" title="BIOS"></a>BIOS</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查找BIOS微码和CPU型号</span></span><br><span class="line">smbiosDump | more</span><br><span class="line"></span><br><span class="line">[root@DESK-VIEW1:~] smbiosDump | more</span><br><span class="line">Dumping live SMBIOS data!</span><br><span class="line">  BIOS Info: <span class="comment">#0</span></span><br><span class="line">    Size: 0x00018</span><br><span class="line">    Vendor: <span class="string">"HP"</span></span><br><span class="line">    Version: <span class="string">"P66"</span></span><br><span class="line">    Date: <span class="string">"07/29/2013"</span></span><br><span class="line">    Start Address: 0xf0000</span><br><span class="line">    ROM Size: 8192 kB</span><br><span class="line">    Features: 0x0703000000007dc9da80</span><br><span class="line">      PCI supported</span><br><span class="line">      PnP supported</span><br><span class="line">      BIOS flashable</span><br><span class="line">      BIOS shadowing allowed</span><br><span class="line">      ESCD supported</span><br><span class="line">      CD boot supported</span><br><span class="line">      Selectable boot supported</span><br><span class="line">      EDD spec supported</span><br><span class="line">      360kB Floppy supported</span><br><span class="line">      1.2MB Floppy supported</span><br><span class="line">      720kB Floppy supported</span><br><span class="line">      Print Screen supported</span><br><span class="line">      8042 Keyboard Services supported</span><br><span class="line">      Serial Services supported</span><br><span class="line">      Printer Services supported</span><br><span class="line">      CGA/Mono Video supported</span><br><span class="line">      ACPI supported</span><br><span class="line">      USB Legacy supported</span><br><span class="line">      BIOS Boot Spec supported</span><br><span class="line">      F12 Network boot supported</span><br><span class="line">      Enable targeted content distribution</span><br><span class="line">  System Info: <span class="comment">#256</span></span><br><span class="line">    Manufacturer: <span class="string">"HP"</span></span><br><span class="line">    Product: <span class="string">"ProLiant DL980 G7"</span></span><br><span class="line">    Serial: <span class="string">"SGH3301F85"</span></span><br><span class="line">    UUID: 35384631303333484753413135344d41</span><br><span class="line">    Wake-up: 0x06 (Power Switch)</span><br><span class="line">  Chassis Info: <span class="comment">#768</span></span><br><span class="line">    Manufacturer: <span class="string">"Hewlett-Packard"</span></span><br><span class="line">    Serial: <span class="string">"SGH3301F85"</span></span><br><span class="line">    Type: 0x17 (Rack Mount Chassis)</span><br><span class="line">    Bootup State: 0x03 (Safe)</span><br><span class="line">    Power Supply State: 0x03 (Safe)</span><br><span class="line">    Thermal State: 0x03 (Safe)</span><br><span class="line">    Security Status: 0x02 (Unknown)</span><br><span class="line">  Processor Info: <span class="comment">#1024</span></span><br><span class="line">    Payload length: 0x2a</span><br><span class="line">    Socket: <span class="string">"Proc 1 (Upper Tray, Processor 1)"</span></span><br><span class="line">    Socket Type: 0x1e (Socket LGA1567)</span><br><span class="line">    Socket Status: Populated</span><br><span class="line">    Type: 0x03 (CPU)</span><br><span class="line">    Family: 0xb3 (Xeon)</span><br><span class="line">    Manufacturer: <span class="string">"Intel"</span></span><br><span class="line">    Version: <span class="string">"Intel(R) Xeon(R) CPU E7- 2860 @ 2.27GHz"</span></span><br><span class="line">    Processor ID: 0xbfebfbff000206f2</span><br><span class="line">    Status: 0x01 (Enabled)</span><br><span class="line">    Voltage: 1.4 V</span><br><span class="line">    External Clock: 133 MHz</span><br><span class="line">    Max. Speed: 4800 MHz</span><br><span class="line">    Current Speed: 2267 MHz</span><br><span class="line">    L1 Cache: <span class="comment">#1808</span></span><br><span class="line">    L2 Cache: <span class="comment">#1824</span></span><br><span class="line">    L3 Cache: <span class="comment">#1840</span></span><br><span class="line">    Core Count: <span class="comment">#10</span></span><br><span class="line">    Core Enabled Count: <span class="comment">#10</span></span><br><span class="line">    Thread Count: <span class="comment">#20</span></span><br></pre></td></tr></table></figure><h3 id="RAID"><a href="#RAID" class="headerlink" title="RAID"></a>RAID</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看RAID微码</span></span><br><span class="line">cat /proc/driver/hpsa/hpsa0</span><br><span class="line"></span><br><span class="line">[root@DESK-VIEW1:~] cat /proc/driver/hpsa/hpsa0</span><br><span class="line">hpsa0: HP Smart Array P410i Controller</span><br><span class="line">Board ID: 0x3245103c</span><br><span class="line">Firmware Version: 6.40</span><br><span class="line">Driver Version: HP HPSA Driver (v 6.0.0.44-4vmw)</span><br><span class="line">Driver Build: 01</span><br><span class="line">IRQ: 45</span><br><span class="line">Logical drives: 1</span><br><span class="line">Current Q depth: 0</span><br><span class="line">Current <span class="comment"># commands on controller: 0</span></span><br><span class="line">Max Q depth since init: 0</span><br><span class="line">Max <span class="comment"># commands on controller since init: 6</span></span><br><span class="line">Max SG entries since init: 128</span><br><span class="line">Max Commands supported: 1020</span><br><span class="line">SCSI host number: 12</span><br><span class="line">Offline volume monitoring: Not running</span><br><span class="line"></span><br><span class="line">hpsa0/C12:B0:T0:L1Direct-Access    LOGICAL VOLUME  6.40RAID 1(1+0)</span><br></pre></td></tr></table></figure><h3 id="NIC"><a href="#NIC" class="headerlink" title="NIC"></a>NIC</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看当前网卡列表</span></span><br><span class="line">vmkchdev -l | grep vmnic</span><br><span class="line"><span class="comment"># 查看某块网卡具体信息</span></span><br><span class="line">ethtool -i vmnic0</span><br><span class="line"></span><br><span class="line">[root@DESK-VIEW1:~] vmkchdev -l | grep vmnic</span><br><span class="line">0000:04:00.0 4040:0100 103c:705a vmkernel vmnic0</span><br><span class="line">0000:04:00.1 4040:0100 103c:705a vmkernel vmnic1</span><br><span class="line">0000:04:00.2 4040:0100 103c:705a vmkernel vmnic2</span><br><span class="line">0000:04:00.3 4040:0100 103c:705a vmkernel vmnic3</span><br><span class="line">0000:54:00.0 14e4:1639 103c:7059 vmkernel vmnic4</span><br><span class="line">0000:54:00.1 14e4:1639 103c:7059 vmkernel vmnic5</span><br><span class="line">0000:57:00.0 14e4:1639 103c:7059 vmkernel vmnic6</span><br><span class="line">0000:57:00.1 14e4:1639 103c:7059 vmkernel vmnic7</span><br><span class="line">0000:5d:00.0 14e4:1639 103c:7059 vmkernel vmnic8</span><br><span class="line">0000:5d:00.1 14e4:1639 103c:7059 vmkernel vmnic9</span><br><span class="line">0000:60:00.0 14e4:1639 103c:7059 vmkernel vmnic10</span><br><span class="line">0000:60:00.1 14e4:1639 103c:7059 vmkernel vmnic11</span><br><span class="line">[root@DESK-VIEW1:~] ethtool -i vmnic0</span><br><span class="line">driver: nx_nic</span><br><span class="line">version: 5.0.621</span><br><span class="line">firmware-version: 4.0.593</span><br><span class="line">bus-info: 0000:04:00.0</span><br><span class="line">[root@DESK-VIEW1:~] ethtool -i vmnic11</span><br><span class="line">driver: bnx2</span><br><span class="line">version: 2.2.4f.v60.10</span><br><span class="line">firmware-version: bc 5.2.3</span><br><span class="line">bus-info: 0000:60:00.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用esxcli command可以查看更多设备描述信息</span></span><br><span class="line">esxcli network nic list</span><br><span class="line"><span class="comment"># 使用esxcli 查看更加详细的网卡信息</span></span><br><span class="line">esxcli network nic get -n vmnic0</span><br><span class="line"></span><br><span class="line">[root@DESK-VIEW1:~] esxcli network nic list</span><br><span class="line">Name     PCI Device    Driver  Admin Status  Link Status  Speed  Duplex  MAC Address         MTU  Description                                                                         </span><br><span class="line">-------  ------------  ------  ------------  -----------  -----  ------  -----------------  ----  ------------------------------------------------------------------------------------</span><br><span class="line">vmnic0   0000:04:00.0  nx_nic  Up            Down             0  Full    d8:9d:67:77:99:38  1500  NetXen HP NC375i Integrated Quad Port Multifunction Gigabit Server Adapter          </span><br><span class="line">vmnic1   0000:04:00.1  nx_nic  Up            Down             0  Full    d8:9d:67:77:99:39  1500  NetXen HP NC375i Integrated Quad Port Multifunction Gigabit Server Adapter          </span><br><span class="line">vmnic10  0000:60:00.0  bnx2    Up            Up            1000  Full    10:60:4b:a2:4a:90  1500  QLogic Corporation NC382T PCI Express Dual Port Multifunction Gigabit Server Adapter</span><br><span class="line">vmnic11  0000:60:00.1  bnx2    Up            Up            1000  Full    10:60:4b:a2:4a:92  1500  QLogic Corporation NC382T PCI Express Dual Port Multifunction Gigabit Server Adapter</span><br><span class="line">vmnic2   0000:04:00.2  nx_nic  Up            Down             0  Full    d8:9d:67:77:99:3a  1500  NetXen HP NC375i Integrated Quad Port Multifunction Gigabit Server Adapter          </span><br><span class="line">vmnic3   0000:04:00.3  nx_nic  Up            Down             0  Full    d8:9d:67:77:99:3b  1500  NetXen HP NC375i Integrated Quad Port Multifunction Gigabit Server Adapter          </span><br><span class="line">vmnic4   0000:54:00.0  bnx2    Up            Up            1000  Full    10:60:4b:a2:03:70  1500  QLogic Corporation NC382T PCI Express Dual Port Multifunction Gigabit Server Adapter</span><br><span class="line">vmnic5   0000:54:00.1  bnx2    Up            Up            1000  Full    10:60:4b:a2:03:72  1500  QLogic Corporation NC382T PCI Express Dual Port Multifunction Gigabit Server Adapter</span><br><span class="line">vmnic6   0000:57:00.0  bnx2    Up            Up            1000  Full    10:60:4b:a2:ca:08  1500  QLogic Corporation NC382T PCI Express Dual Port Multifunction Gigabit Server Adapter</span><br><span class="line">vmnic7   0000:57:00.1  bnx2    Up            Up            1000  Full    10:60:4b:a2:ca:0a  1500  QLogic Corporation NC382T PCI Express Dual Port Multifunction Gigabit Server Adapter</span><br><span class="line">vmnic8   0000:5d:00.0  bnx2    Up            Up            1000  Full    10:60:4b:a2:d9:bc  1500  QLogic Corporation NC382T PCI Express Dual Port Multifunction Gigabit Server Adapter</span><br><span class="line">vmnic9   0000:5d:00.1  bnx2    Up            Up            1000  Full    10:60:4b:a2:d9:be  1500  QLogic Corporation NC382T PCI Express Dual Port Multifunction Gigabit Server Adapter</span><br><span class="line">[root@DESK-VIEW1:~] esxcli network nic get -n vmnic11</span><br><span class="line">   Advertised Auto Negotiation: <span class="literal">true</span></span><br><span class="line">   Advertised Link Modes: 10baseT/Half, 10baseT/Full, 100baseT/Half, 100baseT/Full, 1000baseT/Full</span><br><span class="line">   Auto Negotiation: <span class="literal">true</span></span><br><span class="line">   Cable Type: Twisted Pair</span><br><span class="line">   Current Message Level: 0</span><br><span class="line">   Driver Info: </span><br><span class="line">         Bus Info: 0000:60:00.1</span><br><span class="line">         Driver: bnx2</span><br><span class="line">         Firmware Version: bc 5.2.3</span><br><span class="line">         Version: 2.2.4f.v60.10</span><br><span class="line">   Link Detected: <span class="literal">true</span></span><br><span class="line">   Link Status: Up </span><br><span class="line">   Name: vmnic11</span><br><span class="line">   PHYAddress: 1</span><br><span class="line">   Pause Autonegotiate: <span class="literal">true</span></span><br><span class="line">   Pause RX: <span class="literal">true</span></span><br><span class="line">   Pause TX: <span class="literal">true</span></span><br><span class="line">   Supported Ports: TP</span><br><span class="line">   Supports Auto Negotiation: <span class="literal">true</span></span><br><span class="line">   Supports Pause: <span class="literal">true</span></span><br><span class="line">   Supports Wakeon: <span class="literal">true</span></span><br><span class="line">   Transceiver: internal</span><br><span class="line">   Virtual Address: 00:50:56:54:71:e6</span><br><span class="line">   Wakeon: MagicPacket(tm)</span><br></pre></td></tr></table></figure><h3 id="HBA"><a href="#HBA" class="headerlink" title="HBA"></a>HBA</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看HBA卡驱动类型</span></span><br><span class="line">esxcfg-scsidevs -a</span><br><span class="line"><span class="comment"># 查找HBA卡具体驱动程序</span></span><br><span class="line">vmkload_mod -s &lt;HBADriver&gt; | grep Version</span><br><span class="line">vmkload_mod -s qlnativefc | grep Version</span><br><span class="line"><span class="comment"># 查看HBA卡供应商信息，便于之后确认VMware推荐HBA驱动</span></span><br><span class="line">vmkchdev -l | grep vmhba2</span><br><span class="line">000:0b:00.0 1077:2532 103c:3263 vmkernel vmhba2</span><br><span class="line">Vendor ID(VID): 1077</span><br><span class="line">Device ID(DID): 2532</span><br><span class="line">Sub-Vendor ID(SVID): 103c</span><br><span class="line">Sub-Device ID(SDID): 3263</span><br><span class="line"></span><br><span class="line">[root@DESK-VIEW1:~] esxcfg-scsidevs -a</span><br><span class="line">vmhba38 bnx2i             unbound   iscsi.vmhba38                           QLogic NetXtreme II iSCSI Adapter</span><br><span class="line">vmhba39 bnx2i             unbound   iscsi.vmhba39                           QLogic NetXtreme II iSCSI Adapter</span><br><span class="line">vmhba0  ata_piix          link-n/a  sata.vmhba0                             (0000:00:1f.2) Intel Corporation ICH10 4 port SATA IDE Controller</span><br><span class="line">vmhba1  hpsa              link-n/a  sas.500143802597a240                    (0000:03:00.0) Hewlett-Packard Company Smart Array P410i</span><br><span class="line">vmhba2  qlnativefc        link-up   fc.5001438024275201:5001438024275200    (0000:0b:00.0) QLogic Corp ISP2532-based 8Gb Fibre Channel to PCI Express HBA</span><br><span class="line">vmhba3  qlnativefc        link-n/a  fc.5001438024275203:5001438024275202    (0000:0b:00.1) QLogic Corp ISP2532-based 8Gb Fibre Channel to PCI Express HBA</span><br><span class="line">vmhba4  qlnativefc        link-up   fc.5001438024274bc1:5001438024274bc0    (0000:11:00.0) QLogic Corp ISP2532-based 8Gb Fibre Channel to PCI Express HBA</span><br><span class="line">vmhba40 ata_piix          link-n/a  sata.vmhba40                            (0000:00:1f.2) Intel Corporation ICH10 4 port SATA IDE Controller</span><br><span class="line">vmhba5  qlnativefc        link-n/a  fc.5001438024274bc3:5001438024274bc2    (0000:11:00.1) QLogic Corp ISP2532-based 8Gb Fibre Channel to PCI Express HBA</span><br><span class="line">vmhba32 bnx2i             unbound   iscsi.vmhba32                           QLogic NetXtreme II iSCSI Adapter</span><br><span class="line">vmhba33 bnx2i             unbound   iscsi.vmhba33                           QLogic NetXtreme II iSCSI Adapter</span><br><span class="line">vmhba34 bnx2i             unbound   iscsi.vmhba34                           QLogic NetXtreme II iSCSI Adapter</span><br><span class="line">vmhba35 bnx2i             unbound   iscsi.vmhba35                           QLogic NetXtreme II iSCSI Adapter</span><br><span class="line">vmhba36 bnx2i             unbound   iscsi.vmhba36                           QLogic NetXtreme II iSCSI Adapter</span><br><span class="line">vmhba37 bnx2i             unbound   iscsi.vmhba37                           QLogic NetXtreme II iSCSI Adapter</span><br><span class="line">[root@DESK-VIEW1:~] vmkload_mod -s qlnativefc | grep Version</span><br><span class="line"> Version: 2.1.50.0-1vmw.600.3.57.5050593</span><br><span class="line">[root@DESK-VIEW1:~] vmkchdev -l | grep vmhba2</span><br><span class="line">0000:0b:00.0 1077:2532 103c:3263 vmkernel vmhba2</span><br><span class="line"></span><br><span class="line"><span class="comment"># In ESXi 5.5 and later, you do not see native drivers in the /proc nodes. To view native driver information, run the command:</span></span><br><span class="line">/usr/lib/vmware/vmkmgmt_keyval/vmkmgmt_keyval -a</span><br><span class="line"></span><br><span class="line">[root@DESK-VIEW1:~] /usr/lib/vmware/vmkmgmt_keyval/vmkmgmt_keyval -a | more</span><br><span class="line">Listing all system keys:</span><br><span class="line">Key Value Instance:  vmhba3/qlogic</span><br><span class="line">Listing keys:</span><br><span class="line">Name:   ADAPTER</span><br><span class="line">Type:   string</span><br><span class="line">value:  </span><br><span class="line">QLogic PCI to Fibre Channel Host Adapter <span class="keyword">for</span> HPAJ764A:</span><br><span class="line">        FC Firmware version 8.02.00 (90d5), Driver version 2.1.50.0</span><br><span class="line"></span><br><span class="line">Host Device Name vmhba3</span><br><span class="line"></span><br><span class="line">BIOS version 3.13</span><br><span class="line">FCODE version N/A</span><br><span class="line">EFI version 6.15</span><br><span class="line">Flash FW version 5.09.00</span><br><span class="line">ISP: ISP2532, Serial<span class="comment"># MY532922UB</span></span><br><span class="line">MSI-X enabled</span><br><span class="line">Request Queue = 0x430c04a9e000, Response Queue = 0x430c04abf000</span><br><span class="line">Request Queue count = 2048, Response Queue count = 512</span><br><span class="line">Number of response queues <span class="keyword">for</span> CPU affinity operation: 8</span><br><span class="line">CPU Affinity mode enabled</span><br></pre></td></tr></table></figure><h3 id="IO-Devices"><a href="#IO-Devices" class="headerlink" title="IO Devices"></a>IO Devices</h3><p>登录VMware Compatibility Guide选择查找内容中的IO Devices<br><a href="https://www.vmware.com/resources/compatibility/search.php" target="_blank" rel="noopener">https://www.vmware.com/resources/compatibility/search.php</a></p><p>在右侧可以选择匹配VID/DID/SVID/Max SSID信息，输入上述案例中的DL980的HBA卡信息则可以得到更加精确的结果，1077:2532 103c:3263</p><h3 id="ESXi"><a href="#ESXi" class="headerlink" title="ESXi"></a>ESXi</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看ESXi版本</span></span><br><span class="line">[root@DESK-VIEW1:~] vmware -v</span><br><span class="line">VMware ESXi 6.0.0 build-5572656</span><br></pre></td></tr></table></figure><h3 id="vm-support"><a href="#vm-support" class="headerlink" title="vm-support"></a>vm-support</h3><p>如果需要做应急处置，直接使用vm-support命令收集打包交付给VMware工程师分析也会包含上述硬件微码信息</p><p>“vm-support” command in ESX/ESXi to collect diagnostic information (1010705)<br><a href="https://kb.vmware.com/kb/1010705" target="_blank" rel="noopener">https://kb.vmware.com/kb/1010705</a></p>]]></content>
    
    <summary type="html">
    
      VMware Compatibility Guide
    
    </summary>
    
      <category term="学习 | Study" scheme="https://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
    
  </entry>
  
</feed>
